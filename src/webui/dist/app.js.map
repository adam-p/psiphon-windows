{"version":3,"sources":["../js/main.js"],"names":["window","$window","$","LANGUAGE_CHANGE_EVENT","UI_READY_EVENT","CONNECTED_STATE_CHANGE_EVENT","IS_BROWSER","g_initObj","Cookies","uriHash","location","hash","length","JSON","parse","decodeURIComponent","slice","Config","ClientVersion","Language","Banner","InfoURL","NewVersionEmail","NewVersionURL","FaqURL","DataCollectionInfoURL","DpiScaling","Debug","stringify","AvailableEgressRegions","console","log","overallInit","compareIEVersion","remove","attr","on","updateLogoConnectState","e","preventDefault","HtmlCtrlInterface_BannerClick","target","data","switchToTab","updateLinks","nextTickFn","url","replace","text","lastWindowHeight","height","lastWindowWidth","width","smartresize","nextTick","resizeContent","initScrollFix","setTimeout","HtmlCtrlInterface_AppReady","DEBUG_LOG","updateDpiScaling","fillHeight","innerHeight","position","top","footerHeight","outerHeight","parentsUntil","add","siblings","css","trigger","doMatchHeight","doMatchWidth","g_isRTL","outerWidth","dpiScaling","andResizeContent","lastDpiScaling","ltrTransformOrigin","ltrBottomRightTransformOrigin","rtlTransformOrigin","rtlBottomRightTransformOrigin","getIEVersion","transformOrigin","bottomRightTransformOrigin","toFixed","defaultLeftMargin","scaledLeftMargin","each","basePosition","left","Modernizr","mediaqueries","mqRegexp","i","document","styleSheets","ss","test","cssRules","j","rule","media","mediaText__backup","mediaText","mediaTextSplit","split","k","match","pre","num","post","Math","round","join","scroll","scrollTop","newSrc","stoppedSrc","connectedSrc","g_lastState","prop","g_connectingTooLongTimeout","connectionInit","connectToggleSetup","egressRegionComboSetup","hasClass","resizeConnectContent","textfill","maxFontPixels","parentWidth","parent","innerWidth","parseFloat","right","click","buttonConnectState","parents","HtmlCtrlInterface_StartTunnel","HtmlCtrlInterface_StopTunnel","updateConnectToggle","toggleClass","cycleToggleClass","updateConnectAttemptTooLong","clearTimeout","connectAttemptTooLongReset","connectAttemptTooLong","addClass","removeClass","elem","cls","untilStateChangeFrom","cycleToggleClass_inner","html","egressRegionComboSetup_EgressRegionCombo_click","region","refreshSettings","EgressRegion","applySettings","egressRegionComboSetup_EgressRegion_change","$activeItem","$regionItems","$regionItem","eq","hidden","active","find","showSettingsSection","SETTING_CHANGED_EVENT","BEST_REGION_VALUE","settingsInit","Settings","SplitTunnel","DisableTimeouts","VPN","LocalHttpProxyPort","LocalSocksProxyPort","ExposeLocalProxiesToLAN","SkipUpstreamProxy","UpstreamProxyHostname","UpstreamProxyPort","UpstreamProxyUsername","UpstreamProxyPassword","UpstreamProxyDomain","SystrayMinimize","DisableDisallowedTrafficAlert","defaults","onSettingChanged","onSettingsReset","onSettingsApply","onSettingsTabShown","is","onSettingsTabHiding","headingSelector","id","$expandIcon","blur","systrayMinimizeSetup","disableDisallowedTrafficSetup","splitTunnelSetup","disableTimeoutsSetup","egressRegionSetup","localProxySetup","upstreamProxySetup","vpnModeSetup","updateAvailableEgressRegions","one","enableSettingsApplyButton","getSettingsApplyButtonEnabled","$modal","modal","show","backdrop","off","tab","showSettingsErrorModal","settingsValues","getSettingsTabValues","settingsChanged","settingsObjectChanged","newSettings","key","keys","_","enable","$applyButton","currentlyEnabled","removeAttr","drawAttentionToButton","HtmlCtrlInterface_SaveSettings","forceCurrent","fullNewSettings","extend","fillSettingsValues","forceEgressRegionValid","obj","isUndefined","vpnModeUpdate","val","localProxyValid","skipUpstreamProxyUpdate","upstreamProxyValid","ignoreDisabled","valid","egressRegionValid","egressRegion","returnValue","validatePort","showNoticeModal","showSettingErrorSection","change","extraArgs","$currRegionElem","updateErrorAlert","forceValid","regions","getCookie","elemRegion","includes","event","delay","bind","httpPort","socksPort","unique","localProxyPortConflictNotice","noticeType","bodyKey","skip","needHostname","Boolean","needUsername","portOK","skipUpstreamProxy","g_upstreamProxyErrorNoticeTimer","upstreamProxyErrorNotice","errorMessage","vpn","psiCashUIUpdater","intVal","parseInt","isNaN","toString","section","focusElem","onTabShown","collapse","not","scrollTo","duration","offset","onAfter","sendFeedback","smileyResponses","push","title","question","answer","fields","responses","feedback","email","sendDiagnosticInfo","HtmlCtrlInterface_SendFeedback","displayCornerAlert","showDebugLogsClicked","addLog","loadTemplate","timestamp","Date","toLocaleTimeString","message","priority","prepend","priorities","MAX_LOGS_PER_PRIORITY","debugLogHelper","Array","prototype","call","arguments","DEBUG_WARN","warn","consoleLogger","args","msg","isString","logger","apply","fallbackLanguage","prevLang","lang","i18n","init","PSIPHON","LOCALES","switchLocale","populateLocales","g_languageSuccessAlertShown","locale","initial","setLocale","localizeUI","setCookie","rtl","isRTL","ltrClasses","rtlClasses","translation","en","appBackendStringTable","hasOwnProperty","startsWith","t","HtmlCtrlInterface_AddStringTableItem","localePriorityGuide","locales","map","sort","a","b","localePriority_a","indexOf","localePriority_b","$localeListElem","localeCode","localeName","name","append","PsiCashEventTypeEnum","REFRESH","NEW_PURCHASE","INIT_DONE","LOGIN","LOGOUT","PsiCashServerResponseStatus","Invalid","Success","ExistingTransaction","InsufficientBalance","TransactionAmountMismatch","TransactionTypeNotFound","InvalidTokens","InvalidCredentials","BadRequest","ServerError","PsiCashCommandEnum","PURCHASE","PsiCashCommandBase","command","randomID","PsiCashCommandRefresh","reason","create","constructor","PsiCashCommandPurchase","transactionClass","distinguisher","expectedPrice","PsiCashCommandLogin","username","password","PsiCashCommandLogout","PsiCashMessageTypeEnum","PsiCashStore","Datastore","initDone","purchaseInProgress","uiState","logoutExpected","psicashInit","addWindowFocusHandler","HtmlCtrlInterface_PsiCashCommand","$speedLimitCollapser","$speedLimitCollapserTarget","filter","switchToPsiCashTabAndExpandSpeedLimitInfo","psiCashLibraryInitDone","evt","error","recovered","set","psiCashStateInitialized","psicashData","has_tokens","is_account","PSICASH_ENABLED_COOKIE","refreshPsiCashEventHandler","g_PsiCashData","PsiCashUIState","NSF_BALANCE","uiSelector","ENOUGH_BALANCE","BUYING_BOOST","ACTIVE_BOOST","VPN_MODE_DISABLED","ACCOUNT_LOGGED_OUT","timeout","oldPsiCashData","balance","HtmlCtrlInterface_Log","reconnect_required","HtmlCtrlInterface_ReconnectTunnel","veryFirstUpdate","windowHasFocus","state","purchase_prices","pp","price","millisOfSpeedBoostRemaining","purchases","localTimeExpiry","moment","isAfter","diff","max","syncPsiCashUI","PsiCashBalanceChange","baselineRateLimit","threshold","loggedOut","account_username","buy_psi_url","account_signup_url","account_management_url","forgot_account_url","formatPsi","maxEnoughBalance","last","boostRemainingTime","momentLocale","humanize","boostRemainingText","vpnMode","doBalanceChange","newBalance","allDoneDefer","Deferred","previousBalance","startingPoint","balanceDiff","resolve","promise","BILLION","balanceStepTime","balanceStopInterval","maxSteps","trunc","gigaBalanceDiff","balanceStepCount","min","abs","balanceStepSize","extraStepSize","sign","intermediateBalance","$visiblePsiCashInterface","$visibleBalanceElem","tickDefer","deltaDefer","when","always","finalTickStep","balanceTickInterval","clearInterval","setInterval","psiText","$deltaElem","insertAfter","animationCSSEnpoint","animationPromise","animate","easing","queue","_queue","_first","PsiCashBalanceChange_push","first","isNumber","_pop","PsiCashBalanceChange_pop","nextBalance","changePromise","shift","bestLocale","I18n","localeBestMatch","toLowerCase","buySpeedBoostClick","psicashUIWaitState","then","result","refresh","status","Error","buyPsiClick","skipAccountEncouragement","psicashAccountEncouragementLoginClick","psicashAccountLogin","psicashAccountEncouragementBuyClick","nanopsi","currLang","psi","floor","toLocaleString","substring","psicashAccountLoginSubmitHandler","last_tracker_merge","keyCode","psicashAccountLogout","skipConnectedCheck","start","messageSelector","handleDisallowedTrafficNotice","alertDisallowedTraffic","HtmlCtrlInterface_DisallowedTraffic","subscribe","boosting","appearAnimationTime","showingTime","disappearAnimationTime","toggle","complete","callback","$tab","titleKey","levelIcon","techPreambleKey","techInfoString","closedCallback","DEBUG_ASSERT","$elem","matchSelector","matchSelectorsToMaxHeight","$matchSelectorMatches","$elemsToChange","matchHeight","heightDiff","align","matchSelectors","$dataMatchElems","$matchMaxElems","matchSelectorMaxWidth","unshift","getNetWidth","grossWidth","ie7_10Match","ie11Match","edgeMatch","tridentMatch","msieMatch","ieVersion","navigator","userAgent","comparison","targetVersion","acceptNonIE","g_cookies","localVal","localStorage","getItem","value","setItem","HtmlCtrlInterface_SetCookies","context","nextTickFnInner","runner","hexToRgb","hex","shorthandRegex","m","r","g","exec","backgroundColor","backgroundColorRGB","shadowColor","originalBoxShadow","animationTimeSecs","check","isFunction","hasFocus","handler","base64","encode","random","debugInit","HtmlCtrlInterface_SetState","updateStateCombo","HtmlCtrlInterface_AddLog","regionCheckboxes","HtmlCtrlInterface_AddNotice","downstreamBytesPerSecond","Number","HtmlCtrlInterface_UpdateDpiScaling","debugRefreshPsiCashClick","makeTestRefreshMsg","HtmlCtrlInterface_PsiCashMessage","payload","debugPsiCashInitDoneClick","testInitDoneResponse","checked","msg_id","purchase","authorization","toISOString","type","makeTestRefreshPayload","undefined","isAccount","hasTokens","accountUsername","testRefreshResponse","testPurchaseResponse","alert","resp","msgPayload","expiry","serverTimeExpiry","testAccountLoginResponse","testAccountLogoutResponse","PSIPHON_LINK_PREFIX","commandAppOperation","action","arg","isObject","appURL","unescape","encodeURIComponent","jsonArgs","MAX_SAFE_INTEGER","setProxyWarningTemplate","template","g_timeoutSetState","HtmlCtrlInterface_RefreshSettings","settings","success","reconnectRequired","HtmlCtrlInterface_Deeplink","deeplink","lastIndexOf","g_PsiCashCommandIDToResolver","stringtable","item","string","sendStringTableItem","itemObj","suppressHomePage","settingsJSON","feedbackJSON","cookiesJSON","Promise","commandToTestResponse"],"mappings":";;;;AAAA;;;;;;;;;;;;;;;;;;AAmBA,CAAC,UAASA,MAAT,EAAiB;AAChB;AACA;;AAEA;;AAEA,MAAIC,OAAO,GAAGC,CAAC,CAACF,MAAD,CAAf,CANgB,CAQhB;;AACA,MAAIG,qBAAqB,GAAG,iBAA5B,CATgB,CAWhB;;AACA,MAAIC,cAAc,GAAG,UAArB,CAZgB,CAchB;;AACA,MAAIC,4BAA4B,GAAG,wBAAnC,CAfgB,CAiBhB;;AACA,MAAIC,UAAU,GAAG,IAAjB,CAlBgB,CAoBhB;;AACA,MAAIC,SAAS,GAAG;AAAEC,IAAAA,OAAO,EAAE;AAAX,GAAhB;;AACA,GAAC,YAAW;AACV,QAAIC,OAAO,GAAGC,QAAQ,CAACC,IAAvB;;AACA,QAAIF,OAAO,IAAIA,OAAO,CAACG,MAAR,GAAiB,CAAhC,EAAmC;AACjCL,MAAAA,SAAS,GAAGM,IAAI,CAACC,KAAL,CAAWC,kBAAkB,CAACN,OAAO,CAACO,KAAR,CAAc,CAAd,CAAD,CAA7B,CAAZ;AACAV,MAAAA,UAAU,GAAG,KAAb;AACD,KALS,CAOV;;;AACA,QAAIA,UAAJ,EAAgB;AACdC,MAAAA,SAAS,GAAGA,SAAS,IAAI,EAAzB;AACAA,MAAAA,SAAS,CAACU,MAAV,GAAmBV,SAAS,CAACU,MAAV,IAAoB,EAAvC;AACAV,MAAAA,SAAS,CAACU,MAAV,CAAiBC,aAAjB,GAAiCX,SAAS,CAACU,MAAV,CAAiBC,aAAjB,IAAkC,IAAnE;AACAX,MAAAA,SAAS,CAACU,MAAV,CAAiBE,QAAjB,GAA4BZ,SAAS,CAACU,MAAV,CAAiBE,QAAjB,IAA6B,IAAzD;AACAZ,MAAAA,SAAS,CAACU,MAAV,CAAiBG,MAAjB,GAA0Bb,SAAS,CAACU,MAAV,CAAiBG,MAAjB,IAA2B,YAArD;AACAb,MAAAA,SAAS,CAACU,MAAV,CAAiBI,OAAjB,GACEd,SAAS,CAACU,MAAV,CAAiBI,OAAjB,IAA4B,gDAD9B;AAEAd,MAAAA,SAAS,CAACU,MAAV,CAAiBK,eAAjB,GACEf,SAAS,CAACU,MAAV,CAAiBK,eAAjB,IAAoC,qCADtC;AAEAf,MAAAA,SAAS,CAACU,MAAV,CAAiBM,aAAjB,GACEhB,SAAS,CAACU,MAAV,CAAiBM,aAAjB,IAAkC,mEADpC;AAEAhB,MAAAA,SAAS,CAACU,MAAV,CAAiBO,MAAjB,GAA0BjB,SAAS,CAACU,MAAV,CAAiBO,MAAjB,IAA2B,gDAArD;AACAjB,MAAAA,SAAS,CAACU,MAAV,CAAiBQ,qBAAjB,GACElB,SAAS,CAACU,MAAV,CAAiBQ,qBAAjB,IAA0C,yFAD5C;AAEAlB,MAAAA,SAAS,CAACU,MAAV,CAAiBS,UAAjB,GAA8B,GAA9B;AACAnB,MAAAA,SAAS,CAACU,MAAV,CAAiBU,KAAjB,GAAyBpB,SAAS,CAACU,MAAV,CAAiBU,KAAjB,IAA0B,IAAnD;AAEApB,MAAAA,SAAS,CAACC,OAAV,GAAoBK,IAAI,CAACe,SAAL,CAAe;AACjCC,QAAAA,sBAAsB,EAAE,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,EAAyB,IAAzB;AADS,OAAf,CAApB;AAIAC,MAAAA,OAAO,CAACC,GAAR,CAAYxB,SAAZ;AACD;AACF,GAhCD;;AAkCAL,EAAAA,CAAC,CAAC,SAAS8B,WAAT,GAAuB;AACvB;AACA,QAAIC,gBAAgB,CAAC,KAAD,EAAQ,CAAR,EAAW,KAAX,CAApB,EAAuC;AACrC/B,MAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBgC,MAAhB;AACD,KAJsB,CAMvB;;;AACAhC,IAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBiC,IAAhB,CAAqB,MAArB,EAA6B5B,SAAS,CAACU,MAAV,CAAiBI,OAA9C,EAAuDc,IAAvD,CAA4D,OAA5D,EAAqE5B,SAAS,CAACU,MAAV,CAAiBI,OAAtF,EAPuB,CASvB;;AACApB,IAAAA,OAAO,CAACmC,EAAR,CAAW/B,4BAAX,EAAyCgC,sBAAzC;AACAA,IAAAA,sBAAsB,GAXC,CAavB;;AACAnC,IAAAA,CAAC,CAAC,aAAD,CAAD,CAAiBiC,IAAjB,CAAsB,KAAtB,EAA6B5B,SAAS,CAACU,MAAV,CAAiBG,MAA9C,EAduB,CAevB;;AACAlB,IAAAA,CAAC,CAAC,WAAD,CAAD,CAAekC,EAAf,CAAkB,OAAlB,EAA2B,UAASE,CAAT,EAAY;AACrCA,MAAAA,CAAC,CAACC,cAAF;AACAC,MAAAA,6BAA6B;AAC9B,KAHD,EAhBuB,CAqBvB;AACA;AACA;;AACAtC,IAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuBkC,EAAvB,CAA0B,OAA1B,EAAmC,UAASE,CAAT,EAAY;AAC7CA,MAAAA,CAAC,CAACC,cAAF;AACA,UAAME,MAAM,GAAGvC,CAAC,CAAC,IAAD,CAAD,CAAQwC,IAAR,CAAa,YAAb,CAAf;AACAC,MAAAA,WAAW,CAACF,MAAD,EAAS,IAAT,CAAX;AACD,KAJD,EAxBuB,CA8BvB;AACA;;AACA,QAAMG,WAAW,GAAGC,UAAU,CAAC,SAASD,WAAT,GAAuB;AACpD;AAEA,UAAIE,GAAG,GAAGvC,SAAS,CAACU,MAAV,CAAiBI,OAAjB,CAAyB0B,OAAzB,CAAiC,MAAjC,EAAyC,GAAzC,CAAV;AACA7C,MAAAA,CAAC,CAAC,UAAD,CAAD,CAAciC,IAAd,CAAmB,MAAnB,EAA2BW,GAA3B,EAAgCX,IAAhC,CAAqC,OAArC,EAA8CW,GAA9C;AAEAA,MAAAA,GAAG,GAAGvC,SAAS,CAACU,MAAV,CAAiBM,aAAjB,CAA+BwB,OAA/B,CAAuC,MAAvC,EAA+C,GAA/C,CAAN;AACA7C,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBiC,IAApB,CAAyB,MAAzB,EAAiCW,GAAjC,EAAsCX,IAAtC,CAA2C,OAA3C,EAAoDW,GAApD;AAEAA,MAAAA,GAAG,GAAGvC,SAAS,CAACU,MAAV,CAAiBO,MAAjB,CAAwBuB,OAAxB,CAAgC,MAAhC,EAAwC,GAAxC,CAAN;AACA7C,MAAAA,CAAC,CAAC,SAAD,CAAD,CAAaiC,IAAb,CAAkB,MAAlB,EAA0BW,GAA1B,EAA+BX,IAA/B,CAAoC,OAApC,EAA6CW,GAA7C;AAEAA,MAAAA,GAAG,GAAGvC,SAAS,CAACU,MAAV,CAAiBQ,qBAAjB,CAAuCsB,OAAvC,CAA+C,MAA/C,EAAuD,GAAvD,CAAN;AACA7C,MAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4BiC,IAA5B,CAAiC,MAAjC,EAAyCW,GAAzC,EAA8CX,IAA9C,CAAmD,OAAnD,EAA4DW,GAA5D,EAboD,CAepD;;AACA5C,MAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBiC,IAAtB,CAA2B,MAA3B,EAAmC,YAAY5B,SAAS,CAACU,MAAV,CAAiBK,eAAhE,EACsB0B,IADtB,CAC2BzC,SAAS,CAACU,MAAV,CAAiBK,eAD5C,EAEsBa,IAFtB,CAE2B,OAF3B,EAEoC5B,SAAS,CAACU,MAAV,CAAiBK,eAFrD;AAIApB,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoB8C,IAApB,CAAyBzC,SAAS,CAACU,MAAV,CAAiBC,aAA1C;AACD,KArB6B,CAA9B;AAsBAjB,IAAAA,OAAO,CAACmC,EAAR,CAAWjC,qBAAX,EAAkCyC,WAAlC,EAtDuB,CAuDvB;;AACAA,IAAAA,WAAW,GAxDY,CA0DvB;;AACA,QAAIK,gBAAgB,GAAGhD,OAAO,CAACiD,MAAR,EAAvB;AACA,QAAIC,eAAe,GAAGlD,OAAO,CAACmD,KAAR,EAAtB;AACAnD,IAAAA,OAAO,CAACoD,WAAR,CAAoB,YAAW;AAC7B;AACA;AACA,UAAIJ,gBAAgB,KAAKhD,OAAO,CAACiD,MAAR,EAArB,IACAC,eAAe,KAAKlD,OAAO,CAACmD,KAAR,EADxB,EACyC;AACvCH,QAAAA,gBAAgB,GAAGhD,OAAO,CAACiD,MAAR,EAAnB;AACAC,QAAAA,eAAe,GAAGlD,OAAO,CAACmD,KAAR,EAAlB;AACAE,QAAAA,QAAQ,CAACC,aAAD,CAAR;AACD;AACF,KATD,EA7DuB,CAuEvB;;AACArD,IAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0BkC,EAA1B,CAA6B,OAA7B,EAAsC,YAAW;AAC/CkB,MAAAA,QAAQ,CAACC,aAAD,CAAR;AACD,KAFD,EAxEuB,CA2EvB;;AACAtD,IAAAA,OAAO,CAACmC,EAAR,CAAWjC,qBAAX,EAAkC0C,UAAU,CAACU,aAAD,CAA5C,EA5EuB,CA6EvB;;AACAA,IAAAA,aAAa,GA9EU,CAgFvB;;AACAC,IAAAA,aAAa;AAEbC,IAAAA,UAAU,CAACC,0BAAD,EAA6B,GAA7B,CAAV;AACD,GApFA,CAAD;;AAuFA,WAASH,aAAT,GAAyB;AACvBI,IAAAA,SAAS,CAAC,sBAAD,CAAT,CADuB,CAGvB;;AACAC,IAAAA,gBAAgB,CAACrD,SAAS,CAACU,MAAV,CAAiBS,UAAlB,EAA8B,KAA9B,CAAhB,CAJuB,CAMvB;AACA;AACA;;AACA,QAAImC,UAAU,GAAG5D,OAAO,CAAC6D,WAAR,KAAwB5D,CAAC,CAAC,iBAAD,CAAD,CAAqB6D,QAArB,GAAgCC,GAAzE;AACA,QAAIC,YAAY,GAAG/D,CAAC,CAAC,SAAD,CAAD,CAAagE,WAAb,EAAnB;AACAhE,IAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBgE,WAArB,CAAiC,CAACL,UAAU,GAAGI,YAAd,IAA8B1D,SAAS,CAACU,MAAV,CAAiBS,UAAhF;AACAxB,IAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBiE,YAArB,CAAkC,MAAlC,EAA0CC,GAA1C,CAA8ClE,CAAC,CAAC,iBAAD,CAAD,CAAqBmE,QAArB,EAA9C,EAA+EC,GAA/E,CAAmF,QAAnF,EAA6F,MAA7F,EAZuB,CAcvB;;AACApE,IAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBqE,OAArB,CAA6B,QAA7B;AAEAC,IAAAA,aAAa;AACbC,IAAAA,YAAY,GAlBW,CAoBvB;;AACAvE,IAAAA,CAAC,CAAC,SAAD,CAAD,CAAaoE,GAAb,CAAiBI,OAAO,GAAG,cAAH,GAAoB,aAA5C,EAA2DxE,CAAC,CAAC,kBAAD,CAAD,CAAsByE,UAAtB,EAA3D,EACaL,GADb,CACiB,CAACI,OAAD,GAAW,cAAX,GAA4B,aAD7C,EAC4D,CAD5D;AAED;AAED;;;;;;;;AAMA,WAASd,gBAAT,CAA0BgB,UAA1B,EAA6D;AAAA,QAAvBC,gBAAuB,uEAAN,IAAM;;AAC3D;AACA;AACA;AAEA,QAAIjB,gBAAgB,CAACkB,cAAjB,KAAoCF,UAAxC,EAAoD;AAClD;AACA;AACD;;AACDhB,IAAAA,gBAAgB,CAACkB,cAAjB,GAAkCF,UAAlC;AAEAjB,IAAAA,SAAS,CAAC,uBAAuBiB,UAAxB,CAAT;AACArE,IAAAA,SAAS,CAACU,MAAV,CAAiBS,UAAjB,GAA8BkD,UAA9B;;AAEA,QAAI3C,gBAAgB,CAAC,IAAD,EAAO,CAAP,EAAU,KAAV,CAApB,EAAsC;AACpC;AACA;AACD;;AAED,QAAI8C,kBAAkB,GAAG,OAAzB;AAAA,QACIC,6BAA6B,GAAG,aADpC;AAAA,QAEIC,kBAAkB,GAAG,OAFzB;AAAA,QAGIC,6BAA6B,GAAG,UAHpC;;AAKA,QAAIC,YAAY,OAAO,KAAnB,IAA4BT,OAAhC,EAAyC;AACvC;AACAO,MAAAA,kBAAkB,GAAG,UAArB;AACD;;AAED,QAAIG,eAAe,GAAGV,OAAO,GAAGO,kBAAH,GAAwBF,kBAArD;AAAA,QACIM,0BAA0B,GAAGX,OAAO,GAAGQ,6BAAH,GAAmCF,6BAD3E,CA7B2D,CAgC3D;;AACA9E,IAAAA,CAAC,CAAC,MAAD,CAAD,CAAUoE,GAAV,CAAc;AACZ,8BAAwBc,eADZ;AAEZ,0BAAoBA,eAFR;AAGZ,uBAAiB,WAAWR,UAAX,GAAwB,GAH7B;AAIZ,mBAAa,WAAWA,UAAX,GAAwB,GAJzB;AAKZ,eAAS,CAAC,QAAQA,UAAT,EAAqBU,OAArB,CAA6B,CAA7B,IAAkC,GAL/B;AAMZ,gBAAU,CAAC,QAAQV,UAAT,EAAqBU,OAArB,CAA6B,CAA7B,IAAkC;AANhC,KAAd,EAjC2D,CA0C3D;;AACA,QAAIH,YAAY,OAAO,KAAvB,EAA8B;AAC5B;AACA;AACAjF,MAAAA,CAAC,CAAC,QAAD,CAAD,CAAYoE,GAAZ,CAAgB,aAAhB,EAA+B,EAA/B,EAH4B,CAI5B;;AACA,UAAIiB,iBAAiB,GAAGrF,CAAC,CAAC,QAAD,CAAD,CAAYoE,GAAZ,CAAgB,aAAhB,CAAxB,CAL4B,CAM5B;;AACA,UAAIkB,gBAAgB,GAAG,UAAUD,iBAAV,GAA8B,KAA9B,GAAsCX,UAAtC,GAAmD,GAA1E,CAP4B,CAQ5B;;AACA1E,MAAAA,CAAC,CAAC,QAAD,CAAD,CAAYoE,GAAZ,CAAgB;AACd,gCAAwBc,eADV;AAEd,4BAAoBA,eAFN;AAGd,yBAAiB,WAAWR,UAAX,GAAwB,GAH3B;AAId,qBAAa,WAAWA,UAAX,GAAwB,GAJvB;AAKd,uBAAeY;AALD,OAAhB;AAOD;;AAEDtF,IAAAA,CAAC,CAAC,eAAD,CAAD,CAAmBoE,GAAnB,CAAuB;AACrB,8BAAwBe,0BADH;AAErB,0BAAoBA,0BAFC;AAGrB,uBAAiB,WAAWT,UAAX,GAAwB,GAHpB;AAIrB,mBAAa,WAAWA,UAAX,GAAwB;AAJhB,KAAvB,EA7D2D,CAoE3D;;AACA,QAAIO,YAAY,OAAO,KAAvB,EAA8B;AAC5B;AACAjF,MAAAA,CAAC,CAAC,QAAD,CAAD,CACGoE,GADH,CACO;AAAC,eAAO,EAAR;AAAY,gBAAQ;AAApB,OADP,EAEGmB,IAFH,CAEQ,YAAW;AACf,YAAIC,YAAY,GAAGxF,CAAC,CAAC,IAAD,CAAD,CAAQ6D,QAAR,EAAnB;AACA7D,QAAAA,CAAC,CAAC,IAAD,CAAD,CAAQoE,GAAR,CAAY;AACV,kCAAwBc,eADd;AAEV,8BAAoBA,eAFV;AAGV,2BAAiB,WAAWR,UAAX,GAAwB,GAH/B;AAIV,uBAAa,WAAWA,UAAX,GAAwB;AAJ3B,SAAZ;;AAMA,YAAIc,YAAY,CAAC1B,GAAjB,EAAsB;AACpB9D,UAAAA,CAAC,CAAC,IAAD,CAAD,CAAQoE,GAAR,CAAY;AACV,mBAAQoB,YAAY,CAAC1B,GAAb,GAAmBY,UAApB,GAAkC;AAD/B,WAAZ;AAGD;;AACD,YAAIc,YAAY,CAACC,IAAjB,EAAuB;AACrBzF,UAAAA,CAAC,CAAC,IAAD,CAAD,CAAQoE,GAAR,CAAY;AACV,oBAASoB,YAAY,CAACC,IAAb,GAAoBf,UAArB,GAAmC;AADjC,WAAZ;AAGD;AACF,OApBH;AAqBD,KA5F0D,CA8F3D;AACA;;;AACA,QAAIgB,SAAS,CAACC,YAAd,EAA4B;AAC1B,UAAMC,QAAQ,GAAG,8BAAjB;;AAEA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,QAAQ,CAACC,WAAT,CAAqBrF,MAAzC,EAAiDmF,CAAC,EAAlD,EAAsD;AACpD,YAAMG,EAAE,GAAGF,QAAQ,CAACC,WAAT,CAAqBF,CAArB,CAAX,CADoD,CAGpD;AACA;AACA;;AACA,YAAI;AACF,cAAMI,IAAI,GAAGD,EAAE,CAACE,QAAH,CAAYxF,MAAzB,CADE,CAC+B;AAClC,SAFD,CAGA,OAAO0B,CAAP,EAAU;AACR;AACD;;AAED,aAAK,IAAI+D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,EAAE,CAACE,QAAH,CAAYxF,MAAhC,EAAwCyF,CAAC,EAAzC,EAA6C;AAC3C,cAAMC,IAAI,GAAGJ,EAAE,CAACE,QAAH,CAAYC,CAAZ,CAAb;;AACA,cAAI,CAACC,IAAI,CAACC,KAAV,EAAiB;AACf;AACA;AACD,WAL0C,CAO3C;AACA;;;AACA,cAAI,CAACD,IAAI,CAACC,KAAL,CAAWC,iBAAhB,EAAmC;AACjCF,YAAAA,IAAI,CAACC,KAAL,CAAWC,iBAAX,GAA+BF,IAAI,CAACC,KAAL,CAAWE,SAA1C;AACD;;AAED,cAAMC,cAAc,GAAGJ,IAAI,CAACC,KAAL,CAAWC,iBAAX,CAA6BG,KAA7B,CAAmC,OAAnC,CAAvB;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,cAAc,CAAC9F,MAAnC,EAA2CgG,CAAC,EAA5C,EAAgD;AAC9CF,YAAAA,cAAc,CAACE,CAAD,CAAd,GAAoBF,cAAc,CAACE,CAAD,CAAd,CAAkB7D,OAAlB,CAA0B+C,QAA1B,EAAoC,UAASe,KAAT,EAAgBC,GAAhB,EAAqBC,GAArB,EAA0BC,IAA1B,EAAgC;AACtF,+BAAUF,GAAV,SAAgBG,IAAI,CAACC,KAAL,CAAWH,GAAG,GAAGnC,UAAjB,CAAhB,SAA+CoC,IAA/C;AACD,aAFmB,CAApB;AAGD;;AAEDV,UAAAA,IAAI,CAACC,KAAL,CAAWE,SAAX,GAAuBC,cAAc,CAACS,IAAf,CAAoB,OAApB,CAAvB;AACD;AACF;AACF;;AAED,QAAItC,gBAAgB,KAAK,KAAzB,EAAgC;AAC9B;AACAvB,MAAAA,QAAQ,CAACC,aAAD,CAAR;AACD;AACF,GA3Te,CA6ThB;AACA;;;AACA,WAASC,aAAT,GAAyB;AACvB;AACA;AACAtD,IAAAA,CAAC,CAAC,MAAD,CAAD,CAAUkH,MAAV,CAAiB,YAAW;AAC1BlH,MAAAA,CAAC,CAAC,MAAD,CAAD,CAAUmH,SAAV,CAAoB,CAApB;AACD,KAFD;AAGD,GArUe,CAwUhB;;;AACA,WAAShF,sBAAT,GAAkC;AAChC,QAAIiF,MAAJ,EAAYC,UAAZ,EAAwBC,YAAxB;AACAD,IAAAA,UAAU,GAAGrH,CAAC,CAAC,cAAD,CAAD,CAAkBwC,IAAlB,CAAuB,aAAvB,CAAb;AACA8E,IAAAA,YAAY,GAAGtH,CAAC,CAAC,cAAD,CAAD,CAAkBwC,IAAlB,CAAuB,eAAvB,CAAf;;AAEA,QAAI+E,WAAW,KAAK,WAApB,EAAiC;AAC/BH,MAAAA,MAAM,GAAGE,YAAT;AACD,KAFD,MAGK;AACHF,MAAAA,MAAM,GAAGC,UAAT;AACD;;AAEDrH,IAAAA,CAAC,CAAC,cAAD,CAAD,CAAkBwH,IAAlB,CAAuB,KAAvB,EAA8BJ,MAA9B;AACD;AAGD;AAEA;;;AACA,MAAIG,WAAW,GAAG,SAAlB,CA5VgB,CA8VhB;AACA;;AACA,MAAIE,0BAA0B,GAAG,IAAjC;AAEAzH,EAAAA,CAAC,CAAC,SAAS0H,cAAT,GAA0B;AAC1BC,IAAAA,kBAAkB;AAClBC,IAAAA,sBAAsB,GAFI,CAI1B;;AACA5H,IAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBkC,EAArB,CAAwB,QAAxB,EAAkC,YAAW;AAC3C;AACA,UAAIlC,CAAC,CAAC,kBAAD,CAAD,CAAsB6H,QAAtB,CAA+B,QAA/B,CAAJ,EAA8C;AAC5CzE,QAAAA,QAAQ,CAAC0E,oBAAD,CAAR;AACD;AACF,KALD,EAL0B,CAW1B;;AACA9H,IAAAA,CAAC,CAAC,+CAAD,CAAD,CAAmDkC,EAAnD,CAAsD,OAAtD,EAA+D,YAAW;AACxEkB,MAAAA,QAAQ,CAAC0E,oBAAD,CAAR;AACD,KAFD,EAZ0B,CAe1B;;AACAA,IAAAA,oBAAoB;AACrB,GAjBA,CAAD;;AAmBA,WAASA,oBAAT,GAAgC;AAC9B;AACA9H,IAAAA,CAAC,CAAC,qBAAD,CAAD,CAAyB+H,QAAzB,CAAkC;AAAEC,MAAAA,aAAa,EAAE,CAAC;AAAlB,KAAlC,EAF8B,CAI9B;;AACAhI,IAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBgD,MAArB,CAA4BhD,CAAC,CAAC,qBAAD,CAAD,CAAyBgE,WAAzB,EAA5B,EAL8B,CAO9B;;AACA,QAAIiE,WAAW,GAAGjI,CAAC,CAAC,iBAAD,CAAD,CAAqBkI,MAArB,GAA8BC,UAA9B,MACGC,UAAU,CAACpI,CAAC,CAAC,iBAAD,CAAD,CAAqBkI,MAArB,GAA8B9D,GAA9B,CAAkC,cAAlC,CAAD,CAAV,IAAiE,CADpE,KAEGgE,UAAU,CAACpI,CAAC,CAAC,iBAAD,CAAD,CAAqBkI,MAArB,GAA8B9D,GAA9B,CAAkC,eAAlC,CAAD,CAAV,IAAkE,CAFrE,CAAlB;;AAGA,QAAII,OAAJ,EAAa;AACXxE,MAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBoE,GAArB,CAAyB;AACvBiE,QAAAA,KAAK,EAAG,CAACJ,WAAW,GAAGjI,CAAC,CAAC,iBAAD,CAAD,CAAqByE,UAArB,EAAf,IAAoD,GAArD,GAA0D,IAD1C;AAEvBgB,QAAAA,IAAI,EAAE;AAFiB,OAAzB;AAID,KALD,MAMK;AACHzF,MAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBoE,GAArB,CAAyB;AACvBqB,QAAAA,IAAI,EAAG,CAACwC,WAAW,GAAGjI,CAAC,CAAC,iBAAD,CAAD,CAAqByE,UAArB,EAAf,IAAoD,GAArD,GAA0D,IADzC;AAEvB4D,QAAAA,KAAK,EAAE;AAFgB,OAAzB;AAID;AACF;;AAED,WAASV,kBAAT,GAA8B;AAC5B3H,IAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuBsI,KAAvB,CAA6B,UAASlG,CAAT,EAAY;AACvCA,MAAAA,CAAC,CAACC,cAAF;AACA,UAAIkG,kBAAkB,GAAGvI,CAAC,CAAC,IAAD,CAAD,CAAQwI,OAAR,CAAgB,yBAAhB,EAA2ChG,IAA3C,CAAgD,eAAhD,CAAzB;;AACA,UAAI+F,kBAAkB,KAAK,SAA3B,EAAsC;AACpCE,QAAAA,6BAA6B;AAC9B,OAFD,MAGK,IAAIF,kBAAkB,KAAK,UAAvB,IAAqCA,kBAAkB,KAAK,WAAhE,EAA6E;AAChFG,QAAAA,4BAA4B;AAC7B,OARsC,CASvC;;AACD,KAVD;AAWAC,IAAAA,mBAAmB;AAEnB3I,IAAAA,CAAC,CAAC,qBAAD,CAAD,CAAyB+H,QAAzB,CAAkC;AAAEC,MAAAA,aAAa,EAAE,CAAC;AAAlB,KAAlC,EAd4B,CAgB5B;;AACAjI,IAAAA,OAAO,CAACmC,EAAR,CAAW/B,4BAAX,EAAyCwC,UAAU,CAACgG,mBAAD,CAAnD;AACD,GAhae,CAkahB;;;AACA,WAASA,mBAAT,GAA+B;AAC7B3I,IAAAA,CAAC,CAAC,yBAAD,CAAD,CAA6BuF,IAA7B,CAAkC,YAAW;AAC3CvF,MAAAA,CAAC,CAAC,IAAD,CAAD,CAAQ4I,WAAR,CAAoB,UAApB,EAAgC5I,CAAC,CAAC,IAAD,CAAD,CAAQwC,IAAR,CAAa,eAAb,MAAkC+E,WAAlE;AACD,KAFD;AAIAvH,IAAAA,CAAC,CAAC,oEAAD,CAAD,CAAwEuF,IAAxE,CAA6E,YAAW;AACtFvF,MAAAA,CAAC,CAAC,IAAD,CAAD,CAAQ4I,WAAR,CAAoB,UAApB,EAAgC5I,CAAC,CAAC,IAAD,CAAD,CAAQwC,IAAR,CAAa,eAAb,MAAkC+E,WAAlE;AACD,KAFD;;AAIA,QAAIA,WAAW,KAAK,UAApB,EAAgC;AAC9BsB,MAAAA,gBAAgB,CACd7I,CAAC,CAAC,uIAAD,CADa,EAEd,aAFc,EAGduH,WAHc,CAAhB;AAID,KALD,MAMK,IAAIA,WAAW,KAAK,WAApB,EAAiC,CACpC;AACD,KAFI,MAGA,IAAIA,WAAW,KAAK,UAApB,EAAgC;AACnCsB,MAAAA,gBAAgB,CACd7I,CAAC,CAAC,uIAAD,CADa,EAEd,aAFc,EAGduH,WAHc,CAAhB;AAID,KALI,MAMA,IAAIA,WAAW,KAAK,SAApB,EAA+B,CAClC;AACD;;AAEDuB,IAAAA,2BAA2B;AAC5B,GAhce,CAkchB;AACA;;;AACA,WAASA,2BAAT,GAAuC;AACrC,QAAIvB,WAAW,KAAK,WAAhB,IAA+BA,WAAW,KAAK,SAAnD,EAA8D;AAC5D;AACA,UAAIE,0BAA0B,KAAK,IAAnC,EAAyC;AACvCsB,QAAAA,YAAY,CAACtB,0BAAD,CAAZ;AACAA,QAAAA,0BAA0B,GAAG,IAA7B;AACAuB,QAAAA,0BAA0B;AAC3B;AACF,KAPD,MAQK;AACH;AACA,UAAIvB,0BAA0B,KAAK,IAAnC,EAAyC;AACvCA,QAAAA,0BAA0B,GAAGlE,UAAU,CAAC0F,qBAAD,EAAwB,KAAxB,CAAvC;AACD;AACF;;AAED,aAASA,qBAAT,GAAiC;AAC/BjJ,MAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCkJ,QAAjC,CAA0C,QAA1C;AACAlJ,MAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCmJ,WAAjC,CAA6C,QAA7C;AACD;;AAED,aAASH,0BAAT,GAAsC;AACpChJ,MAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCmJ,WAAjC,CAA6C,QAA7C;AACAnJ,MAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCkJ,QAAjC,CAA0C,QAA1C;AACD;AACF;;AAED,WAASL,gBAAT,CAA0BO,IAA1B,EAAgCC,GAAhC,EAAqCC,oBAArC,EAA2D;AACzDtJ,IAAAA,CAAC,CAACoJ,IAAD,CAAD,CAAQR,WAAR,CAAoBS,GAApB,EAAyB,IAAzB,EAA+B,YAAW;AACxC,UAAI9B,WAAW,KAAK+B,oBAApB,EAA0C;AACxClG,QAAAA,QAAQ,CAAC,SAASmG,sBAAT,GAAkC;AACzCV,UAAAA,gBAAgB,CAACO,IAAD,EAAOC,GAAP,EAAYC,oBAAZ,CAAhB;AACD,SAFO,CAAR;AAGD;AACF,KAND;AAOD;;AAED,WAAS1B,sBAAT,GAAkC;AAChC;AACA;AACA;AACA5H,IAAAA,CAAC,CAAC,uBAAD,CAAD,CAA2BwJ,IAA3B,CAAgCxJ,CAAC,CAAC,iBAAD,CAAD,CAAqBwJ,IAArB,EAAhC,EAJgC,CAMhC;;AACAxJ,IAAAA,CAAC,CAAC,yBAAD,CAAD,CAA6BsI,KAA7B,CAAmC,SAASmB,8CAAT,CAAwDrH,CAAxD,EAA2D;AAC5FA,MAAAA,CAAC,CAACC,cAAF;AACA,UAAMqH,MAAM,GAAG1J,CAAC,CAAC,IAAD,CAAD,CAAQwI,OAAR,CAAgB,eAAhB,EAAiChG,IAAjC,CAAsC,QAAtC,CAAf;;AACA,UAAI,CAACkH,MAAL,EAAa;AACX;AACD;;AAEDC,MAAAA,eAAe,CAAC;AACdC,QAAAA,YAAY,EAAEF;AADA,OAAD,CAAf;AAIAG,MAAAA,aAAa;AACd,KAZD,EAPgC,CAqBhC;;AACA7J,IAAAA,CAAC,CAAC,eAAD,CAAD,CAAmBkC,EAAnB,CAAsB,QAAtB,EAAgC,SAAS4H,0CAAT,GAAsD;AACpF,UAAIC,WAAJ,CADoF,CAEpF;;AACA,UAAMC,YAAY,GAAGhK,CAAC,CAAC,kBAAD,CAAtB;;AACA,WAAK,IAAI6F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmE,YAAY,CAACtJ,MAAjC,EAAyCmF,CAAC,EAA1C,EAA8C;AAC5C,YAAMoE,WAAW,GAAGD,YAAY,CAACE,EAAb,CAAgBrE,CAAhB,CAApB;AACA,YAAM6D,MAAM,GAAGO,WAAW,CAACzH,IAAZ,CAAiB,QAAjB,CAAf;AACA,YAAM2H,MAAM,GAAGF,WAAW,CAACpC,QAAZ,CAAqB,QAArB,CAAf;AACA,YAAMuC,MAAM,GAAGH,WAAW,CAACpC,QAAZ,CAAqB,QAArB,CAAf;AAEA7H,QAAAA,CAAC,CAAC,wCAAwC0J,MAAxC,GAAiD,IAAlD,CAAD,CACGd,WADH,CACe,QADf,EACyBuB,MADzB,EAEGvB,WAFH,CAEe,QAFf,EAEyBwB,MAFzB;;AAIA,YAAIA,MAAJ,EAAY;AACVL,UAAAA,WAAW,GAAGE,WAAd;AACD;AACF,OAjBmF,CAmBpF;;;AACA,UAAIF,WAAJ,EAAiB;AACf;AACA;AACA;AACA/J,QAAAA,CAAC,CAAC,mCAAD,CAAD,CACGiC,IADH,CACQ,WADR,EACqB8H,WAAW,CAACM,IAAZ,CAAiB,aAAjB,EAAgC7H,IAAhC,CAAqC,MAArC,CADrB,EAEGP,IAFH,CAEQ,OAFR,EAEiB8H,WAAW,CAACM,IAAZ,CAAiB,GAAjB,EAAsBpI,IAAtB,CAA2B,OAA3B,CAFjB,EAGGa,IAHH,CAGQiH,WAAW,CAACM,IAAZ,CAAiB,GAAjB,EAAsBvH,IAAtB,EAHR;AAID;AACF,KA7BD,EAtBgC,CAqDhC;;AACA9C,IAAAA,CAAC,CAAC,wCAAD,CAAD,CAA4CsI,KAA5C,CAAkD,UAASlG,CAAT,EAAY;AAC5DA,MAAAA,CAAC,CAACC,cAAF;AACAiI,MAAAA,mBAAmB,CAAC,mCAAD,CAAnB;AACA,aAAO,KAAP;AACD,KAJD;AAKD;AAGD;AAEA;;;AACA,MAAIC,qBAAqB,GAAG,iBAA5B;AAEA,MAAIC,iBAAiB,GAAG,MAAxB;AAEAxK,EAAAA,CAAC,CAAC,SAASyK,YAAT,GAAwB;AACxB;AACA,QAAI,CAACpK,SAAS,CAACqK,QAAf,EACA;AACErK,MAAAA,SAAS,CAACqK,QAAV,GAAqB;AACnBC,QAAAA,WAAW,EAAE,CADM;AAEnBC,QAAAA,eAAe,EAAE,CAFE;AAGnBC,QAAAA,GAAG,EAAE,CAHc;AAInBC,QAAAA,kBAAkB,EAAE,IAJD;AAKnBC,QAAAA,mBAAmB,EAAE,IALF;AAMnBC,QAAAA,uBAAuB,EAAE,CANN;AAOnBC,QAAAA,iBAAiB,EAAE,CAPA;AAQnBC,QAAAA,qBAAqB,EAAE,cARJ;AASnBC,QAAAA,iBAAiB,EAAE,GATA;AAUnBC,QAAAA,qBAAqB,EAAE,MAVJ;AAWnBC,QAAAA,qBAAqB,EAAE,UAXJ;AAYnBC,QAAAA,mBAAmB,EAAE,QAZF;AAanB1B,QAAAA,YAAY,EAAE,IAbK;AAcnB2B,QAAAA,eAAe,EAAE,CAdE;AAenBC,QAAAA,6BAA6B,EAAE,CAfZ;AAgBnBC,QAAAA,QAAQ,EAAE;AACRd,UAAAA,WAAW,EAAE,CADL;AAERC,UAAAA,eAAe,EAAE,CAFT;AAGRC,UAAAA,GAAG,EAAE,CAHG;AAIRC,UAAAA,kBAAkB,EAAE,EAJZ;AAKRC,UAAAA,mBAAmB,EAAE,EALb;AAMRC,UAAAA,uBAAuB,EAAE,CANjB;AAORC,UAAAA,iBAAiB,EAAE,CAPX;AAQRC,UAAAA,qBAAqB,EAAE,EARf;AASRC,UAAAA,iBAAiB,EAAE,EATX;AAURC,UAAAA,qBAAqB,EAAE,EAVf;AAWRC,UAAAA,qBAAqB,EAAE,EAXf;AAYRC,UAAAA,mBAAmB,EAAE,EAZb;AAaR1B,UAAAA,YAAY,EAAE,EAbN;AAcR2B,UAAAA,eAAe,EAAE,CAdT;AAeRC,UAAAA,6BAA6B,EAAE;AAfvB;AAhBS,OAArB;AAkCD,KAtCuB,CAwCxB;;;AACAxL,IAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBkC,EAApB,CAAuBqI,qBAAvB,EAA8CmB,gBAA9C;AACA1L,IAAAA,CAAC,CAAC,mCAAD,CAAD,CAAuCsI,KAAvC,CAA6CqD,eAA7C;AACA3L,IAAAA,CAAC,CAAC,mCAAD,CAAD,CAAuCsI,KAAvC,CAA6CsD,eAA7C;AACA5L,IAAAA,CAAC,CAAC,6CAAD,CAAD,CAAiDkC,EAAjD,CAAoD,OAApD,EAA6D2J,kBAA7D;AACA7L,IAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0BkC,EAA1B,CAA6B,MAA7B,EAAqC,UAASE,CAAT,EAAY;AAC/C,UAAIpC,CAAC,CAAC,eAAD,CAAD,CAAmB6H,QAAnB,CAA4B,QAA5B,KAA4C;AAC5C,OAAC7H,CAAC,CAAC,IAAD,CAAD,CAAQkI,MAAR,GAAiB4D,EAAjB,CAAoB9L,CAAC,CAAC,eAAD,CAArB,CADL,EAC8C;AAAE;AAC9C+L,QAAAA,mBAAmB,CAAC3J,CAAD,CAAnB;AACD;AACF,KALD,EA7CwB,CAoDxB;;AACApC,IAAAA,CAAC,CAAC,oBAAD,CAAD,CACGkC,EADH,CACM,MADN,EACc,YAAW;AACrB,UAAI8J,eAAe,GAAG,8BAA8B,KAAKC,EAAnC,GAAwC,IAA9D;AACAjM,MAAAA,CAAC,CAACgM,eAAD,CAAD,CAAmB9C,QAAnB,CAA4B,oBAA5B;AACA,UAAIgD,WAAW,GAAGlM,CAAC,CAACgM,eAAD,CAAD,CAAmB3B,IAAnB,CAAwB,wBAAxB,CAAlB;AACA6B,MAAAA,WAAW,CAAC/C,WAAZ,CAAwB+C,WAAW,CAAC1J,IAAZ,CAAiB,aAAjB,CAAxB,EACY0G,QADZ,CACqBgD,WAAW,CAAC1J,IAAZ,CAAiB,aAAjB,CADrB,EAJqB,CAOrB;AACA;;AACAxC,MAAAA,CAAC,CAACgM,eAAD,CAAD,CAAmBG,IAAnB;AACD,KAXH,EAYGjK,EAZH,CAYM,MAZN,EAYc,YAAW;AACrB,UAAI8J,eAAe,GAAG,8BAA8B,KAAKC,EAAnC,GAAwC,IAA9D;AACAjM,MAAAA,CAAC,CAACgM,eAAD,CAAD,CAAmB7C,WAAnB,CAA+B,oBAA/B;AACA,UAAI+C,WAAW,GAAGlM,CAAC,CAACgM,eAAD,CAAD,CAAmB3B,IAAnB,CAAwB,wBAAxB,CAAlB;AACA6B,MAAAA,WAAW,CAAC/C,WAAZ,CAAwB+C,WAAW,CAAC1J,IAAZ,CAAiB,aAAjB,CAAxB,EACY0G,QADZ,CACqBgD,WAAW,CAAC1J,IAAZ,CAAiB,aAAjB,CADrB,EAJqB,CAOrB;AACA;;AACAxC,MAAAA,CAAC,CAACgM,eAAD,CAAD,CAAmBG,IAAnB;AACD,KAtBH;AAwBAC,IAAAA,oBAAoB;AACpBC,IAAAA,6BAA6B;AAC7BC,IAAAA,gBAAgB;AAChBC,IAAAA,oBAAoB;AACpBC,IAAAA,iBAAiB;AACjBC,IAAAA,eAAe;AACfC,IAAAA,kBAAkB;AAClBC,IAAAA,YAAY;AAEZC,IAAAA,4BAA4B,CAAC,KAAD,CAA5B,CAtFwB,CAsFa;;AAErC7M,IAAAA,OAAO,CAAC8M,GAAR,CAAY3M,cAAZ,EAA4B,YAAW;AACrC;AACA;AACAyJ,MAAAA,eAAe;AAChB,KAJD;AAKD,GA7FA,CAAD,CA9iBgB,CA6oBhB;AACA;AACA;AAEA;;AACA,WAASkC,kBAAT,GAA8B;AAC5B;AACAiB,IAAAA,yBAAyB,CAAC,KAAD,CAAzB;AACD,GArpBe,CAupBhB;AACA;;;AACA,WAASf,mBAAT,CAA6B3J,CAA7B,EAAgC;AAC9B;AACA;AACA,QAAI2K,6BAA6B,EAAjC,EAAqC;AACnC3K,MAAAA,CAAC,CAACC,cAAF;AAEA,UAAI2K,MAAM,GAAGhN,CAAC,CAAC,iCAAD,CAAd;AAEAgN,MAAAA,MAAM,CAACC,KAAP,CAAa;AACXC,QAAAA,IAAI,EAAE,IADK;AAEXC,QAAAA,QAAQ,EAAE;AAFC,OAAb,EALmC,CAUnC;AACA;;AAEAH,MAAAA,MAAM,CAAC3C,IAAP,CAAY,kBAAZ,EAAgC+C,GAAhC,CAAoC,OAApC,EAA6CP,GAA7C,CAAiD,OAAjD,EAA0D,YAAW;AACnEG,QAAAA,MAAM,CAACC,KAAP,CAAa,MAAb;;AACA,YAAIpD,aAAa,EAAjB,EAAqB;AACnBiD,UAAAA,yBAAyB,CAAC,KAAD,CAAzB;AACA9M,UAAAA,CAAC,CAACoC,CAAC,CAACG,MAAH,CAAD,CAAY8K,GAAZ,CAAgB,MAAhB;AACD,SAHD,MAIK;AACHC,UAAAA,sBAAsB;AACvB;AACF,OATD;AAWAN,MAAAA,MAAM,CAAC3C,IAAP,CAAY,oBAAZ,EAAkC+C,GAAlC,CAAsC,OAAtC,EAA+CP,GAA/C,CAAmD,OAAnD,EAA4D,YAAW;AACrEG,QAAAA,MAAM,CAACC,KAAP,CAAa,MAAb;AACAtD,QAAAA,eAAe,CAACtJ,SAAS,CAACqK,QAAX,CAAf;AACAoC,QAAAA,yBAAyB,CAAC,KAAD,CAAzB;AACA9M,QAAAA,CAAC,CAACoC,CAAC,CAACG,MAAH,CAAD,CAAY8K,GAAZ,CAAgB,MAAhB;AACD,OALD;AAMD;AACF,GA3rBe,CA6rBhB;;;AACA,WAAS3B,gBAAT,CAA0BtJ,CAA1B,EAA6B6J,EAA7B,EAAiC;AAC/BxI,IAAAA,SAAS,CAAC,uBAAuBwI,EAAxB,CAAT;AAEA,QAAIsB,cAAc,GAAGC,oBAAoB,EAAzC;;AAEA,QAAID,cAAc,KAAK,KAAvB,EAA8B;AAC5B;AACAT,MAAAA,yBAAyB,CAAC,KAAD,CAAzB;AACD,KAHD,MAIK;AACH,UAAIW,eAAe,GAAGC,qBAAqB,CAACH,cAAD,CAA3C;AACAT,MAAAA,yBAAyB,CAACW,eAAD,CAAzB;AACD;AACF,GA3sBe,CA6sBhB;;;AACA,WAAS9B,eAAT,CAAyBvJ,CAAzB,EAA4B;AAC1B;AAEAA,IAAAA,CAAC,CAACC,cAAF;AACArC,IAAAA,CAAC,CAAC,IAAD,CAAD,CAAQmM,IAAR;AAEAxC,IAAAA,eAAe,CAACtJ,SAAS,CAACqK,QAAV,CAAmBe,QAApB,EAA8B,KAA9B,CAAf,CAN0B,CAQ1B;AACA;;AACAqB,IAAAA,yBAAyB,CAAC,IAAD,CAAzB;AACD,GAztBe,CA2tBhB;;;AACA,WAASlB,eAAT,CAAyBxJ,CAAzB,EAA4B;AAC1B;AAEAA,IAAAA,CAAC,CAACC,cAAF;AACArC,IAAAA,CAAC,CAAC,IAAD,CAAD,CAAQmM,IAAR;;AAEA,QAAI,CAACY,6BAA6B,EAAlC,EAAsC;AACpC;AACD;;AAED,QAAIlD,aAAa,EAAjB,EAAqB;AACnB;AACAiD,MAAAA,yBAAyB,CAAC,KAAD,CAAzB,CAFmB,CAInB;;AACArK,MAAAA,WAAW,CAAC,iBAAD,CAAX;AACD,KAND,MAOK;AACH6K,MAAAA,sBAAsB;AACvB;AACF,GAhvBe,CAkvBhB;AACA;AACA;AAEA;;;AACA,WAASI,qBAAT,CAA+BC,WAA/B,EAA4C;AAC1C;AACA;AAEA,QAAIC,GAAJ,EAAS/H,CAAT;;AACA,QAAIgI,IAAI,GAAGC,CAAC,CAACD,IAAF,CAAOxN,SAAS,CAACqK,QAAjB,CAAX;;AACA,SAAK7E,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGgI,IAAI,CAACnN,MAArB,EAA6BmF,CAAC,EAA9B,EAAkC;AAChC+H,MAAAA,GAAG,GAAGC,IAAI,CAAChI,CAAD,CAAV;;AACA,UAAI+H,GAAG,KAAK,UAAZ,EAAwB;AACtB;AACA;AACD;;AAED,UAAID,WAAW,CAACC,GAAD,CAAX,KAAqBvN,SAAS,CAACqK,QAAV,CAAmBkD,GAAnB,CAAzB,EAAkD;AAChDnK,QAAAA,SAAS,CAAC,6CAA6CmK,GAA9C,CAAT;AACA,eAAO,IAAP;AACD;AACF;;AAEDnK,IAAAA,SAAS,CAAC,kCAAD,CAAT;AACA,WAAO,KAAP;AACD;;AAED,WAASqJ,yBAAT,CAAmCiB,MAAnC,EAA2C;AACzC,QAAIC,YAAY,GAAGhO,CAAC,CAAC,gCAAD,CAApB;AACA,QAAIiO,gBAAgB,GAAGlB,6BAA6B,EAApD;;AAEA,QAAIgB,MAAM,IAAI,CAACE,gBAAf,EAAiC;AAC/BD,MAAAA,YAAY,CAAC7E,WAAb,CAAyB,UAAzB,EAAqC+E,UAArC,CAAgD,UAAhD;AACAC,MAAAA,qBAAqB,CAACH,YAAD,CAArB;AACD,KAHD,MAIK,IAAI,CAACD,MAAD,IAAWE,gBAAf,EAAiC;AACpCD,MAAAA,YAAY,CAAC9E,QAAb,CAAsB,UAAtB,EAAkCjH,IAAlC,CAAuC,UAAvC,EAAmD,IAAnD;AACD;AACF;;AAED,WAAS8K,6BAAT,GAAyC;AACvC,QAAIiB,YAAY,GAAGhO,CAAC,CAAC,gCAAD,CAApB;AACA,WAAO,CAACgO,YAAY,CAACnG,QAAb,CAAsB,UAAtB,CAAR;AACD,GA9xBe,CAgyBhB;;;AACA,WAASgC,aAAT,GAAyB;AACvB,QAAI0D,cAAc,GAAGC,oBAAoB,EAAzC;;AACA,QAAID,cAAc,KAAK,KAAvB,EAA8B;AAC5B;AACA,aAAO,KAAP;AACD,KALsB,CAOvB;AACA;;;AACAa,IAAAA,8BAA8B,CAACzN,IAAI,CAACe,SAAL,CAAe6L,cAAf,CAAD,CAA9B;AAEA,WAAO,IAAP;AACD,GA7yBe,CA+yBhB;AACA;AACA;AACA;AACA;;;AACA,WAAS5D,eAAT,CAAyBgE,WAAzB,EAAsCU,YAAtC,EAAoD;AAClD,QAAIC,eAAe,GAAGtO,CAAC,CAACuO,MAAF,CAASlO,SAAS,CAACqK,QAAnB,EAA6BiD,WAAW,IAAI,EAA5C,CAAtB;;AAEA,QAAIU,YAAJ,EAAkB;AAChBhO,MAAAA,SAAS,CAACqK,QAAV,GAAqB4D,eAArB;AACD;;AAEDE,IAAAA,kBAAkB,CAACF,eAAD,CAAlB,CAPkD,CASlD;;AACAG,IAAAA,sBAAsB,GAV4B,CAWlD;AACA;AACD,GAj0Be,CAm0BhB;;;AACA,WAASD,kBAAT,CAA4BE,GAA5B,EAAiC;AAC/B;AACA;AACA1O,IAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBoN,GAApB,CAAwB7C,qBAAxB,EAA+CmB,gBAA/C;;AAEA,QAAI,CAACoC,CAAC,CAACa,WAAF,CAAcD,GAAG,CAAC/D,WAAlB,CAAL,EAAqC;AACnC3K,MAAAA,CAAC,CAAC,cAAD,CAAD,CAAkBwH,IAAlB,CAAuB,SAAvB,EAAkC,CAAC,CAACkH,GAAG,CAAC/D,WAAxC;AACD;;AAED,QAAI,CAACmD,CAAC,CAACa,WAAF,CAAcD,GAAG,CAAC9D,eAAlB,CAAL,EAAyC;AACvC5K,MAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBwH,IAAtB,CAA2B,SAA3B,EAAsC,CAAC,CAACkH,GAAG,CAAC9D,eAA5C;AACD;;AAED,QAAI,CAACkD,CAAC,CAACa,WAAF,CAAcD,GAAG,CAAC7D,GAAlB,CAAL,EAA6B;AAC3B7K,MAAAA,CAAC,CAAC,MAAD,CAAD,CAAUwH,IAAV,CAAe,SAAf,EAA0BkH,GAAG,CAAC7D,GAA9B;AACD;;AACD+D,IAAAA,aAAa;;AAEb,QAAI,CAACd,CAAC,CAACa,WAAF,CAAcD,GAAG,CAAC5D,kBAAlB,CAAL,EAA4C;AAC1C9K,MAAAA,CAAC,CAAC,qBAAD,CAAD,CAAyB6O,GAAzB,CAA6BH,GAAG,CAAC5D,kBAAJ,GAAyB,CAAzB,GAA6B4D,GAAG,CAAC5D,kBAAjC,GAAsD,EAAnF;AACD;;AAED,QAAI,CAACgD,CAAC,CAACa,WAAF,CAAcD,GAAG,CAAC3D,mBAAlB,CAAL,EAA6C;AAC3C/K,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0B6O,GAA1B,CAA8BH,GAAG,CAAC3D,mBAAJ,GAA0B,CAA1B,GAA8B2D,GAAG,CAAC3D,mBAAlC,GAAwD,EAAtF;AACD;;AAED+D,IAAAA,eAAe,CAAC,KAAD,CAAf;;AAEA,QAAI,CAAChB,CAAC,CAACa,WAAF,CAAcD,GAAG,CAAC1D,uBAAlB,CAAL,EAAiD;AAC/ChL,MAAAA,CAAC,CAAC,0BAAD,CAAD,CAA8BwH,IAA9B,CAAmC,SAAnC,EAA8C,CAAC,CAACkH,GAAG,CAAC1D,uBAApD;AACD;;AAED,QAAI,CAAC8C,CAAC,CAACa,WAAF,CAAcD,GAAG,CAACxD,qBAAlB,CAAL,EAA+C;AAC7ClL,MAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4B6O,GAA5B,CAAgCH,GAAG,CAACxD,qBAApC;AACD;;AAED,QAAI,CAAC4C,CAAC,CAACa,WAAF,CAAcD,GAAG,CAACvD,iBAAlB,CAAL,EAA2C;AACzCnL,MAAAA,CAAC,CAAC,oBAAD,CAAD,CAAwB6O,GAAxB,CAA4BH,GAAG,CAACvD,iBAAJ,GAAwB,CAAxB,GAA4BuD,GAAG,CAACvD,iBAAhC,GAAoD,EAAhF;AACD;;AAED,QAAI,CAAC2C,CAAC,CAACa,WAAF,CAAcD,GAAG,CAACtD,qBAAlB,CAAL,EAA+C;AAC7CpL,MAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4B6O,GAA5B,CAAgCH,GAAG,CAACtD,qBAApC;AACD;;AAED,QAAI,CAAC0C,CAAC,CAACa,WAAF,CAAcD,GAAG,CAACrD,qBAAlB,CAAL,EAA+C;AAC7CrL,MAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4B6O,GAA5B,CAAgCH,GAAG,CAACrD,qBAApC;AACD;;AAED,QAAI,CAACyC,CAAC,CAACa,WAAF,CAAcD,GAAG,CAACpD,mBAAlB,CAAL,EAA6C;AAC3CtL,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0B6O,GAA1B,CAA8BH,GAAG,CAACpD,mBAAlC;AACD;;AAED,QAAI,CAACwC,CAAC,CAACa,WAAF,CAAcD,GAAG,CAACzD,iBAAlB,CAAL,EAA2C;AACzCjL,MAAAA,CAAC,CAAC,oBAAD,CAAD,CAAwBwH,IAAxB,CAA6B,SAA7B,EAAwCkH,GAAG,CAACzD,iBAA5C;AACD;;AACD8D,IAAAA,uBAAuB;AAEvBC,IAAAA,kBAAkB,CAAC,KAAD,CAAlB;;AAEA,QAAI,CAAClB,CAAC,CAACa,WAAF,CAAcD,GAAG,CAAC9E,YAAlB,CAAL,EAAsC;AACpC,UAAIF,MAAM,GAAGgF,GAAG,CAAC9E,YAAJ,IAAoBY,iBAAjC;AACAxK,MAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCmJ,WAAjC,CAA6C,QAA7C;AACAnJ,MAAAA,CAAC,CAAC,eAAD,CAAD,CAAmBqK,IAAnB,CAAwB,mBAAmBX,MAAnB,GAA4B,MAApD,EAA4DrF,OAA5D,CACE,OADF,EAEE;AAAE4K,QAAAA,cAAc,EAAE;AAAlB,OAFF;AAGD;;AAED,QAAI,CAACnB,CAAC,CAACa,WAAF,CAAcD,GAAG,CAACnD,eAAlB,CAAL,EAAyC;AACvCvL,MAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBwH,IAAtB,CAA2B,SAA3B,EAAsC,CAAC,CAACkH,GAAG,CAACnD,eAA5C;AACD;;AAED,QAAI,CAACuC,CAAC,CAACa,WAAF,CAAcD,GAAG,CAAClD,6BAAlB,CAAL,EAAuD;AACrDxL,MAAAA,CAAC,CAAC,gCAAD,CAAD,CAAoCwH,IAApC,CAAyC,SAAzC,EAAoD,CAAC,CAACkH,GAAG,CAAClD,6BAA1D;AACD,KAzE8B,CA2E/B;;;AACAxL,IAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBkC,EAApB,CAAuBqI,qBAAvB,EAA8CmB,gBAA9C;AACD,GAj5Be,CAm5BhB;AACA;;;AACA,WAAS8B,oBAAT,GAAgC;AAC9B,QAAI0B,KAAK,GAAG,IAAZ;AAEAA,IAAAA,KAAK,GAAGA,KAAK,IAAIC,iBAAiB,CAAC,IAAD,CAAlC;AACAD,IAAAA,KAAK,GAAGA,KAAK,IAAIJ,eAAe,CAAC,IAAD,CAAhC;AACAI,IAAAA,KAAK,GAAGA,KAAK,IAAIF,kBAAkB,CAAC,IAAD,CAAnC;;AAEA,QAAI,CAACE,KAAL,EAAY;AACV,aAAO,KAAP;AACD;;AAED,QAAIE,YAAY,GAAGpP,CAAC,CAAC,yBAAD,CAAD,CAA6BwC,IAA7B,CAAkC,QAAlC,CAAnB;AAEA,QAAI6M,WAAW,GAAG;AAChBxE,MAAAA,GAAG,EAAE7K,CAAC,CAAC,MAAD,CAAD,CAAUwH,IAAV,CAAe,SAAf,IAA4B,CAA5B,GAAgC,CADrB;AAEhBmD,MAAAA,WAAW,EAAE3K,CAAC,CAAC,cAAD,CAAD,CAAkBwH,IAAlB,CAAuB,SAAvB,IAAoC,CAApC,GAAwC,CAFrC;AAGhBoD,MAAAA,eAAe,EAAE5K,CAAC,CAAC,kBAAD,CAAD,CAAsBwH,IAAtB,CAA2B,SAA3B,IAAwC,CAAxC,GAA4C,CAH7C;AAIhBsD,MAAAA,kBAAkB,EAAEwE,YAAY,CAACtP,CAAC,CAAC,qBAAD,CAAD,CAAyB6O,GAAzB,EAAD,CAJhB;AAKhB9D,MAAAA,mBAAmB,EAAEuE,YAAY,CAACtP,CAAC,CAAC,sBAAD,CAAD,CAA0B6O,GAA1B,EAAD,CALjB;AAMhB7D,MAAAA,uBAAuB,EAAEhL,CAAC,CAAC,0BAAD,CAAD,CAA8BwH,IAA9B,CAAmC,SAAnC,IAAgD,CAAhD,GAAoD,CAN7D;AAOhB0D,MAAAA,qBAAqB,EAAElL,CAAC,CAAC,wBAAD,CAAD,CAA4B6O,GAA5B,EAPP;AAQhB1D,MAAAA,iBAAiB,EAAEmE,YAAY,CAACtP,CAAC,CAAC,oBAAD,CAAD,CAAwB6O,GAAxB,EAAD,CARf;AAShBzD,MAAAA,qBAAqB,EAAEpL,CAAC,CAAC,wBAAD,CAAD,CAA4B6O,GAA5B,EATP;AAUhBxD,MAAAA,qBAAqB,EAAErL,CAAC,CAAC,wBAAD,CAAD,CAA4B6O,GAA5B,EAVP;AAWhBvD,MAAAA,mBAAmB,EAAEtL,CAAC,CAAC,sBAAD,CAAD,CAA0B6O,GAA1B,EAXL;AAYhB5D,MAAAA,iBAAiB,EAAEjL,CAAC,CAAC,oBAAD,CAAD,CAAwBwH,IAAxB,CAA6B,SAA7B,IAA0C,CAA1C,GAA8C,CAZjD;AAahBoC,MAAAA,YAAY,EAAEwF,YAAY,KAAK5E,iBAAjB,GAAqC,EAArC,GAA0C4E,YAbxC;AAchB7D,MAAAA,eAAe,EAAEvL,CAAC,CAAC,kBAAD,CAAD,CAAsBwH,IAAtB,CAA2B,SAA3B,IAAwC,CAAxC,GAA4C,CAd7C;AAehBgE,MAAAA,6BAA6B,EAAExL,CAAC,CAAC,gCAAD,CAAD,CAAoCwH,IAApC,CAAyC,SAAzC,IAAsD,CAAtD,GAA0D;AAfzE,KAAlB;AAkBA,WAAO6H,WAAP;AACD;;AAED,WAAS/B,sBAAT,GAAkC;AAChCiC,IAAAA,eAAe,CACb,4BADa,EAEb,2BAFa,EAGb,OAHa,EAIb,IAJa,EAIP,IAJO,EAKb,YAAW;AACTC,MAAAA,uBAAuB;AACxB,KAPY,CAAf;AASD;;AAED,WAASA,uBAAT,GAAmC;AACjClF,IAAAA,mBAAmB,CACjBtK,CAAC,CAAC,sCAAD,CAAD,CAA0CwI,OAA1C,CAAkD,WAAlD,EAA+D0B,EAA/D,CAAkE,CAAlE,CADiB,EAEjBlK,CAAC,CAAC,6BAAD,CAAD,CAAiCkK,EAAjC,CAAoC,CAApC,EAAuC7F,OAAvC,CAA+C,OAA/C,CAFiB,CAAnB;AAGD,GAv8Be,CAy8BhB;AACA;AACA;AAEA;;;AACA,WAAS+H,oBAAT,GAAgC;AAC9BpM,IAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsByP,MAAtB,CAA6B,YAAW;AACtC;AACAzP,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBqE,OAApB,CAA4BkG,qBAA5B,EAAmD,KAAK0B,EAAxD;AACD,KAHD;AAID,GAn9Be,CAq9BhB;AACA;AACA;AAEA;;;AACA,WAASI,6BAAT,GAAyC;AACvCrM,IAAAA,CAAC,CAAC,gCAAD,CAAD,CAAoCyP,MAApC,CAA2C,YAAW;AACpD;AACAzP,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBqE,OAApB,CAA4BkG,qBAA5B,EAAmD,KAAK0B,EAAxD;AACD,KAHD;AAID,GA/9Be,CAi+BhB;AACA;AACA;AAEA;;;AACA,WAASK,gBAAT,GAA4B;AAC1BtM,IAAAA,CAAC,CAAC,cAAD,CAAD,CAAkByP,MAAlB,CAAyB,YAAW;AAClC;AACAzP,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBqE,OAApB,CAA4BkG,qBAA5B,EAAmD,KAAK0B,EAAxD;AACD,KAHD;AAID,GA3+Be,CA6+BhB;AACA;AACA;AAEA;;;AACA,WAASM,oBAAT,GAAgC;AAC9BvM,IAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsByP,MAAtB,CAA6B,YAAW;AACtC;AACAzP,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBqE,OAApB,CAA4BkG,qBAA5B,EAAmD,KAAK0B,EAAxD;AACD,KAHD;AAID,GAv/Be,CAy/BhB;AACA;AACA;AAEA;;;AACA,WAASO,iBAAT,GAA6B;AAC3B;AACAxM,IAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBsI,KAArB,CAA2B,UAASlG,CAAT,EAAYsN,SAAZ,EAAuB;AAChDtN,MAAAA,CAAC,CAACC,cAAF,GADgD,CAGhD;;AACA,UAAIrC,CAAC,CAAC,eAAD,CAAD,CAAmB6H,QAAnB,CAA4B,UAA5B,MACC,CAAC6H,SAAD,IAAc,CAACA,SAAS,CAACT,cAD1B,CAAJ,EAC+C;AAC7CjP,QAAAA,CAAC,CAAC,IAAD,CAAD,CAAQmM,IAAR;AACA;AACD,OAR+C,CAUhD;;;AACA,UAAInM,CAAC,CAAC,IAAD,CAAD,CAAQwI,OAAR,CAAgB,eAAhB,EAAiCX,QAAjC,CAA0C,QAA1C,CAAJ,EAAyD;AACvD;AACD;;AAED7H,MAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCmJ,WAAjC,CAA6C,QAA7C;AACAnJ,MAAAA,CAAC,CAAC,IAAD,CAAD,CAAQwI,OAAR,CAAgB,eAAhB,EAAiCU,QAAjC,CAA0C,QAA1C;AACAiG,MAAAA,iBAAiB,CAAC,KAAD,CAAjB,CAjBgD,CAmBhD;;AACAnP,MAAAA,CAAC,CAAC,eAAD,CAAD,CAAmBqE,OAAnB,CAA2B,QAA3B,EApBgD,CAsBhD;;AACArE,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBqE,OAApB,CAA4BkG,qBAA5B,EAAmD,cAAnD;AACD,KAxBD;AAyBD,GAzhCe,CA2hChB;AACA;;;AACA,WAAS4E,iBAAT;AAA2B;AAAgB;AACzC,QAAIQ,eAAe,GAAG3P,CAAC,CAAC,yBAAD,CAAvB,CADyC,CAGzC;AACA;;AACA,QAAIkP,KAAK,GAAGS,eAAe,CAACjP,MAAhB,GAAyB,CAAzB,IAA8B,CAACiP,eAAe,CAAC9H,QAAhB,CAAyB,QAAzB,CAA3C;AAEA7H,IAAAA,CAAC,CAAC,eAAD,CAAD,CAAmB4I,WAAnB,CAA+B,OAA/B,EAAwC,CAACsG,KAAzC;AACAlP,IAAAA,CAAC,CAAC,6DAAD,CAAD,CAAiE4I,WAAjE,CAA6E,QAA7E,EAAuFsG,KAAvF;AAEAU,IAAAA,gBAAgB;AAChB,WAAOV,KAAP;AACD,GAziCe,CA2iChB;AACA;AACA;AACA;;;AACA,WAAST,sBAAT,GAAkC;AAChC,QAAIU,iBAAiB,EAArB,EAAyB;AACvB;AACA;AACD,KAJ+B,CAMhC;;;AACAI,IAAAA,eAAe,CACb,0CADa,EAEb,8CAFa,EAGb,SAHa,EAIb,IAJa,EAIP,IAJO,EAID,IAJC,CAAf;AAMAjF,IAAAA,mBAAmB,CAAC,mCAAD,CAAnB;AACD,GA7jCe,CA+jChB;AACA;AACA;;;AACA,WAASsC,4BAAT,CAAsCiD,UAAtC,EAAkD;AAChD,QAAIC,OAAO,GAAGC,SAAS,CAAC,wBAAD,CAAvB,CADgD,CAEhD;;AACAD,IAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AAEA9P,IAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBuF,IAAtB,CAA2B,YAAW;AACpC,UAAIyK,UAAU,GAAGhQ,CAAC,CAAC,IAAD,CAAD,CAAQwC,IAAR,CAAa,QAAb,CAAjB,CADoC,CAGpC;;AACA,UAAI,CAACwN,UAAL,EAAiB;AACf;AACD;;AAED,UAAIlC,CAAC,CAACmC,QAAF,CAAWH,OAAX,EAAoBE,UAApB,KAAmCA,UAAU,KAAKxF,iBAAtD,EAAyE;AACvExK,QAAAA,CAAC,CAAC,IAAD,CAAD,CAAQmJ,WAAR,CAAoB,QAApB;AACD,OAFD,MAGK;AACHnJ,QAAAA,CAAC,CAAC,IAAD,CAAD,CAAQkJ,QAAR,CAAiB,QAAjB;AACD;AACF,KAdD;;AAgBA,QAAI2G,UAAJ,EAAgB;AACdpB,MAAAA,sBAAsB;AACvB;;AAEDzO,IAAAA,CAAC,CAAC,eAAD,CAAD,CAAmBqE,OAAnB,CAA2B,QAA3B;AACD,GA5lCe,CA8lChB;AACA;AACA;AAEA;;;AACA,WAASoI,eAAT,GAA2B;AACzB;AACAzM,IAAAA,CAAC,CAAC,2CAAD,CAAD,CAA+CkC,EAA/C,CACI,oCADJ,EAEI,UAASgO,KAAT,EAAgB;AACd;AACA;AACA;AACApC,MAAAA,CAAC,CAACqC,KAAF,CAAQrC,CAAC,CAACsC,IAAF,CAAO,YAAW;AACxB;AACApQ,QAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBqE,OAApB,CAA4BkG,qBAA5B,EAAmD,KAAK0B,EAAxD,EAFwB,CAIxB;;AACA6C,QAAAA,eAAe,CAAC,KAAD,CAAf;AACD,OANO,EAML,IANK,EAMCoB,KAND,CAAR,EAMiB,GANjB;AAOD,KAbL;AAeAlQ,IAAAA,CAAC,CAAC,0BAAD,CAAD,CAA8ByP,MAA9B,CAAqC,YAAW;AAC9C;AACAzP,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBqE,OAApB,CAA4BkG,qBAA5B,EAAmD,KAAK0B,EAAxD;AACD,KAHD;AAID,GAxnCe,CA0nChB;AACA;;;AACA,WAAS6C,eAAT;AAAyB;AAAgB;AACvC;AAEA,QAAIuB,QAAQ,GAAGf,YAAY,CAACtP,CAAC,CAAC,qBAAD,CAAD,CAAyB6O,GAAzB,EAAD,CAA3B;AACA,QAAIyB,SAAS,GAAGhB,YAAY,CAACtP,CAAC,CAAC,sBAAD,CAAD,CAA0B6O,GAA1B,EAAD,CAA5B;AACA,QAAI0B,MAAM,GAAIF,QAAQ,KAAKC,SAAd,IAA6BD,QAAQ,KAAK,CAA1C,IAAiDC,SAAS,KAAK,CAA5E;;AAEA,QAAID,QAAQ,KAAK,KAAb,IAAsBE,MAA1B,EAAkC;AAChC;AACAvQ,MAAAA,CAAC,CAAC,qBAAD,CAAD,CAAyBwI,OAAzB,CAAiC,gBAAjC,EAAmDW,WAAnD,CAA+D,OAA/D;AACD;;AAED,QAAImH,SAAS,KAAK,KAAd,IAAuBC,MAA3B,EAAmC;AACjC;AACAvQ,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0BwI,OAA1B,CAAkC,gBAAlC,EAAoDW,WAApD,CAAgE,OAAhE;AACD;;AAED,QAAIkH,QAAQ,KAAK,KAAjB,EAAwB;AACtB;AACArQ,MAAAA,CAAC,CAAC,oCAAD,CAAD,CAAwCkJ,QAAxC,CAAiD,QAAjD;AACD;;AAED,QAAIoH,SAAS,KAAK,KAAlB,EAAyB;AACvB;AACAtQ,MAAAA,CAAC,CAAC,qCAAD,CAAD,CAAyCkJ,QAAzC,CAAkD,QAAlD;AACD;;AAED,QAAIqH,MAAJ,EAAY;AACV;AACAvQ,MAAAA,CAAC,CAAC,+BAAD,CAAD,CAAmCkJ,QAAnC,CAA4C,QAA5C;AACD;;AAED,QAAImH,QAAQ,KAAK,KAAjB,EAAwB;AACtB;AACArQ,MAAAA,CAAC,CAAC,qBAAD,CAAD,CAAyBwI,OAAzB,CAAiC,gBAAjC,EAAmDU,QAAnD,CAA4D,OAA5D;AACAlJ,MAAAA,CAAC,CAAC,oCAAD,CAAD,CAAwCmJ,WAAxC,CAAoD,QAApD;AACD;;AAED,QAAImH,SAAS,KAAK,KAAlB,EAAyB;AACvB;AACAtQ,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0BwI,OAA1B,CAAkC,gBAAlC,EAAoDU,QAApD,CAA6D,OAA7D;AACAlJ,MAAAA,CAAC,CAAC,qCAAD,CAAD,CAAyCmJ,WAAzC,CAAqD,QAArD;AACD;;AAED,QAAI,CAACoH,MAAL,EAAa;AACX;AACAvQ,MAAAA,CAAC,CAAC,2CAAD,CAAD,CACGwI,OADH,CACW,gBADX,EAC6BU,QAD7B,CACsC,OADtC,EAFW,CAIX;;AACAlJ,MAAAA,CAAC,CAAC,+BAAD,CAAD,CAAmCmJ,WAAnC,CAA+C,QAA/C;AACD;;AAEDyG,IAAAA,gBAAgB;AAEhB,WAAOS,QAAQ,KAAK,KAAb,IAAsBC,SAAS,KAAK,KAApC,IAA6CC,MAApD;AACD,GAnrCe,CAqrChB;;;AACA,WAASC,4BAAT,CAAsCC,UAAtC,EAAkD;AAChD;AACA,QAAIC,OAAO,GAAGD,UAAU,KAAK,oBAAf,GACA,kDADA,GAEA,mDAFd;AAIAlB,IAAAA,eAAe,CACb,8CADa,EAEbmB,OAFa,EAGb,OAHa,EAIb,IAJa,EAIP,IAJO,EAID,IAJC,CAAf,CANgD,CAYhD;;AACApG,IAAAA,mBAAmB,CACjB,uCADiB,EAEjBmG,UAAU,KAAK,oBAAf,GAAsC,qBAAtC,GAA8D,sBAF7C,CAAnB;AAGD,GAtsCe,CAwsChB;AACA;AACA;AAEA;;;AACA,WAAS/D,kBAAT,GAA8B;AAC5B;AACA1M,IAAAA,CAAC,CAAC,kHAAD,CAAD,CAAsHkC,EAAtH,CACI,oCADJ,EAEI,UAASgO,KAAT,EAAgB;AACd;AACA;AACA;AACApC,MAAAA,CAAC,CAACqC,KAAF,CAAQrC,CAAC,CAACsC,IAAF,CAAO,YAAW;AACxB;AACApQ,QAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBqE,OAApB,CAA4BkG,qBAA5B,EAAmD,KAAK0B,EAAxD,EAFwB,CAIxB;;AACA+C,QAAAA,kBAAkB,CAAC,KAAD,CAAlB;AACD,OANO,EAML,IANK,EAMCkB,KAND,CAAR,EAMiB,GANjB;AAOD,KAbL,EAF4B,CAiB5B;;AACAlQ,IAAAA,CAAC,CAAC,oBAAD,CAAD,CAAwByP,MAAxB,CAA+B,YAAW;AACxC;AACAzP,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBqE,OAApB,CAA4BkG,qBAA5B,EAAmD,KAAK0B,EAAxD;AAEA8C,MAAAA,uBAAuB;AACxB,KALD;AAMD,GAruCe,CAuuChB;AACA;;;AACA,WAASC,kBAAT;AAA4B;AAAgB;AAC1C;AACA;AACA;AACA;AAEA,QAAI2B,IAAI,GAAG3Q,CAAC,CAAC,oBAAD,CAAD,CAAwBwH,IAAxB,CAA6B,SAA7B,CAAX;AAEA,QAAIoJ,YAAY,GACdC,OAAO,CAAC7Q,CAAC,CAAC,oBAAD,CAAD,CAAwB6O,GAAxB,EAAD,CAAP,IACAgC,OAAO,CAAC7Q,CAAC,CAAC,wBAAD,CAAD,CAA4B6O,GAA5B,EAAD,CADP,IAEAgC,OAAO,CAAC7Q,CAAC,CAAC,wBAAD,CAAD,CAA4B6O,GAA5B,EAAD,CAFP,IAGAgC,OAAO,CAAC7Q,CAAC,CAAC,sBAAD,CAAD,CAA0B6O,GAA1B,EAAD,CAJT;AAMA,QAAIiC,YAAY,GACdD,OAAO,CAAC7Q,CAAC,CAAC,wBAAD,CAAD,CAA4B6O,GAA5B,EAAD,CAAP,IACAgC,OAAO,CAAC7Q,CAAC,CAAC,sBAAD,CAAD,CAA0B6O,GAA1B,EAAD,CAFT;AAIA,QAAIK,KAAK,GAAG,IAAZ;AAEA,QAAI6B,MAAM,GAAGzB,YAAY,CAACtP,CAAC,CAAC,oBAAD,CAAD,CAAwB6O,GAAxB,EAAD,CAAZ,KAAgD,KAA7D;;AACA,QAAI8B,IAAI,IAAII,MAAZ,EAAoB;AAClB;AACA/Q,MAAAA,CAAC,CAAC,mCAAD,CAAD,CAAuCkJ,QAAvC,CAAgD,QAAhD,EACGV,OADH,CACW,gBADX,EAC6BW,WAD7B,CACyC,OADzC;AAED,KAJD,MAIO;AACL+F,MAAAA,KAAK,GAAG,KAAR,CADK,CAEL;;AACAlP,MAAAA,CAAC,CAAC,mCAAD,CAAD,CAAuCmJ,WAAvC,CAAmD,QAAnD,EACGX,OADH,CACW,gBADX,EAC6BU,QAD7B,CACsC,OADtC;AAED;;AAED,QAAIyH,IAAI,IAAI,CAACC,YAAT,IAAyBC,OAAO,CAAC7Q,CAAC,CAAC,wBAAD,CAAD,CAA4B6O,GAA5B,EAAD,CAApC,EAAyE;AACvE;AACA7O,MAAAA,CAAC,CAAC,wCAAD,CAAD,CAA4CkJ,QAA5C,CAAqD,QAArD,EAFuE,CAGvE;;AACAlJ,MAAAA,CAAC,CAAC,wBAAD,CAAD,CACGwI,OADH,CACW,gBADX,EAC6BW,WAD7B,CACyC,OADzC;AAED,KAND,MAOK;AACH+F,MAAAA,KAAK,GAAG,KAAR,CADG,CAEH;;AACAlP,MAAAA,CAAC,CAAC,wCAAD,CAAD,CAA4CmJ,WAA5C,CAAwD,QAAxD,EAHG,CAIH;;AACAnJ,MAAAA,CAAC,CAAC,wBAAD,CAAD,CACGwI,OADH,CACW,gBADX,EAC6BU,QAD7B,CACsC,OADtC;AAED;;AAED,QAAIyH,IAAI,IAAI,CAACG,YAAT,IAAyBD,OAAO,CAAC7Q,CAAC,CAAC,wBAAD,CAAD,CAA4B6O,GAA5B,EAAD,CAApC,EAAyE;AACvE;AACA7O,MAAAA,CAAC,CAAC,wCAAD,CAAD,CAA4CkJ,QAA5C,CAAqD,QAArD,EAFuE,CAGvE;;AACAlJ,MAAAA,CAAC,CAAC,wBAAD,CAAD,CACGwI,OADH,CACW,gBADX,EAC6BW,WAD7B,CACyC,OADzC;AAED,KAND,MAOK;AACH+F,MAAAA,KAAK,GAAG,KAAR,CADG,CAEH;;AACAlP,MAAAA,CAAC,CAAC,wCAAD,CAAD,CAA4CmJ,WAA5C,CAAwD,QAAxD,EAHG,CAIH;;AACAnJ,MAAAA,CAAC,CAAC,wBAAD,CAAD,CACGwI,OADH,CACW,gBADX,EAC6BU,QAD7B,CACsC,OADtC;AAED;;AAED0G,IAAAA,gBAAgB;AAEhB,WAAOV,KAAP;AACD,GA5yCe,CA8yChB;AACA;;;AACA,WAASH,uBAAT,GAAmC;AACjC,QAAIiC,iBAAiB,GAAGhR,CAAC,CAAC,oBAAD,CAAD,CAAwBwH,IAAxB,CAA6B,SAA7B,CAAxB;AACAxH,IAAAA,CAAC,CAAC,4CAAD,CAAD,CAAgDwH,IAAhD,CAAqD,UAArD,EAAiEwJ,iBAAjE;AACAhR,IAAAA,CAAC,CAAC,sCAAD,CAAD,CAA0C4I,WAA1C,CAAsD,eAAtD,EAAuEoI,iBAAvE;AACD,GApzCe,CAszChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,MAAIC,+BAA+B,GAAG,IAAtC,CAh0CgB,CAk0ChB;;AACAlR,EAAAA,OAAO,CAACmC,EAAR,CAAW/B,4BAAX,EAAyC,YAAW;AAClD,QAAI8Q,+BAAJ,EAAqC;AACnClI,MAAAA,YAAY,CAACkI,+BAAD,CAAZ;AACAA,MAAAA,+BAA+B,GAAG,IAAlC;AACD;AACF,GALD;;AAOA,WAASC,wBAAT,CAAkCC,YAAlC,EAAgD;AAC9C,QAAIF,+BAAJ,EAAqC;AACnC;AACA;AACD,KAJ6C,CAM9C;AACA;;;AACAA,IAAAA,+BAA+B,GAAG1N,UAAU,CAAC,YAAW;AACtD;AACA;AACA;AACA;AACA;AACA,UAAIgE,WAAW,KAAK,WAApB,EAAiC;AAC/B,YAAI0J,+BAAJ,EAAqC;AACnCA,UAAAA,+BAA+B,GAAG,IAAlC;AACD;;AACD;AACD,OAXqD,CAatD;AACA;AACA;;;AACA,UAAIP,OAAO,GAAG,kDAAd;;AACA,UAAIrQ,SAAS,CAACqK,QAAV,CAAmBQ,qBAAvB,EAA8C;AAC5CwF,QAAAA,OAAO,GAAG,qDAAV;AACD;;AAEDnB,MAAAA,eAAe,CACb,2CADa,EAEbmB,OAFa,EAGb,OAHa,EAIb,oCAJa,EAKbS,YALa,EAMb,YAAW;AACTnR,QAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4BqE,OAA5B,CAAoC,OAApC;AACD,OARY,CAAf,CArBsD,CA+BtD;;AACAiG,MAAAA,mBAAmB,CAAC,oCAAD,CAAnB,CAhCsD,CAkCtD;AACA;AACA;AACD,KArC2C,EAqCzC,KArCyC,CAA5C;AAsCD,GAx3Ce,CA03ChB;AACA;AACA;AAEA;;;AACA,WAASqC,YAAT,GAAwB;AACtB;AACA3M,IAAAA,CAAC,CAAC,MAAD,CAAD,CAAUyP,MAAV,CAAiB,YAAW;AAC1B;AACAzP,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBqE,OAApB,CAA4BkG,qBAA5B,EAAmD,KAAK0B,EAAxD;AAEA2C,MAAAA,aAAa;AACd,KALD;AAMD,GAv4Ce,CAy4ChB;AACA;;;AACA,WAASA,aAAT,GAAyB;AACvB,QAAIwC,GAAG,GAAGpR,CAAC,CAAC,MAAD,CAAD,CAAUwH,IAAV,CAAe,SAAf,CAAV;AACAxH,IAAAA,CAAC,CAAC,sDACA,qFADD,CAAD,CAEKwH,IAFL,CAEU,UAFV,EAEsB4J,GAFtB,EAE2BxI,WAF3B,CAEuC,UAFvC,EAEmDwI,GAFnD;AAGApR,IAAAA,CAAC,CAAC,uBAAD,CAAD,CAA2B4I,WAA3B,CAAuC,QAAvC,EAAiD,CAACwI,GAAlD;AACApR,IAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuB4I,WAAvB,CAAmC,eAAnC,EAAoDwI,GAApD;AACApR,IAAAA,CAAC,CAAC,2BAAD,CAAD,CAA+B4I,WAA/B,CAA2C,QAA3C,EAAqDwI,GAArD,EAPuB,CASvB;;AACAC,IAAAA,gBAAgB;AACjB,GAt5Ce,CAw5ChB;AACA;AACA;AAEA;;;AACA,WAASzB,gBAAT,GAA4B;AAC1B5P,IAAAA,CAAC,CAAC,mCAAD,CAAD,CAAuC4I,WAAvC,CACE,oBADF,EACwB5I,CAAC,CAAC,qCAAD,CAAD,CAAyCU,MAAzC,KAAoD,CAD5E;AAED,GAh6Ce,CAk6ChB;AACA;;;AACA,WAAS4O,YAAT,CAAsBT,GAAtB,EAA2B;AACzB,QAAIA,GAAG,CAACnO,MAAJ,KAAe,CAAnB,EAAsB;AACpB,aAAO,CAAP;AACD;;AAED,QAAM4Q,MAAM,GAAGC,QAAQ,CAAC1C,GAAD,CAAvB;;AACA,QAAI2C,KAAK,CAACF,MAAD,CAAL,IAAiBA,MAAM,GAAG,CAA1B,IAA+BA,MAAM,GAAG,KAA5C,EAAmD;AACjD,aAAO,KAAP;AACD;;AAED,QAAIA,MAAM,CAACG,QAAP,OAAsB5C,GAA1B,EAA+B;AAC7B;AACA;AACA,aAAO,KAAP;AACD;;AAED,WAAOyC,MAAP;AACD,GAr7Ce,CAu7ChB;AACA;;;AACA,WAAShH,mBAAT,CAA6BoH,OAA7B,EAAsCC,SAAtC,EAAiD;AAC/C;AACA,aAASC,UAAT,GAAsB;AACpB;AACArO,MAAAA,UAAU,CAAC,YAAW;AACpB;AACAvD,QAAAA,CAAC,CAAC0R,OAAD,CAAD,CAAWG,QAAX,CAAoB,MAApB,EAFoB,CAIpB;;AACA7R,QAAAA,CAAC,CAAC,kCAAD,CAAD,CAAsC8R,GAAtC,CAA0CJ,OAA1C,EAAmDG,QAAnD,CAA4D,MAA5D,EALoB,CAOpB;;AACAtO,QAAAA,UAAU,CAAC,YAAW;AACpBvD,UAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoB+R,QAApB,CACE/R,CAAC,CAAC0R,OAAD,CAAD,CAAWlJ,OAAX,CAAmB,kBAAnB,EAAuC0B,EAAvC,CAA0C,CAA1C,CADF,EAEE;AACE8H,YAAAA,QAAQ,EAAE,GADZ;AACiB;AACfC,YAAAA,MAAM,EAAE,CAAC,EAFX;AAEiB;AACfC,YAAAA,OAAO,EAAE,mBAAW;AAClB,kBAAIP,SAAJ,EAAe;AACb3R,gBAAAA,CAAC,CAAC2R,SAAD,CAAD,CAAazH,EAAb,CAAgB,CAAhB,EAAmB7F,OAAnB,CAA2B,OAA3B;AACD;AACF;AAPH,WAFF;AAWD,SAZS,EAYP,GAZO,CAAV;AAaD,OArBS,EAqBP,GArBO,CAAV;AAsBD,KA1B8C,CA4B/C;;;AACA5B,IAAAA,WAAW,CAAC,eAAD,EAAkBmP,UAAlB,CAAX;AACD;AAGD;;;AAEA5R,EAAAA,CAAC,CAAC,YAAW;AACX;AACAA,IAAAA,CAAC,CAAC,mCAAD,CAAD,CAAuCsI,KAAvC,CAA6C,UAASlG,CAAT,EAAY;AACvDA,MAAAA,CAAC,CAACC,cAAF;AACArC,MAAAA,CAAC,CAAC,mCAAD,CAAD,CAAuCmJ,WAAvC,CAAmD,UAAnD;AACAnJ,MAAAA,CAAC,CAAC,IAAD,CAAD,CAAQkJ,QAAR,CAAiB,UAAjB;AACD,KAJD;AAMAlJ,IAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBsI,KAAtB,CAA4B,UAASlG,CAAT,EAAY;AACtCA,MAAAA,CAAC,CAACC,cAAF;AACA8P,MAAAA,YAAY;AACb,KAHD,EARW,CAaX;AACD,GAdA,CAAD;;AAgBA,WAASA,YAAT,GAAwB;AACtB,QAAIC,eAAe,GAAG,EAAtB;AACApS,IAAAA,CAAC,CAAC,2BAAD,CAAD,CAA+BuF,IAA/B,CAAoC,YAAW;AAC7C6M,MAAAA,eAAe,CAACC,IAAhB,CAAqB;AACnBC,QAAAA,KAAK,EAAEtS,CAAC,CAAC,IAAD,CAAD,CAAQwC,IAAR,CAAa,uBAAb,CADY;AAEnB+P,QAAAA,QAAQ,EAAEvS,CAAC,CAAC,IAAD,CAAD,CAAQwC,IAAR,CAAa,sBAAb,CAFS;AAGnBgQ,QAAAA,MAAM,EAAExS,CAAC,CAAC,IAAD,CAAD,CAAQwC,IAAR,CAAa,uBAAb;AAHW,OAArB;AAKD,KAND;AAQA,QAAIiQ,MAAM,GAAG;AACXC,MAAAA,SAAS,EAAEN,eADA;AAEXO,MAAAA,QAAQ,EAAE3S,CAAC,CAAC,oBAAD,CAAD,CAAwB6O,GAAxB,EAFC;AAGX+D,MAAAA,KAAK,EAAE5S,CAAC,CAAC,iBAAD,CAAD,CAAqB6O,GAArB,EAHI;AAIXgE,MAAAA,kBAAkB,EAAE,CAAC,CAAC7S,CAAC,CAAC,2BAAD,CAAD,CAA+BwH,IAA/B,CAAoC,SAApC;AAJX,KAAb,CAVsB,CAiBtB;;AACA/E,IAAAA,WAAW,CAAC,iBAAD,CAAX,CAlBsB,CAoBtB;;AACAzC,IAAAA,CAAC,CAAC,2BAAD,CAAD,CAA+BmJ,WAA/B,CAA2C,UAA3C;AACAnJ,IAAAA,CAAC,CAAC,oBAAD,CAAD,CAAwB6O,GAAxB,CAA4B,EAA5B;AACA7O,IAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqB6O,GAArB,CAAyB,EAAzB;AACA7O,IAAAA,CAAC,CAAC,2BAAD,CAAD,CAA+BwH,IAA/B,CAAoC,SAApC,EAA+C,IAA/C,EAxBsB,CA0BtB;;AACAsL,IAAAA,8BAA8B,CAACnS,IAAI,CAACe,SAAL,CAAe+Q,MAAf,CAAD,CAA9B,CA3BsB,CA6BtB;;AACAM,IAAAA,kBAAkB,CAAC/S,CAAC,CAAC,yBAAD,CAAF,CAAlB;AACD;AAGD;;;AAEAA,EAAAA,CAAC,CAAC,YAAW;AACXA,IAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBsI,KAAtB,CAA4B0K,oBAA5B,EADW,CAGX;;AACA,QAAI9F,IAAI,GAAGlN,CAAC,CAAC,kBAAD,CAAD,CAAsBwH,IAAtB,CAA2B,SAA3B,CAAX;AACAxH,IAAAA,CAAC,CAAC,eAAD,CAAD,CACG4I,WADH,CACe,oBADf,EACqCsE,IADrC,EAEGtE,WAFH,CAEe,mBAFf,EAEoC,CAACsE,IAFrC;AAGD,GARA,CAAD;;AAUA,WAAS8F,oBAAT,GAAgC;AAC9B;AACA,QAAI9F,IAAI,GAAGlN,CAAC,CAAC,IAAD,CAAD,CAAQwH,IAAR,CAAa,SAAb,CAAX,CAF8B,CAG9B;;AACAxH,IAAAA,CAAC,CAAC,eAAD,CAAD,CACG4I,WADH,CACe,oBADf,EACqCsE,IADrC,EAEGtE,WAFH,CAEe,mBAFf,EAEoC,CAACsE,IAFrC;AAGD,GAjiDe,CAmiDhB;;;AACA,WAAS+F,MAAT,CAAgBvE,GAAhB,EAAqB;AACnB1O,IAAAA,CAAC,CAAC,4BAAD,CAAD,CAAgCgC,MAAhC;AAEAhC,IAAAA,CAAC,CAAC,eAAD,CAAD,CAAmBkT,YAAnB,CACElT,CAAC,CAAC,eAAD,CADH,EAEE;AACEmT,MAAAA,SAAS,EAAE,IAAIC,IAAJ,GAAWC,kBAAX,EADb;AAEEC,MAAAA,OAAO,EAAE5E,GAAG,CAAC4E,OAFf;AAGEC,MAAAA,QAAQ,EAAE,cAAc7E,GAAG,CAAC6E;AAH9B,KAFF,EAOE;AACEC,MAAAA,OAAO,EAAC;AADV,KAPF,EAHmB,CAcnB;AACA;;AACA,QAAI9E,GAAG,CAAC6E,QAAJ,GAAe,CAAnB,EAAsB;AACpBvT,MAAAA,CAAC,CAAC,uBAAD,CAAD,CAA2BmJ,WAA3B,CAAuC,WAAvC;AACD,KAlBkB,CAoBnB;AACA;;;AACA8J,IAAAA,MAAM,CAACQ,UAAP,GAAoBR,MAAM,CAACQ,UAAP,IAAqB,EAAzC;AACAR,IAAAA,MAAM,CAACQ,UAAP,CAAkB/E,GAAG,CAAC6E,QAAtB,IAAkC,IAAlC,CAvBmB,CAyBnB;AACA;;AACA,QAAIG,qBAAqB,GAAG,GAA5B;;AACA,QAAID,UAAU,GAAG3F,CAAC,CAACD,IAAF,CAAOoF,MAAM,CAACQ,UAAd,CAAjB;;AACA,SAAK,IAAI5N,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4N,UAAU,CAAC/S,MAA/B,EAAuCmF,CAAC,EAAxC,EAA4C;AAC1C7F,MAAAA,CAAC,CAAC,6BAA2ByT,UAAU,CAAC5N,CAAD,CAAtC,CAAD,CAA4C/E,KAA5C,CAAkD4S,qBAAlD,EAAyE1R,MAAzE;AACD;AACF,GApkDe,CAskDhB;;;AACA,WAASyB,SAAT,GAAqB;AACnBkQ,IAAAA,cAAc,CAAC7T,MAAM,CAAC8B,OAAP,CAAeC,GAAhB,EAAqB+R,KAAK,CAACC,SAAN,CAAgB/S,KAAhB,CAAsBgT,IAAtB,CAA2BC,SAA3B,CAArB,CAAd;AACD;;AAED,WAASC,UAAT,GAAsB;AACpBL,IAAAA,cAAc,CAAC7T,MAAM,CAAC8B,OAAP,CAAeqS,IAAhB,EAAsBL,KAAK,CAACC,SAAN,CAAgB/S,KAAhB,CAAsBgT,IAAtB,CAA2BC,SAA3B,CAAtB,CAAd;AACD;;AAED,WAASJ,cAAT,CAAwBO,aAAxB,EAAuCC,IAAvC,EAA6C;AAC3C,QAAI,CAAC9T,SAAS,CAACU,MAAV,CAAiBU,KAAtB,EAA6B;AAC3B;AACD;;AAED,QAAI2S,GAAG,GAAG,QAAV;;AACA,SAAK,IAAIvO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsO,IAAI,CAACzT,MAAzB,EAAiCmF,CAAC,EAAlC,EAAsC;AACpCuO,MAAAA,GAAG,IAAI,GAAP;;AACA,UAAItG,CAAC,CAACuG,QAAF,CAAWF,IAAI,CAACtO,CAAD,CAAf,CAAJ,EAAyB;AACvBuO,QAAAA,GAAG,IAAID,IAAI,CAACtO,CAAD,CAAX;AACD,OAFD,MAGK;AACHuO,QAAAA,GAAG,IAAIzT,IAAI,CAACe,SAAL,CAAeyS,IAAI,CAACtO,CAAD,CAAnB,CAAP;AACD;AACF;;AAEDoN,IAAAA,MAAM,CAAC;AAACM,MAAAA,QAAQ,EAAE,CAAX;AAAcD,MAAAA,OAAO,EAAEc;AAAvB,KAAD,CAAN;AAEA,QAAME,MAAM,GAAIJ,aAAa,IAAIpU,MAAM,CAAC8B,OAAP,CAAeC,GAAhD;;AACA,QAAI;AACF,UAAIzB,UAAJ,EAAgB;AACdkU,QAAAA,MAAM,CAACC,KAAP,CAAa3S,OAAb,EAAsB,CAACwS,GAAD,CAAtB;AACD;AACF,KAJD,CAKA,OAAOhS,CAAP,EAAU;AACR;AACA;AACA;AACAkS,MAAAA,MAAM,CAACF,GAAD,CAAN;AACD;AACF;AAGD;;;AAEApU,EAAAA,CAAC,CAAC,YAAW;AACX,QAAMwU,gBAAgB,GAAG,IAAzB;AAEA,QAAIC,QAAQ,GAAG1E,SAAS,CAAC,UAAD,CAAxB,CAHW,CAIX;;AACA,QAAI0E,QAAJ,EAAc;AACZA,MAAAA,QAAQ,GAAG1E,SAAS,CAAC,UAAD,CAAT,CAAsBlN,OAAtB,CAA8B,GAA9B,EAAmC,GAAnC,EAAwCA,OAAxC,CAAgD,GAAhD,EAAqD,GAArD,CAAX;AACD,KAPU,CASX;;;AACA,QAAM6R,IAAI,GACRD,QAAQ,IACPpU,SAAS,CAACU,MAAV,IAAoBV,SAAS,CAACU,MAAV,CAAiBE,QADtC,IAEAuT,gBAHF;AAKAG,IAAAA,IAAI,CAACC,IAAL,CAAU9U,MAAM,CAAC+U,OAAP,CAAeC,OAAzB,EAAkCN,gBAAlC;AACAO,IAAAA,YAAY,CAACL,IAAD,EAAO,IAAP,CAAZ,CAhBW,CAkBX;;AACAM,IAAAA,eAAe;AAChB,GApBA,CAAD,CAlnDgB,CAwoDhB;;AACA,MAAIC,2BAA2B,GAAG,KAAlC,CAzoDgB,CA2oDhB;;AACA,MAAIzQ,OAAO,GAAG,KAAd;;AAEA,WAASuQ,YAAT,CAAsBG,MAAtB,EAA8BC,OAA9B,EAAuC;AACrCR,IAAAA,IAAI,CAACS,SAAL,CAAeF,MAAf,EADqC,CAGrC;;AACA9R,IAAAA,QAAQ,CAAC,YAAW;AAClBuR,MAAAA,IAAI,CAACU,UAAL,GADkB,CAGlB;AACA;;AACAtV,MAAAA,OAAO,CAACsE,OAAR,CAAgBpE,qBAAhB;;AAEA,UAAI,CAACkV,OAAD,IAAY,CAACF,2BAAjB,EAA8C;AAC5C;AACAA,QAAAA,2BAA2B,GAAG,IAA9B;AACAlC,QAAAA,kBAAkB,CAAC/S,CAAC,CAAC,yBAAD,CAAF,CAAlB;AACD,OAXiB,CAalB;;;AACAsV,MAAAA,SAAS,CAAC,UAAD,EAAaJ,MAAb,CAAT,CAdkB,CAgBlB;;AACA7D,MAAAA,gBAAgB;AACjB,KAlBO,CAAR,CAJqC,CAwBrC;AACA;AACA;;AAEA,QAAMkE,GAAG,GAAGZ,IAAI,CAACa,KAAL,EAAZ;AACAhR,IAAAA,OAAO,GAAG+Q,GAAV,CA7BqC,CA+BrC;AACA;;AACAvV,IAAAA,CAAC,CAAC,yBAAD,CAAD,CAA6BuF,IAA7B,CAAkC,YAAW;AAC3C,UAAIkQ,UAAU,GAAGzV,CAAC,CAAC,IAAD,CAAD,CAAQwC,IAAR,CAAa,kBAAb,CAAjB;AACA,UAAIkT,UAAU,GAAG1V,CAAC,CAAC,IAAD,CAAD,CAAQwC,IAAR,CAAa,kBAAb,CAAjB;;AAEA,UAAIiT,UAAJ,EAAgB;AACdzV,QAAAA,CAAC,CAAC,IAAD,CAAD,CAAQ4I,WAAR,CAAoB6M,UAApB,EAAgC,CAACF,GAAjC;AACD;;AAED,UAAIG,UAAJ,EAAgB;AACd1V,QAAAA,CAAC,CAAC,IAAD,CAAD,CAAQ4I,WAAR,CAAoB8M,UAApB,EAAgCH,GAAhC;AACD;AACF,KAXD,EAjCqC,CA8CrC;AACA;AACA;AAEA;;AACA,QAAII,WAAW,GAAG7V,MAAM,CAAC+U,OAAP,CAAeC,OAAf,CAAuBc,EAAvB,CAA0BD,WAA5C;AACA,QAAIE,qBAAqB,GAAG,EAA5B;;AACA,SAAK,IAAIjI,GAAT,IAAgB+H,WAAhB,EAA6B;AAC3B,UAAI,CAACA,WAAW,CAACG,cAAZ,CAA2BlI,GAA3B,CAAL,EAAsC;AACpC;AACD;;AAED,UAAIE,CAAC,CAACiI,UAAF,CAAanI,GAAb,EAAkB,aAAlB,CAAJ,EAAsC;AACpCiI,QAAAA,qBAAqB,CAACjI,GAAD,CAArB,GAA6B+G,IAAI,CAACqB,CAAL,CAAOpI,GAAP,CAA7B;AACD;AACF;;AAEDqI,IAAAA,oCAAoC,CAACf,MAAD,EAASW,qBAAT,CAApC;AACD;;AAED,WAASb,eAAT,GAA2B;AACzB,QAAIkB,mBAAmB,GAAG,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,EAAyB,OAAzB,EAAkC,OAAlC,CAA1B;AACA,QAAIC,OAAO,GAAGnW,CAAC,CAACoW,GAAF,CAAMtW,MAAM,CAAC+U,OAAP,CAAeC,OAArB,EAA8B,UAASjG,GAAT,EAAcjB,GAAd,EAAmB;AAAE,aAAOA,GAAP;AAAa,KAAhE,CAAd,CAFyB,CAGzB;;AACAuI,IAAAA,OAAO,CAACE,IAAR,CAAa,UAASC,CAAT,EAAYC,CAAZ,EAAe;AAC1B,UAAIC,gBAAgB,GAAGN,mBAAmB,CAACO,OAApB,CAA4BH,CAA5B,CAAvB;AACA,UAAII,gBAAgB,GAAGR,mBAAmB,CAACO,OAApB,CAA4BF,CAA5B,CAAvB;AACAC,MAAAA,gBAAgB,GAAIA,gBAAgB,GAAG,CAApB,GAAyB,GAAzB,GAA+BA,gBAAlD;AACAE,MAAAA,gBAAgB,GAAIA,gBAAgB,GAAG,CAApB,GAAyB,GAAzB,GAA+BA,gBAAlD;;AAEA,UAAIF,gBAAgB,GAAGE,gBAAvB,EAAyC;AACvC,eAAO,CAAC,CAAR;AACD,OAFD,MAGK,IAAIF,gBAAgB,GAAGE,gBAAvB,EAAyC;AAC5C,eAAO,CAAP;AACD,OAFI,MAGA,IAAIJ,CAAC,GAAGC,CAAR,EAAW;AACd,eAAO,CAAC,CAAR;AACD,OAFI,MAGA,IAAID,CAAC,GAAGC,CAAR,EAAW;AACd,eAAO,CAAP;AACD;;AACD,aAAO,CAAP;AACD,KAnBD;AAqBA,QAAII,eAAe,GAAG3W,CAAC,CAAC,gBAAD,CAAvB;;AAEA,SAAK,IAAI6F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsQ,OAAO,CAACzV,MAA5B,EAAoCmF,CAAC,EAArC,EAAyC;AACvC;AACA,UAAI,CAACxF,SAAS,CAACU,MAAV,CAAiBU,KAAlB,IAA2BqM,CAAC,CAACiI,UAAF,CAAaI,OAAO,CAACtQ,CAAD,CAApB,EAAyB,KAAzB,CAA/B,EAAgE;AAC9D;AACD;;AAED8Q,MAAAA,eAAe,CAACzD,YAAhB,CACElT,CAAC,CAAC,kBAAD,CADH,EAEE;AAAE4W,QAAAA,UAAU,EAAET,OAAO,CAACtQ,CAAD,CAArB;AACEgR,QAAAA,UAAU,EAAE/W,MAAM,CAAC+U,OAAP,CAAeC,OAAf,CAAuBqB,OAAO,CAACtQ,CAAD,CAA9B,EAAmCiR;AADjD,OAFF,EAIE;AAAEC,QAAAA,MAAM,EAAE;AAAV,OAJF;AAKD,KAtCwB,CAwCzB;;;AACA/W,IAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBsI,KAAtB,CAA4B,UAASlG,CAAT,EAAY;AACtCA,MAAAA,CAAC,CAACC,cAAF;AACA0S,MAAAA,YAAY,CAAC/U,CAAC,CAAC,IAAD,CAAD,CAAQwC,IAAR,CAAa,QAAb,CAAD,CAAZ;AACD,KAHD;AAID;AAGD;AAEA;;AAGA;;AAEA;;;;;;;AAKA,MAAMwU,oBAAoB,GAAG;AAC3B;AACAC,IAAAA,OAAO,EAAE,kBAFkB;;AAG3B;AACAC,IAAAA,YAAY,EAAE,uBAJa;;AAK3B;AACAC,IAAAA,SAAS,EAAE,oBANgB;;AAO3B;AACAC,IAAAA,KAAK,EAAE,gBARoB;;AAS3B;AACAC,IAAAA,MAAM,EAAE;AAVmB,GAA7B;AAaA;;;;;;AAKA,MAAMC,2BAA2B,GAAG;AAClCC,IAAAA,OAAO,EAAE,CAAC,CADwB;AACrB;AACbC,IAAAA,OAAO,EAAE,CAFyB;AAGlCC,IAAAA,mBAAmB,EAAE,CAHa;AAIlCC,IAAAA,mBAAmB,EAAE,CAJa;AAKlCC,IAAAA,yBAAyB,EAAE,CALO;AAMlCC,IAAAA,uBAAuB,EAAE,CANS;AAOlCC,IAAAA,aAAa,EAAE,CAPmB;AAQlCC,IAAAA,kBAAkB,EAAE,CARc;AASlCC,IAAAA,UAAU,EAAE,CATsB;AAUlCC,IAAAA,WAAW,EAAE;AAVqB,GAApC;AAaA;;;;;;;AAOC;;;;;;;;;;AAUD;;;;;;;;AAQA;;;;;;;;;;;;;;;;AAgBA;;;;;;;AAOA;;;;;;;;;AASA;;;;;;;AAOA;;;;;;AAKA,MAAMC,kBAAkB,GAAG;AACzBhB,IAAAA,OAAO,EAAE,SADgB;AAEzBiB,IAAAA,QAAQ,EAAE,UAFe;AAGzBd,IAAAA,KAAK,EAAE,OAHkB;AAIzBC,IAAAA,MAAM,EAAE;AAJiB,GAA3B;AAOA;;;;;;;AAMA,WAASc,kBAAT,CAA4BC,OAA5B,EAAqC;AACnC;;;;AAIA,SAAKA,OAAL,GAAeA,OAAf;AAEA;;;;;AAIA,SAAKnM,EAAL,GAAUoM,QAAQ,EAAlB;AACD;AAED;;;;;;;;AAMA,WAASC,qBAAT,CAA+BC,MAA/B,EAAuC;AACrCJ,IAAAA,kBAAkB,CAACrE,IAAnB,CAAwB,IAAxB,EAA8BmE,kBAAkB,CAAChB,OAAjD;AACA,SAAKsB,MAAL,GAAcA,MAAd;AACD;;AACDD,EAAAA,qBAAqB,CAACzE,SAAtB,GAAkC/F,CAAC,CAAC0K,MAAF,CAASL,kBAAkB,CAACtE,SAA5B,EAAuC;AAAC4E,IAAAA,WAAW,EAAEH;AAAd,GAAvC,CAAlC;AAEA;;;;;;;;;AAQA,WAASI,sBAAT,CAAgCC,gBAAhC,EAAkDC,aAAlD,EAAiEC,aAAjE,EAAgF;AAC9EV,IAAAA,kBAAkB,CAACrE,IAAnB,CAAwB,IAAxB,EAA8BmE,kBAAkB,CAACC,QAAjD;AACA,SAAKS,gBAAL,GAAwBA,gBAAxB;AACA,SAAKC,aAAL,GAAqBA,aAArB;AACA,SAAKC,aAAL,GAAqBA,aAArB;AACD;;AACDH,EAAAA,sBAAsB,CAAC7E,SAAvB,GAAmC/F,CAAC,CAAC0K,MAAF,CAASL,kBAAkB,CAACtE,SAA5B,EAAuC;AACxE4E,IAAAA,WAAW,EAAEC;AAD2D,GAAvC,CAAnC;AAIA;;;;;;;;AAOA,WAASI,mBAAT,CAA6BC,QAA7B,EAAuCC,QAAvC,EAAiD;AAC/Cb,IAAAA,kBAAkB,CAACrE,IAAnB,CAAwB,IAAxB,EAA8BmE,kBAAkB,CAACb,KAAjD;AACA,SAAK2B,QAAL,GAAgBA,QAAhB;AACA,SAAKC,QAAL,GAAgBA,QAAhB;AACD;;AACDF,EAAAA,mBAAmB,CAACjF,SAApB,GAAgC/F,CAAC,CAAC0K,MAAF,CAASL,kBAAkB,CAACtE,SAA5B,EAAuC;AAAC4E,IAAAA,WAAW,EAAEK;AAAd,GAAvC,CAAhC;AAEA;;;;;;AAKA,WAASG,oBAAT,GAAgC;AAC9Bd,IAAAA,kBAAkB,CAACrE,IAAnB,CAAwB,IAAxB,EAA8BmE,kBAAkB,CAACZ,MAAjD;AACD;;AACD4B,EAAAA,oBAAoB,CAACpF,SAArB,GAAiC/F,CAAC,CAAC0K,MAAF,CAASL,kBAAkB,CAACtE,SAA5B,EAAuC;AACtE4E,IAAAA,WAAW,EAAEQ;AADyD,GAAvC,CAAjC;AAIA;;;;;;AAKA,MAAMC,sBAAsB,GAAG;AAC7BjC,IAAAA,OAAO,EAAE,SADoB;AAE7BC,IAAAA,YAAY,EAAE,cAFe;AAG7BC,IAAAA,SAAS,EAAE,WAHkB;AAI7BC,IAAAA,KAAK,EAAE,eAJsB;AAK7BC,IAAAA,MAAM,EAAE;AALqB,GAA/B;AAQA;;;;;;AAOA;;AACA;;AACA,MAAM8B,YAAY,GAAG,IAAIC,SAAJ,CAAc;AACjCC,IAAAA,QAAQ,EAAE,KADuB;AAEjCC,IAAAA,kBAAkB,EAAE,KAFa;AAGjCC,IAAAA,OAAO,EAAE,IAHwB;AAIjCC,IAAAA,cAAc,EAAE;AAJiB,GAAd,EAKlB,cALkB,CAArB;AAOAxZ,EAAAA,CAAC,CAAC,SAASyZ,WAAT,GAAuB;AACvB;AACA;AAEA;AACAC,IAAAA,qBAAqB,CAAC,YAAW;AAC/B,UAAI,CAACP,YAAY,CAAC3W,IAAb,CAAkB6W,QAAvB,EAAiC;AAC/B;AACD;;AACDM,MAAAA,gCAAgC,CAAC,IAAIrB,qBAAJ,CAA0B,WAA1B,CAAD,CAAhC;AACD,KALoB,CAArB,CALuB,CAYvB;;AACAvY,IAAAA,OAAO,CAACmC,EAAR,CAAW/B,4BAAX,EAAyC,YAAW;AAClD,UAAI,CAACgZ,YAAY,CAAC3W,IAAb,CAAkB6W,QAAvB,EAAiC;AAC/B;AACD;;AACDM,MAAAA,gCAAgC,CAAC,IAAIrB,qBAAJ,CAA0B,wBAA1B,CAAD,CAAhC;AACD,KALD,EAbuB,CAoBvB;AACA;;AACAvY,IAAAA,OAAO,CAACmC,EAAR,CAAWjC,qBAAX,EAAkC,YAAW;AAC3C,UAAI,CAACkZ,YAAY,CAAC3W,IAAb,CAAkB6W,QAAvB,EAAiC;AAC/B;AACD;;AACDM,MAAAA,gCAAgC,CAAC,IAAIrB,qBAAJ,CAA0B,oBAA1B,CAAD,CAAhC;AACD,KALD,EAtBuB,CA6BvB;AACA;;AACAtY,IAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBkC,EAApB,CAAuBqI,qBAAvB,EAA8C,YAAW;AACvD,UAAI,CAAC4O,YAAY,CAAC3W,IAAb,CAAkB6W,QAAvB,EAAiC;AAC/B;AACD;;AACDM,MAAAA,gCAAgC,CAAC,IAAIrB,qBAAJ,CAA0B,kBAA1B,CAAD,CAAhC;AACD,KALD,EA/BuB,CAsCvB;AACA;AACA;;AACAtY,IAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBkI,MAApB,GAA6BhG,EAA7B,CAAgC,OAAhC,EAAyC,UAASE,CAAT,EAAY;AACnDA,MAAAA,CAAC,CAACC,cAAF;AACAiI,MAAAA,mBAAmB,CAAC,oCAAD,CAAnB;AACA,aAAO,KAAP;AACD,KAJD,EAzCuB,CA+CvB;AACA;;AACAtK,IAAAA,CAAC,CAAC,8DAAD,CAAD,CAAkEkC,EAAlE,CAAqE,OAArE,EAA8E,UAASE,CAAT,EAAY;AACxF,UAAImF,WAAW,KAAK,WAApB,EAAiC;AAC/BnF,QAAAA,CAAC,CAACC,cAAF;AACAkN,QAAAA,eAAe,CACb,iCADa,EAEb,gCAFa,EAGb,MAHa,EAIb,IAJa,EAIP,IAJO,EAKb,YAAW;AACT9M,UAAAA,WAAW,CAAC,iBAAD,CAAX;AACD,SAPY,CAAf;AASD;AACF,KAbD,EAjDuB,CAgEvB;;AACA,QAAMmX,oBAAoB,GAAG5Z,CAAC,CAAC,uCAAD,CAA9B;AACA,QAAM6Z,0BAA0B,GAAG7Z,CAAC,CAAC4Z,oBAAoB,CAACpX,IAArB,CAA0B,QAA1B,CAAD,CAApC;AACAqX,IAAAA,0BAA0B,CAAC3X,EAA3B,CAA8B,QAA9B,EAAwC,YAAM;AAC5C0X,MAAAA,oBAAoB,CAACE,MAArB,CAA4B,yBAA5B,EAAuD3Q,WAAvD,CAAmE,wBAAnE,EAA6FD,QAA7F,CAAsG,0BAAtG;AACA0Q,MAAAA,oBAAoB,CAACE,MAArB,CAA4B,4BAA5B,EAA0D5Q,QAA1D,CAAmE,IAAnE;AACAoM,MAAAA,SAAS,CAAC,qBAAD,EAAwB,IAAxB,CAAT;AACD,KAJD,EAIGpT,EAJH,CAIM,OAJN,EAIe,YAAM;AACnB0X,MAAAA,oBAAoB,CAACE,MAArB,CAA4B,2BAA5B,EAAyD5Q,QAAzD,CAAkE,wBAAlE,EAA4FC,WAA5F,CAAwG,0BAAxG;AACAyQ,MAAAA,oBAAoB,CAACE,MAArB,CAA4B,4BAA5B,EAA0D3Q,WAA1D,CAAsE,IAAtE;AACAmM,MAAAA,SAAS,CAAC,qBAAD,EAAwB,KAAxB,CAAT;AACD,KARD,EAnEuB,CA4EvB;AACA;AACA;;AACAtV,IAAAA,CAAC,CAAC,sDAAD,CAAD,CAA0D6M,GAA1D,CAA8D,OAA9D,EAAuE,YAAM;AAC3E,UAAIkD,SAAS,CAAC,qBAAD,CAAb,EAAsC;AACpC8J,QAAAA,0BAA0B,CAAChI,QAA3B,CAAoC,MAApC;AACD;AACF,KAJD,EA/EuB,CAqFvB;;AACA7R,IAAAA,CAAC,CAAC,oBAAD,CAAD,CAAwBkC,EAAxB,CAA2B,OAA3B,EAAoC6X,yCAApC;AACD,GAvFA,CAAD;AAyFA;;;;;;AAKA,WAASC,sBAAT,CAAgCC,GAAhC,EAAqCzX,IAArC,EAA2C;AACzC,QAAIA,IAAI,CAAC0X,KAAT,EAAgB;AACd;AACA;AACA,UAAI1X,IAAI,CAAC2X,SAAT,EAAoB;AAClB5K,QAAAA,eAAe,CACb,0BADa,EAEb,mCAFa,EAGb,OAHa,EAIb,oCAJa,EAKb/M,IAAI,CAAC0X,KALQ,EAMb,IANa,CAAf,CADkB,CAOT;AACV,OARD,MASK;AACH3K,QAAAA,eAAe,CACb,0BADa,EAEb,qCAFa,EAGb,OAHa,EAIb,oCAJa,EAKb/M,IAAI,CAAC0X,KALQ,EAMb,IANa,CAAf,CADG,CAOM;AACV;AACF;;AAEDf,IAAAA,YAAY,CAACiB,GAAb,CAAiB,UAAjB,EAA6B,IAA7B;AACAT,IAAAA,gCAAgC,CAAC,IAAIrB,qBAAJ,CAA0B,WAA1B,CAAD,CAAhC;AACD;;AACDvY,EAAAA,OAAO,CAACmC,EAAR,CAAW8U,oBAAoB,CAACG,SAAhC,EAA2C6C,sBAA3C;AAEA;;;;;;AAKA,WAASK,uBAAT,CAAiCC,WAAjC,EAA8C;AAC5C;AACA;AACA,WAAOA,WAAW,CAACC,UAAZ,IAA0BD,WAAW,CAACE,UAA7C;AACD;;AAED,MAAIC,sBAAsB,GAAG,kBAA7B;AAEA;;;;;;AAKA,WAASC,0BAAT,CAAoCT,GAApC,EAAyCzX,IAAzC,EAA+C;AAC7C6O,IAAAA,gBAAgB,CAAC7O,IAAD,CAAhB;AACD;;AACDzC,EAAAA,OAAO,CAACmC,EAAR,CAAW8U,oBAAoB,CAACC,OAAhC,EAAyCyD,0BAAzC;AAEA;;AACA,MAAIC,aAAa,GAAG,IAApB;AAEA;;;;;;AAKA,MAAMC,cAAc,GAAG;AACrBC,IAAAA,WAAW,EAAE;AAACC,MAAAA,UAAU,EAAE;AAAb,KADQ;AAErBC,IAAAA,cAAc,EAAE;AAACD,MAAAA,UAAU,EAAE;AAAb,KAFK;AAGrBE,IAAAA,YAAY,EAAE;AAACF,MAAAA,UAAU,EAAE;AAAb,KAHO;AAIrBG,IAAAA,YAAY,EAAE;AAACH,MAAAA,UAAU,EAAE;AAAb,KAJO;AAKrBI,IAAAA,iBAAiB,EAAE;AAACJ,MAAAA,UAAU,EAAE;AAAb,KALE;AAMrBK,IAAAA,kBAAkB,EAAE;AAACL,MAAAA,UAAU,EAAE;AAAb;AANC,GAAvB;AAQA3B,EAAAA,YAAY,CAACiB,GAAb,CAAiB,SAAjB,EAA4BQ,cAAc,CAACC,WAA3C;AAEA;;;;;AAIA,WAASxJ,gBAAT,CAA0BiJ,WAA1B,EAAuC;AACrC;AACA;AACA,QAAI,CAACjJ,gBAAgB,CAAC+J,OAAtB,EAA+B;AAC7B/J,MAAAA,gBAAgB,CAAC+J,OAAjB,GAA2B,IAA3B;AACD,KALoC,CAOrC;AACA;;;AACA,QAAMC,cAAc,GAAGV,aAAvB;;AAEA,QAAIL,WAAJ,EAAiB;AACf,UAAIK,aAAJ,EAAmB;AACjB;AACA,YAAI,CAAC7M,CAAC,CAAC0D,KAAF,CAAQ8I,WAAW,CAACgB,OAApB,CAAD,IAAiChB,WAAW,CAACgB,OAAZ,KAAwBX,aAAa,CAACW,OAA3E,EAAoF;AAClFC,UAAAA,qBAAqB,CAAC,0BAAD,EAA6BjB,WAAW,CAACgB,OAAZ,GAAsBX,aAAa,CAACW,OAAjE,CAArB;AACD,SAJgB,CAKjB;;AACD;;AAEDX,MAAAA,aAAa,GAAGL,WAAhB;;AAEA,UAAIA,WAAW,CAACkB,kBAAhB,EAAoC;AAClC;AACA;AACAD,QAAAA,qBAAqB,CAAC,oDAAD,CAArB;AACAE,QAAAA,iCAAiC;AAAC;AAAqB,YAAtB,CAAjC;AACD;AACF;;AAED,QAAI,CAACd,aAAL,EAAoB;AAClB;AACA;AACD;;AAEDL,IAAAA,WAAW,GAAGK,aAAd;AAEA;;;;AAGA,QAAIe,eAAe,GAAG,KAAtB,CAxCqC,CA0CrC;AACA;AACA;;AACA,QAAI3L,SAAS,CAAC0K,sBAAD,CAAb,EAAuC;AACrC;AACA;AACA,UAAI,CAACJ,uBAAuB,CAACC,WAAD,CAA5B,EAA2C;AACzChF,QAAAA,SAAS,CAACmF,sBAAD,EAAyB,KAAzB,CAAT,CADyC,CAEzC;;AACA,eAAOpJ,gBAAgB,CAACiJ,WAAD,CAAvB;AACD;AACF,KARD,MASK;AACH;AACA,UAAIqB,cAAc,MACXtB,uBAAuB,CAACC,WAAD,CAD1B,IAEG/S,WAAW,KAAK,WAFvB,EAGA;AACE;AACAgU,QAAAA,qBAAqB,CAAC,4BAAD,CAArB;AACAG,QAAAA,eAAe,GAAG,IAAlB;AACApG,QAAAA,SAAS,CAACmF,sBAAD,EAAyB,IAAzB,CAAT,CAJF,CAKE;AACD,OATD,MAUK;AACH;AACA;AACD;AACF;;AAED,QAAImB,KAAK,GAAGhB,cAAc,CAACC,WAA3B,CAxEqC,CAyErC;;AAEA,QAAIP,WAAW,CAACuB,eAAhB,EAAiC;AAC/B,WAAK,IAAIhW,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyU,WAAW,CAACuB,eAAZ,CAA4Bnb,MAAhD,EAAwDmF,CAAC,EAAzD,EAA6D;AAC3D,YAAIiW,EAAE,GAAGxB,WAAW,CAACuB,eAAZ,CAA4BhW,CAA5B,CAAT;;AACA,YAAIiW,EAAE,CAAC,OAAD,CAAF,KAAgB,aAAhB,IAAiCA,EAAE,CAACC,KAAH,IAAYzB,WAAW,CAACgB,OAA7D,EAAsE;AACpE;AACAM,UAAAA,KAAK,GAAGhB,cAAc,CAACG,cAAvB;AACA;AACD;AACF;AACF;;AAED,QAAIiB,2BAA2B,GAAG,CAAlC;;AAEA,QAAI1B,WAAW,CAAC2B,SAAhB,EAA2B;AACzB,WAAK,IAAIpW,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAGyU,WAAW,CAAC2B,SAAZ,CAAsBvb,MAA1C,EAAkDmF,EAAC,EAAnD,EAAuD;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAIyU,WAAW,CAAC2B,SAAZ,CAAsBpW,EAAtB,EAAyB,OAAzB,MAAsC,aAA1C,EAAyD;AACvD,cAAMqW,eAAe,GAAGC,MAAM,CAAC7B,WAAW,CAAC2B,SAAZ,CAAsBpW,EAAtB,EAAyBqW,eAA1B,CAA9B;;AACA,cAAI3U,WAAW,KAAK,WAAhB,IAA+B2U,eAAe,CAACE,OAAhB,CAAwBD,MAAM,EAA9B,CAAnC,EAAsE;AACpEP,YAAAA,KAAK,GAAGhB,cAAc,CAACK,YAAvB;AAEAe,YAAAA,2BAA2B,GAAGE,eAAe,CAACG,IAAhB,CAAqBF,MAAM,EAA3B,CAA9B,CAHoE,CAIpE;AACA;AACA;;AACAH,YAAAA,2BAA2B,GAAGjV,IAAI,CAACuV,GAAL,CAAS,CAAT,EAAYN,2BAAZ,CAA9B;AACA;AACD;AACF;AACF;AACF;;AAED,QAAI7C,YAAY,CAAC3W,IAAb,CAAkB8W,kBAAtB,EAA0C;AACxC;AACAsC,MAAAA,KAAK,GAAGhB,cAAc,CAACI,YAAvB;AACD;;AAED,QAAIV,WAAW,CAACE,UAAZ,IAA0B,CAACF,WAAW,CAACC,UAA3C,EAAuD;AACrD;AACA;AACAqB,MAAAA,KAAK,GAAGhB,cAAc,CAACO,kBAAvB;AACD,KA/HoC,CAiIrC;;;AACA,QAAIS,KAAK,KAAKhB,cAAc,CAACO,kBAAzB,IAA+CE,cAA/C,IAAiEA,cAAc,CAACd,UAApF,EAAgG;AAC9F;AACA,UAAIpB,YAAY,CAAC3W,IAAb,CAAkBgX,cAAtB,EAAsC;AACpCzG,QAAAA,kBAAkB,CAAC/S,CAAC,CAAC,mCAAD,CAAF,CAAlB,CADoC,CAEpC;;AACAiT,QAAAA,MAAM,CAAC;AAACM,UAAAA,QAAQ,EAAE,CAAX;AAAcD,UAAAA,OAAO,EAAE;AAAvB,SAAD,CAAN;AACAiI,QAAAA,qBAAqB,CAAC,4CAAD,CAArB;AACD,OALD,MAMK;AACHxI,QAAAA,kBAAkB,CAAC/S,CAAC,CAAC,uCAAD,CAAF,CAAlB,CADG,CAEH;;AACAiT,QAAAA,MAAM,CAAC;AAACM,UAAAA,QAAQ,EAAE,CAAX;AAAcD,UAAAA,OAAO,EAAE;AAAvB,SAAD,CAAN;AACAiI,QAAAA,qBAAqB,CAAC,4DAAD,CAArB;AACD;;AAEDpC,MAAAA,YAAY,CAACiB,GAAb,CAAiB,gBAAjB,EAAmC,KAAnC;AACD,KAlJoC,CAoJrC;AACA;;;AACA,QAAI/Z,SAAS,CAACqK,QAAV,CAAmBG,GAAvB,EAA4B;AAC1B+Q,MAAAA,KAAK,GAAGhB,cAAc,CAACM,iBAAvB;AACD,KAxJoC,CA0JrC;;;AACAqB,IAAAA,aAAa,CAACjC,WAAD,EAAcsB,KAAd,EAAqBI,2BAArB,CAAb,CA3JqC,CA6JrC;;AACAQ,IAAAA,oBAAoB,CAACnK,IAArB,CAA0BiI,WAAW,CAACgB,OAAtC,EAA+CI,eAA/C,EA9JqC,CAgKrC;AACA;AACA;;AACA,QAAMe,iBAAiB,GAAG1M,SAAS,CAAC,mBAAD,CAAnC;AACA,QAAM2M,SAAS,GAAG,CAAC,KAAK,EAAN,IAAY,CAA9B,CApKqC,CAoKJ;;AACjC,QAAI,CAACD,iBAAD,IAAsBA,iBAAiB,GAAGC,SAA9C,EAAyD;AACvD;AACAjZ,MAAAA,SAAS,CAAC,4CAAD,CAAT;AACAzD,MAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBkJ,QAAtB,CAA+B,QAA/B;AACAlJ,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0BmJ,WAA1B,CAAsC,QAAtC;AACD,KALD,MAMK;AACH;AACA1F,MAAAA,SAAS,CAAC,4CAAD,CAAT;AACAzD,MAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBmJ,WAAtB,CAAkC,QAAlC;AACAnJ,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0BkJ,QAA1B,CAAmC,QAAnC;AACD,KAhLoC,CAkLrC;AACA;AACA;;;AACA,QAAI0S,KAAK,KAAKhB,cAAc,CAACK,YAA7B,EAA2C;AACzC;AACA;AACA;AACAlS,MAAAA,YAAY,CAACsI,gBAAgB,CAAC+J,OAAlB,CAAZ,CAJyC,CAMzC;;AACA,UAAIY,2BAA2B,GAAG,MAAM,IAAxC,EAA8C;AAC5C3K,QAAAA,gBAAgB,CAAC+J,OAAjB,GAA2B7X,UAAU,CAAC8N,gBAAD,EAAmB,IAAnB,CAArC;AACD,OAFD,MAGK;AACHA,QAAAA,gBAAgB,CAAC+J,OAAjB,GAA2B7X,UAAU,CAAC8N,gBAAD,EAAmB,KAAK,IAAxB,CAArC;AACD;AACF;;AAED8H,IAAAA,YAAY,CAACiB,GAAb,CAAiB,SAAjB,EAA4BwB,KAA5B;AAEA;;;;;;;AAMA,aAASW,aAAT,CAAuBjC,WAAvB,EAAoCsB,KAApC,EAA2CI,2BAA3C,EAAwE;AACtE;AACAhc,MAAAA,CAAC,CAAC,oBAAD,CAAD,CAAwB8R,GAAxB,CAA4B8J,KAAK,CAACd,UAAlC,EAA8C5R,QAA9C,CAAuD,QAAvD;AACAlJ,MAAAA,CAAC,CAAC4b,KAAK,CAACd,UAAP,CAAD,CAAoB3R,WAApB,CAAgC,QAAhC,EAHsE,CAKtE;AACA;;AACA,UAAMwT,SAAS,GAAIrC,WAAW,CAACE,UAAZ,IAA0B,CAACF,WAAW,CAACC,UAA1D;AAEAva,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0B4I,WAA1B,CAAsC,QAAtC,EAAgDgT,KAAK,KAAKhB,cAAc,CAACK,YAAzE;AACAjb,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0B4I,WAA1B,CAAsC,QAAtC,EAAgDgT,KAAK,KAAKhB,cAAc,CAACK,YAAzE;AAEAjb,MAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4B4I,WAA5B,CAAwC,QAAxC,EAAkD,CAAC0R,WAAW,CAACE,UAA/D;AACAxa,MAAAA,CAAC,CAAC,4BAAD,CAAD,CAAgC4I,WAAhC,CAA4C,QAA5C,EAAsD0R,WAAW,CAACE,UAAlE;AACAxa,MAAAA,CAAC,CAAC,gCAAD,CAAD,CAAoC4I,WAApC,CAAgD,QAAhD,EAA0D,CAAC+T,SAA3D;AACA3c,MAAAA,CAAC,CAAC,gCAAD,CAAD,CAAoC4I,WAApC,CAAgD,QAAhD,EAA0D+T,SAA1D;AAEA3c,MAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqB4I,WAArB,CAAiC,QAAjC,EAA2CgT,KAAK,KAAKhB,cAAc,CAACC,WAApE;AACA7a,MAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqB4I,WAArB,CAAiC,QAAjC,EAA2CgT,KAAK,KAAKhB,cAAc,CAACC,WAApE;AAEA7a,MAAAA,CAAC,CAAC,gFAAD,CAAD,CAAoF4I,WAApF,CAAgG,QAAhG,EAA0G,CAAC,CAAC0R,WAAW,CAACsC,gBAAd,IAAkCD,SAA5I;AACA3c,MAAAA,CAAC,CAAC,mHAAD,CAAD,CAAuH8C,IAAvH,CAA4HwX,WAAW,CAACsC,gBAAxI,EAA0JhU,WAA1J,CAAsK,QAAtK,EAAgL,CAAC0R,WAAW,CAACsC,gBAA7L;;AAEA,UAAItC,WAAW,CAACuC,WAAhB,EAA6B;AAC3B7c,QAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuBwH,IAAvB,CAA4B,MAA5B,EAAoC8S,WAAW,CAACuC,WAAhD,EAA6D1T,WAA7D,CAAyE,QAAzE;AACD,OAFD,MAGK;AACH;AACA;AACAnJ,QAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuBkJ,QAAvB,CAAgC,QAAhC;AACD;;AAEDlJ,MAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCwH,IAAjC,CAAsC,MAAtC,EAA8C8S,WAAW,CAACwC,kBAA1D;AACA9c,MAAAA,CAAC,CAAC,iCAAD,CAAD,CAAqCwH,IAArC,CAA0C,MAA1C,EAAkD8S,WAAW,CAACyC,sBAA9D;AACA/c,MAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCwH,IAAjC,CAAsC,MAAtC,EAA8C8S,WAAW,CAAC0C,kBAA1D;;AAEA,UAAI1C,WAAW,CAACuB,eAAhB,EAAiC;AAC/B,aAAK,IAAIhW,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGyU,WAAW,CAACuB,eAAZ,CAA4Bnb,MAAhD,EAAwDmF,GAAC,EAAzD,EAA6D;AAC3D,cAAIiW,GAAE,GAAGxB,WAAW,CAACuB,eAAZ,CAA4BhW,GAA5B,CAAT;;AAEA,cAAIiW,GAAE,CAAC,OAAD,CAAF,KAAgB,aAApB,EAAmC;AACjC9b,YAAAA,CAAC,qDAA6C8b,GAAE,CAAClD,aAAhD,SAAD,CAAoE9V,IAApE,CAAyEma,SAAS,CAAC1L,QAAQ,CAACuK,GAAE,CAACC,KAAJ,CAAT,CAAlF;AACA/b,YAAAA,CAAC,qDAA6C8b,GAAE,CAAClD,aAAhD,SAAD,CAAoEpW,IAApE,CAAyE,eAAzE,EAA0FsZ,GAAE,CAACC,KAA7F;AAEA/b,YAAAA,CAAC,oDAA4C8b,GAAE,CAAClD,aAA/C,gGAAgJkD,GAAE,CAAClD,aAAnJ,SAAD,CACKhQ,WADL,CACiB,gBADjB,EACmC0R,WAAW,CAACgB,OAAZ,IAAuBQ,GAAE,CAACC,KAD7D;AAEA/b,YAAAA,CAAC,oDAA4C8b,GAAE,CAAClD,aAA/C,gGAAgJkD,GAAE,CAAClD,aAAnJ,SAAD,CACKhQ,WADL,CACiB,oBADjB,EACuC0R,WAAW,CAACgB,OAAZ,GAAsBQ,GAAE,CAACC,KADhE;AAED;AACF,SAb8B,CAe/B;;;AACA,YAAMmB,gBAAgB,GAAGld,CAAC,CAAC,0DAAD,CAAD,CAA8DkJ,QAA9D,CAAuE,QAAvE,EAAiF4Q,MAAjF,CAAwF,iBAAxF,EAA2GqD,IAA3G,EAAzB;AACAD,QAAAA,gBAAgB,CAAC/T,WAAjB,CAA6B,QAA7B,EAjB+B,CAkB/B;;AACAnJ,QAAAA,CAAC,CAAC,yBAAD,CAAD,CAA6BwC,IAA7B,CAAkC,eAAlC,EAAmD0a,gBAAgB,CAAC1a,IAAjB,CAAsB,eAAtB,CAAnD;AACD;;AAED,UAAM4a,kBAAkB,GAAGjB,MAAM,CAC5BnK,QADsB,CACbgK,2BADa,EAEtB9G,MAFsB,CAEfmI,YAAY,EAFG,EAGtBC,QAHsB,GAItBza,OAJsB,CAId,GAJc,EAIT,QAJS,CAA3B,CA1DsE,CA8DzC;;AAC7B,UAAM0a,kBAAkB,GAAG5I,IAAI,CAACqB,CAAL,CAAO,8BAAP,EAAuCnT,OAAvC,CAA+C,IAA/C,EAAqDua,kBAArD,CAA3B;AACApd,MAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCwJ,IAAjC,CAAsC+T,kBAAtC;AAEA,UAAMC,OAAO,GAAGxd,CAAC,CAAC,MAAD,CAAD,CAAUwH,IAAV,CAAe,SAAf,CAAhB;AACAxH,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0B4I,WAA1B,CAAsC,QAAtC,EAAgD,CAAC4U,OAAjD;AACAxd,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0B4I,WAA1B,CAAsC,QAAtC,EAAgD4U,OAAhD,EApEsE,CAsEtE;;AACA,UAAIxd,CAAC,CAAC,8BAAD,CAAD,CAAkC6H,QAAlC,CAA2C,QAA3C,CAAJ,EAA0D;AACxD7H,QAAAA,CAAC,CAAC,8BAAD,CAAD,CAAkCmJ,WAAlC,CAA8C,QAA9C,EADwD,CAGxD;AACA;;AACA/F,QAAAA,QAAQ,CAACC,aAAD,CAAR;AACD;AACF;AACF;AAED;;;;;;;;;;AAQA,WAASoa,eAAT,CAAyBC,UAAzB,EAAqChC,eAArC,EAAsD;AACpD,QAAMiC,YAAY,GAAG3d,CAAC,CAAC4d,QAAF,EAArB,CADoD,CAGpD;AACA;AACA;;AACA5d,IAAAA,CAAC,CAAC,4BAAD,CAAD,CAAgC8C,IAAhC,CAAqCma,SAAS,CAACS,UAAD,CAA9C;AAEA,QAAIG,eAAe,GAAGtM,QAAQ,CAACvR,CAAC,CAAC,0BAAD,CAAD,CAA8BwC,IAA9B,CAAmC,iBAAnC,CAAD,CAA9B,CARoD,CAQmC;;AACvF,QAAIsL,CAAC,CAAC0D,KAAF,CAAQqM,eAAR,CAAJ,EAA8B;AAC5B;AACA;AACA;AACA,UAAMC,aAAa,GAAGpC,eAAe,GAAG,CAAH,GAAOgC,UAA5C;AACA1d,MAAAA,CAAC,CAAC,0BAAD,CAAD,CAA8B8C,IAA9B,CAAmCma,SAAS,CAACa,aAAD,CAA5C,EAA6Dtb,IAA7D,CAAkE,iBAAlE,EAAqFsb,aAArF;AACAD,MAAAA,eAAe,GAAGC,aAAlB;AACD,KAPD,MAQK;AACH;AACA;AACA9d,MAAAA,CAAC,CAAC,0BAAD,CAAD,CAA8B8C,IAA9B,CAAmCma,SAAS,CAACY,eAAD,CAA5C;AACD;;AAED,QAAIE,WAAW,GAAGL,UAAU,GAAGG,eAA/B,CAvBoD,CAyBpD;AACA;;AACA,QAAIE,WAAW,KAAK,CAApB,EAAuB;AACrBJ,MAAAA,YAAY,CAACK,OAAb;AACA,aAAOL,YAAY,CAACM,OAAb,EAAP;AACD;;AAEDF,IAAAA,WAAW,GAAGjQ,CAAC,CAAC0D,KAAF,CAAQuM,WAAR,IAAuBL,UAAvB,GAAoCK,WAAlD,CAhCoD,CAkCpD;;AACA/d,IAAAA,CAAC,CAAC,0BAAD,CAAD,CAA8BwC,IAA9B,CAAmC,iBAAnC,EAAsDkb,UAAtD,EAnCoD,CAqCpD;;AACA,QAAMQ,OAAO,GAAG,GAAhB;AACA,QAAMC,eAAe,GAAG,IAAxB,CAvCoD,CAuCpB;;AAChC,QAAMC,mBAAmB,GAAG,EAA5B,CAxCoD,CAwCpB;;AAChC,QAAMC,QAAQ,GAAGtX,IAAI,CAACuX,KAAL,CAAWH,eAAe,GAAGC,mBAA7B,CAAjB,CAzCoD,CA2CpD;;AACA,QAAMG,eAAe,GAAGR,WAAW,GAAGG,OAAtC;AAEA,QAAIM,gBAAgB,GAAGzX,IAAI,CAACuV,GAAL,CAAS,CAAT,EAAYvV,IAAI,CAAC0X,GAAL,CAAS1X,IAAI,CAAC2X,GAAL,CAASH,eAAT,CAAT,EAAoCF,QAApC,CAAZ,CAAvB;AACA,QAAMM,eAAe,GAAG5X,IAAI,CAACuX,KAAL,CAAWC,eAAe,GAAGC,gBAA7B,IAAiDN,OAAzE,CA/CoD,CAiDpD;AACA;;AACA,QAAIU,aAAa,GAAGb,WAAW,GAAIhX,IAAI,CAAC8X,IAAL,CAAUd,WAAV,IAAyBS,gBAAzB,GAA4CG,eAA/E;AAEA,QAAIG,mBAAmB,GAAGjB,eAA1B;AAEA,QAAMkB,wBAAwB,GAAG/e,CAAC,CAAC,mCAAD,CAAD,CAAuC8R,GAAvC,CAA2C,SAA3C,CAAjC;AACA,QAAMkN,mBAAmB,GAAGD,wBAAwB,CAAC1U,IAAzB,CAA8B,0BAA9B,CAA5B,CAxDoD,CA0DpD;AACA;AACA;;AACA,QAAM4U,SAAS,GAAGjf,CAAC,CAAC4d,QAAF,EAAlB;AACA,QAAMsB,UAAU,GAAGlf,CAAC,CAAC4d,QAAF,EAAnB;AACA5d,IAAAA,CAAC,CAACmf,IAAF,CAAOF,SAAS,CAAChB,OAAV,EAAP,EAA4BiB,UAAU,CAACjB,OAAX,EAA5B,EAAkDmB,MAAlD,CAAyD,YAAM;AAC7D;AACAzB,MAAAA,YAAY,CAACK,OAAb;AACD,KAHD;;AAKA,QAAMqB,aAAa,GAAG,SAAhBA,aAAgB,CAACC,mBAAD,EAAyB;AAC7C,UAAI,CAACA,mBAAL,EAA0B;AACxB;AACD;;AACDC,MAAAA,aAAa,CAACD,mBAAD,CAAb;AACAA,MAAAA,mBAAmB,GAAG,IAAtB,CAL6C,CAM7C;;AACAtf,MAAAA,CAAC,CAAC,0BAAD,CAAD,CAA8B8C,IAA9B,CAAmCma,SAAS,CAACS,UAAD,CAA5C,EAP6C,CAQ7C;;AACAuB,MAAAA,SAAS,CAACjB,OAAV;AACD,KAVD;;AAYA,QAAIsB,mBAAmB,GAAGE,WAAW,CAAC,YAAM;AAC1ChB,MAAAA,gBAAgB;;AAChB,UAAIA,gBAAgB,GAAG,CAAvB,EAA0B;AACxB;AACAa,QAAAA,aAAa,CAACC,mBAAD,CAAb;AACA;AACD;;AAEDR,MAAAA,mBAAmB,IAAIH,eAAvB;;AACA,UAAIC,aAAa,GAAGV,OAApB,EAA6B;AAC3BY,QAAAA,mBAAmB,IAAIZ,OAAvB;AACAU,QAAAA,aAAa,IAAIV,OAAjB;AACD;;AACDc,MAAAA,mBAAmB,CAAClc,IAApB,CAAyBma,SAAS,CAAC6B,mBAAD,CAAlC;AACD,KAdoC,EAclC,EAdkC,CAArC,CAhFoD,CAgGpD;AACA;;AACAvb,IAAAA,UAAU,CAAC,YAAM;AACf8b,MAAAA,aAAa,CAACC,mBAAD,CAAb;AACD,KAFS,EAEPnB,eAFO,CAAV,CAlGoD,CAsGpD;AACA;;AACA,QAAIa,mBAAmB,CAACte,MAApB,GAA6B,CAAjC,EAAoC;AAClC,UAAI+e,OAAO,GAAGxC,SAAS,CAACc,WAAD,CAAvB;;AACA,UAAIA,WAAW,GAAG,CAAlB,EAAqB;AACnB;AACA0B,QAAAA,OAAO,GAAG9K,IAAI,CAACqB,CAAL,CAAO,0BAAP,EAAmCnT,OAAnC,CAA2C,IAA3C,EAAiDoa,SAAS,CAACc,WAAD,CAA1D,CAAV;AACD,OALiC,CAOlC;;;AACA,UAAM2B,UAAU,GAAG1f,CAAC,CAAC,6CAAD,CAAD,CACEkJ,QADF,CACY6U,WAAW,GAAG,CAAf,GAAoB,QAApB,GAA+B,OAD1C,EAEEjb,IAFF,CAEO2c,OAFP,EAGEE,WAHF,CAGcX,mBAHd,CAAnB,CARkC,CAalC;AACA;;AACA,UAAMY,mBAAmB,GAAI7B,WAAW,GAAG,CAAf,GAC1B;AACA;AACE,qBAAa,GADf;AAEE,mBAAW;AAFb,OAF0B,GAM1B;AACA;AACE,qBAAa,MADf;AAEE,mBAAW;AAFb,OAPF;AAYA,UAAM8B,gBAAgB,GAAGH,UAAU,CAChCvP,KADsB,CAChB,EADgB,EAEtBjH,QAFsB,CAEb,kBAFa,EAGtB4W,OAHsB,CAGdF,mBAHc,EAGO;AAC5B5N,QAAAA,QAAQ,EAAG+L,WAAW,GAAG,CAAf,GAAoBI,eAApB,GAAsCA,eADpB;AAE5B4B,QAAAA,MAAM,EAAE,OAFoB;AAG5BC,QAAAA,KAAK,EAAE;AAHqB,OAHP,EAOtB/B,OAPsB,EAAzB;AASA4B,MAAAA,gBAAgB,CAACT,MAAjB,CAAwB,YAAM;AAC1BM,QAAAA,UAAU,CAAC1d,MAAX;AACAkd,QAAAA,UAAU,CAAClB,OAAX;AACH,OAHD;AAID,KAxCD,MAyCK;AACH;AACAkB,MAAAA,UAAU,CAAClB,OAAX;AACD;;AAED,WAAOL,YAAY,CAACM,OAAb,EAAP;AACD;AAED;;;;;AAGA,MAAMzB,oBAAoB,GAAG;AAC3B;;;;;AAKAyD,IAAAA,MAAM,EAAE,EANmB;;AAQ3B;;;;;AAKAC,IAAAA,MAAM,EAAE,KAbmB;;AAe3B;;;;;;AAMA7N,IAAAA,IAAI,EAAE,SAAS8N,yBAAT,CAAmCzC,UAAnC,EAA+C0C,KAA/C,EAAsD;AAC1D,UAAI,CAACtS,CAAC,CAACuS,QAAF,CAAW3C,UAAX,CAAL,EAA6B;AAC3B;AACD,OAHyD,CAK1D;AACA;;;AACA,WAAKwC,MAAL,GAAcE,KAAd;;AAEA,WAAKH,MAAL,CAAY5N,IAAZ,CAAiBqL,UAAjB;;AAEA,UAAI,KAAKuC,MAAL,CAAYvf,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B;AACA0C,QAAAA,QAAQ,CAAC,KAAKkd,IAAN,EAAY,IAAZ,CAAR;AACD;AACF,KApC0B;;AAsC3B;;;AAGAA,IAAAA,IAAI,EAAE,SAASC,wBAAT,GAAoC;AAAA;;AACxC,UAAI,KAAKN,MAAL,CAAYvf,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B;AACA;AACD,OAJuC,CAMxC;AACA;;;AACA,UAAM8f,WAAW,GAAG,KAAKP,MAAL,CAAY,CAAZ,CAApB;AACA,UAAMQ,aAAa,GAAGhD,eAAe,CAAC+C,WAAD,EAAc,KAAKN,MAAnB,CAArC;AACA,WAAKA,MAAL,GAAc,KAAd;AAEAO,MAAAA,aAAa,CAACrB,MAAd,CAAqB,YAAM;AACzB,QAAA,KAAI,CAACa,MAAL,CAAYS,KAAZ,GADyB,CAEzB;;;AACA,QAAA,KAAI,CAACJ,IAAL;AACD,OAJD;AAKD;AA1D0B,GAA7B;AA6DA;;;;;AAIA,WAASjD,YAAT,GAAwB;AACtB,QAAInI,MAAM,GAAGlV,CAAC,CAAC,MAAD,CAAD,CAAUiC,IAAV,CAAe,MAAf,CAAb;;AACA,QAAI6L,CAAC,CAACiI,UAAF,CAAab,MAAb,EAAqB,KAArB,CAAJ,EAAiC;AAC/B;AACAA,MAAAA,MAAM,GAAG,UAAT;AACD,KALqB,CAOtB;AACA;AACA;AACA;AACA;AACA;;;AACA,QAAMyL,UAAU,GAAGC,IAAI,CAACC,eAAL,CAAqB3L,MAArB,EAA6BiH,MAAM,CAAChG,OAAP,EAA7B,CAAnB;;AAEA,QAAI,CAACwK,UAAD,IAAeA,UAAU,CAACG,WAAX,OAA6B5L,MAAM,CAAC4L,WAAP,EAAhD,EAAsE;AACpE,UAAI,CAACH,UAAL,EAAiB;AACf3M,QAAAA,UAAU,qCAA8BkB,MAA9B,gCAAV;AACD,OAFD,MAGK;AACHlB,QAAAA,UAAU,qCAA8BkB,MAA9B,mCAA6DyL,UAA7D,OAAV;AACD;AACF;;AAED,WAAOA,UAAU,IAAI,IAArB;AACD;AAED;;;;;AAGA,WAASI,kBAAT,GAA8B;AAC5B,QAAIxZ,WAAW,KAAK,WAApB,EAAiC;AAC/BgI,MAAAA,eAAe,CACb,iCADa,EAEb,gCAFa,EAGb,MAHa,EAIb,IAJa,EAIP,IAJO,EAKb,YAAW;AACT9M,QAAAA,WAAW,CAAC,iBAAD,CAAX;AACD,OAPY,CAAf;AASA;AACD;;AAED,QAAMmW,aAAa,GAAG5Y,CAAC,CAAC,IAAD,CAAD,CAAQwC,IAAR,CAAa,eAAb,CAAtB;AACA,QAAMqW,aAAa,GAAG7Y,CAAC,qDAA6C4Y,aAA7C,SAAD,CAAiEpW,IAAjE,CAAsE,eAAtE,CAAtB,CAf4B,CAiB5B;;AACA2W,IAAAA,YAAY,CAACiB,GAAb,CAAiB,oBAAjB,EAAuC,IAAvC;AACA/I,IAAAA,gBAAgB;AAChB2P,IAAAA,kBAAkB,CAAC,IAAD,EAAO,kCAAP,CAAlB;AAEArH,IAAAA,gCAAgC,CAAC,IAAIjB,sBAAJ,CAC/B,aAD+B,EAChBE,aADgB,EACDC,aADC,CAAD,CAAhC,CAEGoI,IAFH,CAEQ,UAACC,MAAD,EAAY;AAChB;AACAF,MAAAA,kBAAkB,CAAC,KAAD,CAAlB;AACA7H,MAAAA,YAAY,CAACiB,GAAb,CAAiB,oBAAjB,EAAuC,KAAvC;;AACA,UAAI8G,MAAM,CAACC,OAAX,EAAoB;AAClB;AACA9P,QAAAA,gBAAgB,CAAC6P,MAAM,CAACC,OAAR,CAAhB;AACD,OAHD,MAIK;AACH;AACAxH,QAAAA,gCAAgC,CAAC,IAAIrB,qBAAJ,CAA0B,mBAA1B,CAAD,CAAhC;AACD;;AAED,UAAI4I,MAAM,CAAChH,KAAX,EAAkB;AAChB;AACA3K,QAAAA,eAAe,CACb,iCADa,EAEb,gCAFa,EAGb,OAHa,EAIb,oCAJa,EAKb2R,MAAM,CAAChH,KALM,EAMb,IANa,CAAf,CAFgB,CAQP;AACV,OATD,MAUK;AACH,gBAAQgH,MAAM,CAACE,MAAf;AACE,eAAK9J,2BAA2B,CAACG,mBAAjC;AACE;AACA;AACA;AACA;AACA;AACAlI,YAAAA,eAAe,CACb,+CADa,EAEb,8CAFa,EAGb,SAHa,EAIb,IAJa,EAIN;AACP,gBALa,EAKN;AACP,gBANa,CAAf,CANF,CAYW;;AACT;;AAEF,eAAK+H,2BAA2B,CAACI,mBAAjC;AACE;AACA;AACA;AACA;AACA;AACAnI,YAAAA,eAAe,CACb,+CADa,EAEb,8CAFa,EAGb,SAHa,EAIb,IAJa,EAIN;AACP,gBALa,EAKN;AACP,gBANa,CAAf,CANF,CAYW;;AACT;;AAEF,eAAK+H,2BAA2B,CAACK,yBAAjC;AACE;AACA;AACApI,YAAAA,eAAe,CACb,qDADa,EAEb,oDAFa,EAGb,SAHa,EAIb,IAJa,EAIN;AACP,gBALa,EAKN;AACP,gBANa,CAAf,CAHF,CASW;;AACT;;AAEF,eAAK+H,2BAA2B,CAACM,uBAAjC;AACE;AACA;AACArI,YAAAA,eAAe,CACb,mDADa,EAEb,kDAFa,EAGb,SAHa,EAIb,IAJa,EAIN;AACP,gBALa,EAKN;AACP,gBANa,CAAf,CAHF,CASW;;AACT;;AAEF,eAAK+H,2BAA2B,CAACO,aAAjC;AACE;AAEA,gBAAI8C,aAAa,CAACH,UAAlB,EAA8B;AAC5B;AACA;AACA;AACAjL,cAAAA,eAAe,CACb,yCADa,EAEb,gDAFa,EAGb,SAHa,EAIb,IAJa,EAIN;AACP,kBALa,EAKN;AACP,kBANa,CAAf,CAJ4B,CAUnB;AACV,aAXD,MAYK;AACH;AACA;AACAA,cAAAA,eAAe,CACb,yCADa,EAEb,gDAFa,EAGb,OAHa,EAIb,IAJa,EAIN;AACP,kBALa,EAKN;AACP,kBANa,CAAf,CAHG,CASM;AACV,aAzBH,CA2BE;AACA;;;AACAoK,YAAAA,gCAAgC,CAAC,IAAIrB,qBAAJ,CAA0B,gBAA1B,CAAD,CAAhC;AACA;;AAEF,eAAKhB,2BAA2B,CAACU,WAAjC;AACE;AACAzI,YAAAA,eAAe,CACb,uCADa,EAEb,sCAFa,EAGb,OAHa,EAIb,IAJa,EAIN;AACP,gBALa,EAKN;AACP,gBANa,CAAf,CAFF,CAQW;;AACT;;AAEF,eAAK+H,2BAA2B,CAACE,OAAjC;AACE;AACAzE,YAAAA,kBAAkB,CAAC/S,CAAC,CAAC,0CAAD,CAAF,CAAlB,CAFF,CAGE;AACA;;AACA;;AAEF;AACE,kBAAM,IAAIqhB,KAAJ,CAAU,mDAAmDH,MAAM,CAACE,MAApE,CAAN;AA1GJ;AA4GD;AACF,KAvIH;AAwID;;AACDphB,EAAAA,CAAC,CAAC,yBAAD,CAAD,CAA6BsI,KAA7B,CAAmCyY,kBAAnC;AAGA;;;;AAGA,WAASO,WAAT,CAAqBlf,CAArB,EAAwB;AACtB,QAAIA,CAAJ,EAAO;AACLA,MAAAA,CAAC,CAACC,cAAF;AACD;;AAED,QAAIkF,WAAW,KAAK,WAApB,EAAiC;AAC/BgI,MAAAA,eAAe,CACb,iCADa,EAEb,gCAFa,EAGb,MAHa,EAIb,IAJa,EAIP,IAJO,EAKb,YAAW;AACT9M,QAAAA,WAAW,CAAC,iBAAD,CAAX;AACD,OAPY,CAAf;AASA;AACD;;AAEDA,IAAAA,WAAW,CAAC,cAAD,CAAX;;AAEA,QAAI,CAAC6e,WAAW,CAACC,wBAAb,IAAyC,CAAC5G,aAAa,CAACH,UAA5D,EAAwE;AACtE;AACA;AACAxa,MAAAA,CAAC,CAAC,8BAAD,CAAD,CAAkCiN,KAAlC,CAAwC;AAAEC,QAAAA,IAAI,EAAE,IAAR;AAAcC,QAAAA,QAAQ,EAAE;AAAxB,OAAxC;AACA;AACD;;AAEDmU,IAAAA,WAAW,CAACC,wBAAZ,GAAuC,KAAvC,CA3BsB,CA6BtB;;AACAzhB,IAAAA,MAAM,CAACU,QAAP,GAAkBR,CAAC,CAAC,mBAAD,CAAD,CAAuBwH,IAAvB,CAA4B,MAA5B,CAAlB;AACD;;AACDxH,EAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuBsI,KAAvB,CAA6BgZ,WAA7B;AAEA;;;;;AAIAthB,EAAAA,CAAC,CAAC,gDAAD,CAAD,CAAoDkC,EAApD,CAAuD,OAAvD,EAAgE,SAASsf,qCAAT,CAA+Cpf,CAA/C,EAAkD;AAChHA,IAAAA,CAAC,CAACC,cAAF;AACArC,IAAAA,CAAC,CAAC,8BAAD,CAAD,CAAkCiN,KAAlC,CAAwC,MAAxC,EAAgDJ,GAAhD,CAAoD,QAApD,EAA8D,YAAM;AAClE4U,MAAAA,mBAAmB;AACpB,KAFD;AAGD,GALD;AAMAzhB,EAAAA,CAAC,CAAC,gDAAD,CAAD,CAAoDkC,EAApD,CAAuD,OAAvD,EAAgE,SAASwf,mCAAT,CAA6Ctf,CAA7C,EAAgD;AAC9GA,IAAAA,CAAC,CAACC,cAAF;AACAif,IAAAA,WAAW,CAACC,wBAAZ,GAAuC,IAAvC;AACAvhB,IAAAA,CAAC,CAAC,8BAAD,CAAD,CAAkCiN,KAAlC,CAAwC,MAAxC,EAAgDJ,GAAhD,CAAoD,QAApD,EAA8D,YAAM;AAClEyU,MAAAA,WAAW;AACZ,KAFD;AAGD,GAND;AAQA;;;;;;AAKA,WAASrE,SAAT,CAAmB0E,OAAnB,EAA4B;AAC1B,QAAI,CAAC7T,CAAC,CAACuS,QAAF,CAAWsB,OAAX,CAAL,EAA0B;AACxBA,MAAAA,OAAO,GAAGpQ,QAAQ,CAACoQ,OAAD,CAAlB;AACD;;AAED,QAAIzD,OAAO,GAAG,GAAd;AAEA,QAAI0D,QAAQ,GAAG5hB,CAAC,CAAC,MAAD,CAAD,CAAUiC,IAAV,CAAe,MAAf,CAAf,CAP0B,CAS1B;AACA;AACA;;AAEA,QAAI4f,GAAG,GAAGF,OAAO,GAAGzD,OAApB,CAb0B,CAc1B;;AACA2D,IAAAA,GAAG,GAAG9a,IAAI,CAAC+a,KAAL,CAAWD,GAAG,GAAG,GAAjB,IAAwB,GAA9B,CAf0B,CAgB1B;;AACA,QAAI;AACFA,MAAAA,GAAG,GAAGA,GAAG,CAACE,cAAJ,CAAmBH,QAAnB,CAAN;AACD,KAFD,CAGA,OAAOxf,CAAP,EAAU;AACR;AACAyf,MAAAA,GAAG,GAAGA,GAAG,CAACE,cAAJ,CAAmB,IAAnB,CAAN;AACD,KAvByB,CAyB1B;AACA;;;AACA,QAAIF,GAAG,CAACG,SAAJ,CAAcH,GAAG,CAACnhB,MAAJ,GAAa,MAAMA,MAAjC,MAA6C,KAAjD,EAAwD;AACtDmhB,MAAAA,GAAG,GAAGA,GAAG,CAACG,SAAJ,CAAc,CAAd,EAAiBH,GAAG,CAACnhB,MAAJ,GAAa,MAAMA,MAApC,CAAN;AACD;;AAED,WAAOmhB,GAAP;AACD;AAED;;;;;;;AAKA,WAASJ,mBAAT,CAA6BvR,KAA7B,EAAoC;AAClC,QAAIA,KAAJ,EAAW;AACTA,MAAAA,KAAK,CAAC7N,cAAN;AACD;;AAED,QAAIkF,WAAW,KAAK,WAApB,EAAiC;AAC/B;AACAgI,MAAAA,eAAe,CACb,iCADa,EAEb,gCAFa,EAGb,MAHa,EAIb,IAJa,EAIP,IAJO,EAKb,YAAW;AACT9M,QAAAA,WAAW,CAAC,iBAAD,CAAX;AACD,OAPY,CAAf;AASA;AACD,KAjBiC,CAmBlC;;;AACAzC,IAAAA,CAAC,CAAC,qCAAD,CAAD,CAAyCmJ,WAAzC,CAAqD,OAArD,EApBkC,CAsBlC;;AACAnJ,IAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0BiN,KAA1B,CAAgC;AAC9BC,MAAAA,IAAI,EAAE,IADwB;AAE9BC,MAAAA,QAAQ,EAAE;AAFoB,KAAhC,EAGGN,GAHH,CAGO,OAHP,EAGgB,YAAY;AAC1B7M,MAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBqE,OAAtB,CAA8B,OAA9B;AACD,KALD,EAKGwI,GALH,CAKO,QALP,EAKiB,YAAY;AAC3B;AACA7M,MAAAA,CAAC,CAAC,uCAAD,CAAD,CAA2C6O,GAA3C,CAA+C,EAA/C,EAF2B,CAI3B;AACA;AACA;AACD,KAZD;AAaD;;AACD7O,EAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuBkC,EAAvB,CAA0B,OAA1B,EAAmCuf,mBAAnC;AAEA;;;;;AAIA,WAASQ,gCAAT,CAA0C/R,KAA1C,EAAiD;AAC/C,QAAIA,KAAJ,EAAW;AACTA,MAAAA,KAAK,CAAC7N,cAAN;AACD;;AAED,QAAIkF,WAAW,KAAK,WAApB,EAAiC;AAC/B;AACA;AACAvH,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0BiN,KAA1B,CAAgC,MAAhC,EAAwCJ,GAAxC,CAA4C,QAA5C,EAAsD,YAAY;AAChE0C,QAAAA,eAAe,CACb,iCADa,EAEb,gCAFa,EAGb,MAHa,EAIb,IAJa,EAIP,IAJO,EAKb,YAAW;AACT9M,UAAAA,WAAW,CAAC,iBAAD,CAAX;AACD,SAPY,CAAf;AASD,OAVD;AAWA;AACD;;AAED,QAAMsW,QAAQ,GAAG/Y,CAAC,CAAC,kBAAD,CAAD,CAAsB6O,GAAtB,EAAjB;AACA,QAAMmK,QAAQ,GAAGhZ,CAAC,CAAC,kBAAD,CAAD,CAAsB6O,GAAtB,EAAjB,CAvB+C,CAyB/C;;AACA7O,IAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBwI,OAAtB,CAA8B,gBAA9B,EAAgDI,WAAhD,CAA4D,OAA5D,EAAqE,CAACmQ,QAAtE;AACA/Y,IAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBwI,OAAtB,CAA8B,gBAA9B,EAAgDI,WAAhD,CAA4D,OAA5D,EAAqE,CAACoQ,QAAtE;;AACA,QAAI,CAACD,QAAD,IAAa,CAACC,QAAlB,EAA4B;AAC1BhZ,MAAAA,CAAC,CAAC,CAAC+Y,QAAD,GAAY,kBAAZ,GAAiC,kBAAlC,CAAD,CAAuD1U,OAAvD,CAA+D,OAA/D;AACA;AACD,KA/B8C,CAiC/C;AACA;AACA;;;AACArE,IAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0BiN,KAA1B,CAAgC,MAAhC,EApC+C,CAsC/C;;AACA+T,IAAAA,kBAAkB,CAAC,IAAD,EAAO,gCAAP,CAAlB;AAEArH,IAAAA,gCAAgC,CAAC,IAAIb,mBAAJ,CAAwBC,QAAxB,EAAkCC,QAAlC,CAAD,CAAhC,CACGiI,IADH,CACQ,UAACC,MAAD,EAAY;AAEhB;AACA;AACA,UAAIA,MAAM,CAACE,MAAP,KAAkB9J,2BAA2B,CAACE,OAAlD,EAA2D;AACzDwJ,QAAAA,kBAAkB,CAAC,KAAD,EAAQ,IAAR,CAAlB;AACD;;AAED,UAAIE,MAAM,CAACC,OAAX,EAAoB;AAClB;AACA;AACA;AACA9P,QAAAA,gBAAgB,CAAC6P,MAAM,CAACC,OAAR,CAAhB;AACD,OALD,MAMK;AACH;AACAxH,QAAAA,gCAAgC,CAAC,IAAIrB,qBAAJ,CAA0B,eAA1B,CAAD,CAAhC;AACD;;AAED,UAAI4I,MAAM,CAAChH,KAAX,EAAkB;AAChB;AACA3K,QAAAA,eAAe,CACb,mCADa,EAEb,uCAFa,EAGb,OAHa,EAIb,oCAJa,EAKb2R,MAAM,CAAChH,KALM,EAMb,IANa,CAAf,CAFgB,CAQP;AACV,OATD,MAUK;AACH,gBAAQgH,MAAM,CAACE,MAAf;AACE,eAAK9J,2BAA2B,CAACQ,kBAAjC;AACEvI,YAAAA,eAAe,CACb,mCADa,EAEb,wCAFa,EAGb,SAHa,EAIb,IAJa,EAIN;AACP,gBALa,EAKN;AACP,gBANa,CAAf,CADF,CAOW;;AACT;;AAEF,eAAK+H,2BAA2B,CAACS,UAAjC;AACE;AACAxI,YAAAA,eAAe,CACb,mCADa,EAEb,qCAFa,EAGb,OAHa,EAIb,IAJa,EAIN;AACP,gBALa,EAKN;AACP,gBANa,CAAf,CAFF,CAQW;;AACT;;AAEF,eAAK+H,2BAA2B,CAACU,WAAjC;AACE;AACAzI,YAAAA,eAAe,CACb,mCADa,EAEb,iCAFa,EAGb,OAHa,EAIb,IAJa,EAIN;AACP,gBALa,EAKN;AACP,gBANa,CAAf,CAFF,CAQW;;AACT;;AAEF,eAAK+H,2BAA2B,CAACE,OAAjC;AACE;AACA,gBAAI0J,MAAM,CAACgB,kBAAX,EAA+B;AAC7B3S,cAAAA,eAAe,CACb,mCADa,EAEb,uCAFa,EAGb,SAHa,EAIb,IAJa,EAIN;AACP,kBALa,EAKN;AACP,kBANa,CAAf,CAD6B,CAOpB;AACV,aAVH,CAYE;AACA;;;AACAoK,YAAAA,gCAAgC,CAAC,IAAIrB,qBAAJ,CAA0B,WAA1B,CAAD,CAAhC,CAAyE2I,IAAzE,CAA8E,YAAM;AAClFD,cAAAA,kBAAkB,CAAC,KAAD,EAAQ,IAAR,CAAlB;AACD,aAFD;AAGA;;AAEF;AACE,kBAAM,IAAIK,KAAJ,CAAU,0DAA0DH,MAAM,CAACE,MAA3E,CAAN;AArDJ;AAuDD;AACF,KAvFH;AAwFD;;AACDphB,EAAAA,CAAC,CAAC,wCAAD,CAAD,CAA4CkC,EAA5C,CAA+C,OAA/C,EAAwD+f,gCAAxD;AACAjiB,EAAAA,CAAC,CAAC,4BAAD,CAAD,CAAgCkC,EAAhC,CAAmC,OAAnC,EAA4C,UAAUgO,KAAV,EAAiB;AAC3D,QAAIA,KAAK,CAACtC,GAAN,KAAc,OAAd,IAAyBsC,KAAK,CAACiS,OAAN,KAAkB,EAA/C,EAAmD;AACjDF,MAAAA,gCAAgC;AACjC;AACF,GAJD;AAMA;;;;;;;;AAOA,WAASG,oBAAT,CAA8BlS,KAA9B,EAA+D;AAAA,QAA1BmS,kBAA0B,uEAAP,KAAO;;AAC7D,QAAInS,KAAJ,EAAW;AACTA,MAAAA,KAAK,CAAC7N,cAAN;AACD;;AAED,QAAI,CAACggB,kBAAD,IAAuB9a,WAAW,KAAK,WAA3C,EAAwD;AACtDvH,MAAAA,CAAC,CAAC,8BAAD,CAAD,CAAkCiN,KAAlC,CAAwC;AAAEC,QAAAA,IAAI,EAAE,IAAR;AAAcC,QAAAA,QAAQ,EAAE;AAAxB,OAAxC;AACA;AACD;;AAED6T,IAAAA,kBAAkB,CAAC,IAAD,EAAO,iCAAP,CAAlB;AACA7H,IAAAA,YAAY,CAACiB,GAAb,CAAiB,gBAAjB,EAAmC,IAAnC;AAEAT,IAAAA,gCAAgC,CAAC,IAAIV,oBAAJ,EAAD,CAAhC,CACGgI,IADH,CACQ,UAACC,MAAD,EAAY;AAChBF,MAAAA,kBAAkB,CAAC,KAAD,EAAQ,IAAR,CAAlB;;AAEA,UAAIE,MAAM,CAACC,OAAX,EAAoB;AAClB;AACA9P,QAAAA,gBAAgB,CAAC6P,MAAM,CAACC,OAAR,CAAhB;AACD;;AAED,UAAID,MAAM,CAAC1F,kBAAX,EAA+B;AAC7B;AACAD,QAAAA,qBAAqB,CAAC,qDAAD,CAArB;AACAE,QAAAA,iCAAiC;AAAC;AAAqB,YAAtB,CAAjC;AACD;;AAED,UAAIyF,MAAM,CAAChH,KAAX,EAAkB;AAChB;AACA3K,QAAAA,eAAe,CACb,6BADa,EAEb,iCAFa,EAGb,OAHa,EAIb,oCAJa,EAKb2R,MAAM,CAAChH,KALM,EAMb,IANa,CAAf,CAFgB,CAQP;AACV,OATD,MAUK;AACH;AACA;AACA;AACAP,QAAAA,gCAAgC,CAAC,IAAIrB,qBAAJ,CAA0B,QAA1B,CAAD,CAAhC;AACD;AACF,KA/BH;AAgCD;;AACDtY,EAAAA,CAAC,CAAC,oBAAD,CAAD,CAAwBkC,EAAxB,CAA2B,OAA3B,EAAoCkgB,oBAApC;AAEA;;;;;AAIApiB,EAAAA,CAAC,CAAC,iDAAD,CAAD,CAAqDkC,EAArD,CAAwD,OAAxD,EAAiE,UAACE,CAAD,EAAO;AACtEA,IAAAA,CAAC,CAACC,cAAF;AACArC,IAAAA,CAAC,CAAC,8BAAD,CAAD,CAAkCiN,KAAlC,CAAwC,MAAxC,EAAgDJ,GAAhD,CAAoD,QAApD,EAA8D,YAAM;AAClEpE,MAAAA,6BAA6B;AAC7BhG,MAAAA,WAAW,CAAC,iBAAD,CAAX;AACD,KAHD;AAID,GAND;AAOAzC,EAAAA,CAAC,CAAC,gDAAD,CAAD,CAAoDkC,EAApD,CAAuD,OAAvD,EAAgE,UAACE,CAAD,EAAO;AACrEA,IAAAA,CAAC,CAACC,cAAF;AACArC,IAAAA,CAAC,CAAC,8BAAD,CAAD,CAAkCiN,KAAlC,CAAwC,MAAxC,EAAgDJ,GAAhD,CAAoD,QAApD,EAA8D,YAAM;AAClEuV,MAAAA,oBAAoB,CAAC,IAAD,EAAO,IAAP,CAApB;AACD,KAFD;AAGD,GALD;AAOA;;;;;;AAKA,WAASpB,kBAAT,CAA4BsB,KAA5B,EAAmCC,eAAnC,EAAoD;AAClD,QAAIA,eAAJ,EAAqB;AACnBviB,MAAAA,CAAC,CAAC,qCAAD,CAAD,CAAyC8R,GAAzC,CAA6CyQ,eAA7C,EAA8DrZ,QAA9D,CAAuE,QAAvE;AACAlJ,MAAAA,CAAC,CAACuiB,eAAD,CAAD,CAAmBpZ,WAAnB,CAA+B,QAA/B;AACD;;AAEDnJ,IAAAA,CAAC,CAAC,6CAAD,CAAD,CAAiD4I,WAAjD,CAA6D,QAA7D,EAAuE,CAAC0Z,KAAxE;AACD;;AAED,WAASvI,yCAAT,GAAqD;AACnD;AACA;AACA;AACA;AACA;AACAzE,IAAAA,SAAS,CAAC,qBAAD,EAAwB,KAAxB,CAAT;AACA7S,IAAAA,WAAW,CAAC,cAAD,EAAiB,YAAM;AAChC;AACA;AACA;AACA;AACA;AACAc,MAAAA,UAAU,CAAC,YAAM;AACf,YAAMqW,oBAAoB,GAAG5Z,CAAC,CAAC,uCAAD,CAA9B;AACA,YAAM6Z,0BAA0B,GAAG7Z,CAAC,CAAC4Z,oBAAoB,CAACpX,IAArB,CAA0B,QAA1B,CAAD,CAApC;;AACA,YAAI,CAACqX,0BAA0B,CAAChS,QAA3B,CAAoC,IAApC,CAAL,EAAgD;AAC9CgS,UAAAA,0BAA0B,CAAChI,QAA3B,CAAoC,MAApC;AACD;AACF,OANS,EAMP,IANO,CAAV;AAOD,KAbU,CAAX;AAcD;AAED;;;;;;;AAKA,WAAS2Q,6BAAT,GAAyC;AACvC,QAAIrJ,YAAY,CAAC3W,IAAb,CAAkB+W,OAAlB,KAA8BqB,cAAc,CAACK,YAAjD,EAA+D;AAC7D;AACA;AACAxX,MAAAA,SAAS,CAAC,iDAAD,CAAT;AACA;AACD;;AAEDwP,IAAAA,MAAM,CAAC;AACLM,MAAAA,QAAQ,EAAE,CADL;AACQ;AACbD,MAAAA,OAAO,EAAE;AAFJ,KAAD,CAAN;;AAKA,QAAIjT,SAAS,CAACqK,QAAV,CAAmBc,6BAAvB,EAAsD;AACpD;AACA/H,MAAAA,SAAS,CAAC,sEAAD,CAAT;AACA;AACD;;AAED,QAAI,CAAC+e,6BAA6B,CAACC,sBAAnC,EAA2D;AACzD;AACAhf,MAAAA,SAAS,CAAC,iEAAD,CAAT;AACA;AACD,KAvBsC,CAwBvC;;;AAEAA,IAAAA,SAAS,CAAC,8CAAD,CAAT;AAEA+e,IAAAA,6BAA6B,CAACC,sBAA9B,GAAuD,KAAvD;AAEAC,IAAAA,mCAAmC;AAEnCnT,IAAAA,eAAe,CACb,uCADa,EAEb,sCAFa,EAGb,MAHa,EAIb,IAJa,EAIP,IAJO,EAID,YAAM;AAChBwK,MAAAA,yCAAyC;AAEzC;;;;;;;;;;;AAWD,KAlBY,CAAf;AAmBD;;AACDyI,EAAAA,6BAA6B,CAACC,sBAA9B,GAAuD,IAAvD;AACA1iB,EAAAA,OAAO,CAACmC,EAAR,CAAW/B,4BAAX,EAAyC,YAAM;AAC7C,QAAIoH,WAAW,KAAK,SAApB,EAA+B;AAC7B;AACA9D,MAAAA,SAAS,CAAC,yGAAD,CAAT;AACA+e,MAAAA,6BAA6B,CAACC,sBAA9B,GAAuD,IAAvD;AACD;AACF,GAND;AAOAtJ,EAAAA,YAAY,CAACwJ,SAAb,CAAuB,SAAvB,EAAkC,YAAM;AACtC,QAAIxJ,YAAY,CAAC3W,IAAb,CAAkB+W,OAAlB,KAA8BqB,cAAc,CAACK,YAA7C,IACA,CAACuH,6BAA6B,CAACI,QADnC,EAC6C;AAC3Cnf,MAAAA,SAAS,CAAC,8CAAD,CAAT;AACA+e,MAAAA,6BAA6B,CAACI,QAA9B,GAAyC,IAAzC;AACD,KAJD,MAKK,IAAIJ,6BAA6B,CAACI,QAAlC,EAA4C;AAC/C;AACAnf,MAAAA,SAAS,CAAC,6FAAD,CAAT;AACA+e,MAAAA,6BAA6B,CAACI,QAA9B,GAAyC,KAAzC;AACAJ,MAAAA,6BAA6B,CAACC,sBAA9B,GAAuD,IAAvD;AACD;AACF,GAZD;AAcA;;AAEA,WAAS1P,kBAAT,CAA4B3J,IAA5B,EAAkC;AAChChG,IAAAA,QAAQ,CAAC,YAAM;AACb;AACA,UAAMyf,mBAAmB,GAAG,GAA5B;AACA,UAAMC,WAAW,GAAG,IAApB;AACA,UAAMC,sBAAsB,GAAG,IAA/B,CAJa,CAKb;AACA;AACA;AACA;AACA;AACA;;AACA/iB,MAAAA,CAAC,CAACoJ,IAAD,CAAD,CAAQ4Z,MAAR,CAAe;AACbhR,QAAAA,QAAQ,EAAE6Q,mBADG;AAEbI,QAAAA,QAAQ,EAAE,oBAAM;AACd1f,UAAAA,UAAU,CAAC,YAAW;AACpBvD,YAAAA,CAAC,CAACoJ,IAAD,CAAD,CAAQ4Z,MAAR,CAAe;AAAChR,cAAAA,QAAQ,EAAE+Q;AAAX,aAAf;AACD,WAFS,EAEPD,WAFO,CAAV;AAGD;AANY,OAAf;AAQD,KAnBO,CAAR;AAoBD,GArzGe,CAuzGhB;AACA;;;AACA,WAASrgB,WAAT,CAAqB4K,GAArB,EAA0B6V,QAA1B,EAAoC;AAClC,QAAIC,IAAI,GAAGnjB,CAAC,CAACqN,GAAD,CAAZ;;AACA,QAAI8V,IAAI,CAACtb,QAAL,CAAc,QAAd,CAAJ,EAA6B;AAC3B;AACA,UAAIqb,QAAJ,EAAc;AACZ9f,QAAAA,QAAQ,CAAC8f,QAAD,CAAR;AACD;AACF,KALD,MAMK;AACH;AACA,UAAIA,QAAJ,EAAc;AACZC,QAAAA,IAAI,CAAC9Y,IAAL,CAAU,qBAAV,EAAiCwC,GAAjC,CAAqC,OAArC,EAA8CqW,QAA9C;AACD;;AACDC,MAAAA,IAAI,CAAC9Y,IAAL,CAAU,qBAAV,EAAiCgD,GAAjC,CAAqC,MAArC;AACD;AACF;AAED;;;;;;;;;;;;AAUA,WAASkC,eAAT,CAAyB6T,QAAzB,EAAmC1S,OAAnC,EAA4C2S,SAA5C,EAAuDC,eAAvD,EAAwEC,cAAxE,EAAwFC,cAAxF,EAAwG;AACtGC,IAAAA,YAAY,CAACL,QAAQ,IAAI1S,OAAb,EAAsB,6BAAtB,EAAqD0S,QAArD,EAA+D1S,OAA/D,CAAZ;AAEA,QAAI1D,MAAM,GAAGhN,CAAC,CAAC,cAAD,CAAd;AAEAgN,IAAAA,MAAM,CAAC3C,IAAP,CAAY,iBAAZ,EAA+Bb,IAA/B,CAAoCmL,IAAI,CAACqB,CAAL,CAAOoN,QAAP,CAApC;AACApW,IAAAA,MAAM,CAAC3C,IAAP,CAAY,uBAAZ,EAAqCb,IAArC,CAA0CmL,IAAI,CAACqB,CAAL,CAAOtF,OAAP,CAA1C;AAEA1D,IAAAA,MAAM,CAAC3C,IAAP,CAAY,iBAAZ,EAA+BnB,QAA/B,CAAwC,QAAxC;;AACA,QAAIma,SAAJ,EAAe;AACbrW,MAAAA,MAAM,CAAC3C,IAAP,4BAAgCgZ,SAAhC,GAA6Cla,WAA7C,CAAyD,QAAzD;AACD;;AAED,QAAIma,eAAe,IAAIC,cAAvB,EAAuC;AACrCvW,MAAAA,MAAM,CAAC3C,IAAP,CAAY,gCAAZ,EAA8Cb,IAA9C,CAAmDmL,IAAI,CAACqB,CAAL,CAAOsN,eAAP,CAAnD;AACAtW,MAAAA,MAAM,CAAC3C,IAAP,CAAY,4BAAZ,EAA0CvH,IAA1C,CAA+CygB,cAA/C;AACAvW,MAAAA,MAAM,CAAC3C,IAAP,CAAY,uBAAZ,EAAqClB,WAArC,CAAiD,QAAjD;AACD,KAJD,MAKK;AACH6D,MAAAA,MAAM,CAAC3C,IAAP,CAAY,uBAAZ,EAAqCnB,QAArC,CAA8C,QAA9C;AACD,KApBqG,CAsBtG;;;AACA8D,IAAAA,MAAM,CAACC,KAAP,CAAa;AACXC,MAAAA,IAAI,EAAE,IADK;AAEXC,MAAAA,QAAQ,EAAE;AAFC,KAAb,EAGGN,GAHH,CAGO,QAHP,EAGiB,YAAW;AAC1B,UAAI2W,cAAJ,EAAoB;AAClBA,QAAAA,cAAc;AACf;AACF,KAPD;AAQD;AAED;AAEA;;;AACA,WAASlf,aAAT,GAAyB;AACvB,QAAIuB,CAAJ;AAAA,QAAOM,CAAP;AAAA,QAAUud,KAAV;AAAA,QAAiBC,aAAjB;AAAA,QAAgCC,yBAAyB,GAAG,EAA5D;AAAA,QAAgEC,qBAAhE;AACA,QAAIC,cAAc,GAAG9jB,CAAC,CAAC,qBAAD,CAAtB,CAFuB,CAIvB;AACA;AACA;;AACA,SAAK6F,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGie,cAAc,CAACpjB,MAA/B,EAAuCmF,CAAC,EAAxC,EAA4C;AAC1C6d,MAAAA,KAAK,GAAGI,cAAc,CAAC5Z,EAAf,CAAkBrE,CAAlB,CAAR,CAD0C,CAG1C;;AACA,UAAIiI,CAAC,CAACa,WAAF,CAAc+U,KAAK,CAAClhB,IAAN,CAAW,+BAAX,CAAd,CAAJ,EAAgE;AAC9DkhB,QAAAA,KAAK,CAAClhB,IAAN,CAAW,+BAAX,EAA4C+O,QAAQ,CAACmS,KAAK,CAACtf,GAAN,CAAU,aAAV,CAAD,CAApD,EACM5B,IADN,CACW,kCADX,EAC+C+O,QAAQ,CAACmS,KAAK,CAACtf,GAAN,CAAU,gBAAV,CAAD,CADvD;AAED,OAPyC,CAS1C;;;AACAsf,MAAAA,KAAK,CAACtf,GAAN,CAAU,aAAV,EAAyBsf,KAAK,CAAClhB,IAAN,CAAW,+BAAX,CAAzB,EACM4B,GADN,CACU,gBADV,EAC4Bsf,KAAK,CAAClhB,IAAN,CAAW,kCAAX,CAD5B;AAGAmhB,MAAAA,aAAa,GAAGD,KAAK,CAAClhB,IAAN,CAAW,cAAX,CAAhB;AACAohB,MAAAA,yBAAyB,CAACD,aAAD,CAAzB,GAA2C,IAA3C;AACD,KAtBsB,CAwBvB;AACA;AACA;;;AACA,SAAK9d,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGie,cAAc,CAACpjB,MAA/B,EAAuCmF,CAAC,EAAxC,EAA4C;AAC1C6d,MAAAA,KAAK,GAAGI,cAAc,CAAC5Z,EAAf,CAAkBrE,CAAlB,CAAR;AACA8d,MAAAA,aAAa,GAAGD,KAAK,CAAClhB,IAAN,CAAW,cAAX,CAAhB,CAF0C,CAI1C;;AACA,UAAIohB,yBAAyB,CAACD,aAAD,CAAzB,KAA6C,IAAjD,EAAuD;AACrDE,QAAAA,qBAAqB,GAAI7jB,CAAC,CAAC2jB,aAAD,CAA1B;;AACA,aAAKxd,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG0d,qBAAqB,CAACnjB,MAAtC,EAA8CyF,CAAC,EAA/C,EAAmD;AACjDyd,UAAAA,yBAAyB,CAACD,aAAD,CAAzB,GAA2C5c,IAAI,CAACuV,GAAL,CACzCsH,yBAAyB,CAACD,aAAD,CADgB,EAEzCE,qBAAqB,CAAC3Z,EAAtB,CAAyB/D,CAAzB,EAA4BnD,MAA5B,EAFyC,CAA3C;AAGD;AACF,OAZyC,CAc1C;;;AACA+gB,MAAAA,WAAW,CAACL,KAAD,EAAQE,yBAAyB,CAACD,aAAD,CAAjC,CAAX;AACD;;AAED,aAASI,WAAT,CAAqBL,KAArB,EAA4B1gB,MAA5B,EAAoC;AAClC,UAAIghB,UAAU,GAAGhhB,MAAM,GAAG0gB,KAAK,CAAC1gB,MAAN,EAA1B;;AACA,UAAIghB,UAAU,IAAI,CAAlB,EAAqB;AACnB;AACA;AACD;;AAED,UAAIC,KAAK,GAAGP,KAAK,CAAClhB,IAAN,CAAW,oBAAX,CAAZ;;AACA,UAAIyhB,KAAK,KAAK,KAAd,EAAqB;AACnBP,QAAAA,KAAK,CAACtf,GAAN,CAAU,gBAAV,EAA4B4f,UAAU,GAAGN,KAAK,CAAClhB,IAAN,CAAW,kCAAX,CAAzC;AACD,OAFD,MAGK,IAAIyhB,KAAK,KAAK,QAAd,EAAwB;AAC3BP,QAAAA,KAAK,CAACtf,GAAN,CAAU,aAAV,EAAyB4f,UAAU,GAAGN,KAAK,CAAClhB,IAAN,CAAW,+BAAX,CAAtC;AACD,OAFI,MAGA;AAAE;AACLkhB,QAAAA,KAAK,CAACtf,GAAN,CAAU,aAAV,EAAyB4f,UAAU,GAAC,CAAX,GAAeN,KAAK,CAAClhB,IAAN,CAAW,+BAAX,CAAxC,EACM4B,GADN,CACU,gBADV,EAC4B4f,UAAU,GAAC,CAAX,GAAeN,KAAK,CAAClhB,IAAN,CAAW,kCAAX,CAD3C;AAED;AACF;AACF,GAx7Ge,CA07GhB;;;AACA,WAAS+B,YAAT,GAAwB;AACtB,QAAI2f,cAAc,GAAG,EAArB;AAAA,QAAyBC,eAAzB;AAAA,QAA0CT,KAA1C;AAAA,QACIC,aADJ;AAAA,QACmBS,cADnB;AAAA,QACmCC,qBADnC;AAAA,QAC0Dxe,CAD1D;AAAA,QAC6DM,CAD7D;AAGAge,IAAAA,eAAe,GAAGnkB,CAAC,CAAC,oBAAD,CAAnB,CAJsB,CAMtB;AACA;AACA;;AACA,SAAK6F,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGse,eAAe,CAACzjB,MAAhC,EAAwCmF,CAAC,EAAzC,EAA6C;AAC3C6d,MAAAA,KAAK,GAAGS,eAAe,CAACja,EAAhB,CAAmBrE,CAAnB,CAAR;AACA6d,MAAAA,KAAK,CAACtf,GAAN,CAAU,OAAV,EAAmB,EAAnB,EAF2C,CAI3C;;AACAuf,MAAAA,aAAa,GAAGD,KAAK,CAAClhB,IAAN,CAAW,aAAX,CAAhB;;AACA,UAAI,CAACsL,CAAC,CAACmC,QAAF,CAAWiU,cAAX,EAA2BP,aAA3B,CAAL,EAAgD;AAC9C,YAAID,KAAK,CAAClhB,IAAN,CAAW,uBAAX,MAAwC,MAA5C,EAAoD;AAClD0hB,UAAAA,cAAc,CAAC7R,IAAf,CAAoBsR,aAApB;AACD,SAFD,MAGK;AACHO,UAAAA,cAAc,CAACI,OAAf,CAAuBX,aAAvB;AACD;AACF;AACF,KAvBqB,CAyBtB;;;AACA,SAAK9d,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGqe,cAAc,CAACxjB,MAA/B,EAAuCmF,CAAC,EAAxC,EAA4C;AAC1C8d,MAAAA,aAAa,GAAGO,cAAc,CAACre,CAAD,CAA9B;AAEAwe,MAAAA,qBAAqB,GAAG,GAAxB;AACAD,MAAAA,cAAc,GAAGpkB,CAAC,CAAC2jB,aAAD,CAAlB;;AACA,WAAKxd,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGie,cAAc,CAAC1jB,MAA/B,EAAuCyF,CAAC,EAAxC,EAA4C;AAC1Cke,QAAAA,qBAAqB,GAAGtd,IAAI,CAACuV,GAAL,CACE+H,qBADF,EAEED,cAAc,CAACla,EAAf,CAAkB/D,CAAlB,EAAqB1B,UAArB,EAFF,CAAxB;AAGD,OATyC,CAW1C;;;AACA0f,MAAAA,eAAe,GAAGnkB,CAAC,CAAC,wBAAwB2jB,aAAxB,GAAwC,IAAzC,CAAnB;;AACA,WAAKxd,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGge,eAAe,CAACzjB,MAAhC,EAAwCyF,CAAC,EAAzC,EAA6C;AAC3Cud,QAAAA,KAAK,GAAGS,eAAe,CAACja,EAAhB,CAAmB/D,CAAnB,CAAR;AACAud,QAAAA,KAAK,CAACxgB,KAAN,CAAYqhB,WAAW,CAACb,KAAD,EAAQW,qBAAR,CAAvB;AACD;AACF;;AAED,aAASE,WAAT,CAAqBb,KAArB,EAA4Bc,UAA5B,EAAwC;AACtC,aAAOA,UAAU,IACRpc,UAAU,CAACsb,KAAK,CAACtf,GAAN,CAAU,eAAV,CAAD,CAAV,IAA0C,CADlC,CAAV,IAEEgE,UAAU,CAACsb,KAAK,CAACtf,GAAN,CAAU,cAAV,CAAD,CAAV,IAAyC,CAF3C,KAGEgE,UAAU,CAACsb,KAAK,CAACtf,GAAN,CAAU,oBAAV,CAAD,CAAV,IAA+C,CAHjD,KAIEgE,UAAU,CAACsb,KAAK,CAACtf,GAAN,CAAU,mBAAV,CAAD,CAAV,IAA8C,CAJhD,KAKEgE,UAAU,CAACsb,KAAK,CAACtf,GAAN,CAAU,cAAV,CAAD,CAAV,IAAyC,CAL3C,KAMEgE,UAAU,CAACsb,KAAK,CAACtf,GAAN,CAAU,aAAV,CAAD,CAAV,IAAwC,CAN1C,CAAP;AAOD;AACF;AAED;;;;;;;;AAMA,WAASa,YAAT,GAAwB;AACtB;AACA;AAEA,QAAIwf,WAAJ,EAAiBC,SAAjB,EAA4BC,SAA5B,EAAuCC,YAAvC,EAAqDC,SAArD;AAEA,QAAIC,SAAS,GAAG,KAAhB,CANsB,CAQtB;AACA;;AAEA,QAAI1kB,UAAJ,EAAgB;AACd;AACA;AAEA;AACAqkB,MAAAA,WAAW,GAAG3kB,MAAM,CAACilB,SAAP,CAAiBC,SAAjB,CAA2Bre,KAA3B,CAAiC,0CAAjC,CAAd,CALc,CAMd;;AACA+d,MAAAA,SAAS,GAAG5kB,MAAM,CAACilB,SAAP,CAAiBC,SAAjB,CAA2Bre,KAA3B,CAAiC,gBAAjC,CAAZ,CAPc,CAQd;;AACAge,MAAAA,SAAS,GAAG7kB,MAAM,CAACilB,SAAP,CAAiBC,SAAjB,CAA2Bre,KAA3B,CAAiC,aAAjC,CAAZ;;AAEA,UAAI8d,WAAJ,EAAiB;AACfK,QAAAA,SAAS,GAAGvT,QAAQ,CAACkT,WAAW,CAAC,CAAD,CAAZ,CAApB;AACD,OAFD,MAGK,IAAIC,SAAJ,EAAe;AAClB;AACAI,QAAAA,SAAS,GAAGvT,QAAQ,CAACmT,SAAS,CAAC,CAAD,CAAV,CAAR,GAAyB,CAArC;AACD,OAHI,MAIA,IAAIC,SAAJ,EAAe;AAClBG,QAAAA,SAAS,GAAGvT,QAAQ,CAACoT,SAAS,CAAC,CAAD,CAAV,CAApB;AACD;AACF,KArBD,MAsBK;AACH;AACAC,MAAAA,YAAY,GAAG9kB,MAAM,CAACilB,SAAP,CAAiBC,SAAjB,CAA2Bre,KAA3B,CAAiC,0BAAjC,CAAf,CAFG,CAGH;;AACAke,MAAAA,SAAS,GAAG/kB,MAAM,CAACilB,SAAP,CAAiBC,SAAjB,CAA2Bre,KAA3B,CAAiC,YAAjC,CAAZ,CAJG,CAMH;AACA;AACA;;AACAge,MAAAA,SAAS,GAAG7kB,MAAM,CAACilB,SAAP,CAAiBC,SAAjB,CAA2Bre,KAA3B,CAAiC,aAAjC,CAAZ;;AAEA,UAAIie,YAAJ,EAAkB;AAChB;AACAE,QAAAA,SAAS,GAAGvT,QAAQ,CAACqT,YAAY,CAAC,CAAD,CAAb,CAAR,GAA4B,CAAxC;AACD,OAHD,MAIK,IAAIC,SAAJ,EAAe;AAClBC,QAAAA,SAAS,GAAGvT,QAAQ,CAACsT,SAAS,CAAC,CAAD,CAAV,CAApB;AACD,OAFI,MAGA,IAAIF,SAAJ,EAAe;AAClBG,QAAAA,SAAS,GAAGvT,QAAQ,CAACoT,SAAS,CAAC,CAAD,CAAV,CAApB;AACD;AACF;;AAED,WAAOG,SAAP;AACD,GAljHe,CAojHhB;;;AACA,WAAS/iB,gBAAT,CAA0BkjB,UAA1B,EAAsCC,aAAtC,EAAqDC,WAArD,EAAkE;AAChE,QAAIL,SAAS,GAAG7f,YAAY,EAA5B;;AAEA,QAAI6f,SAAS,KAAK,KAAlB,EAAyB;AACvB,aAAOK,WAAP;AACD;;AAED,QAAIF,UAAU,KAAK,IAAnB,EAAyB;AACvB,aAAOH,SAAS,IAAII,aAApB;AACD,KAFD,MAGK,IAAID,UAAU,KAAK,IAAnB,EAAyB;AAC5B,aAAOH,SAAS,GAAGI,aAAnB;AACD,KAFI,MAGA,IAAID,UAAU,KAAK,IAAnB,EAAyB;AAC5B,aAAOH,SAAS,GAAGI,aAAnB;AACD,KAFI,MAGA,IAAID,UAAU,KAAK,KAAnB,EAA0B;AAC7B,aAAOH,SAAS,IAAII,aAApB;AACD,KAFI,MAGA,IAAID,UAAU,KAAK,KAAnB,EAA0B;AAC7B,aAAOH,SAAS,IAAII,aAApB;AACD;;AAED,WAAO,KAAP;AACD,GA7kHe,CA+kHhB;AACA;AACA;AACA;;;AACA,MAAIE,SAAS,GAAG/kB,SAAS,CAACC,OAAV,GAAoBK,IAAI,CAACC,KAAL,CAAWP,SAAS,CAACC,OAArB,CAApB,GAAoD,EAApE;AAEA;;;;;;AAKA,WAASyP,SAAT,CAAmB+G,IAAnB,EAAyB;AACvB,QAAI1W,UAAJ,EAAgB;AACd,UAAMilB,QAAQ,GAAG1kB,IAAI,CAACC,KAAL,CAAWd,MAAM,CAACwlB,YAAP,CAAoBC,OAApB,CAA4BzO,IAA5B,CAAX,CAAjB;;AACA,UAAI,CAAChJ,CAAC,CAACa,WAAF,CAAc0W,QAAd,CAAD,GAA2BA,QAAQ,KAAK,IAA5C,EAAkD;AAChD,eAAOA,QAAP;AACD;;AACD,aAAOD,SAAS,CAACtO,IAAD,CAAhB;AACD;;AAED,WAAOsO,SAAS,CAACtO,IAAD,CAAhB;AACD;AAED;;;;;;;AAKA,WAASxB,SAAT,CAAmBwB,IAAnB,EAAyB0O,KAAzB,EAAgC;AAC9B,QAAIplB,UAAJ,EAAgB;AACdN,MAAAA,MAAM,CAACwlB,YAAP,CAAoBG,OAApB,CAA4B3O,IAA5B,EAAkCnW,IAAI,CAACe,SAAL,CAAe8jB,KAAf,CAAlC;AACD;;AAEDJ,IAAAA,SAAS,CAACtO,IAAD,CAAT,GAAkB0O,KAAlB;AACAE,IAAAA,4BAA4B,CAAC/kB,IAAI,CAACe,SAAL,CAAe0jB,SAAf,CAAD,CAA5B;AACD,GAlnHe,CAqnHhB;AACA;;;AACA,WAAShiB,QAAT,CAAkB8f,QAAlB,EAA4ByC,OAA5B,EAAqC;AACnChjB,IAAAA,UAAU,CAACugB,QAAD,EAAWyC,OAAX,CAAV;AACD,GAznHe,CA2nHhB;AACA;;;AACA,WAAShjB,UAAT,CAAoBugB,QAApB,EAA8ByC,OAA9B,EAAuC;AACrC,WAAO,SAASC,eAAT,GAA2B;AAChC,UAAIzR,IAAI,GAAGJ,SAAX;;AACA,UAAI8R,MAAM,GAAG,SAATA,MAAS,GAAW;AACtB3C,QAAAA,QAAQ,CAAC3O,KAAT,CAAeoR,OAAf,EAAwBxR,IAAxB;AACD,OAFD;;AAIA5Q,MAAAA,UAAU,CAACsiB,MAAD,EAAS,CAAT,CAAV;AACD,KAPD;AAQD,GAtoHe,CAwoHhB;AACA;;;AACA,WAASC,QAAT,CAAkBC,GAAlB,EAAuB;AACrB;AACA,QAAIC,cAAc,GAAG,kCAArB;AACAD,IAAAA,GAAG,GAAGA,GAAG,CAACljB,OAAJ,CAAYmjB,cAAZ,EAA4B,UAASC,CAAT,EAAYC,CAAZ,EAAeC,CAAf,EAAkB5P,CAAlB,EAAqB;AACrD,aAAO2P,CAAC,GAAGA,CAAJ,GAAQC,CAAR,GAAYA,CAAZ,GAAgB5P,CAAhB,GAAoBA,CAA3B;AACD,KAFK,CAAN;AAIA,QAAI2K,MAAM,GAAG,4CAA4CkF,IAA5C,CAAiDL,GAAjD,CAAb;AACA,WAAO7E,MAAM,GAAG;AACdgF,MAAAA,CAAC,EAAE3U,QAAQ,CAAC2P,MAAM,CAAC,CAAD,CAAP,EAAY,EAAZ,CADG;AAEdiF,MAAAA,CAAC,EAAE5U,QAAQ,CAAC2P,MAAM,CAAC,CAAD,CAAP,EAAY,EAAZ,CAFG;AAGd3K,MAAAA,CAAC,EAAEhF,QAAQ,CAAC2P,MAAM,CAAC,CAAD,CAAP,EAAY,EAAZ;AAHG,KAAH,GAIT,IAJJ;AAKD,GAvpHe,CAypHhB;AACA;;;AACA,WAAS/S,qBAAT,CAA+B/E,IAA/B,EAAqC;AACnC;AACA;AAEA,QAAIid,eAAJ,EAAqBC,kBAArB,EAAyCC,WAAzC;AACA,QAAI7C,KAAK,GAAG1jB,CAAC,CAACoJ,IAAD,CAAb;AAEA,QAAIod,iBAAiB,GAAG9C,KAAK,CAAClhB,IAAN,CAAW,yCAAX,CAAxB;;AACA,QAAI,CAACgkB,iBAAL,EAAwB;AACtBA,MAAAA,iBAAiB,GAAG9C,KAAK,CAACtf,GAAN,CAAU,YAAV,CAApB;AACAsf,MAAAA,KAAK,CAAClhB,IAAN,CAAW,yCAAX,EAAsDgkB,iBAAtD;AACD,KAXkC,CAanC;AACA;;;AAEAH,IAAAA,eAAe,GAAG3C,KAAK,CAACtf,GAAN,CAAU,kBAAV,CAAlB;;AACA,QAAI,CAACiiB,eAAL,EAAsB;AACpBA,MAAAA,eAAe,GAAG,MAAlB;AACD;;AAED,QAAIA,eAAe,CAAC,CAAD,CAAf,KAAuB,GAA3B,EAAgC;AAC9B;AACAC,MAAAA,kBAAkB,GAAGR,QAAQ,CAACO,eAAD,CAA7B;AACAA,MAAAA,eAAe,GAAG,SAASC,kBAAkB,CAACJ,CAA5B,GAAgC,IAAhC,GACSI,kBAAkB,CAACH,CAD5B,GACgC,IADhC,GAESG,kBAAkB,CAAC/P,CAF5B,GAEgC,GAFlD;AAGD,KA3BkC,CA6BnC;;;AACA,QAAI8P,eAAe,CAACvlB,KAAhB,CAAsB,CAAtB,EAAyB,CAAzB,MAAgC,MAApC,EAA4C;AAC1CylB,MAAAA,WAAW,GAAG,UAAUF,eAAe,CAACvlB,KAAhB,CAAsB,CAAtB,EAAyB,CAAC,CAA1B,CAAV,GAAyC,QAAvD;AACD,KAFD,MAGK;AACHylB,MAAAA,WAAW,GAAGF,eAAd;AACD,KAnCkC,CAqCnC;;;AACA,QAAII,iBAAiB,GAAG,CAAxB,CAtCmC,CAwCnC;;AACA/C,IAAAA,KAAK,CAACtf,GAAN,CAAU;AACR,oBAAc,EADN;AAER,oBAAc,oCAAoCmiB;AAF1C,KAAV,EAzCmC,CA8CnC;;AACAzY,IAAAA,CAAC,CAACqC,KAAF,CAAQ,YAAW;AACjB;AACAuT,MAAAA,KAAK,CAACtf,GAAN,CAAU;AACR,sBAAc,gBAAgBqiB,iBAAhB,GAAoC,GAD1C;AAER,sBAAc;AAFN,OAAV,EAFiB,CAOjB;;AACA/C,MAAAA,KAAK,CAAC7W,GAAN,CAAU,eAAV,EAA2B,YAAW;AACpC6W,QAAAA,KAAK,CAACtf,GAAN,CAAU;AACR,wBAAc,EADN;AAER,wBAAcoiB;AAFN,SAAV;AAID,OALD;AAMD,KAdD,EAcG,EAdH,EA/CmC,CA6D3B;;AACT;;AAED,WAAS/C,YAAT,CAAsBiD,KAAtB,EAA6B;AAC3B,QAAIrmB,SAAS,CAACU,MAAV,CAAiBU,KAArB,EAA4B;AAC1B,UAAIqM,CAAC,CAAC6Y,UAAF,CAAaD,KAAb,CAAJ,EAAyB;AACvBA,QAAAA,KAAK,GAAGA,KAAK,EAAb;AACD;;AAED,UAAI,CAACA,KAAL,EAAY;AACV,YAAIpT,OAAO,GAAG,0BAA0BoT,KAA1B,GAAkC,YAAhD;;AACA,aAAK,IAAI7gB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkO,SAAS,CAACrT,MAA9B,EAAsCmF,CAAC,EAAvC,EAA2C;AACzCyN,UAAAA,OAAO,IAAI,OAAOS,SAAS,CAAClO,CAAD,CAAhB,GAAsB,IAAjC;AACD;;AACD,cAAM,IAAIwb,KAAJ,CAAU/N,OAAV,CAAN;AACD;AACF;AACF;AAED;;;;;;AAIA,WAASqI,cAAT,GAA0B;AACxB,WAAO7V,QAAQ,CAAC8gB,QAAT,EAAP;AACD;AAED;;;;;;AAIA,WAASlN,qBAAT,CAA+BmN,OAA/B,EAAwC;AACtC9mB,IAAAA,OAAO,CAACmC,EAAR,CAAW,OAAX,EAAoB2kB,OAApB;AACD;AAED;;;;;;AAIA,WAASxO,QAAT,GAAoB;AAClB,WAAOyO,MAAM,CAACC,MAAP,CAAchgB,IAAI,CAACigB,MAAL,EAAd,CAAP;AACD;AAED;AAEA;;;AAEAhnB,EAAAA,CAAC,CAAC,SAASinB,SAAT,GAAqB;AACrB,QAAI,CAAC5mB,SAAS,CAACU,MAAV,CAAiBU,KAAtB,EAA6B;AAC3BzB,MAAAA,CAAC,CAAC,yBAAD,CAAD,CAA6BgC,MAA7B;AACA;AACD,KAJoB,CAMrB;;;AACAhC,IAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuBsI,KAAvB,CAA6B,UAASlG,CAAT,EAAY;AACvC,UAAI,CAAChC,UAAL,EAAiB;AACf;AACD;;AAEDgC,MAAAA,CAAC,CAACC,cAAF;AACA,UAAIkG,kBAAkB,GAAGvI,CAAC,CAAC,IAAD,CAAD,CAAQwI,OAAR,CAAgB,yBAAhB,EAA2ChG,IAA3C,CAAgD,eAAhD,CAAzB;;AACA,UAAI+F,kBAAkB,KAAK,SAA3B,EAAsC;AACpC3G,QAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACAqlB,QAAAA,0BAA0B,CAAC;AAACtL,UAAAA,KAAK,EAAE;AAAR,SAAD,CAA1B;AACArY,QAAAA,UAAU,CAAC,YAAW;AACpB2jB,UAAAA,0BAA0B,CAAC;AAACtL,YAAAA,KAAK,EAAE;AAAR,WAAD,CAA1B;AACD,SAFS,EAEP,IAFO,CAAV;AAGD,OAND,MAOK,IAAIrT,kBAAkB,KAAK,UAAvB,IAAqCA,kBAAkB,KAAK,WAAhE,EAA6E;AAChF3G,QAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACAqlB,QAAAA,0BAA0B,CAAC;AAACtL,UAAAA,KAAK,EAAE;AAAR,SAAD,CAA1B;AACArY,QAAAA,UAAU,CAAC,YAAW;AACpB2jB,UAAAA,0BAA0B,CAAC;AAACtL,YAAAA,KAAK,EAAE;AAAR,WAAD,CAA1B;AACD,SAFS,EAEP,IAFO,CAAV;AAGD,OApBsC,CAqBvC;;AACD,KAtBD,EAPqB,CA+BrB;;AACA,aAASuL,gBAAT,GAA4B;AAC1BnnB,MAAAA,CAAC,CAAC,cAAD,CAAD,CAAkB6O,GAAlB,CAAsBtH,WAAtB;AACD;;AACDxH,IAAAA,OAAO,CAACmC,EAAR,CAAW/B,4BAAX,EAAyCgnB,gBAAzC;AACAA,IAAAA,gBAAgB,GApCK,CAqCrB;;AACAnnB,IAAAA,CAAC,CAAC,cAAD,CAAD,CAAkBkC,EAAlB,CAAqB,QAArB,EAA+B,YAAW;AACxCglB,MAAAA,0BAA0B,CAAC;AAACtL,QAAAA,KAAK,EAAE5b,CAAC,CAAC,cAAD,CAAD,CAAkB6O,GAAlB;AAAR,OAAD,CAA1B;AACD,KAFD,EAtCqB,CA0CrB;;AACA7O,IAAAA,CAAC,CAAC,cAAD,CAAD,CAAkBsI,KAAlB,CAAwB,YAAW;AACjC8e,MAAAA,wBAAwB,CAAC;AACvB9T,QAAAA,OAAO,EAAEtT,CAAC,CAAC,kBAAD,CAAD,CAAsB6O,GAAtB,EADc;AAEvB0E,QAAAA,QAAQ,EAAEhC,QAAQ,CAACvR,CAAC,CAAC,mBAAD,CAAD,CAAuB6O,GAAvB,EAAD;AAFK,OAAD,CAAxB;AAID,KALD,EA3CqB,CAkDrB;;AACA7O,IAAAA,CAAC,CAAC,iCAAD,CAAD,CAAqCsI,KAArC,CAA2C,YAAW;AACpD,UAAIwH,OAAO,GAAG,EAAd;AAAA,UAAkBuX,gBAAgB,GAAGrnB,CAAC,CAAC,qCAAD,CAAtC;;AACA,WAAK,IAAI6F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwhB,gBAAgB,CAAC3mB,MAArC,EAA6CmF,CAAC,EAA9C,EAAkD;AAChD,YAAIwhB,gBAAgB,CAACnd,EAAjB,CAAoBrE,CAApB,EAAuB2B,IAAvB,CAA4B,SAA5B,CAAJ,EAA4C;AAC1CsI,UAAAA,OAAO,CAACuC,IAAR,CAAagV,gBAAgB,CAACnd,EAAjB,CAAoBrE,CAApB,EAAuBgJ,GAAvB,EAAb;AACD;AACF;;AACDyY,MAAAA,2BAA2B,CAAC;AAC1B7W,QAAAA,UAAU,EAAE,wBADc;AAE1BjO,QAAAA,IAAI,EAAE;AAAEsN,UAAAA,OAAO,EAAEA;AAAX;AAFoB,OAAD,CAA3B;AAID,KAXD,EAnDqB,CAgErB;;AACA9P,IAAAA,CAAC,CAAC,+BAAD,CAAD,CAAmCsI,KAAnC,CAAyC,YAAW;AAClDgf,MAAAA,2BAA2B,CAAC;AAC1B7W,QAAAA,UAAU,EAAE;AADc,OAAD,CAA3B;AAGD,KAJD,EAjEqB,CAuErB;;AACAzQ,IAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCsI,KAAjC,CAAuC,YAAW;AAChDgf,MAAAA,2BAA2B,CAAC;AAC1B7W,QAAAA,UAAU,EAAE,oBADc;AAE1BjO,QAAAA,IAAI,EAAE;AAAE8Q,UAAAA,OAAO,EAAEtT,CAAC,CAAC,iCAAD,CAAD,CAAqC6O,GAArC;AAAX;AAFoB,OAAD,CAA3B;AAID,KALD,EAxEqB,CA+ErB;;AACA7O,IAAAA,CAAC,CAAC,4BAAD,CAAD,CAAgCsI,KAAhC,CAAsC,YAAW;AAC/Cgf,MAAAA,2BAA2B,CAAC;AAC1B7W,QAAAA,UAAU,EAAE,mBADc;AAE1BjO,QAAAA,IAAI,EAAE;AAAE+kB,UAAAA,wBAAwB,EAAEC,MAAM,CAACxnB,CAAC,CAAC,gCAAD,CAAD,CAAoC6O,GAApC,EAAD;AAAlC;AAFoB,OAAD,CAA3B;AAID,KALD,EAhFqB,CAuFrB;;AACA7O,IAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCsI,KAAjC,CAAuC,YAAW;AAChDgf,MAAAA,2BAA2B,CAAC;AAC1B7W,QAAAA,UAAU,EAAE;AADc,OAAD,CAA3B;AAGD,KAJD,EAxFqB,CA8FrB;;AACAzQ,IAAAA,CAAC,CAAC,8BAAD,CAAD,CAAkCsI,KAAlC,CAAwC,YAAW;AACjDgf,MAAAA,2BAA2B,CAAC;AAC1B7W,QAAAA,UAAU,EAAE;AADc,OAAD,CAA3B;AAGD,KAJD,EA/FqB,CAqGrB;;AACAzQ,IAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4BsI,KAA5B,CAAkC,YAAW;AAC3Cgf,MAAAA,2BAA2B,CAAC;AAC1B7W,QAAAA,UAAU,EAAE;AADc,OAAD,CAA3B;AAGD,KAJD,EAtGqB,CA4GrB;;AACAzQ,IAAAA,CAAC,CAAC,0BAAD,CAAD,CAA8BsI,KAA9B,CAAoC,YAAW;AAC7Cgf,MAAAA,2BAA2B,CAAC;AAC1B7W,QAAAA,UAAU,EAAE,sCADc;AAE1BjO,QAAAA,IAAI,EAAE;AAFoB,OAAD,CAA3B;AAID,KALD,EA7GqB,CAoHrB;;AACAxC,IAAAA,CAAC,CAAC,2BAAD,CAAD,CAA+BsI,KAA/B,CAAqC,YAAW;AAC9Cmf,MAAAA,kCAAkC,CAAC;AACjC/iB,QAAAA,UAAU,EAAE1E,CAAC,CAAC,+BAAD,CAAD,CAAmC6O,GAAnC;AADqB,OAAD,CAAlC;AAGD,KAJD,EArHqB,CA2HrB;;AACA7O,IAAAA,CAAC,CAAC,yBAAD,CAAD,CAA6BsI,KAA7B,CAAmC,SAASof,wBAAT,GAAoC;AACrE,UAAI,CAAC1nB,CAAC,CAAC,+BAAD,CAAD,CAAmC6O,GAAnC,EAAD,IACA,CAAC7O,CAAC,CAAC,iCAAD,CAAD,CAAqC6O,GAArC,EADD,IAEA,CAAC7O,CAAC,CAAC,kCAAD,CAAD,CAAsC6O,GAAtC,EAFD,IAGA,CAAC7O,CAAC,CAAC,kCAAD,CAAD,CAAsC6O,GAAtC,EAHD,IAIA,CAAC7O,CAAC,CAAC,mCAAD,CAAD,CAAuC6O,GAAvC,EAJL,EAImD;AACjD;AACD;;AAED,UAAMuF,GAAG,GAAGuT,kBAAkB,CAAC,IAAD,CAA9B;AACAC,MAAAA,gCAAgC,CAACxT,GAAD,CAAhC;AAEAkB,MAAAA,SAAS,CAAC,8BAAD,EAAiClB,GAAG,CAACyT,OAAJ,CAAYvM,OAA7C,CAAT;AACAhG,MAAAA,SAAS,CAAC,gCAAD,EAAmClB,GAAG,CAACyT,OAAJ,CAAYhM,eAAZ,CAA4Bnb,MAA5B,GAAqC0T,GAAG,CAACyT,OAAJ,CAAYhM,eAAZ,CAA4BxR,IAA5B,CAAiC,UAAAyR,EAAE;AAAA,eAAIA,EAAE,CAAClD,aAAH,KAAmB,KAAvB;AAAA,OAAnC,EAAiEmD,KAAtG,GAA8G,IAAjJ,CAAT;AACAzG,MAAAA,SAAS,CAAC,iCAAD,EAAoClB,GAAG,CAACyT,OAAJ,CAAYhM,eAAZ,CAA4Bnb,MAA5B,GAAqC0T,GAAG,CAACyT,OAAJ,CAAYhM,eAAZ,CAA4BxR,IAA5B,CAAiC,UAAAyR,EAAE;AAAA,eAAIA,EAAE,CAAClD,aAAH,KAAmB,MAAvB;AAAA,OAAnC,EAAkEmD,KAAvG,GAA+G,IAAnJ,CAAT;AACAzG,MAAAA,SAAS,CAAC,iCAAD,EAAoClB,GAAG,CAACyT,OAAJ,CAAYhM,eAAZ,CAA4Bnb,MAA5B,GAAqC0T,GAAG,CAACyT,OAAJ,CAAYhM,eAAZ,CAA4BxR,IAA5B,CAAiC,UAAAyR,EAAE;AAAA,eAAIA,EAAE,CAAClD,aAAH,KAAmB,MAAvB;AAAA,OAAnC,EAAkEmD,KAAvG,GAA+G,IAAnJ,CAAT;AACAzG,MAAAA,SAAS,CAAC,kCAAD,EAAqClB,GAAG,CAACyT,OAAJ,CAAYhM,eAAZ,CAA4Bnb,MAA5B,GAAqC0T,GAAG,CAACyT,OAAJ,CAAYhM,eAAZ,CAA4BxR,IAA5B,CAAiC,UAAAyR,EAAE;AAAA,eAAIA,EAAE,CAAClD,aAAH,KAAmB,OAAvB;AAAA,OAAnC,EAAmEmD,KAAxG,GAAgH,IAArJ,CAAT;AACAzG,MAAAA,SAAS,CAAC,gCAAD,EAAmClB,GAAG,CAACyT,OAAJ,CAAYrN,UAA/C,CAAT;AACAlF,MAAAA,SAAS,CAAC,gCAAD,EAAmClB,GAAG,CAACyT,OAAJ,CAAYtN,UAA/C,CAAT;AACAjF,MAAAA,SAAS,CAAC,sCAAD,EAAyClB,GAAG,CAACyT,OAAJ,CAAYjL,gBAArD,CAAT;AACD,KApBD,EA5HqB,CAkJrB;;AACA5c,IAAAA,CAAC,CAAC,0BAAD,CAAD,CAA8BsI,KAA9B,CAAoC,SAASwf,yBAAT,GAAqC;AACvEC,MAAAA,oBAAoB;AACrB,KAFD;AAIA,QAAM7J,OAAO,GAAG,GAAhB,CAvJqB,CAwJrB;;AACAle,IAAAA,CAAC,CAAC,+BAAD,CAAD,CAAmC6O,GAAnC,CAAuCf,CAAC,CAACuS,QAAF,CAAWtQ,SAAS,CAAC,8BAAD,CAApB,IAAwDA,SAAS,CAAC,8BAAD,CAAT,GAA4CmO,OAApG,GAA8G,EAArJ;AACAle,IAAAA,CAAC,CAAC,iCAAD,CAAD,CAAqC6O,GAArC,CAAyCf,CAAC,CAACuS,QAAF,CAAWtQ,SAAS,CAAC,gCAAD,CAApB,IAA0DA,SAAS,CAAC,gCAAD,CAAT,GAA8CmO,OAAxG,GAAkH,EAA3J;AACAle,IAAAA,CAAC,CAAC,kCAAD,CAAD,CAAsC6O,GAAtC,CAA0Cf,CAAC,CAACuS,QAAF,CAAWtQ,SAAS,CAAC,iCAAD,CAApB,IAA2DA,SAAS,CAAC,iCAAD,CAAT,GAA+CmO,OAA1G,GAAoH,EAA9J;AACAle,IAAAA,CAAC,CAAC,kCAAD,CAAD,CAAsC6O,GAAtC,CAA0Cf,CAAC,CAACuS,QAAF,CAAWtQ,SAAS,CAAC,iCAAD,CAApB,IAA2DA,SAAS,CAAC,iCAAD,CAAT,GAA+CmO,OAA1G,GAAoH,EAA9J;AACAle,IAAAA,CAAC,CAAC,mCAAD,CAAD,CAAuC6O,GAAvC,CAA2Cf,CAAC,CAACuS,QAAF,CAAWtQ,SAAS,CAAC,kCAAD,CAApB,IAA4DA,SAAS,CAAC,kCAAD,CAAT,GAAgDmO,OAA5G,GAAsH,EAAjK;AAEAle,IAAAA,CAAC,CAAC,iCAAD,CAAD,CAAqC,CAArC,EAAwCgoB,OAAxC,GAAkDjY,SAAS,CAAC,gCAAD,CAA3D;AACA/P,IAAAA,CAAC,CAAC,iCAAD,CAAD,CAAqC,CAArC,EAAwCgoB,OAAxC,GAAkDjY,SAAS,CAAC,gCAAD,CAA3D;AACA/P,IAAAA,CAAC,CAAC,uCAAD,CAAD,CAA2C6O,GAA3C,CAA+CkB,SAAS,CAAC,sCAAD,CAAT,GAAoDA,SAAS,CAAC,sCAAD,CAA7D,GAAwG,EAAvJ,EAjKqB,CAmKrB;;AACA/P,IAAAA,CAAC,CAAC,4BAAD,CAAD,CAAgCsI,KAAhC,CAAsC,SAASwf,yBAAT,GAAqC;AACzEtF,MAAAA,6BAA6B;AAC9B,KAFD;AAID,GAxKA,CAAD;AA0KA;;;;;;AAKA,WAASmF,kBAAT,CAA4BM,MAA5B,EAAoC;AAClC,QAAIC,QAAQ,GAAG,IAAf;AAAqB;;AACrB,QAAIloB,CAAC,CAAC,uCAAD,CAAD,CAA2C6O,GAA3C,EAAJ,EAAsD;AACpDqZ,MAAAA,QAAQ,GAAG;AACTjc,QAAAA,EAAE,wBAAiBoM,QAAQ,EAAzB,CADO;AAET,iBAAS,aAFA;AAGTO,QAAAA,aAAa,EAAE,KAHN;AAITuP,QAAAA,aAAa,EAAE,YAJN;AAKTjM,QAAAA,eAAe,EAAEC,MAAM,GAAGjY,GAAT,CAAakE,UAAU,CAACpI,CAAC,CAAC,uCAAD,CAAD,CAA2C6O,GAA3C,EAAD,CAAvB,EAA2E,SAA3E,EAAsFuZ,WAAtF;AALR,OAAX;AAOD;AAED;;;AACA,QAAIhU,GAAG,GAAG;AACRiU,MAAAA,IAAI,EAAEnP,sBAAsB,CAACjC,OADrB;AAERhL,MAAAA,EAAE,EAAEgc,MAFI;AAGRJ,MAAAA,OAAO,EAAES,sBAAsB,CAACJ,QAAD;AAHvB,KAAV;AAMA,WAAO9T,GAAP;AACD;AAED;;;;;;;;;;AAQA,WAASkU,sBAAT,GAAyH;AAAA,QAAzFJ,QAAyF,uEAAhFK,SAAgF;AAAA,QAArEC,SAAqE,uEAA3DD,SAA2D;AAAA,QAAhDE,SAAgD,uEAAtCF,SAAsC;AAAA,QAA3BG,eAA2B,uEAAXH,SAAW;AACvH,QAAMrK,OAAO,GAAG,GAAhB;;AAEA,QAAIpQ,CAAC,CAACa,WAAF,CAAc6Z,SAAd,CAAJ,EAA8B;AAC5BA,MAAAA,SAAS,GAAGxoB,CAAC,CAAC,iCAAD,CAAD,CAAqC,CAArC,EAAwCgoB,OAApD;AACD,KAFD,MAGK;AACHhoB,MAAAA,CAAC,CAAC,iCAAD,CAAD,CAAqC,CAArC,EAAwCgoB,OAAxC,GAAkDQ,SAAlD;AACD;;AAED,QAAI1a,CAAC,CAACa,WAAF,CAAc8Z,SAAd,CAAJ,EAA8B;AAC5BA,MAAAA,SAAS,GAAGzoB,CAAC,CAAC,iCAAD,CAAD,CAAqC,CAArC,EAAwCgoB,OAApD;AACD,KAFD,MAGK;AACHhoB,MAAAA,CAAC,CAAC,iCAAD,CAAD,CAAqC,CAArC,EAAwCgoB,OAAxC,GAAkDS,SAAlD;AACD;;AAED,QAAI3a,CAAC,CAACa,WAAF,CAAc+Z,eAAd,CAAJ,EAAoC;AAClCA,MAAAA,eAAe,GAAG1oB,CAAC,CAAC,uCAAD,CAAD,CAA2C6O,GAA3C,EAAlB;AACD,KAFD,MAGK;AACH7O,MAAAA,CAAC,CAAC,uCAAD,CAAD,CAA2C6O,GAA3C,CAA+C6Z,eAAe,GAAGA,eAAH,GAAqB,EAAnF;AACD;;AAED,WAAO;AACLlN,MAAAA,kBAAkB,EAAExb,CAAC,CAAC,yCAAD,CAAD,CAA6C,CAA7C,EAAgDgoB,OAD/D;AAELxN,MAAAA,UAAU,EAAEgO,SAFP;AAGL5L,MAAAA,gBAAgB,EAAE8L,eAHb;AAILnO,MAAAA,UAAU,EAAEkO,SAJP;AAKLnN,MAAAA,OAAO,EAAEmN,SAAS,GAAGrgB,UAAU,CAACpI,CAAC,CAAC,+BAAD,CAAD,CAAmC6O,GAAnC,EAAD,CAAV,GAAuDqP,OAA1D,GAAoE,CALjF;AAMLrC,MAAAA,eAAe,EAAE4M,SAAS,GAAG,CAC3B;AACE,iBAAS,aADX;AAEE7P,QAAAA,aAAa,EAAE,KAFjB;AAGEmD,QAAAA,KAAK,EAAE3T,UAAU,CAACpI,CAAC,CAAC,iCAAD,CAAD,CAAqC6O,GAArC,EAAD,CAAV,GAAyDqP;AAHlE,OAD2B,EAM3B;AACE,iBAAS,aADX;AAEEtF,QAAAA,aAAa,EAAE,MAFjB;AAGEmD,QAAAA,KAAK,EAAE3T,UAAU,CAACpI,CAAC,CAAC,kCAAD,CAAD,CAAsC6O,GAAtC,EAAD,CAAV,GAA0DqP;AAHnE,OAN2B,EAW3B;AACE,iBAAS,aADX;AAEEtF,QAAAA,aAAa,EAAE,MAFjB;AAGEmD,QAAAA,KAAK,EAAE3T,UAAU,CAACpI,CAAC,CAAC,kCAAD,CAAD,CAAsC6O,GAAtC,EAAD,CAAV,GAA0DqP;AAHnE,OAX2B,EAgB3B;AACE,iBAAS,aADX;AAEEtF,QAAAA,aAAa,EAAE,OAFjB;AAGEmD,QAAAA,KAAK,EAAE3T,UAAU,CAACpI,CAAC,CAAC,mCAAD,CAAD,CAAuC6O,GAAvC,EAAD,CAAV,GAA2DqP;AAHpE,OAhB2B,CAAH,GAqBtB,EA3BC;AA4BLjC,MAAAA,SAAS,EAAEwM,SAAS,IAAIP,QAAb,GAAwB,CAACA,QAAD,CAAxB,GAAqC,IA5B3C;AA6BLrL,MAAAA,WAAW,EAAE,mDA7BR;AA8BLC,MAAAA,kBAAkB,EAAE,4CA9Bf;AA+BLC,MAAAA,sBAAsB,EAAE,0BA/BnB;AAgCLC,MAAAA,kBAAkB,EAAE;AAhCf,KAAP;AAkCD;AAED;;;;;AAGA,WAAS+K,oBAAT,GAAgC;AAC9B,QAAM7N,KAAK,GAAGla,CAAC,CAAC,8BAAD,CAAD,CAAkC,CAAlC,EAAqCgoB,OAAnD;AACA,QAAM7N,SAAS,GAAGna,CAAC,CAAC,kCAAD,CAAD,CAAsC,CAAtC,EAAyCgoB,OAA3D;AACA;;AACA,QAAM5T,GAAG,GAAG;AACViU,MAAAA,IAAI,EAAEnP,sBAAsB,CAAC/B,SADnB;AAEVlL,MAAAA,EAAE,EAAE,EAFM;AAGV4b,MAAAA,OAAO,EAAE3N,KAAK,GAAG;AACfA,QAAAA,KAAK,EAAE,yBADQ;AAEfC,QAAAA,SAAS,EAAEA;AAFI,OAAH,GAGV;AANM,KAAZ;AASA5W,IAAAA,UAAU,CAAC;AAAA,aAAMqkB,gCAAgC,CAACxT,GAAD,CAAtC;AAAA,KAAD,EAA8C,GAA9C,CAAV;AACD;AAED;;;;;;AAIA,WAASuU,mBAAT,CAA6BvQ,OAA7B,EAAsC;AACpC,QAAMhE,GAAG,GAAGuT,kBAAkB,CAACvP,OAAO,CAACnM,EAAT,CAA9B,CADoC,CAEpC;;AACA1I,IAAAA,UAAU,CAAC;AAAA,aAAMqkB,gCAAgC,CAACxT,GAAD,CAAtC;AAAA,KAAD,EAA8C,IAA9C,CAAV;AACD;AAED;;;;;;AAIA,WAASwU,oBAAT,CAA8BxQ,OAA9B,EAAuC;AACrC,QAAI,CAACA,OAAO,CAACQ,aAAT,IAA0B,CAACR,OAAO,CAACS,aAAnC,IAAoD,CAACT,OAAO,CAACO,gBAAjE,EAAmF;AACjFkQ,MAAAA,KAAK,CAAC,gDAAgDloB,IAAI,CAACe,SAAL,CAAe0W,OAAf,CAAjD,CAAL;AACD;;AAED,QAAI0Q,IAAI,GAAG9oB,CAAC,CAAC,mCAAD,CAAD,CAAuC6O,GAAvC,EAAX;AAEA;;AACA,QAAIka,UAAU,GAAG;AACf7O,MAAAA,KAAK,EAAE,IADQ;AAEfkH,MAAAA,MAAM,EAAE9J,2BAA2B,CAACC,OAFrB;AAGf2Q,MAAAA,QAAQ,EAAE;AAHK,KAAjB;AAMA;;AACA,QAAI9T,GAAG,GAAG;AACRiU,MAAAA,IAAI,EAAEnP,sBAAsB,CAAChC,YADrB;AAERjL,MAAAA,EAAE,EAAEmM,OAAO,CAACnM,EAFJ;AAGR4b,MAAAA,OAAO,EAAEkB;AAHD,KAAV;;AAMA,QAAID,IAAI,KAAK,OAAb,EAAsB;AACpB1U,MAAAA,GAAG,CAACyT,OAAJ,CAAY3N,KAAZ,GAAoB,aAApB;AACD,KAFD,MAGK,IAAI5C,2BAA2B,CAACwR,IAAD,CAA3B,KAAsCxR,2BAA2B,CAACE,OAAtE,EAA+E;AAClFpD,MAAAA,GAAG,CAACyT,OAAJ,CAAYzG,MAAZ,GAAqB9J,2BAA2B,CAACE,OAAjD;AAEA,UAAIwR,MAAM,GAAG7M,MAAM,GAAGjY,GAAT,CAAa,CAAb,EAAgB,MAAhB,EAAwBkkB,WAAxB,EAAb;;AACA,UAAIhQ,OAAO,CAACQ,aAAR,KAA0B,MAA9B,EAAsC;AACpCoQ,QAAAA,MAAM,GAAG7M,MAAM,GAAGjY,GAAT,CAAa,EAAb,EAAiB,MAAjB,EAAyBkkB,WAAzB,EAAT;AACD,OAFD,MAGK,IAAIhQ,OAAO,CAACQ,aAAR,KAA0B,MAA9B,EAAsC;AACzCoQ,QAAAA,MAAM,GAAG7M,MAAM,GAAGjY,GAAT,CAAa,CAAb,EAAgB,KAAhB,EAAuBkkB,WAAvB,EAAT;AACD,OAFI,MAGA,IAAIhQ,OAAO,CAACQ,aAAR,KAA0B,OAA9B,EAAuC;AAC1CoQ,QAAAA,MAAM,GAAG7M,MAAM,GAAGjY,GAAT,CAAa,EAAb,EAAiB,KAAjB,EAAwBkkB,WAAxB,EAAT;AACD;AAED;;;AACA,UAAIF,QAAQ,GAAG;AACbjc,QAAAA,EAAE,4BAAqBoM,QAAQ,EAA7B,CADW;AAEb,iBAASD,OAAO,CAACO,gBAFJ;AAEsB;AACnCC,QAAAA,aAAa,EAAER,OAAO,CAACQ,aAHV;AAIbuP,QAAAA,aAAa,EAAE,YAJF;AAIgB;AAC7BjM,QAAAA,eAAe,EAAE8M,MALJ;AAMbC,QAAAA,gBAAgB,EAAED;AANL,OAAf;AASAhpB,MAAAA,CAAC,CAAC,+BAAD,CAAD,CAAmC6O,GAAnC,CAAuC,CAAC8L,aAAa,CAACW,OAAd,GAAwBlD,OAAO,CAACS,aAAjC,IAAkD,GAAzF;AACAzE,MAAAA,GAAG,CAACyT,OAAJ,CAAY1G,OAAZ,GAAsBmH,sBAAsB,CAACJ,QAAD,CAA5C;AACD,KA1BI,MA2BA;AACH9T,MAAAA,GAAG,CAACyT,OAAJ,CAAYzG,MAAZ,GAAqB9J,2BAA2B,CAACwR,IAAD,CAAhD;AACD,KArDoC,CAuDrC;;;AACAvlB,IAAAA,UAAU,CAAC;AAAA,aAAMqkB,gCAAgC,CAACxT,GAAD,CAAtC;AAAA,KAAD,EAA8C,IAA9C,CAAV;AACD;AAED;;;;;;AAIA,WAAS8U,wBAAT,CAAkC9Q,OAAlC,EAA2C;AACzC,QAAI0Q,IAAI,GAAG9oB,CAAC,CAAC,8BAAD,CAAD,CAAkC6O,GAAlC,EAAX;AAEA;;AACA,QAAIka,UAAU,GAAG;AACf7O,MAAAA,KAAK,EAAE,IADQ;AAEfkH,MAAAA,MAAM,EAAE9J,2BAA2B,CAACC,OAFrB;AAGf2K,MAAAA,kBAAkB,EAAE,IAHL;AAIff,MAAAA,OAAO,EAAE;AAJM,KAAjB;AAOA;;AACA,QAAI/M,GAAG,GAAG;AACRiU,MAAAA,IAAI,EAAEnP,sBAAsB,CAAC9B,KADrB;AAERnL,MAAAA,EAAE,EAAEmM,OAAO,CAACnM,EAFJ;AAGR4b,MAAAA,OAAO,EAAEkB;AAHD,KAAV;;AAMA,QAAID,IAAI,KAAK,OAAb,EAAsB;AACpB1U,MAAAA,GAAG,CAACyT,OAAJ,CAAY3N,KAAZ,GAAoB,aAApB;AACD,KAFD,MAGK,IAAI5C,2BAA2B,CAACwR,IAAD,CAA3B,KAAsCxR,2BAA2B,CAACE,OAAtE,EAA+E;AAClF;AACAxX,MAAAA,CAAC,CAAC,iCAAD,CAAD,CAAqC,CAArC,EAAwCgoB,OAAxC,GAAkD,IAAlD;AAEA5T,MAAAA,GAAG,CAACyT,OAAJ,CAAYzG,MAAZ,GAAqB9J,2BAA2B,CAACE,OAAjD;AAEApD,MAAAA,GAAG,CAACyT,OAAJ,CAAY3F,kBAAZ,GAAiCliB,CAAC,CAAC,wCAAD,CAAD,CAA4C,CAA5C,EAA+CgoB,OAAhF;AAEA5T,MAAAA,GAAG,CAACyT,OAAJ,CAAY1G,OAAZ,GAAsBmH,sBAAsB,CAACC,SAAD,EAAY,IAAZ,EAAkB,IAAlB,EAAwB,eAAxB,CAA5C;AACD,KATI,MAUA;AACHnU,MAAAA,GAAG,CAACyT,OAAJ,CAAYzG,MAAZ,GAAqB9J,2BAA2B,CAACwR,IAAD,CAAhD;AACD,KAjCwC,CAmCzC;;;AACAvlB,IAAAA,UAAU,CAAC;AAAA,aAAMqkB,gCAAgC,CAACxT,GAAD,CAAtC;AAAA,KAAD,EAA8C,IAA9C,CAAV;AACD;AAED;;;;;;AAIA,WAAS+U,yBAAT,CAAmC/Q,OAAnC,EAA4C;AAC1C,QAAI0Q,IAAI,GAAG9oB,CAAC,CAAC,+BAAD,CAAD,CAAmC6O,GAAnC,EAAX;AAEA;;AACA,QAAIka,UAAU,GAAG;AACf7O,MAAAA,KAAK,EAAE;AADQ,KAAjB;AAIA;;AACA,QAAI9F,GAAG,GAAG;AACRiU,MAAAA,IAAI,EAAEnP,sBAAsB,CAAC7B,MADrB;AAERpL,MAAAA,EAAE,EAAEmM,OAAO,CAACnM,EAFJ;AAGR4b,MAAAA,OAAO,EAAEkB;AAHD,KAAV;;AAMA,QAAID,IAAI,KAAK,OAAb,EAAsB;AACpB1U,MAAAA,GAAG,CAACyT,OAAJ,CAAY3N,KAAZ,GAAoB,aAApB;AACD,KAFD,MAGK;AACH9F,MAAAA,GAAG,CAACyT,OAAJ,CAAYrM,kBAAZ,GAAiCxb,CAAC,CAAC,wCAAD,CAAD,CAA4C,CAA5C,EAA+CgoB,OAAhF;AACA5T,MAAAA,GAAG,CAACyT,OAAJ,CAAY1G,OAAZ,GAAsBmH,sBAAsB,CAACC,SAAD,EAAY,IAAZ,EAAkB,KAAlB,EAAyB,IAAzB,CAA5C;AACD,KArByC,CAuB1C;;;AACAhlB,IAAAA,UAAU,CAAC;AAAA,aAAMqkB,gCAAgC,CAACxT,GAAD,CAAtC;AAAA,KAAD,EAA8C,IAA9C,CAAV;AACD;AAGD;;;AAEA,MAAMgV,mBAAmB,GAAG,MAA5B;AAEA;;;;;;;AAMC,WAASC,mBAAT,CAA6BC,MAA7B,EAA+C;AAAA,QAAVC,GAAU,uEAAN,IAAM;;AAC9C,QAAIzb,CAAC,CAAC0b,QAAF,CAAWD,GAAX,CAAJ,EAAqB;AACnBA,MAAAA,GAAG,GAAG5oB,IAAI,CAACe,SAAL,CAAe6nB,GAAf,CAAN;AACD;;AAED,QAAInpB,UAAJ,EAAgB;AACd,UAAMqpB,MAAM,aAAML,mBAAN,SAA4BE,MAA5B,SAAqCC,GAAG,KAAK,IAAR,GAAe,MAAIA,GAAnB,GAAyB,EAA9D,CAAZ;AACA3nB,MAAAA,OAAO,CAACC,GAAR,CAAY4nB,MAAZ;AACD,KAHD,MAIK;AACH,UAAMA,OAAM,aAAML,mBAAN,SAA4BE,MAA5B,SAAqCC,GAAG,KAAK,IAAR,GAAe,MAAIzC,MAAM,CAACC,MAAP,CAAc2C,QAAQ,CAACC,kBAAkB,CAACJ,GAAD,CAAnB,CAAtB,CAAnB,GAAsE,EAA3G,CAAZ;;AACAzpB,MAAAA,MAAM,CAACU,QAAP,GAAkBipB,OAAlB;AACD;AACF;AAED;AAEA;;;AACA,WAASrC,wBAAT,CAAkCwC,QAAlC,EAA4C;AAC1CxmB,IAAAA,QAAQ,CAAC,YAAW;AAClB;AACA,UAAM+Q,IAAI,GAAGrG,CAAC,CAAC0b,QAAF,CAAWI,QAAX,IAAuBA,QAAvB,GAAkCjpB,IAAI,CAACC,KAAL,CAAWgpB,QAAX,CAA/C;AACA3W,MAAAA,MAAM,CAACkB,IAAD,CAAN;AACD,KAJO,CAAR;AAKD,GAztIe,CA2tIhB;;;AACA,WAASmT,2BAAT,CAAqCsC,QAArC,EAA+C;AAC7CxmB,IAAAA,QAAQ,CAAC,YAAW;AAClB;AACA,UAAM+Q,IAAI,GAAGrG,CAAC,CAAC0b,QAAF,CAAWI,QAAX,IAAuBA,QAAvB,GAAkCjpB,IAAI,CAACC,KAAL,CAAWgpB,QAAX,CAA/C;;AACA,UAAIzV,IAAI,CAAC1D,UAAL,KAAoB,oBAAxB,EAA8C;AAC5CS,QAAAA,wBAAwB,CAACiD,IAAI,CAAC3R,IAAL,CAAU8Q,OAAX,CAAxB;AACD,OAFD,MAGK,IAAIa,IAAI,CAAC1D,UAAL,KAAoB,oBAApB,IACA0D,IAAI,CAAC1D,UAAL,KAAoB,qBADxB,EAC+C;AAClDD,QAAAA,4BAA4B,CAAC2D,IAAI,CAAC1D,UAAN,CAA5B;AACD,OAHI,MAIA,IAAI0D,IAAI,CAAC1D,UAAL,KAAoB,wBAAxB,EAAkD;AACrD;AACA6E,QAAAA,SAAS,CAAC,wBAAD,EAA2BnB,IAAI,CAAC3R,IAAL,CAAUsN,OAArC,CAAT,CAFqD,CAGrD;;AACAlD,QAAAA,4BAA4B,CAAC,IAAD,CAA5B;AACD,OALI,MAMA,IAAIuH,IAAI,CAAC1D,UAAL,KAAoB,aAAxB,EAAuC;AAC1C,YAAI0D,IAAI,CAAC3R,IAAL,CAAU+V,MAAV,KAAqB,oBAAzB,EAA+C;AAC7CiK,UAAAA,6BAA6B;AAC9B;AACF,OAJI,MAKA,IAAIrO,IAAI,CAAC1D,UAAL,KAAoB,mBAAxB,EAA6C;AAChD;AACA,YAAI0I,YAAY,CAAC3W,IAAb,CAAkB+W,OAAlB,KAA8BqB,cAAc,CAACK,YAAjD,EAA+D;AAC7D;AACA3F,UAAAA,SAAS,CAAC,mBAAD,EAAsBnB,IAAI,CAAC3R,IAAL,CAAU+kB,wBAAV,IAAsCC,MAAM,CAACqC,gBAAnE,CAAT,CAF6D,CAG7D;;AACAxY,UAAAA,gBAAgB;AACjB;AACF,OARI,MASA,IAAI8C,IAAI,CAAC1D,UAAL,KAAoB,oCAAxB,EAA8D;AACjElB,QAAAA,eAAe,CACb,iDADa,EAEb,gDAFa,EAGb,OAHa,EAIb,IAJa,EAIP,IAJO,EAID,IAJC,CAAf;AAKD,OANI,MAOA,IAAI4E,IAAI,CAAC1D,UAAL,KAAoB,sCAAxB,EAAgE;AACnE,YAAMqZ,uBAAuB,GAAGnV,IAAI,CAACqB,CAAL,CAAO,sDAAP,CAAhC;AACA/C,QAAAA,MAAM,CAAC;AACLM,UAAAA,QAAQ,EAAE,CADL;AACQ;AACbD,UAAAA,OAAO,EAAExF,CAAC,CAACic,QAAF,CAAWD,uBAAX,EAAoC;AAACtnB,YAAAA,IAAI,EAAE2R,IAAI,CAAC3R;AAAZ,WAApC;AAFJ,SAAD,CAAN;AAID,OANI,MAOA,IAAI2R,IAAI,CAAC1D,UAAL,KAAoB,iCAAxB,EAA2D;AAC9DsC,QAAAA,kBAAkB,CAAC/S,CAAC,CAAC,gCAAD,CAAF,CAAlB;AACD;AACF,KA/CO,CAAR;AAgDD,GA7wIe,CA+wIhB;AACA;;;AACA,MAAIgqB,iBAAiB,GAAG,IAAxB;;AACA,WAAS9C,0BAAT,CAAoC0C,QAApC,EAA8C;AAC5C;AACA,QAAII,iBAAiB,KAAK,IAA1B,EAAgC;AAC9BjhB,MAAAA,YAAY,CAACihB,iBAAD,CAAZ;AACAA,MAAAA,iBAAiB,GAAG,IAApB;AACD;;AAEDA,IAAAA,iBAAiB,GAAGzmB,UAAU,CAAC,YAAW;AACxCymB,MAAAA,iBAAiB,GAAG,IAApB,CADwC,CAGxC;;AACA,UAAI7V,IAAI,GAAGrG,CAAC,CAAC0b,QAAF,CAAWI,QAAX,IAAuBA,QAAvB,GAAkCjpB,IAAI,CAACC,KAAL,CAAWgpB,QAAX,CAA7C;AACAriB,MAAAA,WAAW,GAAG4M,IAAI,CAACyH,KAAnB;AACA7b,MAAAA,OAAO,CAACsE,OAAR,CAAgBlE,4BAAhB;AACD,KAP6B,EAO3B,GAP2B,CAA9B;AAQD,GAjyIe,CAmyIhB;;;AACA,WAAS8pB,iCAAT,CAA2CL,QAA3C,EAAqD;AACnDxmB,IAAAA,QAAQ,CAAC,YAAW;AAClB,UAAI+Q,IAAI,GAAGxT,IAAI,CAACC,KAAL,CAAWgpB,QAAX,CAAX;AACAjgB,MAAAA,eAAe,CAACwK,IAAI,CAAC+V,QAAN,EAAgB,IAAhB,CAAf;;AAEA,UAAI/V,IAAI,CAACgW,OAAT,EAAiB;AACf,YAAIhW,IAAI,CAACiW,iBAAT,EAA4B;AAC1B;AACArX,UAAAA,kBAAkB,CAAC/S,CAAC,CAAC,uBAAD,CAAF,CAAlB;AACD,SAHD,MAIK;AACH+S,UAAAA,kBAAkB,CAAC/S,CAAC,CAAC,sBAAD,CAAF,CAAlB;AACD;AACF,OAZiB,CAalB;;AACD,KAdO,CAAR;AAeD,GApzIe,CAszIhB;;;AACA,WAASynB,kCAAT,CAA4CmC,QAA5C,EAAsD;AACpDnmB,IAAAA,SAAS,CAAC,2CAAD,CAAT,CADoD,CAGpD;;AACA,QAAI0Q,IAAI,GAAGrG,CAAC,CAAC0b,QAAF,CAAWI,QAAX,IAAuBA,QAAvB,GAAkCjpB,IAAI,CAACC,KAAL,CAAWgpB,QAAX,CAA7C;AACAxmB,IAAAA,QAAQ,CAAC,YAAW;AAClBM,MAAAA,gBAAgB,CAACyQ,IAAI,CAACzP,UAAN,CAAhB;AACD,KAFO,CAAR;AAGD,GA/zIe,CAi0IhB;;;AACA,WAAS2lB,0BAAT,CAAoCT,QAApC,EAA8C;AAC5CnmB,IAAAA,SAAS,CAAC,mCAAD,CAAT,CAD4C,CAG5C;;AACA,QAAI0Q,IAAI,GAAGrG,CAAC,CAAC0b,QAAF,CAAWI,QAAX,IAAuBA,QAAvB,GAAkCjpB,IAAI,CAACC,KAAL,CAAWgpB,QAAX,CAA7C;AACAxmB,IAAAA,QAAQ,CAAC,YAAW;AAClB;AAEA,UAAI+Q,IAAI,CAACmW,QAAL,CAAcvU,UAAd,CAAyB,uBAAzB,CAAJ,EAAuD;AACrDtT,QAAAA,WAAW,CAAC,cAAD,CAAX;;AACA,YAAI8E,WAAW,KAAK,WAApB,EAAiC;AAC/B+Z,UAAAA,WAAW;AACZ;AACF,OALD,MAMK,IAAInN,IAAI,CAACmW,QAAL,CAAcvU,UAAd,CAAyB,mBAAzB,KAAiD5B,IAAI,CAACmW,QAAL,CAAcvU,UAAd,CAAyB,qBAAzB,CAArD,EAAsG;AACzGtT,QAAAA,WAAW,CAAC,cAAD,CAAX;AACD,OAFI,MAGA,IAAI0R,IAAI,CAACmW,QAAL,CAAcvU,UAAd,CAAyB,oBAAzB,CAAJ,EAAoD;AACvDtT,QAAAA,WAAW,CAAC,eAAD,CAAX;AACD,OAFI,MAGA,IAAI0R,IAAI,CAACmW,QAAL,CAAcvU,UAAd,CAAyB,qBAAzB,CAAJ,EAAqD;AACxD,YAAMrE,OAAO,GAAGyC,IAAI,CAACmW,QAAL,CAActI,SAAd,CAAwB7N,IAAI,CAACmW,QAAL,CAAcC,WAAd,CAA0B,GAA1B,IAA+B,CAAvD,CAAhB;AACAjgB,QAAAA,mBAAmB,+BAAwBoH,OAAxB,EAAnB;AACD,OAHI,MAIA,IAAIyC,IAAI,CAACmW,QAAL,CAAcvU,UAAd,CAAyB,oBAAzB,CAAJ,EAAoD;AACvDtT,QAAAA,WAAW,CAAC,eAAD,CAAX;AACD,OAFI,MAGA;AACHomB,QAAAA,KAAK,CAAC1U,IAAI,CAACmW,QAAN,CAAL;AACA/O,QAAAA,qBAAqB,CAAC,2DAAD,CAArB;AACD;AACF,KA1BO,CAAR;AA2BD;AAGD;;;;;;;AAKA,WAASqM,gCAAT,CAA0CgC,QAA1C,EAAoD;AAClDxmB,IAAAA,QAAQ,CAAC,YAAW;AAClBK,MAAAA,SAAS,CAAC,kCAAD,EAAqCmmB,QAArC,CAAT;AAEA,UAAIzV,IAAJ;;AACA,UAAI;AACF;AACAA,QAAAA,IAAI,GAAGrG,CAAC,CAAC0b,QAAF,CAAWI,QAAX,IAAuBA,QAAvB,GAAkCjpB,IAAI,CAACC,KAAL,CAAWgpB,QAAX,CAAzC;AACD,OAHD,CAIA,OAAMxnB,CAAN,EAAS;AACPmZ,QAAAA,qBAAqB,CAAC,0DAA0DnZ,CAA3D,CAArB;AACA;AACD;;AAED,cAAQ+R,IAAI,CAACkU,IAAb;AACE,aAAKnP,sBAAsB,CAACjC,OAA5B;AACE;AACAlX,UAAAA,OAAO,CAACsE,OAAR,CAAgB2S,oBAAoB,CAACC,OAArC,EAA8C9C,IAAI,CAAC0T,OAAnD;AACA;;AAEF,aAAK3O,sBAAsB,CAAChC,YAA5B;AACE;AACA;AACA;;AAEF,aAAKgC,sBAAsB,CAAC/B,SAA5B;AACE;AACApX,UAAAA,OAAO,CAACsE,OAAR,CAAgB2S,oBAAoB,CAACG,SAArC,EAAgDhD,IAAI,CAAC0T,OAArD;AACA;;AAEF,aAAK3O,sBAAsB,CAAC9B,KAA5B;AACE;AACA;AACA;;AAEF,aAAK8B,sBAAsB,CAAC7B,MAA5B;AACE;AACA;AACA;AAxBJ,OAbkB,CAwClB;;;AACA,UAAIlD,IAAI,CAAClI,EAAL,IAAW,CAAC6B,CAAC,CAACa,WAAF,CAAc6b,4BAA4B,CAACrW,IAAI,CAAClI,EAAN,CAA1C,CAAhB,EAAsE;AACpE;AACAue,QAAAA,4BAA4B,CAACrW,IAAI,CAAClI,EAAN,CAA5B,CAAsC6H,IAAtC,CAA2C,IAA3C,EAAiDK,IAAI,CAAC0T,OAAtD;AACA,eAAO2C,4BAA4B,CAACrW,IAAI,CAAClI,EAAN,CAAnC;AACD;AACF,KA9CO,CAAR;AA+CD;AAED;AAEA;;;AACA,WAASzI,0BAAT,GAAsC;AACpCJ,IAAAA,QAAQ,CAAC,YAAW;AAClBimB,MAAAA,mBAAmB,CAAC,OAAD,CAAnB;AAEAtpB,MAAAA,OAAO,CAACsE,OAAR,CAAgBnE,cAAhB;AACD,KAJO,CAAR;AAKD,GAr6Ie,CAu6IhB;AACA;AACA;AACA;AACA;;;AACA,WAAS+V,oCAAT,CAA8Cf,MAA9C,EAAsDuV,WAAtD,EAAmE;AACjE,SAAK,IAAI7c,GAAT,IAAgB6c,WAAhB,EAA6B;AAC3B,UAAI,CAACA,WAAW,CAAC3U,cAAZ,CAA2BlI,GAA3B,CAAL,EAAsC;AACpC;AACD;;AAED,UAAI8c,IAAI,GAAG;AACTxV,QAAAA,MAAM,EAAEA,MADC;AAETtH,QAAAA,GAAG,EAAEA,GAFI;AAGT+c,QAAAA,MAAM,EAAEF,WAAW,CAAC7c,GAAD;AAHV,OAAX;AAKAgd,MAAAA,mBAAmB,CAACF,IAAD,CAAnB;AACD;;AAED,aAASE,mBAAT,CAA6BC,OAA7B,EAAsC;AACpCznB,MAAAA,QAAQ,CAAC,YAAW;AAClBimB,QAAAA,mBAAmB,CAAC,aAAD,EAAgBwB,OAAhB,CAAnB;AACD,OAFO,CAAR;AAGD;AACF;AAED;;;;;AAGA,WAAStP,qBAAT,GAAiC;AAC/B,QAAMnH,GAAG,GAAGR,KAAK,CAACC,SAAN,CAAgB/S,KAAhB,CAAsBgT,IAAtB,CAA2BC,SAA3B,EAAsC9M,IAAtC,CAA2C,GAA3C,CAAZ;AACA7D,IAAAA,QAAQ,CAAC,YAAW;AAClBimB,MAAAA,mBAAmB,CAAC,KAAD,EAAQjV,GAAR,CAAnB;AACD,KAFO,CAAR;AAGD,GAz8Ie,CA28IhB;;;AACA,WAAS3L,6BAAT,GAAyC;AACvC;AACA,QAAIlB,WAAW,KAAK,UAAhB,IAA8BA,WAAW,KAAK,WAAlD,EAA+D;AAC7D;AACD;;AACDnE,IAAAA,QAAQ,CAAC,YAAW;AAClBimB,MAAAA,mBAAmB,CAAC,OAAD,CAAnB;AACD,KAFO,CAAR;AAGD,GAp9Ie,CAs9IhB;;;AACA,WAAS3gB,4BAAT,GAAwC;AACtC;AACA,QAAInB,WAAW,KAAK,UAAhB,IAA8BA,WAAW,KAAK,cAAlD,EAAkE;AAChE;AACD;;AACDnE,IAAAA,QAAQ,CAAC,YAAW;AAClBimB,MAAAA,mBAAmB,CAAC,MAAD,CAAnB;AACD,KAFO,CAAR;AAGD,GA/9Ie,CAi+IhB;;;AACA,WAAS5N,iCAAT,CAA2CqP,gBAA3C,EAA6D;AAC3D;AACA,QAAIvjB,WAAW,KAAK,UAAhB,IAA8BA,WAAW,KAAK,cAAlD,EAAkE;AAChE;AACD;;AACDnE,IAAAA,QAAQ,CAAC,YAAW;AAClBimB,MAAAA,mBAAmB,CAAC,WAAD,qBAA0ByB,gBAAgB,GAAG,GAAH,GAAS,GAAnD,EAAnB;;AACA,UAAI1qB,UAAJ,EAAgB;AACdyoB,QAAAA,KAAK,CAAC,8BAAD,CAAL;AACD;AACF,KALO,CAAR;AAMD,GA7+Ie,CA++IhB;;;AACA,WAASza,8BAAT,CAAwC2c,YAAxC,EAAsD;AACpD3nB,IAAAA,QAAQ,CAAC,YAAW;AAClBimB,MAAAA,mBAAmB,CAAC,cAAD,EAAiB0B,YAAjB,CAAnB;;AACA,UAAI3qB,UAAJ,EAAgB;AACd;AACA0N,QAAAA,CAAC,CAACqC,KAAF,CAAQ8Z,iCAAR,EAA2C,GAA3C,EAAgDtpB,IAAI,CAACe,SAAL,CAAe;AAC7DwoB,UAAAA,QAAQ,EAAEvpB,IAAI,CAACC,KAAL,CAAWmqB,YAAX,CADmD;AAE7DZ,UAAAA,OAAO,EAAE,IAFoD;AAG7DC,UAAAA,iBAAiB,EAAE7iB,WAAW,KAAK,WAAhB,IAA+BA,WAAW,KAAK;AAHL,SAAf,CAAhD;AAKD;AACF,KAVO,CAAR;AAWD,GA5/Ie,CA8/IhB;;;AACA,WAASuL,8BAAT,CAAwCkY,YAAxC,EAAsD;AACpD5nB,IAAAA,QAAQ,CAAC,YAAW;AAClBimB,MAAAA,mBAAmB,CAAC,cAAD,EAAiB2B,YAAjB,CAAnB;AACD,KAFO,CAAR;AAGD,GAngJe,CAqgJhB;;;AACA,WAAStF,4BAAT,CAAsCuF,WAAtC,EAAmD;AACjD7nB,IAAAA,QAAQ,CAAC,YAAW;AAClBimB,MAAAA,mBAAmB,CAAC,YAAD,EAAe4B,WAAf,CAAnB;AACD,KAFO,CAAR;AAGD,GA1gJe,CA4gJhB;;;AACA,WAAS3oB,6BAAT,GAAyC;AACvCc,IAAAA,QAAQ,CAAC,YAAW;AAClBimB,MAAAA,mBAAmB,CAAC,aAAD,CAAnB;;AACA,UAAIjpB,UAAJ,EAAgB;AACdyoB,QAAAA,KAAK,CAAC,wCAAD,CAAL;AACD;AACF,KALO,CAAR;AAMD;AAED;;;;;;AAIA,WAASnG,mCAAT,GAA+C;AAC7Ctf,IAAAA,QAAQ,CAAC,YAAW;AAClBimB,MAAAA,mBAAmB,CAAC,mBAAD,CAAnB;;AACA,UAAIjpB,UAAJ,EAAgB;AACdyoB,QAAAA,KAAK,CAAC,qDAAD,CAAL;AACD;AACF,KALO,CAAR;AAMD;AAED;;;;;;;;AAMA,MAAI2B,4BAA4B,GAAG,EAAnC;AAEA;;;;;;;AAMA,WAAS7Q,gCAAT,CAA0CvB,OAA1C,EAAmD;AACjD,QAAI6F,OAAO,GAAG,IAAIiN,OAAJ,CAAY,UAAClN,OAAD,EAAa;AACrCwM,MAAAA,4BAA4B,CAACpS,OAAO,CAACnM,EAAT,CAA5B,GAA2C+R,OAA3C;AAEA5a,MAAAA,QAAQ,CAAC,YAAW;AAClBimB,QAAAA,mBAAmB,CAAC,SAAD,EAAYjR,OAAZ,CAAnB;;AAEA,YAAIhY,UAAJ,EAAgB;AAAA;;AACd,cAAM+qB,qBAAqB,uEACxBlT,kBAAkB,CAAChB,OADK,EACK0R,mBADL,0CAExB1Q,kBAAkB,CAACC,QAFK,EAEM0Q,oBAFN,0CAGxB3Q,kBAAkB,CAACb,KAHK,EAGG8R,wBAHH,0CAIxBjR,kBAAkB,CAACZ,MAJK,EAII8R,yBAJJ,yBAA3B;AAMAgC,UAAAA,qBAAqB,CAAC/S,OAAO,CAACA,OAAT,CAArB,CAAuCA,OAAvC;AACD;AACF,OAZO,CAAR;AAaD,KAhBa,CAAd;AAkBA,WAAO6F,OAAP;AACD;AAED;AAEA;AACA;;;AAEAne,EAAAA,MAAM,CAACsnB,wBAAP,GAAkCA,wBAAlC,CA5kJgB,CA4kJ4C;;AAC5DtnB,EAAAA,MAAM,CAAConB,0BAAP,GAAoCA,0BAApC;AACApnB,EAAAA,MAAM,CAACwnB,2BAAP,GAAqCA,2BAArC;AACAxnB,EAAAA,MAAM,CAACmqB,iCAAP,GAA2CA,iCAA3C;AACAnqB,EAAAA,MAAM,CAAC2nB,kCAAP,GAA4CA,kCAA5C;AACA3nB,EAAAA,MAAM,CAACuqB,0BAAP,GAAoCA,0BAApC;AACAvqB,EAAAA,MAAM,CAAC8nB,gCAAP,GAA0CA,gCAA1C;AAEC,CAplJH,EAolJK9nB,MAplJL","sourcesContent":["/*\n * Copyright (c) 2015, Psiphon Inc.\n * All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\n(function(window) {\n  \"use strict\";\n  /* jshint strict:true, newcap:false */\n\n  /* GENERAL */\n\n  var $window = $(window);\n\n  // Fired on the window when the UI language changes\n  var LANGUAGE_CHANGE_EVENT = 'language-change';\n\n  // Fired on the window when HTML interface declares itself ready.\n  var UI_READY_EVENT = 'ui-ready';\n\n  // Fired on the window when the connected state changes\n  var CONNECTED_STATE_CHANGE_EVENT = 'connected-state-change';\n\n  // We often test in-browser and need to behave a bit differently\n  var IS_BROWSER = true;\n\n  // Parse whatever JSON parameters were passed by the application.\n  var g_initObj = { Cookies: {} };\n  (function() {\n    var uriHash = location.hash;\n    if (uriHash && uriHash.length > 1) {\n      g_initObj = JSON.parse(decodeURIComponent(uriHash.slice(1)));\n      IS_BROWSER = false;\n    }\n\n    // For browser debugging\n    if (IS_BROWSER) {\n      g_initObj = g_initObj || {};\n      g_initObj.Config = g_initObj.Config || {};\n      g_initObj.Config.ClientVersion = g_initObj.Config.ClientVersion || '99';\n      g_initObj.Config.Language = g_initObj.Config.Language || 'en';\n      g_initObj.Config.Banner = g_initObj.Config.Banner || 'banner.png';\n      g_initObj.Config.InfoURL =\n        g_initObj.Config.InfoURL || 'https://example.com/browser-InfoURL/index.html';\n      g_initObj.Config.NewVersionEmail =\n        g_initObj.Config.NewVersionEmail || 'browser-NewVersionEmail@example.com';\n      g_initObj.Config.NewVersionURL =\n        g_initObj.Config.NewVersionURL || 'https://example.com/browser-NewVersionURL/en/download.html#direct';\n      g_initObj.Config.FaqURL = g_initObj.Config.FaqURL || 'https://example.com/browser-FaqURL/en/faq.html';\n      g_initObj.Config.DataCollectionInfoURL =\n        g_initObj.Config.DataCollectionInfoURL || 'https://example.com/browser-DataCollectionInfoURL/en/privacy.html#information-collected';\n      g_initObj.Config.DpiScaling = 1.0;\n      g_initObj.Config.Debug = g_initObj.Config.Debug || true;\n\n      g_initObj.Cookies = JSON.stringify({\n        AvailableEgressRegions: ['US', 'GB', 'JP', 'NL', 'DE']\n      });\n\n      console.log(g_initObj);\n    }\n  })();\n\n  $(function overallInit() {\n    // Do some browser-version-dependent DOM pruning\n    if (compareIEVersion('lte', 7, false)) {\n      $('.ie7Remove').remove();\n    }\n\n    // Set the logo \"info\" link\n    $('.js-logo a').attr('href', g_initObj.Config.InfoURL).attr('title', g_initObj.Config.InfoURL);\n\n    // Update the logo when the connected state changes\n    $window.on(CONNECTED_STATE_CHANGE_EVENT, updateLogoConnectState);\n    updateLogoConnectState();\n\n    // The banner image filename is parameterized.\n    $('.banner img').attr('src', g_initObj.Config.Banner);\n    // Let the C-code decide what should be opened when the banner is clicked.\n    $('.banner a').on('click', function(e) {\n      e.preventDefault();\n      HtmlCtrlInterface_BannerClick();\n    });\n\n    // Some elements besides the nav tabs switch to panes. Add handlers for that.\n    // Using `data-toggle`+`data-target` isn't good enough, as it doesn't result in the\n    // nav tab being activated.\n    $('[data-tab-switch]').on('click', function(e) {\n      e.preventDefault();\n      const target = $(this).data('tab-switch');\n      switchToTab(target, null);\n    });\n\n    // Links to the download site and email address are parameterized and need to\n    // be updated when the language changes.\n    const updateLinks = nextTickFn(function updateLinks() {\n      // Our configured download site URLs are to the English version of the pages, but the site supports language redirects. So we'll strip out the `/en` before updating in the UI.\n\n      let url = g_initObj.Config.InfoURL.replace('/en/', '/');\n      $('.InfoURL').attr('href', url).attr('title', url);\n\n      url = g_initObj.Config.NewVersionURL.replace('/en/', '/');\n      $('.NewVersionURL').attr('href', url).attr('title', url);\n\n      url = g_initObj.Config.FaqURL.replace('/en/', '/');\n      $('.FaqURL').attr('href', url).attr('title', url);\n\n      url = g_initObj.Config.DataCollectionInfoURL.replace('/en/', '/');\n      $('.DataCollectionInfoURL').attr('href', url).attr('title', url);\n\n      // No replacement on the email address\n      $('.NewVersionEmail').attr('href', 'mailto:' + g_initObj.Config.NewVersionEmail)\n                           .text(g_initObj.Config.NewVersionEmail)\n                           .attr('title', g_initObj.Config.NewVersionEmail);\n\n      $('.ClientVersion').text(g_initObj.Config.ClientVersion);\n    });\n    $window.on(LANGUAGE_CHANGE_EVENT, updateLinks);\n    // ...and now.\n    updateLinks();\n\n    // Update the size of our tab content element when the window resizes...\n    var lastWindowHeight = $window.height();\n    var lastWindowWidth = $window.width();\n    $window.smartresize(function() {\n      // Only go through the resize logic if the window actually changed size.\n      // This helps with the constant resize events we get with IE7.\n      if (lastWindowHeight !== $window.height() ||\n          lastWindowWidth !== $window.width()) {\n        lastWindowHeight = $window.height();\n        lastWindowWidth = $window.width();\n        nextTick(resizeContent);\n      }\n    });\n    // ...and when a tab is activated...\n    $('a[data-toggle=\"tab\"]').on('shown', function() {\n      nextTick(resizeContent);\n    });\n    // ...and when the language changes...\n    $window.on(LANGUAGE_CHANGE_EVENT, nextTickFn(resizeContent));\n    // ...and now.\n    resizeContent();\n\n    // We don't want buggy scrolling behaviour (which can result from some click-drag selecting)\n    initScrollFix();\n\n    setTimeout(HtmlCtrlInterface_AppReady, 100);\n  });\n\n\n  function resizeContent() {\n    DEBUG_LOG('resizeContent called');\n\n    // Do DPI scaling\n    updateDpiScaling(g_initObj.Config.DpiScaling, false);\n\n    // We want the content part of our window to fill the window, we don't want\n    // excessive scroll bars, etc. It's difficult to do \"fill the remaining height\"\n    // with just CSS, so we're going to do some on-resize height adjustment in JS.\n    var fillHeight = $window.innerHeight() - $('.js-main-height').position().top;\n    var footerHeight = $('.footer').outerHeight();\n    $('.js-main-height').outerHeight((fillHeight - footerHeight) / g_initObj.Config.DpiScaling);\n    $('.js-main-height').parentsUntil('body').add($('.js-main-height').siblings()).css('height', '100%');\n\n    // Let the panes know that content resized\n    $('.js-main-height').trigger('resize');\n\n    doMatchHeight();\n    doMatchWidth();\n\n    // Adjust the banner to account for the logo space.\n    $('.banner').css(g_isRTL ? 'margin-right' : 'margin-left', $('.header-nav-join').outerWidth())\n                .css(!g_isRTL ? 'margin-right' : 'margin-left', 0);\n  }\n\n  /**\n   * Take steps necessary to adapt to changing screen DPI (like an intial scaling other\n   * than 1.0, or when the app gets dragged between monitors with different scaling).\n   * @param {string} dpiScaling Contains a floating point number, like \"1.0\", \"1.2\", \"2.5\"\n   * @param {boolean} andResizeContent Indicates whether a full resize should occur (default true)\n   */\n  function updateDpiScaling(dpiScaling, andResizeContent=true) {\n    // NOTE: This may not get processed often enough. If, say, a `.affix`\n    // element is added programmatically to the DOM, it won't get\n    // processed until/unless a DPI change occurs.\n\n    if (updateDpiScaling.lastDpiScaling === dpiScaling) {\n      // We only do this processing when the scaling actually changes.\n      return;\n    }\n    updateDpiScaling.lastDpiScaling = dpiScaling;\n\n    DEBUG_LOG('updateDpiScaling: ' + dpiScaling);\n    g_initObj.Config.DpiScaling = dpiScaling;\n\n    if (compareIEVersion('lt', 9, false)) {\n      // We need IE9+ to support DPI scaling\n      return;\n    }\n\n    var ltrTransformOrigin = '0 0 0',\n        ltrBottomRightTransformOrigin = '100% 100% 0',\n        rtlTransformOrigin = '0 0 0',\n        rtlBottomRightTransformOrigin = '0 100% 0';\n\n    if (getIEVersion() === false && g_isRTL) {\n      // Non-IE in RTL need the origin on the right.\n      rtlTransformOrigin = '100% 0 0';\n    }\n\n    var transformOrigin = g_isRTL ? rtlTransformOrigin : ltrTransformOrigin,\n        bottomRightTransformOrigin = g_isRTL ? rtlBottomRightTransformOrigin : ltrBottomRightTransformOrigin;\n\n    // Set the overall body scaling\n    $('html').css({\n      '-ms-transform-origin': transformOrigin,\n      'transform-origin': transformOrigin,\n      '-ms-transform': 'scale(' + dpiScaling + ')',\n      'transform': 'scale(' + dpiScaling + ')',\n      'width': (100.0 / dpiScaling).toFixed(1) + '%',\n      'height': (100.0 / dpiScaling).toFixed(1) + '%'\n    });\n\n    // For elements (like modals) outside the normal flow, additional changes are needed.\n    if (getIEVersion() !== false) {\n      // The left margin will vary depending on default value.\n      // First reset an overridden left margin\n      $('.modal').css('margin-left', '');\n      // Get the default left margin\n      var defaultLeftMargin = $('.modal').css('margin-left');\n      // Create the left margin we want, based on the default\n      var scaledLeftMargin = 'calc(' + defaultLeftMargin + ' * ' + dpiScaling + ')';\n      // Now apply the styles.\n      $('.modal').css({\n        '-ms-transform-origin': transformOrigin,\n        'transform-origin': transformOrigin,\n        '-ms-transform': 'scale(' + dpiScaling + ')',\n        'transform': 'scale(' + dpiScaling + ')',\n        'margin-left': scaledLeftMargin\n      });\n    }\n\n    $('.global-alert').css({\n      '-ms-transform-origin': bottomRightTransformOrigin,\n      'transform-origin': bottomRightTransformOrigin,\n      '-ms-transform': 'scale(' + dpiScaling + ')',\n      'transform': 'scale(' + dpiScaling + ')'\n    });\n\n    // Elements with the `affix` class are position:fixed and need to be adjusted separately\n    if (getIEVersion() !== false) {\n      // Reset previous position modification.\n      $('.affix')\n        .css({'top': '', 'left': ''})\n        .each(function() {\n          var basePosition = $(this).position();\n          $(this).css({\n            '-ms-transform-origin': transformOrigin,\n            'transform-origin': transformOrigin,\n            '-ms-transform': 'scale(' + dpiScaling + ')',\n            'transform': 'scale(' + dpiScaling + ')'\n          });\n          if (basePosition.top) {\n            $(this).css({\n              'top': (basePosition.top * dpiScaling) + 'px'\n            });\n          }\n          if (basePosition.left) {\n            $(this).css({\n              'left': (basePosition.left * dpiScaling) + 'px'\n            });\n          }\n        });\n    }\n\n    // Media query breakpoints need to be scaled accoring to the DPI scaling. This happens\n    // automatically in the browser, but not in our app's HTML control.\n    if (Modernizr.mediaqueries) {\n      const mqRegexp = /^([^0-9]+)([0-9]+)([^0-9]+)$/;\n\n      for (let i = 0; i < document.styleSheets.length; i++) {\n        const ss = document.styleSheets[i];\n\n        // In the IE browser -- but not the app! -- the style sheets created by our data\n        // URI CSS (`data:text/css;base64`, see main.html) will cause an \"access denied\"\n        // exception when we try to access the `cssRules` property. So we'll test for that.\n        try {\n          const test = ss.cssRules.length; // eslint-disable-line\n        }\n        catch (e) {\n          continue;\n        }\n\n        for (let j = 0; j < ss.cssRules.length; j++) {\n          const rule = ss.cssRules[j];\n          if (!rule.media) {\n            // Not a media query rule\n            continue;\n          }\n\n          // Before modifying the media query, we need to make a backup of the\n          // original (if we haven't already).\n          if (!rule.media.mediaText__backup) {\n            rule.media.mediaText__backup = rule.media.mediaText;\n          }\n\n          const mediaTextSplit = rule.media.mediaText__backup.split(' and ');\n          for (let k = 0; k < mediaTextSplit.length; k++) {\n            mediaTextSplit[k] = mediaTextSplit[k].replace(mqRegexp, function(match, pre, num, post) {\n              return `${pre}${Math.round(num * dpiScaling)}${post}`;\n            });\n          }\n\n          rule.media.mediaText = mediaTextSplit.join(' and ');\n        }\n      }\n    }\n\n    if (andResizeContent !== false) {\n      // Need to resize everything.\n      nextTick(resizeContent);\n    }\n  }\n\n  // Ensures that elements that should not be scrolled are not scrolled.\n  // This should only be called once.\n  function initScrollFix() {\n    // It would be much better to fix this correctly using CSS rather than\n    // detecting a bad state and correcting it. But until we figure that out...\n    $('body').scroll(function() {\n      $('body').scrollTop(0);\n    });\n  }\n\n\n  // Update the main connect button, as well as the connection indicator on the tab.\n  function updateLogoConnectState() {\n    var newSrc, stoppedSrc, connectedSrc;\n    stoppedSrc = $('.js-logo img').data('stopped-src');\n    connectedSrc = $('.js-logo img').data('connected-src');\n\n    if (g_lastState === 'connected') {\n      newSrc = connectedSrc;\n    }\n    else {\n      newSrc = stoppedSrc;\n    }\n\n    $('.js-logo img').prop('src', newSrc);\n  }\n\n\n  /* CONNECTION ****************************************************************/\n\n  // The current connected actual state of the application\n  var g_lastState = 'stopped';\n\n  // Used to monitor whether the current connection attempt is taking too long and\n  // so if a \"download new version\" message should be shown.\n  var g_connectingTooLongTimeout = null;\n\n  $(function connectionInit() {\n    connectToggleSetup();\n    egressRegionComboSetup();\n\n    // Update the size of our elements when the tab content element resizes...\n    $('.js-main-height').on('resize', function() {\n      // Only if this tab is active\n      if ($('#connection-pane').hasClass('active')) {\n        nextTick(resizeConnectContent);\n      }\n    });\n    // ...and when the tab is activated...\n    $('a[href=\"#connection-pane\"][data-toggle=\"tab\"]').on('shown', function() {\n      nextTick(resizeConnectContent);\n    });\n    // ...and now.\n    resizeConnectContent();\n  });\n\n  function resizeConnectContent() {\n    // Resize the text in the button\n    $('.textfill-container').textfill({ maxFontPixels: -1 });\n\n    // Set the outer connect button div to the correct height\n    $('#connect-toggle').height($('#connect-toggle > *').outerHeight());\n\n    // Center the connect button div\n    var parentWidth = $('#connect-toggle').parent().innerWidth() -\n                        (parseFloat($('#connect-toggle').parent().css('padding-left')) || 0) -\n                        (parseFloat($('#connect-toggle').parent().css('padding-right')) || 0);\n    if (g_isRTL) {\n      $('#connect-toggle').css({\n        right: ((parentWidth - $('#connect-toggle').outerWidth()) / 2.0)+'px',\n        left: ''\n      });\n    }\n    else {\n      $('#connect-toggle').css({\n        left: ((parentWidth - $('#connect-toggle').outerWidth()) / 2.0)+'px',\n        right: ''\n      });\n    }\n  }\n\n  function connectToggleSetup() {\n    $('#connect-toggle a').click(function(e) {\n      e.preventDefault();\n      var buttonConnectState = $(this).parents('.connect-toggle-content').data('connect-state');\n      if (buttonConnectState === 'stopped') {\n        HtmlCtrlInterface_StartTunnel();\n      }\n      else if (buttonConnectState === 'starting' || buttonConnectState === 'connected') {\n        HtmlCtrlInterface_StopTunnel();\n      }\n      // the stopping button is disabled\n    });\n    updateConnectToggle();\n\n    $('.textfill-container').textfill({ maxFontPixels: -1 });\n\n    // Update the button when the back-end tells us the state has changed.\n    $window.on(CONNECTED_STATE_CHANGE_EVENT, nextTickFn(updateConnectToggle));\n  }\n\n  // Update the main connect button, as well as the connection indicator on the tab.\n  function updateConnectToggle() {\n    $('.connect-toggle-content').each(function() {\n      $(this).toggleClass('z-behind', $(this).data('connect-state') !== g_lastState);\n    });\n\n    $('a[href=\"#connection-pane\"][data-toggle=\"tab\"] [data-connect-state]').each(function() {\n      $(this).toggleClass('z-behind', $(this).data('connect-state') !== g_lastState);\n    });\n\n    if (g_lastState === 'starting') {\n      cycleToggleClass(\n        $('.connect-toggle-content[data-connect-state=\"starting\"] .icon-spin, .connect-toggle-content[data-connect-state=\"starting\"] .state-word'),\n        'in-progress',\n        g_lastState);\n    }\n    else if (g_lastState === 'connected') {\n      // No additional work\n    }\n    else if (g_lastState === 'stopping') {\n      cycleToggleClass(\n        $('.connect-toggle-content[data-connect-state=\"stopping\"] .icon-spin, .connect-toggle-content[data-connect-state=\"stopping\"] .state-word'),\n        'in-progress',\n        g_lastState);\n    }\n    else if (g_lastState === 'stopped') {\n      // No additional work\n    }\n\n    updateConnectAttemptTooLong();\n  }\n\n  // Keeps track of how long the current connection attempt is taking and whether\n  // a message should be shown to the user indicating how to get a new version.\n  function updateConnectAttemptTooLong() {\n    if (g_lastState === 'connected' || g_lastState === 'stopped') {\n      // Clear the too-long timeout\n      if (g_connectingTooLongTimeout !== null) {\n        clearTimeout(g_connectingTooLongTimeout);\n        g_connectingTooLongTimeout = null;\n        connectAttemptTooLongReset();\n      }\n    }\n    else {\n      // Start the too-long timeout\n      if (g_connectingTooLongTimeout === null) {\n        g_connectingTooLongTimeout = setTimeout(connectAttemptTooLong, 60000);\n      }\n    }\n\n    function connectAttemptTooLong() {\n      $('.js-hide-if-long-connecting').addClass('hidden');\n      $('.js-show-if-long-connecting').removeClass('hidden');\n    }\n\n    function connectAttemptTooLongReset() {\n      $('.js-hide-if-long-connecting').removeClass('hidden');\n      $('.js-show-if-long-connecting').addClass('hidden');\n    }\n  }\n\n  function cycleToggleClass(elem, cls, untilStateChangeFrom) {\n    $(elem).toggleClass(cls, 1000, function() {\n      if (g_lastState === untilStateChangeFrom) {\n        nextTick(function cycleToggleClass_inner() {\n          cycleToggleClass(elem, cls, untilStateChangeFrom);\n        });\n      }\n    });\n  }\n\n  function egressRegionComboSetup() {\n    // Rather than duplicating the markup of the settings' egress region list,\n    // we're going to copy it now.\n    // IE7: Don't use $().clone().\n    $('#EgressRegionCombo ul').html($('ul#EgressRegion').html());\n\n    // When an item in the combo is clicked, make the settings code do the work.\n    $('#EgressRegionCombo ul a').click(function egressRegionComboSetup_EgressRegionCombo_click(e) {\n      e.preventDefault();\n      const region = $(this).parents('[data-region]').data('region');\n      if (!region) {\n        return;\n      }\n\n      refreshSettings({\n        EgressRegion: region\n      });\n\n      applySettings();\n    });\n\n    // Have the combobox track the state of the control in the settings pane.\n    $('#EgressRegion').on('change', function egressRegionComboSetup_EgressRegion_change() {\n      let $activeItem;\n      // Copy the relevant classes to the combo items from the settings items.\n      const $regionItems = $('#EgressRegion li');\n      for (let i = 0; i < $regionItems.length; i++) {\n        const $regionItem = $regionItems.eq(i);\n        const region = $regionItem.data('region');\n        const hidden = $regionItem.hasClass('hidden');\n        const active = $regionItem.hasClass('active');\n\n        $('#EgressRegionCombo li[data-region=\"' + region + '\"]')\n          .toggleClass('hidden', hidden)\n          .toggleClass('active', active);\n\n        if (active) {\n          $activeItem = $regionItem;\n        }\n      }\n\n      // Update the button\n      if ($activeItem) {\n        // Most of the list items have an `a` element as an immediate child, but the \"Best\n        // Performance\" element has its `data-i18n` attribute on a `strong` element under\n        // the `a` element.\n        $('#EgressRegionCombo .btn span.flag')\n          .attr('data-i18n', $activeItem.find('[data-i18n]').data('i18n'))\n          .attr('class', $activeItem.find('a').attr('class'))\n          .text($activeItem.find('a').text());\n      }\n    });\n\n    // If the label is clicked, jump to the Egress Region settings section\n    $('.egress-region-combo-container label a').click(function(e) {\n      e.preventDefault();\n      showSettingsSection('#settings-accordion-egress-region');\n      return false;\n    });\n  }\n\n\n  /* SETTINGS ******************************************************************/\n\n  // Event fired on #settings-pane when a setting is changed.\n  var SETTING_CHANGED_EVENT = 'setting-changed';\n\n  var BEST_REGION_VALUE = 'BEST';\n\n  $(function settingsInit() {\n    // This is merely to help with testing\n    if (!g_initObj.Settings)\n    {\n      g_initObj.Settings = {\n        SplitTunnel: 0,\n        DisableTimeouts: 0,\n        VPN: 0,\n        LocalHttpProxyPort: 7771,\n        LocalSocksProxyPort: 7770,\n        ExposeLocalProxiesToLAN: 1,\n        SkipUpstreamProxy: 1,\n        UpstreamProxyHostname: 'upstreamhost',\n        UpstreamProxyPort: 234,\n        UpstreamProxyUsername: 'user',\n        UpstreamProxyPassword: 'password',\n        UpstreamProxyDomain: 'domain',\n        EgressRegion: 'GB',\n        SystrayMinimize: 0,\n        DisableDisallowedTrafficAlert: 0,\n        defaults: {\n          SplitTunnel: 0,\n          DisableTimeouts: 0,\n          VPN: 0,\n          LocalHttpProxyPort: '',\n          LocalSocksProxyPort: '',\n          ExposeLocalProxiesToLAN: 0,\n          SkipUpstreamProxy: 0,\n          UpstreamProxyHostname: '',\n          UpstreamProxyPort: '',\n          UpstreamProxyUsername: '',\n          UpstreamProxyPassword: '',\n          UpstreamProxyDomain: '',\n          EgressRegion: '',\n          SystrayMinimize: 0,\n          DisableDisallowedTrafficAlert: 0\n        }\n      };\n    }\n\n    // Event handlers\n    $('#settings-pane').on(SETTING_CHANGED_EVENT, onSettingChanged);\n    $('.settings-buttons .reset-settings').click(onSettingsReset);\n    $('.settings-buttons .apply-settings').click(onSettingsApply);\n    $('a[href=\"#settings-pane\"][data-toggle=\"tab\"]').on('shown', onSettingsTabShown);\n    $('a[data-toggle=\"tab\"]').on('show', function(e) {\n      if ($('#settings-tab').hasClass('active') &&    // we were active\n          !$(this).parent().is($('#settings-tab'))) { // we won't be active\n        onSettingsTabHiding(e);\n      }\n    });\n\n    // Change the accordion heading icon on expand/collapse\n    $('.js-accordion-body')\n      .on('show', function() {\n        var headingSelector = '.accordion-toggle[href=\"#' + this.id + '\"]';\n        $(headingSelector).addClass('accordion-expanded');\n        var $expandIcon = $(headingSelector).find('.accordion-expand-icon');\n        $expandIcon.removeClass($expandIcon.data('icon-closed'))\n                   .addClass($expandIcon.data('icon-opened'));\n\n        // Remove focus from the heading to clear the text-decoration. (It's too\n        // ham-fisted to do it in CSS.)\n        $(headingSelector).blur();\n      })\n      .on('hide', function() {\n        var headingSelector = '.accordion-toggle[href=\"#' + this.id + '\"]';\n        $(headingSelector).removeClass('accordion-expanded');\n        var $expandIcon = $(headingSelector).find('.accordion-expand-icon');\n        $expandIcon.removeClass($expandIcon.data('icon-opened'))\n                   .addClass($expandIcon.data('icon-closed'));\n\n        // Remove focus from the heading to clear the text-decoration. (It's too\n        // ham-fisted to do it in CSS.)\n        $(headingSelector).blur();\n      });\n\n    systrayMinimizeSetup();\n    disableDisallowedTrafficSetup();\n    splitTunnelSetup();\n    disableTimeoutsSetup();\n    egressRegionSetup();\n    localProxySetup();\n    upstreamProxySetup();\n    vpnModeSetup();\n\n    updateAvailableEgressRegions(false); // don't force valid -- haven't filled in settings yet\n\n    $window.one(UI_READY_EVENT, function() {\n      // Fill in the settings. This must be done after the UI is ready, since it might\n      // show an error, requiring i18n to be initialized.\n      refreshSettings();\n    });\n  });\n\n  //\n  // Overall event handlers\n  //\n\n  // Settings tab has been navigated to and is shown\n  function onSettingsTabShown() {\n    // Reset the Apply button\n    enableSettingsApplyButton(false);\n  }\n\n  // Settings tab is showing, but is being navigated away from.\n  // Call e.preventDefault() to prevent navigation away.\n  function onSettingsTabHiding(e) {\n    // If the settings have been changed and not applied, prevent navigating away\n    // and prompt the user for how it should be resolved.\n    if (getSettingsApplyButtonEnabled()) {\n      e.preventDefault();\n\n      var $modal = $('#SettingsUnappliedChangesPrompt');\n\n      $modal.modal({\n        show: true,\n        backdrop: 'static'\n      });\n\n      // Note: If we don't first remove existing click handlers (with .off), then\n      // the handler that wasn't clicked last time will still be present.\n\n      $modal.find('.js-apply-button').off('click').one('click', function() {\n        $modal.modal('hide');\n        if (applySettings()) {\n          enableSettingsApplyButton(false);\n          $(e.target).tab('show');\n        }\n        else {\n          showSettingsErrorModal();\n        }\n      });\n\n      $modal.find('.js-discard-button').off('click').one('click', function() {\n        $modal.modal('hide');\n        refreshSettings(g_initObj.Settings);\n        enableSettingsApplyButton(false);\n        $(e.target).tab('show');\n      });\n    }\n  }\n\n  // A setting value has been changed.\n  function onSettingChanged(e, id) {\n    DEBUG_LOG('onSettingChanged: ' + id);\n\n    var settingsValues = getSettingsTabValues();\n\n    if (settingsValues === false) {\n      // Settings values are invalid\n      enableSettingsApplyButton(false);\n    }\n    else {\n      var settingsChanged = settingsObjectChanged(settingsValues);\n      enableSettingsApplyButton(settingsChanged);\n    }\n  }\n\n  // Handler for the Reset Settings button\n  function onSettingsReset(e) {\n    /*jshint validthis:true */\n\n    e.preventDefault();\n    $(this).blur();\n\n    refreshSettings(g_initObj.Settings.defaults, false);\n\n    // Force the Apply button to be enabled. Otherwise the user might be confused\n    // about how to make the Reset take effect.\n    enableSettingsApplyButton(true);\n  }\n\n  // Handler for the Apply Settings button\n  function onSettingsApply(e) {\n    /*jshint validthis:true */\n\n    e.preventDefault();\n    $(this).blur();\n\n    if (!getSettingsApplyButtonEnabled()) {\n      return;\n    }\n\n    if (applySettings()) {\n      // Reset the Apply button\n      enableSettingsApplyButton(false);\n\n      // Switch to Connection tab\n      switchToTab('#connection-tab');\n    }\n    else {\n      showSettingsErrorModal();\n    }\n  }\n\n  //\n  // General settings functions\n  //\n\n  // Returns true if newSettings differs from the current canonical settings.\n  function settingsObjectChanged(newSettings) {\n    // This does not take into account more/fewer keys in the object, since that\n    // should not happen.\n\n    var key, i;\n    var keys = _.keys(g_initObj.Settings);\n    for (i = 0; i < keys.length; i++) {\n      key = keys[i];\n      if (key === 'defaults') {\n        // The defaults object doesn't count in the comparison.\n        continue;\n      }\n\n      if (newSettings[key] !== g_initObj.Settings[key]) {\n        DEBUG_LOG('settingsObjectChanged: detected change: ' + key);\n        return true;\n      }\n    }\n\n    DEBUG_LOG('settingsObjectChanged: no change');\n    return false;\n  }\n\n  function enableSettingsApplyButton(enable) {\n    var $applyButton = $('#settings-pane .apply-settings');\n    var currentlyEnabled = getSettingsApplyButtonEnabled();\n\n    if (enable && !currentlyEnabled) {\n      $applyButton.removeClass('disabled').removeAttr('disabled');\n      drawAttentionToButton($applyButton);\n    }\n    else if (!enable && currentlyEnabled) {\n      $applyButton.addClass('disabled').attr('disabled', true);\n    }\n  }\n\n  function getSettingsApplyButtonEnabled() {\n    var $applyButton = $('#settings-pane .apply-settings');\n    return !$applyButton.hasClass('disabled');\n  }\n\n  // Save the current settings (and possibly reconnect).\n  function applySettings() {\n    var settingsValues = getSettingsTabValues();\n    if (settingsValues === false) {\n      // Settings are invalid.\n      return false;\n    }\n\n    // Update settings in the application (and trigger a reconnect, if\n    // necessary).\n    HtmlCtrlInterface_SaveSettings(JSON.stringify(settingsValues));\n\n    return true;\n  }\n\n  // Refresh the current settings. If newSettings is truthy, it will become the\n  // the new current settings, otherwise the existing current settings will be\n  // refreshed in the UI.\n  // newSettings can be a partial settings object (like, just {egressRegion: \"US\"} or whatever).\n  // If forceCurrent is true, the new settings will be become canonical (rather than just displayed).\n  function refreshSettings(newSettings, forceCurrent) {\n    var fullNewSettings = $.extend(g_initObj.Settings, newSettings || {});\n\n    if (forceCurrent) {\n      g_initObj.Settings = fullNewSettings;\n    }\n\n    fillSettingsValues(fullNewSettings);\n\n    // When the settings change, we need to check the current egress region choice.\n    forceEgressRegionValid();\n    // NOTE: If more checks like this are added, we'll need to chain them (somehow),\n    // otherwise we'll have a mess of modals.\n  }\n\n  // Fill in the settings controls with the values in `obj`.\n  function fillSettingsValues(obj) {\n    // Bit of a hack: Unhook the setting-changed event while we fill in the\n    // values, then hook it up again after.\n    $('#settings-pane').off(SETTING_CHANGED_EVENT, onSettingChanged);\n\n    if (!_.isUndefined(obj.SplitTunnel)) {\n      $('#SplitTunnel').prop('checked', !!obj.SplitTunnel);\n    }\n\n    if (!_.isUndefined(obj.DisableTimeouts)) {\n      $('#DisableTimeouts').prop('checked', !!obj.DisableTimeouts);\n    }\n\n    if (!_.isUndefined(obj.VPN)) {\n      $('#VPN').prop('checked', obj.VPN);\n    }\n    vpnModeUpdate();\n\n    if (!_.isUndefined(obj.LocalHttpProxyPort)) {\n      $('#LocalHttpProxyPort').val(obj.LocalHttpProxyPort > 0 ? obj.LocalHttpProxyPort : '');\n    }\n\n    if (!_.isUndefined(obj.LocalSocksProxyPort)) {\n      $('#LocalSocksProxyPort').val(obj.LocalSocksProxyPort > 0 ? obj.LocalSocksProxyPort : '');\n    }\n\n    localProxyValid(false);\n\n    if (!_.isUndefined(obj.ExposeLocalProxiesToLAN)) {\n      $('#ExposeLocalProxiesToLAN').prop('checked', !!obj.ExposeLocalProxiesToLAN);\n    }\n\n    if (!_.isUndefined(obj.UpstreamProxyHostname)) {\n      $('#UpstreamProxyHostname').val(obj.UpstreamProxyHostname);\n    }\n\n    if (!_.isUndefined(obj.UpstreamProxyPort)) {\n      $('#UpstreamProxyPort').val(obj.UpstreamProxyPort > 0 ? obj.UpstreamProxyPort : '');\n    }\n\n    if (!_.isUndefined(obj.UpstreamProxyUsername)) {\n      $('#UpstreamProxyUsername').val(obj.UpstreamProxyUsername);\n    }\n\n    if (!_.isUndefined(obj.UpstreamProxyPassword)) {\n      $('#UpstreamProxyPassword').val(obj.UpstreamProxyPassword);\n    }\n\n    if (!_.isUndefined(obj.UpstreamProxyDomain)) {\n      $('#UpstreamProxyDomain').val(obj.UpstreamProxyDomain);\n    }\n\n    if (!_.isUndefined(obj.SkipUpstreamProxy)) {\n      $('#SkipUpstreamProxy').prop('checked', obj.SkipUpstreamProxy);\n    }\n    skipUpstreamProxyUpdate();\n\n    upstreamProxyValid(false);\n\n    if (!_.isUndefined(obj.EgressRegion)) {\n      var region = obj.EgressRegion || BEST_REGION_VALUE;\n      $('#EgressRegion [data-region]').removeClass('active');\n      $('#EgressRegion').find('[data-region=\"' + region + '\"] a').trigger(\n        'click',\n        { ignoreDisabled: true });\n    }\n\n    if (!_.isUndefined(obj.SystrayMinimize)) {\n      $('#SystrayMinimize').prop('checked', !!obj.SystrayMinimize);\n    }\n\n    if (!_.isUndefined(obj.DisableDisallowedTrafficAlert)) {\n      $('#DisableDisallowedTrafficAlert').prop('checked', !!obj.DisableDisallowedTrafficAlert);\n    }\n\n    // Re-hook the setting-changed event\n    $('#settings-pane').on(SETTING_CHANGED_EVENT, onSettingChanged);\n  }\n\n  // Extracts the values current set in the tab and returns and object with them.\n  // Returns false if the settings are invalid.\n  function getSettingsTabValues() {\n    var valid = true;\n\n    valid = valid && egressRegionValid(true);\n    valid = valid && localProxyValid(true);\n    valid = valid && upstreamProxyValid(true);\n\n    if (!valid) {\n      return false;\n    }\n\n    var egressRegion = $('#EgressRegion li.active').data('region');\n\n    var returnValue = {\n      VPN: $('#VPN').prop('checked') ? 1 : 0,\n      SplitTunnel: $('#SplitTunnel').prop('checked') ? 1 : 0,\n      DisableTimeouts: $('#DisableTimeouts').prop('checked') ? 1 : 0,\n      LocalHttpProxyPort: validatePort($('#LocalHttpProxyPort').val()),\n      LocalSocksProxyPort: validatePort($('#LocalSocksProxyPort').val()),\n      ExposeLocalProxiesToLAN: $('#ExposeLocalProxiesToLAN').prop('checked') ? 1 : 0,\n      UpstreamProxyHostname: $('#UpstreamProxyHostname').val(),\n      UpstreamProxyPort: validatePort($('#UpstreamProxyPort').val()),\n      UpstreamProxyUsername: $('#UpstreamProxyUsername').val(),\n      UpstreamProxyPassword: $('#UpstreamProxyPassword').val(),\n      UpstreamProxyDomain: $('#UpstreamProxyDomain').val(),\n      SkipUpstreamProxy: $('#SkipUpstreamProxy').prop('checked') ? 1 : 0,\n      EgressRegion: egressRegion === BEST_REGION_VALUE ? '' : egressRegion,\n      SystrayMinimize: $('#SystrayMinimize').prop('checked') ? 1 : 0,\n      DisableDisallowedTrafficAlert: $('#DisableDisallowedTrafficAlert').prop('checked') ? 1 : 0\n    };\n\n    return returnValue;\n  }\n\n  function showSettingsErrorModal() {\n    showNoticeModal(\n      'settings#error-modal#title',\n      'settings#error-modal#body',\n      'error',\n      null, null,\n      function() {\n        showSettingErrorSection();\n      }\n    );\n  }\n\n  function showSettingErrorSection() {\n    showSettingsSection(\n      $('#settings-accordion .collapse .error').parents('.collapse').eq(0),\n      $('#settings-pane .error input').eq(0).trigger('focus'));\n  }\n\n  //\n  // Systray Minimize\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function systrayMinimizeSetup() {\n    $('#SystrayMinimize').change(function() {\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n    });\n  }\n\n  //\n  // Disable disallowed traffic alert\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function disableDisallowedTrafficSetup() {\n    $('#DisableDisallowedTrafficAlert').change(function() {\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n    });\n  }\n\n  //\n  // Split Tunnel\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function splitTunnelSetup() {\n    $('#SplitTunnel').change(function() {\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n    });\n  }\n\n  //\n  // Disable Timeouts\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function disableTimeoutsSetup() {\n    $('#DisableTimeouts').change(function() {\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n    });\n  }\n\n  //\n  // Egress Region (Psiphon Server Region)\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function egressRegionSetup() {\n    // Handle changes to the Egress Region\n    $('#EgressRegion a').click(function(e, extraArgs) {\n      e.preventDefault();\n\n      // Do nothing if we're disabled, unless we're forcing a disabled bypass\n      if ($('#EgressRegion').hasClass('disabled') &&\n          (!extraArgs || !extraArgs.ignoreDisabled)) {\n        $(this).blur();\n        return;\n      }\n\n      // Check if this target item is already active. Return if so.\n      if ($(this).parents('[data-region]').hasClass('active')) {\n        return;\n      }\n\n      $('#EgressRegion [data-region]').removeClass('active');\n      $(this).parents('[data-region]').addClass('active');\n      egressRegionValid(false);\n\n      // This event helps the combobox on the connect pane stay in sync.\n      $('#EgressRegion').trigger('change');\n\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, 'EgressRegion');\n    });\n  }\n\n  // Returns true if the egress region value is valid, otherwise false.\n  // Shows/hides an error message as appropriate.\n  function egressRegionValid(/*finalCheck*/) {\n    var $currRegionElem = $('#EgressRegion li.active');\n\n    // Check to make sure the currently selected egress region is one of the\n    // available regions.\n    var valid = $currRegionElem.length > 0 && !$currRegionElem.hasClass('hidden');\n\n    $('#EgressRegion').toggleClass('error', !valid);\n    $('#settings-accordion-egress-region .js-egress-region-invalid').toggleClass('hidden', valid);\n\n    updateErrorAlert();\n    return valid;\n  }\n\n  // Check to make sure the currently selected egress region is one of the available\n  // regions. If not, inform the user and get them to pick another.\n  // A mismatch may occur either as a result of a change in the available egress\n  // regions, or a change in the current selection (i.e., a settings change).\n  function forceEgressRegionValid() {\n    if (egressRegionValid()) {\n      // Valid, nothing to do\n      return;\n    }\n\n    // Put up the modal message\n    showNoticeModal(\n      'settings#egress-region#error-modal-title',\n      'settings#egress-region#error-modal-body-http',\n      'warning',\n      null, null, null);\n\n    showSettingsSection('#settings-accordion-egress-region');\n  }\n\n  // Update the egress region options we show in the UI.\n  // If `forceValid` is true, then if the currently selected region is no longer\n  // available, the user will be prompted to pick a new one.\n  function updateAvailableEgressRegions(forceValid) {\n    var regions = getCookie('AvailableEgressRegions');\n    // On first run there will be no such cookie.\n    regions = regions || [];\n\n    $('#EgressRegion li').each(function() {\n      var elemRegion = $(this).data('region');\n\n      // If no region, this is a divider\n      if (!elemRegion) {\n        return;\n      }\n\n      if (_.includes(regions, elemRegion) || elemRegion === BEST_REGION_VALUE) {\n        $(this).removeClass('hidden');\n      }\n      else {\n        $(this).addClass('hidden');\n      }\n    });\n\n    if (forceValid) {\n      forceEgressRegionValid();\n    }\n\n    $('#EgressRegion').trigger('change');\n  }\n\n  //\n  // Local Proxy Ports\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function localProxySetup() {\n    // Handle change events\n    $('#LocalHttpProxyPort, #LocalSocksProxyPort').on(\n        'keyup keydown keypress change blur',\n        function(event) {\n          // We need to delay this processing so that the change to the text has\n          // had a chance to take effect. Otherwise this.val() will return the old\n          // value.\n          _.delay(_.bind(function() {\n            // Tell the settings pane a change was made.\n            $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n\n            // Check for validity.\n            localProxyValid(false);\n          }, this, event), 100);\n        });\n\n    $('#ExposeLocalProxiesToLAN').change(function() {\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n    });\n  }\n\n  // Returns true if the local proxy values are valid, otherwise false.\n  // Shows/hides an error message as appropriate.\n  function localProxyValid(/*finalCheck*/) {\n    // This check always shows an error while the user is typing, so finalCheck is ignored.\n\n    var httpPort = validatePort($('#LocalHttpProxyPort').val());\n    var socksPort = validatePort($('#LocalSocksProxyPort').val());\n    var unique = (httpPort !== socksPort) || (httpPort === 0) || (socksPort === 0);\n\n    if (httpPort !== false && unique) {\n      // Remove HTTP port error state\n      $('#LocalHttpProxyPort').parents('.control-group').removeClass('error');\n    }\n\n    if (socksPort !== false && unique) {\n      // Remove SOCKS port error state\n      $('#LocalSocksProxyPort').parents('.control-group').removeClass('error');\n    }\n\n    if (httpPort !== false) {\n      // Remove port value error message\n      $('.help-inline.js-LocalHttpProxyPort').addClass('hidden');\n    }\n\n    if (socksPort !== false) {\n      // Remove port value error message\n      $('.help-inline.js-LocalSocksProxyPort').addClass('hidden');\n    }\n\n    if (unique) {\n      // Remove uniqueness error message\n      $('.help-block.local-port-unique').addClass('hidden');\n    }\n\n    if (httpPort === false) {\n      // Add HTTP port error state\n      $('#LocalHttpProxyPort').parents('.control-group').addClass('error');\n      $('.help-inline.js-LocalHttpProxyPort').removeClass('hidden');\n    }\n\n    if (socksPort === false) {\n      // Add SOCKS port error state\n      $('#LocalSocksProxyPort').parents('.control-group').addClass('error');\n      $('.help-inline.js-LocalSocksProxyPort').removeClass('hidden');\n    }\n\n    if (!unique) {\n      // Add error state on both ports\n      $('#LocalHttpProxyPort, #LocalSocksProxyPort')\n        .parents('.control-group').addClass('error');\n      // Show error message\n      $('.help-block.local-port-unique').removeClass('hidden');\n    }\n\n    updateErrorAlert();\n\n    return httpPort !== false && socksPort !== false && unique;\n  }\n\n  // Show an error modal telling the user there is a local port conflict problem\n  function localProxyPortConflictNotice(noticeType) {\n    // Show the appropriate message depending on the error\n    var bodyKey = noticeType === 'HttpProxyPortInUse' ?\n                  'settings#local-proxy-ports#error-modal-body-http' :\n                  'settings#local-proxy-ports#error-modal-body-socks';\n\n    showNoticeModal(\n      'settings#local-proxy-ports#error-modal-title',\n      bodyKey,\n      'error',\n      null, null, null);\n\n    // Switch to the appropriate settings section\n    showSettingsSection(\n      '#settings-accordion-local-proxy-ports',\n      noticeType === 'HttpProxyPortInUse' ? '#LocalHttpProxyPort' : '#LocalSocksProxyPort');\n  }\n\n  //\n  // Upstream Proxy\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function upstreamProxySetup() {\n    // Handle change events\n    $('#UpstreamProxyHostname, #UpstreamProxyPort, #UpstreamProxyUsername, #UpstreamProxyPassword, #UpstreamProxyDomain').on(\n        'keyup keydown keypress change blur',\n        function(event) {\n          // We need to delay this processing so that the change to the text has\n          // had a chance to take effect. Otherwise this.val() will return the old\n          // value.\n          _.delay(_.bind(function() {\n            // Tell the settings pane a change was made.\n            $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n\n            // Check for validity.\n            upstreamProxyValid(false);\n          }, this, event), 100);\n        });\n\n    // Add the \"skip\" checkbox handler.\n    $('#SkipUpstreamProxy').change(function() {\n      // Trigger overall change event\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n\n      skipUpstreamProxyUpdate();\n    });\n  }\n\n  // Returns true if the upstream proxy values are valid, otherwise false.\n  // Shows/hides an error message as appropriate.\n  function upstreamProxyValid(/*finalCheck*/) {\n    // If any field other than hostname is set, then hostname must be set,\n    // AND if port is set, it must be an integer in the range 1-65535,\n    // AND if either of domain or password is set, then username must be as well.\n    // Unless 'skip' is checked.\n\n    let skip = $('#SkipUpstreamProxy').prop('checked');\n\n    let needHostname =\n      Boolean($('#UpstreamProxyPort').val()) ||\n      Boolean($('#UpstreamProxyUsername').val()) ||\n      Boolean($('#UpstreamProxyPassword').val()) ||\n      Boolean($('#UpstreamProxyDomain').val());\n\n    let needUsername =\n      Boolean($('#UpstreamProxyPassword').val()) ||\n      Boolean($('#UpstreamProxyDomain').val());\n\n    let valid = true;\n\n    let portOK = validatePort($('#UpstreamProxyPort').val()) !== false;\n    if (skip || portOK) {\n      // Hide the port-specific message\n      $('.help-inline.js-UpstreamProxyPort').addClass('hidden')\n        .parents('.control-group').removeClass('error');\n    } else {\n      valid = false;\n      // Port value bad. Show error while typing\n      $('.help-inline.js-UpstreamProxyPort').removeClass('hidden')\n        .parents('.control-group').addClass('error');\n    }\n\n    if (skip || !needHostname || Boolean($('#UpstreamProxyHostname').val())) {\n      // Hide the \"hostname required\" message\n      $('.upstream-proxy-set-hostname-error-msg').addClass('hidden');\n      // And remove error state from the control\n      $('#UpstreamProxyHostname')\n        .parents('.control-group').removeClass('error');\n    }\n    else {\n      valid = false;\n      // Show the \"hostname required\" message\n      $('.upstream-proxy-set-hostname-error-msg').removeClass('hidden');\n      // And add error state to the control\n      $('#UpstreamProxyHostname')\n        .parents('.control-group').addClass('error');\n    }\n\n    if (skip || !needUsername || Boolean($('#UpstreamProxyUsername').val())) {\n      // Hide the \"username required\" message\n      $('.upstream-proxy-set-username-error-msg').addClass('hidden');\n      // And remove error state from the control\n      $('#UpstreamProxyUsername')\n        .parents('.control-group').removeClass('error');\n    }\n    else {\n      valid = false;\n      // Show the \"username required\" message\n      $('.upstream-proxy-set-username-error-msg').removeClass('hidden');\n      // And add error state to the control\n      $('#UpstreamProxyUsername')\n        .parents('.control-group').addClass('error');\n    }\n\n    updateErrorAlert();\n\n    return valid;\n  }\n\n  // The other upstream proxy settings should be disabled if skip-upstream-proxy\n  // is set.\n  function skipUpstreamProxyUpdate() {\n    var skipUpstreamProxy = $('#SkipUpstreamProxy').prop('checked');\n    $('.js-skip-upstream-proxy-incompatible input').prop('disabled', skipUpstreamProxy);\n    $('.js-skip-upstream-proxy-incompatible').toggleClass('disabled-text', skipUpstreamProxy);\n  }\n\n  // The occurrence of an upstream proxy error might mean that a tunnel cannot\n  // ever be established, but not necessarily -- it might just be, for example,\n  // that the upstream proxy doesn't allow the port needed for one of our\n  // servers, but not all of them.\n  // So instead of showing an error immediately, we'll remember that the upstream\n  // proxy error occurred, wait a while to see if we connect successfully, and\n  // show it if we haven't connected.\n  // Potential enhancement: If the error modal is showing and the connection\n  // succeeds, dismiss the modal. This would be good behaviour, but probably too\n  // fringe to be worthwhile.\n  var g_upstreamProxyErrorNoticeTimer = null;\n\n  // When the connected state changes, we clear the timer.\n  $window.on(CONNECTED_STATE_CHANGE_EVENT, function() {\n    if (g_upstreamProxyErrorNoticeTimer) {\n      clearTimeout(g_upstreamProxyErrorNoticeTimer);\n      g_upstreamProxyErrorNoticeTimer = null;\n    }\n  });\n\n  function upstreamProxyErrorNotice(errorMessage) {\n    if (g_upstreamProxyErrorNoticeTimer) {\n      // We've already received an upstream proxy error and we're waiting to show it.\n      return;\n    }\n\n    // This is the first upstream proxy error we've received, so start waiting to\n    // show a message for it.\n    g_upstreamProxyErrorNoticeTimer = setTimeout(function() {\n      // It can happen that we receive a notice about an upstream error *after*\n      // we have successfully connected -- it will have been received from one\n      // of the parallel unsuccessful connection attempts. We should not show\n      // such an error. So, as a general statement: Do not show upstream errors\n      // if we're already successfully connected.\n      if (g_lastState === 'connected') {\n        if (g_upstreamProxyErrorNoticeTimer) {\n          g_upstreamProxyErrorNoticeTimer = null;\n        }\n        return;\n      }\n\n      // There are two slightly different error messages shown depending on whether\n      // there is an upstream proxy explicitly configured, or it's the default\n      // empty value, which means the pre-existing system proxy will be used.\n      var bodyKey = 'settings#upstream-proxy#error-modal-body-default';\n      if (g_initObj.Settings.UpstreamProxyHostname) {\n        bodyKey = 'settings#upstream-proxy#error-modal-body-configured';\n      }\n\n      showNoticeModal(\n        'settings#upstream-proxy#error-modal-title',\n        bodyKey,\n        'error',\n        'general#notice-modal-tech-preamble',\n        errorMessage,\n        function() {\n          $('#UpstreamProxyHostname').trigger('focus');\n        });\n\n      // Switch to the appropriate settings section\n      showSettingsSection('#settings-accordion-upstream-proxy');\n\n      // We are not going to set the timer to null here. We only want the error\n      // to show once per connection attempt sequence. It will be cleared when\n      // the client transistions to 'stopped' or 'connected'.\n    }, 60000);\n  }\n\n  //\n  // VPN Mode (Transport Mode)\n  //\n\n  // Will be called exactly once. Set up event listeners, etc.\n  function vpnModeSetup() {\n    // Some fields are disabled in VPN mode\n    $('#VPN').change(function() {\n      // Tell the settings pane a change was made.\n      $('#settings-pane').trigger(SETTING_CHANGED_EVENT, this.id);\n\n      vpnModeUpdate();\n    });\n  }\n\n  // Some of the settings are incompatible with VPN mode. We'll modify the\n  // display depending on the choice of VPN mode.\n  function vpnModeUpdate() {\n    var vpn = $('#VPN').prop('checked');\n    $('input.vpn-incompatible, .vpn-incompatible input, '+\n      'select.vpn-incompatible, .vpn-incompatible select, .vpn-incompatible .dropdown-menu')\n        .prop('disabled', vpn).toggleClass('disabled', vpn);\n    $('.vpn-incompatible-msg').toggleClass('hidden', !vpn);\n    $('.vpn-incompatible').toggleClass('disabled-text', vpn);\n    $('.js-vpn-incompatible-hide').toggleClass('hidden', vpn);\n\n    // The VPN mode also has implications for the PsiCash UI, so update it as well.\n    psiCashUIUpdater();\n  }\n\n  //\n  // Helpers\n  //\n\n  // Show/hide the error alert depending on whether we have an erroneous field\n  function updateErrorAlert() {\n    $('#settings-pane .value-error-alert').toggleClass(\n      'invisible z-behind', $('#settings-pane .control-group.error').length === 0);\n  }\n\n  // Returns the numeric port if valid, otherwise false. Note that 0 is a valid\n  // return value, and falsy, so use `=== false`.\n  function validatePort(val) {\n    if (val.length === 0) {\n      return 0;\n    }\n\n    const intVal = parseInt(val);\n    if (isNaN(intVal) || intVal < 1 || intVal > 65535) {\n      return false;\n    }\n\n    if (intVal.toString() !== val) {\n      // There were extra characters at the end of the string that didn't get converted\n      // into the int.\n      return false;\n    }\n\n    return intVal;\n  }\n\n  // Show the Settings tab and expand the target section.\n  // If focusElem is optional; if set, focus will be put in that element.\n  function showSettingsSection(section, focusElem) {\n    // We can only expand the section after the tab is shown\n    function onTabShown() {\n      // Hack: The collapse-show doesn't seem to work unless we wait a bit\n      setTimeout(function() {\n        // Expand the section\n        $(section).collapse('show');\n\n        // Collapse any other sections\n        $('#settings-accordion .in.collapse').not(section).collapse('hide');\n\n        // Scroll to the section, after allowing the section to expand\n        setTimeout(function() {\n          $('#settings-pane').scrollTo(\n            $(section).parents('.accordion-group').eq(0),\n            {\n              duration: 500, // animation time\n              offset: -50,   // leave some space for the alert\n              onAfter: function() {\n                if (focusElem) {\n                  $(focusElem).eq(0).trigger('focus');\n                }\n              }\n            });\n        }, 200);\n      }, 500);\n    }\n\n    // Make sure the settings tab is showing.\n    switchToTab('#settings-tab', onTabShown);\n  }\n\n\n  /* FEEDBACK ******************************************************************/\n\n  $(function() {\n    // Add click listener to the happy/sad choices\n    $('.feedback-smiley .feedback-choice').click(function(e) {\n      e.preventDefault();\n      $('.feedback-smiley .feedback-choice').removeClass('selected');\n      $(this).addClass('selected');\n    });\n\n    $('#feedback-submit').click(function(e) {\n      e.preventDefault();\n      sendFeedback();\n    });\n\n    // The sponsor-specific links in the text will be set correctly elsewhere.\n  });\n\n  function sendFeedback() {\n    var smileyResponses = [];\n    $('.feedback-choice.selected').each(function() {\n      smileyResponses.push({\n        title: $(this).data('feedback-choice-title'),\n        question: $(this).data('feedback-choice-hash'),\n        answer: $(this).data('feedback-choice-value')\n      });\n    });\n\n    var fields = {\n      responses: smileyResponses,\n      feedback: $('#feedback-comments').val(),\n      email: $('#feedback-email').val(),\n      sendDiagnosticInfo: !!$('#feedback-send-diagnostic').prop('checked')\n    };\n\n    // Switch to the connection tab\n    switchToTab('#connection-tab');\n\n    // Clear the feedback form\n    $('.feedback-choice.selected').removeClass('selected');\n    $('#feedback-comments').val('');\n    $('#feedback-email').val('');\n    $('#feedback-send-diagnostic').prop('checked', true);\n\n    // Actually send the feedback\n    HtmlCtrlInterface_SendFeedback(JSON.stringify(fields));\n\n    // Show (and hide) the success alert\n    displayCornerAlert($('#feedback-success-alert'));\n  }\n\n\n  /* LOGS **********************************************************************/\n\n  $(function() {\n    $('#show-debug-logs').click(showDebugLogsClicked);\n\n    // Set the initial show-debug state\n    var show = $('#show-debug-logs').prop('checked');\n    $('.log-messages')\n      .toggleClass('showing-priority-0', show)\n      .toggleClass('hiding-priority-0', !show);\n  });\n\n  function showDebugLogsClicked() {\n    /*jshint validthis:true */\n    var show = $(this).prop('checked');\n    // We use both a showing and a hiding class to try to deal with IE7's CSS insanity.\n    $('.log-messages')\n      .toggleClass('showing-priority-0', show)\n      .toggleClass('hiding-priority-0', !show);\n  }\n\n  // Expects obj to be of the form {priority: 0|1|2, message: string}\n  function addLog(obj) {\n    $('.log-messages .placeholder').remove();\n\n    $('.log-messages').loadTemplate(\n      $(\"#log-template\"),\n      {\n        timestamp: new Date().toLocaleTimeString(),\n        message: obj.message,\n        priority: 'priority-' + obj.priority\n      },\n      {\n        prepend:true\n      });\n\n    // The \"Show Debug Logs\" checkbox is hidden until we actually get a debug\n    // message.\n    if (obj.priority < 1) {\n      $('#logs-pane .invisible').removeClass('invisible');\n    }\n\n    // Record the priorities we've seen.\n    // We'll keep them in a (fake) Set.\n    addLog.priorities = addLog.priorities || {};\n    addLog.priorities[obj.priority] = true;\n\n    // Don't allow the log messages list to grow forever!\n    // We'll set a limit for each priority. (Arbitrarily. May need to revisit.)\n    var MAX_LOGS_PER_PRIORITY = 200;\n    var priorities = _.keys(addLog.priorities);\n    for (var i = 0; i < priorities.length; i++) {\n      $('.log-messages .priority-'+priorities[i]).slice(MAX_LOGS_PER_PRIORITY).remove();\n    }\n  }\n\n  // Used for temporary debugging messages.\n  function DEBUG_LOG() {\n    debugLogHelper(window.console.log, Array.prototype.slice.call(arguments));\n  }\n\n  function DEBUG_WARN() {\n    debugLogHelper(window.console.warn, Array.prototype.slice.call(arguments));\n  }\n\n  function debugLogHelper(consoleLogger, args) {\n    if (!g_initObj.Config.Debug) {\n      return;\n    }\n\n    let msg = 'DEBUG:';\n    for (let i = 0; i < args.length; i++) {\n      msg += ' ';\n      if (_.isString(args[i])) {\n        msg += args[i];\n      }\n      else {\n        msg += JSON.stringify(args[i]);\n      }\n    }\n\n    addLog({priority: 0, message: msg});\n\n    const logger = (consoleLogger || window.console.log);\n    try {\n      if (IS_BROWSER) {\n        logger.apply(console, [msg]);\n      }\n    }\n    catch (e) {\n      // IE8 (at least IE8 mode in IE11) has weird console.log (etc.) implementations that\n      // are objects? But can still be called? But even trying to access .apply throws an\n      // exception? But calling it directly is okay?\n      logger(msg);\n    }\n  }\n\n\n  /* LANGUAGE ******************************************************************/\n\n  $(function() {\n    const fallbackLanguage = 'en';\n\n    let prevLang = getCookie('language');\n    // Legacy formats weren't BCP 47 and had `_` or `@`, so update for backwards compatibility\n    if (prevLang) {\n      prevLang = getCookie('language').replace('_', '-').replace('@', '-');\n    }\n\n    // Language priority: cookie, system locale, fallback\n    const lang =\n      prevLang ||\n      (g_initObj.Config && g_initObj.Config.Language) ||\n      fallbackLanguage;\n\n    i18n.init(window.PSIPHON.LOCALES, fallbackLanguage);\n    switchLocale(lang, true);\n\n    // Populate the list of language choices\n    populateLocales();\n  });\n\n  // We only want to show the success/welcome message once.\n  let g_languageSuccessAlertShown = false;\n\n  // Other functions may need to know if we're currently using a RTL locale or not\n  let g_isRTL = false;\n\n  function switchLocale(locale, initial) {\n    i18n.setLocale(locale);\n\n    // We want this code to run asynchronously, after everything else is done.\n    nextTick(function() {\n      i18n.localizeUI();\n\n      // The content of elements will have changed, so trigger custom event that can\n      // be listened for to take additional actions.\n      $window.trigger(LANGUAGE_CHANGE_EVENT);\n\n      if (!initial && !g_languageSuccessAlertShown) {\n        // Show (and hide) the success alert\n        g_languageSuccessAlertShown = true;\n        displayCornerAlert($('#language-success-alert'));\n      }\n\n      // Remember the user's choice\n      setCookie('language', locale);\n\n      // PsiCash may need to update numbers or moment.js\n      psiCashUIUpdater();\n    });\n\n    //\n    // Right-to-left languages need special consideration.\n    //\n\n    const rtl = i18n.isRTL();\n    g_isRTL = rtl;\n\n    // We'll use a data attribute to store classes which should only be used\n    // for RTL and not LTR, and vice-versa.\n    $('[data-i18n-rtl-classes]').each(function() {\n      var ltrClasses = $(this).data('i18n-ltr-classes');\n      var rtlClasses = $(this).data('i18n-rtl-classes');\n\n      if (ltrClasses) {\n        $(this).toggleClass(ltrClasses, !rtl);\n      }\n\n      if (rtlClasses) {\n        $(this).toggleClass(rtlClasses, rtl);\n      }\n    });\n\n    //\n    // Update C code string table with new language values\n    //\n\n    // Iterate through the English keys, since we know it will be complete.\n    var translation = window.PSIPHON.LOCALES.en.translation;\n    var appBackendStringTable = {};\n    for (var key in translation) {\n      if (!translation.hasOwnProperty(key)) {\n        continue;\n      }\n\n      if (_.startsWith(key, 'appbackend#')) {\n        appBackendStringTable[key] = i18n.t(key);\n      }\n    }\n\n    HtmlCtrlInterface_AddStringTableItem(locale, appBackendStringTable);\n  }\n\n  function populateLocales() {\n    var localePriorityGuide = ['en', 'fa', 'ar', 'zh', 'zh_CN', 'zh_TW'];\n    var locales = $.map(window.PSIPHON.LOCALES, function(val, key) { return key; });\n    // Sort the locales according to the priority guide\n    locales.sort(function(a, b) {\n      var localePriority_a = localePriorityGuide.indexOf(a);\n      var localePriority_b = localePriorityGuide.indexOf(b);\n      localePriority_a = (localePriority_a < 0) ? 999 : localePriority_a;\n      localePriority_b = (localePriority_b < 0) ? 999 : localePriority_b;\n\n      if (localePriority_a < localePriority_b) {\n        return -1;\n      }\n      else if (localePriority_a > localePriority_b) {\n        return 1;\n      }\n      else if (a < b) {\n        return -1;\n      }\n      else if (a > b) {\n        return 1;\n      }\n      return 0;\n    });\n\n    var $localeListElem = $('#language-pane');\n\n    for (var i = 0; i < locales.length; i++) {\n      // If we're not in debug mode, don't output the dev locales\n      if (!g_initObj.Config.Debug && _.startsWith(locales[i], 'dev')) {\n        continue;\n      }\n\n      $localeListElem.loadTemplate(\n        $(\"#locale-template\"),\n        { localeCode: locales[i],\n          localeName: window.PSIPHON.LOCALES[locales[i]].name},\n        { append: true });\n    }\n\n    // Set up the click handlers\n    $('.language-choice').click(function(e) {\n      e.preventDefault();\n      switchLocale($(this).data('locale'));\n    });\n  }\n\n\n  /* ABOUT *********************************************************************/\n\n  // No special code. Sponsor-specific links are set elsewhere.\n\n\n  /* PSICASH *******************************************************************/\n\n  /**\n   * PsiCash-related events.\n   * @enum {string}\n   * @readonly\n   */\n  const PsiCashEventTypeEnum = {\n    /** Argument is PsiCashRefreshData */\n    REFRESH: 'psicash::refresh',\n    /** Argument is PsiCashPurchaseResponse */\n    NEW_PURCHASE: 'psicash::new-purchase',\n    /** Argument is PsiCashInitDoneData */\n    INIT_DONE: 'psicash::init-done',\n    /** Argument is PsiCashLoginData */\n    LOGIN: 'psicash::login',\n    /** Argument is PsiCashLogoutData */\n    LOGOUT: 'psicash::logout'\n  };\n\n  /**\n   * Server response statuses\n   * @enum {number}\n   * @readonly\n   */\n  const PsiCashServerResponseStatus = {\n    Invalid: -1, // Should never be used if well-behaved\n    Success: 0,\n    ExistingTransaction: 1,\n    InsufficientBalance: 2,\n    TransactionAmountMismatch: 3,\n    TransactionTypeNotFound: 4,\n    InvalidTokens: 5,\n    InvalidCredentials: 6,\n    BadRequest: 7,\n    ServerError: 8\n  };\n\n  /**\n   * @typedef {Object} PsiCashPurchasePrice\n   * @property {!string} class\n   * @property {!string} distinguisher\n   * @property {!number} price\n   */\n\n   /**\n    * @typedef {Object} PsiCashPurchase\n    * @property {!string} id\n    * @property {!string} class\n    * @property {!string} distinguisher\n    * @property {!any} authorization\n    * @property {?moment} localTimeExpiry\n    * @property {?moment} serverTimeExpiry\n    */\n\n  /**\n   * The expected payload passed to HtmlCtrlInterface_PsiCashMessage when a purchase is complete.\n   * @typedef {Object} PsiCashPurchaseResponse\n   * @property {?string} error\n   * @property {!PsiCashServerResponseStatus} status\n   * @property {?PsiCashRefreshData} refresh\n   */\n\n  /**\n   * The expected payload passed to HtmlCtrlInterface_PsiCashMessage when a refresh should be done.\n   * @typedef {Object} PsiCashRefreshData\n   * @property {boolean} reconnect_required\n   * @property {boolean} is_account\n   * @property {boolean} has_tokens\n   * @property {?string} account_username Will be set iff is_account is true and has_tokens is true\n   * @property {number} balance\n   * @property {PsiCashPurchasePrice[]} purchase_prices\n   * @property {PsiCashPurchase[]} purchases\n   * @property {?string} buy_psi_url\n   * @property {string} account_signup_url\n   * @property {string} account_management_url\n   * @property {string} forgot_account_url\n   */\n\n  /**\n   * The expected payload passed to HtmlCtrlInterface_PsiCashMessage when PsiCash.Init() is done.\n   * @typedef {Object} PsiCashInitDoneData\n   * @property {?string} error\n   * @property {?boolean} recovered\n   */\n\n  /**\n   * The expected payload passed to HtmlCtrlInterface_PsiCashMessage when account login is complete.\n   * @typedef {Object} PsiCashLoginResponse\n   * @property {?string} error\n   * @property {!PsiCashServerResponseStatus} status\n   * @property {?boolean} last_tracker_merge\n   * @property {?PsiCashRefreshData} refresh\n   */\n\n  /**\n   * The expected payload passed to HtmlCtrlInterface_PsiCashMessage when account logout is complete.\n   * @typedef {Object} PsiCashLogoutResponse\n   * @property {?string} error\n   * @property {?PsiCashRefreshData} refresh\n   */\n\n  /**\n   * Used as the \"command\" type passed to HtmlCtrlInterface_PsiCashCommand.\n   * @enum {string}\n   * @readonly\n   */\n  const PsiCashCommandEnum = {\n    REFRESH: 'refresh',\n    PURCHASE: 'purchase',\n    LOGIN: 'login',\n    LOGOUT: 'logout'\n  };\n\n  /**\n   * PsiCash command base class constrcutor\n   * @class PsiCashCommandBase\n   * @classdesc Should only be used by subclasses\n   * @param {PsiCashCommandEnum} command\n   */\n  function PsiCashCommandBase(command) {\n    /**\n     * @name PsiCashCommandBase#command\n     * @type {PsiCashCommandEnum}\n     */\n    this.command = command;\n\n    /**\n     * @name PsiCashCommandBase#id\n     * @type {string}\n     */\n    this.id = randomID();\n  }\n\n  /**\n   * Construct a new refresh command\n   * @class PsiCashCommandRefresh\n   * @classdesc Passed to HtmlCtrlInterface_PsiCashCommand to indicate a data refresh is desired\n   * @param {string} reason Indicates the reason for the refresh (used for logging and debugging)\n   */\n  function PsiCashCommandRefresh(reason) {\n    PsiCashCommandBase.call(this, PsiCashCommandEnum.REFRESH);\n    this.reason = reason;\n  }\n  PsiCashCommandRefresh.prototype = _.create(PsiCashCommandBase.prototype, {constructor: PsiCashCommandRefresh});\n\n  /**\n   * Construct a new purchase command\n   * @class PsiCashCommandPurchase\n   * @classdesc Passed to HtmlCtrlInterface_PsiCashCommand to indicate a purchase is desired\n   * @param {string} transactionClass\n   * @param {string} distinguisher\n   * @param {number} expectedPrice\n   */\n  function PsiCashCommandPurchase(transactionClass, distinguisher, expectedPrice) {\n    PsiCashCommandBase.call(this, PsiCashCommandEnum.PURCHASE);\n    this.transactionClass = transactionClass;\n    this.distinguisher = distinguisher;\n    this.expectedPrice = expectedPrice;\n  }\n  PsiCashCommandPurchase.prototype = _.create(PsiCashCommandBase.prototype, {\n    constructor: PsiCashCommandPurchase\n  });\n\n  /**\n   * Construct a new PsiCash account login command\n   * @class PsiCashCommandLogin\n   * @classdesc Passed to HtmlCtrlInterface_PsiCashCommand to indicate a purchase is desired\n   * @param {string} username\n   * @param {string} password\n   */\n  function PsiCashCommandLogin(username, password) {\n    PsiCashCommandBase.call(this, PsiCashCommandEnum.LOGIN);\n    this.username = username;\n    this.password = password;\n  }\n  PsiCashCommandLogin.prototype = _.create(PsiCashCommandBase.prototype, {constructor: PsiCashCommandLogin});\n\n  /**\n   * Construct a new PsiCash account logout command\n   * @class PsiCashCommandLogout\n   * @classdesc Passed to HtmlCtrlInterface_PsiCashCommand to indicate a purchase is desired\n   */\n  function PsiCashCommandLogout() {\n    PsiCashCommandBase.call(this, PsiCashCommandEnum.LOGOUT);\n  }\n  PsiCashCommandLogout.prototype = _.create(PsiCashCommandBase.prototype, {\n    constructor: PsiCashCommandLogout\n  });\n\n  /**\n   * PsiCash-related messages from the C code.\n   * @enum {string}\n   * @readonly\n   */\n  const PsiCashMessageTypeEnum = {\n    REFRESH: 'refresh',\n    NEW_PURCHASE: 'new-purchase',\n    INIT_DONE: 'init-done',\n    LOGIN: 'account-login',\n    LOGOUT: 'account-logout'\n  };\n\n  /**\n   * @typedef {Object} PsiCashMessageData\n   * @property {PsiCashMessageTypeEnum} type\n   * @property {string} id\n   * @property {PsiCashRefreshData} payload\n   */\n\n  // TODO: Maybe roll this into a more global pubsub? But why?\n  /** @type {Datastore} */\n  const PsiCashStore = new Datastore({\n    initDone: false,\n    purchaseInProgress: false,\n    uiState: null,\n    logoutExpected: false\n  }, 'PsiCashStore');\n\n  $(function psicashInit() {\n    // NOTE: \"refresh\" will not make a server request unless we're connected. If not\n    // connected, it just gets locally cached values.\n\n    // And update the UI values every time the app gets focus.\n    addWindowFocusHandler(function() {\n      if (!PsiCashStore.data.initDone) {\n        return;\n      }\n      HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('app-focus'));\n    });\n\n    // And update the UI values every time we get connected.\n    $window.on(CONNECTED_STATE_CHANGE_EVENT, function() {\n      if (!PsiCashStore.data.initDone) {\n        return;\n      }\n      HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('connected-state-change'));\n    });\n\n    // And update the UI values every time the display language changes, so that the numbers\n    // are correctly formatted.\n    $window.on(LANGUAGE_CHANGE_EVENT, function() {\n      if (!PsiCashStore.data.initDone) {\n        return;\n      }\n      HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('ui-language-change'));\n    });\n\n    // And update the UI when the settings change. If we go into/out of VPN mode we need to\n    // disable the UI and indicate why.\n    $('#settings-pane').on(SETTING_CHANGED_EVENT, function() {\n      if (!PsiCashStore.data.initDone) {\n        return;\n      }\n      HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('settings-changed'));\n    });\n\n    // We're going to set this click handler on the parent rather than the link, since the\n    // link element is going to be replaced on each language change (alternatively, we\n    // could set this on language change, but this is easier and fine).\n    $('.vpn-mode-ui a').parent().on('click', function(e) {\n      e.preventDefault();\n      showSettingsSection('#settings-accordion-transport-mode');\n      return false;\n    });\n\n    // Disallow external links (that don't have their own special handlers) from opening\n    // if we're not connected (per PsiCash behaviour rules).\n    $('a.js-psicash-account-signup, a.js-psicash-account-management').on('click', function(e) {\n      if (g_lastState !== 'connected') {\n        e.preventDefault();\n        showNoticeModal(\n          'psicash#mustconnect-modal#title',\n          'psicash#mustconnect-modal#body',\n          'info',\n          null, null,\n          function() {\n            switchToTab('#connection-tab');\n          }\n        );\n      }\n    });\n\n    // Initialize the collapsible speed limit info (persisted in a cookie)\n    const $speedLimitCollapser = $('.psicash-pane__speed-limit__collapser');\n    const $speedLimitCollapserTarget = $($speedLimitCollapser.data('target'));\n    $speedLimitCollapserTarget.on('hidden', () => {\n      $speedLimitCollapser.filter('.icon-chevron-up-circle').removeClass('icon-chevron-up-circle').addClass('icon-chevron-down-circle');\n      $speedLimitCollapser.filter('.icon-question-circle.fade').addClass('in');\n      setCookie('SpeedLimitCollapsed', true);\n    }).on('shown', () => {\n      $speedLimitCollapser.filter('.icon-chevron-down-circle').addClass('icon-chevron-up-circle').removeClass('icon-chevron-down-circle');\n      $speedLimitCollapser.filter('.icon-question-circle.fade').removeClass('in');\n      setCookie('SpeedLimitCollapsed', false);\n    });\n    // Altering the collapsed state before the pane is shown seems to result in\n    // things not working afterwards. So we're going to wait until the first time\n    // the pane is shown to get into the correct state.\n    $('.nav-tabs a[href=\"#psicash-pane\"][data-toggle=\"tab\"]').one('shown', () => {\n      if (getCookie('SpeedLimitCollapsed')) {\n        $speedLimitCollapserTarget.collapse('hide');\n      }\n    });\n\n    // Any time the speed limit badge is clicked on, we want it to expand the info collapser\n    $('.badge.speed-limit').on('click', switchToPsiCashTabAndExpandSpeedLimitInfo);\n  });\n\n  /**\n   * Handles the message indicating that the PsiCash library failed to initialize.\n   * @param {*} evt Event. Unused.\n   * @param {PsiCashInitDoneData} data\n   */\n  function psiCashLibraryInitDone(evt, data) {\n    if (data.error) {\n      // The library failed to initialize. This is very bad. The user lost their Tracker credit\n      // or their Account logged-in state.\n      if (data.recovered) {\n        showNoticeModal(\n          'psicash#init-error-title',\n          'psicash#init-error-body-recovered',\n          'error',\n          'general#notice-modal-tech-preamble',\n          data.error,\n          null); // callback\n      }\n      else {\n        showNoticeModal(\n          'psicash#init-error-title',\n          'psicash#init-error-body-unrecovered',\n          'error',\n          'general#notice-modal-tech-preamble',\n          data.error,\n          null); // callback\n      }\n    }\n\n    PsiCashStore.set('initDone', true);\n    HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('init-done'));\n  }\n  $window.on(PsiCashEventTypeEnum.INIT_DONE, psiCashLibraryInitDone);\n\n  /**\n   * Helper function to determine if PsiCash is ready for use.\n   * @param {?PsiCashRefreshData} psicashData The data to use for the check. If not provided,\n   *    g_PsiCashData will be used.\n   */\n  function psiCashStateInitialized(psicashData) {\n    // If we have tokens then we're initialized, or if we have an account (regardless of\n    // tokens, because we might be logged out).\n    return psicashData.has_tokens || psicashData.is_account;\n  }\n\n  var PSICASH_ENABLED_COOKIE = 'psicash::Enabled';\n\n  /**\n   * Called when PsiCash-related data should be refreshed. This may or may not mean that\n   * a request was made to the server to get fresh data.\n   * @param {PsiCashRefreshData} data\n   */\n  function refreshPsiCashEventHandler(evt, data) {\n    psiCashUIUpdater(data);\n  }\n  $window.on(PsiCashEventTypeEnum.REFRESH, refreshPsiCashEventHandler);\n\n  /** @type {?PsiCashRefreshData} */\n  var g_PsiCashData = null;\n\n  /**\n   * The state determines which chunks of UI are visible.\n   * @enum {object}\n   * @readonly\n   */\n  const PsiCashUIState = {\n    NSF_BALANCE: {uiSelector: '#psicash-corner-nsfbalance'},\n    ENOUGH_BALANCE: {uiSelector: '#psicash-corner-enoughbalance'},\n    BUYING_BOOST: {uiSelector: '#psicash-corner-buyingboost'},\n    ACTIVE_BOOST: {uiSelector: '#psicash-corner-activeboost'},\n    VPN_MODE_DISABLED: {uiSelector: '#psicash-corner-vpndisabled'},\n    ACCOUNT_LOGGED_OUT: {uiSelector: '#psicash-corner-accountloggedout'}\n  };\n  PsiCashStore.set('uiState', PsiCashUIState.NSF_BALANCE);\n\n  /**\n   * Called from refreshPsiCash and on an interval to update the PsiCash UI.\n   * @param {?PsiCashRefreshData} psicashData Will be undefined when called on a timer.\n   */\n  function psiCashUIUpdater(psicashData) {\n    // This must be set by any code below that queues up another call to this function via\n    // setTimeout. This is to prevent building up a flood of redundant calls.\n    if (!psiCashUIUpdater.timeout) {\n      psiCashUIUpdater.timeout = null;\n    }\n\n    // g_PsiCashData gets reassigned in the next if-block, but we want to be able to\n    // reference the previous state. Note that this may be null.\n    const oldPsiCashData = g_PsiCashData;\n\n    if (psicashData) {\n      if (g_PsiCashData) {\n        // For later diagnostics, log if psicashData values changed\n        if (!_.isNaN(psicashData.balance) && psicashData.balance !== g_PsiCashData.balance) {\n          HtmlCtrlInterface_Log('PsiCash: balance change:', psicashData.balance - g_PsiCashData.balance);\n        }\n        // TODO: Log other changes? Kind of a hassle.\n      }\n\n      g_PsiCashData = psicashData;\n\n      if (psicashData.reconnect_required) {\n        // We'll continue with our UI update, but we need to reconnect deal with a change\n        // of purchase/token state.\n        HtmlCtrlInterface_Log('PsiCash::RefreshState indicates reconnect required');\n        HtmlCtrlInterface_ReconnectTunnel(/*suppressHomePage=*/true);\n      }\n    }\n\n    if (!g_PsiCashData) {\n      // No data to use, nothing to do.\n      return;\n    }\n\n    psicashData = g_PsiCashData;\n\n    /**\n     * Will be true for the very first update when the UI is enabled. Affects which animations are shown.\n     */\n    let veryFirstUpdate = false;\n\n    // The enabled cookie will not be present on the very first run, and is set to true\n    // when we first enter a state where the PsiCash UI can be shown (and the onboarding\n    // presented).\n    if (getCookie(PSICASH_ENABLED_COOKIE)) {\n      // Even if the cookie is present, the user might have deleted their psicashdatastore\n      // file, so double-check the sanity of our state.\n      if (!psiCashStateInitialized(psicashData)) {\n        setCookie(PSICASH_ENABLED_COOKIE, false);\n        // Re-call this function to start all over.\n        return psiCashUIUpdater(psicashData);\n      }\n    }\n    else {\n      // Check if we're in a state where the functionality can be enabled.\n      if (windowHasFocus()\n          && psiCashStateInitialized(psicashData)\n          && g_lastState === 'connected')\n      {\n        // We're in a good state, and this is the very first time.\n        HtmlCtrlInterface_Log('PsiCash: very first update');\n        veryFirstUpdate = true;\n        setCookie(PSICASH_ENABLED_COOKIE, true);\n        // TODO: onboarding\n      }\n      else {\n        // PsiCash is still disabled, so there's nothing to do.\n        return;\n      }\n    }\n\n    let state = PsiCashUIState.NSF_BALANCE;\n    // DO NOT return early from this point. state must be updated in PsiCashStore.uiState.\n\n    if (psicashData.purchase_prices) {\n      for (let i = 0; i < psicashData.purchase_prices.length; i++) {\n        let pp = psicashData.purchase_prices[i];\n        if (pp['class'] === 'speed-boost' && pp.price <= psicashData.balance) {\n          // We can afford at least one level of Speed Boost\n          state = PsiCashUIState.ENOUGH_BALANCE;\n          break;\n        }\n      }\n    }\n\n    let millisOfSpeedBoostRemaining = 0;\n\n    if (psicashData.purchases) {\n      for (let i = 0; i < psicashData.purchases.length; i++) {\n        // There are two different contexts/ways of checking for active Speed Boost.\n        // **If we are connected**, then we rely on psiphond to decide that the\n        // authorization is expired, which will result in tunnel-core reconnecting and a\n        // signal that the authorization is now rejected. This is when the purchase is\n        // actually removed from the PsiCash lib datastore. So, if we are connected, its\n        // presence in the purchases array should be interpreted as meaning that the\n        // purchase/authorization is valid.\n        // **If we are not connected**, then we have to rely on the purchase expiry.\n        // (We're certainly not going to show a purchase as active for hours too long\n        // until the user happens to connect and refresh PsiCash state.)\n        // Note: We're making no special effort to check for multiple active Speed Boosts.\n        // This should not happen, per server rules.\n        if (psicashData.purchases[i]['class'] === 'speed-boost') {\n          const localTimeExpiry = moment(psicashData.purchases[i].localTimeExpiry);\n          if (g_lastState === 'connected' || localTimeExpiry.isAfter(moment())) {\n            state = PsiCashUIState.ACTIVE_BOOST;\n\n            millisOfSpeedBoostRemaining = localTimeExpiry.diff(moment());\n            // Clock skew (between client<->PsiCash server<->psiphond) could result in a\n            // purchase being used past the expiry in the purchase record. Ensure we're\n            // not showing a negative value in the UI.\n            millisOfSpeedBoostRemaining = Math.max(0, millisOfSpeedBoostRemaining);\n            break;\n          }\n        }\n      }\n    }\n\n    if (PsiCashStore.data.purchaseInProgress) {\n      // We are waiting for a purchase request to complete\n      state = PsiCashUIState.BUYING_BOOST;\n    }\n\n    if (psicashData.is_account && !psicashData.has_tokens) {\n      // If we're in an account-logged-out state, PsiCash functionality is disabled until\n      // the user logs back in (or resets data).\n      state = PsiCashUIState.ACCOUNT_LOGGED_OUT;\n    }\n\n    // If we are newly transitioning into a logged out state, let the user know\n    if (state === PsiCashUIState.ACCOUNT_LOGGED_OUT && oldPsiCashData && oldPsiCashData.has_tokens) {\n      // Either the user just logged out manually or our tokens expired\n      if (PsiCashStore.data.logoutExpected) {\n        displayCornerAlert($('#psicash-account-logged-out-alert'));\n        // Log to UI and to diagnostics\n        addLog({priority: 2, message: 'PsiCash account logged out'});\n        HtmlCtrlInterface_Log('PsiCash account logged out; user initiated');\n      }\n      else {\n        displayCornerAlert($('#psicash-account-tokens-expired-alert'));\n        // Log to UI and to diagnostics\n        addLog({priority: 2, message: 'PsiCash account logged out; probably due to expired tokens'});\n        HtmlCtrlInterface_Log('PsiCash account logged out; probably due to expired tokens');\n      }\n\n      PsiCashStore.set('logoutExpected', false);\n    }\n\n    // Speed Boost cannot function in L2TP/IPSec mode. We want to disabled controls and\n    // indicate why we're in that state.\n    if (g_initObj.Settings.VPN) {\n      state = PsiCashUIState.VPN_MODE_DISABLED;\n    }\n\n    // Show and hide the appropriate parts of the UI\n    syncPsiCashUI(psicashData, state, millisOfSpeedBoostRemaining);\n\n    // Now that the correct interface is showing, update the balance\n    PsiCashBalanceChange.push(psicashData.balance, veryFirstUpdate);\n\n    // Some UI elements (i.e., the turtle speed limit) don't apply to users with a high\n    // baseline speed. So we'll selectively show/hide those elements depending on the\n    // the Psiphon speed limit.\n    const baselineRateLimit = getCookie('BaselineRateLimit');\n    const threshold = (5 << 20) / 8; // 5 mbps in bytes; arbitrarily \"fast\"\n    if (!baselineRateLimit || baselineRateLimit > threshold) {\n      // Either we don't yet have a baseline, or it's above the threshold\n      DEBUG_LOG('Baseline speed is high; hiding speed limit');\n      $('.js-hide-if-fast').addClass('hidden');\n      $('.js-hide-if-not-fast').removeClass('hidden');\n    }\n    else {\n      // The baseline is below the threshold\n      DEBUG_LOG('Baseline speed is low; showing speed limit');\n      $('.js-hide-if-fast').removeClass('hidden');\n      $('.js-hide-if-not-fast').addClass('hidden');\n    }\n\n    // When we have an active speed boost, we want this function to be called repeatedly,\n    // so that the countdown timer is updated, and so the UI changes when the speed boost\n    // ends. But there's no reason to do work on an interval if there's no active boost.\n    if (state === PsiCashUIState.ACTIVE_BOOST) {\n      // There are triggers that result in this function being called, and we don't want\n      // to create periodic update timeouts every time, or else we'll end up with updates\n      // happening way too often (multiple times per second).\n      clearTimeout(psiCashUIUpdater.timeout);\n\n      // Wait longer between updates if there's a lot of time left in the boost.\n      if (millisOfSpeedBoostRemaining < 120 * 1000) {\n        psiCashUIUpdater.timeout = setTimeout(psiCashUIUpdater, 1000);\n      }\n      else {\n        psiCashUIUpdater.timeout = setTimeout(psiCashUIUpdater, 60 * 1000);\n      }\n    }\n\n    PsiCashStore.set('uiState', state);\n\n    /**\n     * Update relevant parts of the UI, depending on state and data\n     * @param {!PsiCashRefreshData} psicashData\n     * @param {!object} state\n     * @param {?Number} millisOfSpeedBoostRemaining\n     */\n    function syncPsiCashUI(psicashData, state, millisOfSpeedBoostRemaining) {\n      // Show the appropriate corner content\n      $('.js-psicash-corner').not(state.uiSelector).addClass('hidden');\n      $(state.uiSelector).removeClass('hidden');\n\n      // We can't use `state === PsiCashUIState.ACCOUNT_LOGGED_OUT` to determine this\n      // condition because VPN_MODE_DISABLED will supersede ACCOUNT_LOGGED_OUT.\n      const loggedOut = (psicashData.is_account && !psicashData.has_tokens);\n\n      $('.js-show-if-boosting').toggleClass('hidden', state !== PsiCashUIState.ACTIVE_BOOST);\n      $('.js-hide-if-boosting').toggleClass('hidden', state === PsiCashUIState.ACTIVE_BOOST);\n\n      $('.js-show-if-is-account').toggleClass('hidden', !psicashData.is_account);\n      $('.js-show-if-not-is-account').toggleClass('hidden', psicashData.is_account);\n      $('.js-show-if-logged-out-account').toggleClass('hidden', !loggedOut);\n      $('.js-hide-if-logged-out-account').toggleClass('hidden', loggedOut);\n\n      $('.js-show-if-nsf').toggleClass('hidden', state !== PsiCashUIState.NSF_BALANCE);\n      $('.js-hide-if-nsf').toggleClass('hidden', state === PsiCashUIState.NSF_BALANCE);\n\n      $('.psicash-pane__user-and-balance__username-container .js-psicash-account-signup').toggleClass('hidden', !!psicashData.account_username || loggedOut);\n      $('.psicash-pane__user-and-balance__username-container .psicash-pane__user-and-balance__username-container__username').text(psicashData.account_username).toggleClass('hidden', !psicashData.account_username);\n\n      if (psicashData.buy_psi_url) {\n        $('a.psicash-buy-psi').prop('href', psicashData.buy_psi_url).removeClass('hidden');\n      }\n      else {\n        // For some states, hiding the \"buy\" button will look strange, but since that\n        // implies there's no earner token, the whole PsiCash UI will be hidden anyway.\n        $('a.psicash-buy-psi').addClass('hidden');\n      }\n\n      $('a.js-psicash-account-signup').prop('href', psicashData.account_signup_url);\n      $('a.js-psicash-account-management').prop('href', psicashData.account_management_url);\n      $('a.js-psicash-forgot-account').prop('href', psicashData.forgot_account_url);\n\n      if (psicashData.purchase_prices) {\n        for (let i = 0; i < psicashData.purchase_prices.length; i++) {\n          let pp = psicashData.purchase_prices[i];\n\n          if (pp['class'] === 'speed-boost') {\n            $(`.js-psicash-sb-price[data-distinguisher=\"${pp.distinguisher}\"]`).text(formatPsi(parseInt(pp.price)));\n            $(`.js-psicash-sb-price[data-distinguisher=\"${pp.distinguisher}\"]`).data('expectedPrice', pp.price);\n\n            $(`.speed-boost-button[data-distinguisher=\"${pp.distinguisher}\"], .js-max-boost-container .js-psicash-buy-speedboost-price[data-distinguisher=\"${pp.distinguisher}\"]`)\n                .toggleClass('enough-balance', psicashData.balance >= pp.price);\n            $(`.speed-boost-button[data-distinguisher=\"${pp.distinguisher}\"], .js-max-boost-container .js-psicash-buy-speedboost-price[data-distinguisher=\"${pp.distinguisher}\"]`)\n                .toggleClass('not-enough-balance', psicashData.balance < pp.price);\n          }\n        }\n\n        // Set proper visibility for the \"buy max boost\" button.\n        const maxEnoughBalance = $('.js-max-boost-container .js-psicash-buy-speedboost-price').addClass('hidden').filter('.enough-balance').last();\n        maxEnoughBalance.removeClass('hidden');\n        // Set the distinguisher on the button so the handler can pick it up.\n        $('.js-max-boost-container').data('distinguisher', maxEnoughBalance.data('distinguisher'));\n      }\n\n      const boostRemainingTime = moment\n          .duration(millisOfSpeedBoostRemaining)\n          .locale(momentLocale())\n          .humanize()\n          .replace(' ', '&nbsp;'); // avoid splitting the time portion\n      const boostRemainingText = i18n.t('psicash#ui-speedboost-active').replace('%s', boostRemainingTime);\n      $('.speed-boost-time-remaining').html(boostRemainingText);\n\n      const vpnMode = $('#VPN').prop('checked');\n      $('.js-show-if-vpn-mode').toggleClass('hidden', !vpnMode);\n      $('.js-hide-if-vpn-mode').toggleClass('hidden', vpnMode);\n\n      // Show the whole corner block, if it's hidden.\n      if ($('#psicash-block, #psicash-tab').hasClass('hidden')) {\n        $('#psicash-block, #psicash-tab').removeClass('hidden');\n\n        // Some layout actions like height-matching won't have succeeded while the\n        // UI was hidden. So do a content-resize with the newly visible content.\n        nextTick(resizeContent);\n      }\n    }\n  }\n\n  /**\n   * Update the UI to a new balance, complete with animations.\n   * @param {number} newBalance The balance to update the UI to match.\n   * @param {boolean} veryFirstUpdate Whether this is the very first balance update\n   *    (determines which animations are used).\n   * @returns {jQuery.Promise} A promise that will be resolved when the update animations\n   *    are complete.\n   */\n  function doBalanceChange(newBalance, veryFirstUpdate) {\n    const allDoneDefer = $.Deferred();\n\n    // There are two different kinds of balance display elements: those that get animated\n    // on balance change (.js-psicash-balance-anim) and those that don't (.js-psicash-balance-noanim).\n    // Start by directly updating the non-animated elements.\n    $('.js-psicash-balance-noanim').text(formatPsi(newBalance));\n\n    let previousBalance = parseInt($('.js-psicash-balance-anim').data('psicash-balance')); // may be NaN\n    if (_.isNaN(previousBalance)) {\n      // If this is the very first refresh after the UI is enabled, we want to animate the\n      // balance change. But if this is just an app start-up that's restoring a previous\n      // balance, then we don't.\n      const startingPoint = veryFirstUpdate ? 0 : newBalance;\n      $('.js-psicash-balance-anim').text(formatPsi(startingPoint)).data('psicash-balance', startingPoint);\n      previousBalance = startingPoint;\n    }\n    else {\n      // Update the value of the balance field. This is mostly so that a post-language-change\n      // refresh will show the balance in the correct format.\n      $('.js-psicash-balance-anim').text(formatPsi(previousBalance));\n    }\n\n    let balanceDiff = newBalance - previousBalance;\n\n    // If the diff is 0, we're not going to update anything. Otherwise we're going to\n    // animate the change.\n    if (balanceDiff === 0) {\n      allDoneDefer.resolve();\n      return allDoneDefer.promise();\n    }\n\n    balanceDiff = _.isNaN(balanceDiff) ? newBalance : balanceDiff;\n\n    // Set the data value to the real balance immediately, to prevent later confusion.\n    $('.js-psicash-balance-anim').data('psicash-balance', newBalance);\n\n    // We're going to animate the balance increasing. We need to figure out the steps.\n    const BILLION = 1e9;\n    const balanceStepTime = 2000;   // ms\n    const balanceStopInterval = 25; // ms\n    const maxSteps = Math.trunc(balanceStepTime / balanceStopInterval);\n\n    // We only want to consider billions\n    const gigaBalanceDiff = balanceDiff / BILLION;\n\n    let balanceStepCount = Math.max(1, Math.min(Math.abs(gigaBalanceDiff), maxSteps));\n    const balanceStepSize = Math.trunc(gigaBalanceDiff / balanceStepCount) * BILLION;\n\n    // If we only stepped balanceStepSize, the last step might be huge. So we'll\n    // take some larger steps at the start.\n    let extraStepSize = balanceDiff - (Math.sign(balanceDiff) * balanceStepCount * balanceStepSize);\n\n    let intermediateBalance = previousBalance;\n\n    const $visiblePsiCashInterface = $('#psicash-block .js-psicash-corner').not('.hidden');\n    const $visibleBalanceElem = $visiblePsiCashInterface.find('.js-psicash-balance-anim');\n\n    // There are two different aynchronous animations that we want to want to wait\n    // on before declaring this balance change complete: The number ticking up or down,\n    // and the CSS delta transition. We're going to use promises to keep track of them finishing.\n    const tickDefer = $.Deferred();\n    const deltaDefer = $.Deferred();\n    $.when(tickDefer.promise(), deltaDefer.promise()).always(() => {\n      // Resolve the master deferred\n      allDoneDefer.resolve();\n    });\n\n    const finalTickStep = (balanceTickInterval) => {\n      if (!balanceTickInterval) {\n        return;\n      }\n      clearInterval(balanceTickInterval);\n      balanceTickInterval = null;\n      // Update all balance fields, not just the visible one.\n      $('.js-psicash-balance-anim').text(formatPsi(newBalance));\n      // Ticking is all done\n      tickDefer.resolve();\n    };\n\n    let balanceTickInterval = setInterval(() => {\n      balanceStepCount--;\n      if (balanceStepCount < 1) {\n        // Ticking is done\n        finalTickStep(balanceTickInterval);\n        return;\n      }\n\n      intermediateBalance += balanceStepSize;\n      if (extraStepSize > BILLION) {\n        intermediateBalance += BILLION;\n        extraStepSize -= BILLION;\n      }\n      $visibleBalanceElem.text(formatPsi(intermediateBalance));\n    }, 10);\n\n    // If our animation is super slow, the whole thing might take too long, so we're\n    // also going to time-bound the whole process.\n    setTimeout(() => {\n      finalTickStep(balanceTickInterval);\n    }, balanceStepTime);\n\n    // We're going to test that $visibleBalanceElem actually exists, otherwise we risk\n    // never resolving the animation promise.\n    if ($visibleBalanceElem.length > 0) {\n      let psiText = formatPsi(balanceDiff);\n      if (balanceDiff > 0) {\n        // Negative numbers naturally get a '-', but we'll need to add a '+' sign (localized)\n        psiText = i18n.t('positive-value-indicator').replace('%d', formatPsi(balanceDiff));\n      }\n\n      // Create and insert the element we'll use for the animation\n      const $deltaElem = $('<span class=\"psicash-balance-delta\"></span>')\n                          .addClass((balanceDiff > 0) ? 'credit' : 'debit')\n                          .text(psiText)\n                          .insertAfter($visibleBalanceElem);\n\n      // It's unfortunate that we have to do the animation using jQuery's .animate()\n      // rather than CSS transitions, but transitions seem flaky in IE.\n      const animationCSSEnpoint = (balanceDiff > 0) ?\n        // credit\n        {\n          'font-size': '0',\n          'opacity': '0.4'\n        } :\n        // debit\n        {\n          'font-size': '500%',\n          'opacity': '0'\n        };\n\n      const animationPromise = $deltaElem\n        .delay(10)\n        .addClass('balance-changing')\n        .animate(animationCSSEnpoint, {\n          duration: (balanceDiff > 0) ? balanceStepTime : balanceStepTime,\n          easing: 'swing',\n          queue: true })\n        .promise();\n\n      animationPromise.always(() => {\n          $deltaElem.remove();\n          deltaDefer.resolve();\n      });\n    }\n    else {\n      // We're not doing the transition animation, so just resolve the deferred\n      deltaDefer.resolve();\n    }\n\n    return allDoneDefer.promise();\n  }\n\n  /**\n   * Used to queue balance changes. Required to make sure animations don't get messed up.\n   */\n  const PsiCashBalanceChange = {\n    /**\n     * The queue of balances to change to\n     * @type {number[]}\n     * @private\n     */\n    _queue: [],\n\n    /**\n     * Whether the next balance change will be the very first one\n     * @type {boolean}\n     * @private\n     */\n    _first: false,\n\n    /**\n     * Enqueues the given balance to change the UI to.\n     * @param {!number} newBalance The balance to change to.\n     * @param {!boolean} first Whether this is the very first balance change ever (not just\n     *  a fresh app start-up).\n     */\n    push: function PsiCashBalanceChange_push(newBalance, first) {\n      if (!_.isNumber(newBalance)) {\n        return;\n      }\n\n      // This properly be stored in the queue, but it doesn't matter. There will only ever\n      // be one \"first\", and it'll be the first change.\n      this._first = first;\n\n      this._queue.push(newBalance);\n\n      if (this._queue.length === 1) {\n        // We're not already processing the queue and need to start\n        nextTick(this._pop, this);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _pop: function PsiCashBalanceChange_pop() {\n      if (this._queue.length === 0) {\n        // We're done\n        return;\n      }\n\n      // We process the next item in the queue before removing it. Its presence acts as a\n      // flag that we're processing.\n      const nextBalance = this._queue[0];\n      const changePromise = doBalanceChange(nextBalance, this._first);\n      this._first = false;\n\n      changePromise.always(() => {\n        this._queue.shift();\n        // Keep processing the queue\n        this._pop();\n      });\n    }\n  };\n\n  /**\n   * Gets the moment locale matching the current UI locale.\n   * @returns {!string}\n   */\n  function momentLocale() {\n    let locale = $('html').attr('lang');\n    if (_.startsWith(locale, 'dev')) {\n      // Moment has different locale codes for pseudolocales.\n      locale = 'x-pseudo';\n    }\n\n    // `locale` is now our starting point. Moment has case-sensitive locale matches, but\n    // also has case-inconsistent locale names (e.g., it has \"en-SG\" in the current\n    // release, although that looks to be changed in a future release). It also has\n    // exact matching, so it won't recognize \"zh\" even though it has \"zh-cn\". And if it\n    // gets a locale of the form \"pt-Latn-BR\", it will fall back to \"pt\" rather than \"pt-BR\".\n    // So we need to do some massaging and fuzzy-matching.\n    const bestLocale = I18n.localeBestMatch(locale, moment.locales());\n\n    if (!bestLocale || bestLocale.toLowerCase() !== locale.toLowerCase()) {\n      if (!bestLocale) {\n        DEBUG_WARN(`missing momentjs locale: '${locale}'; falling back to English`);\n      }\n      else {\n        DEBUG_WARN(`missing momentjs locale: '${locale}'; using best match: '${bestLocale}'`);\n      }\n    }\n\n    return bestLocale || 'en';\n  }\n\n  /**\n   * Event handler for the \"buy speed boost\" button click.\n   */\n  function buySpeedBoostClick() {\n    if (g_lastState !== 'connected') {\n      showNoticeModal(\n        'psicash#mustconnect-modal#title',\n        'psicash#mustconnect-modal#body',\n        'info',\n        null, null,\n        function() {\n          switchToTab('#connection-tab');\n        }\n      );\n      return;\n    }\n\n    const distinguisher = $(this).data('distinguisher');\n    const expectedPrice = $(`.js-psicash-sb-price[data-distinguisher=\"${distinguisher}\"]`).data('expectedPrice');\n\n    // Set the purchase-in-progress state and update UI.\n    PsiCashStore.set('purchaseInProgress', true);\n    psiCashUIUpdater();\n    psicashUIWaitState(true, '#psicash-ui-overlay-buying-boost');\n\n    HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandPurchase(\n      'speed-boost', distinguisher, expectedPrice))\n      .then((result) => {\n        // Clear the purchase-in-progress state and update UI.\n        psicashUIWaitState(false);\n        PsiCashStore.set('purchaseInProgress', false);\n        if (result.refresh) {\n          // The reponse supplied refresh data\n          psiCashUIUpdater(result.refresh);\n        }\n        else {\n          // We need to do a full refresh\n          HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('purchase-response'));\n        }\n\n        if (result.error) {\n          // Catastrophic failure. Show a modal error and hope the user can figure it out.\n          showNoticeModal(\n            'psicash#transaction-error-title',\n            'psicash#transaction-error-body',\n            'error',\n            'general#notice-modal-tech-preamble',\n            result.error,\n            null); // callback\n        }\n        else {\n          switch (result.status) {\n            case PsiCashServerResponseStatus.ExistingTransaction:\n              // There's an existing transaction that this purchase attempt conflicts with.\n              // This is a weird state, since a non-expired purchase should have prevented\n              // the purchase attempt in the first place. Hopefully the attempt request has\n              // corrected our clock skew with the server, and now the existing purchase\n              // will be indicated correctly.\n              showNoticeModal(\n                'psicash#transaction-ExistingTransaction-title',\n                'psicash#transaction-ExistingTransaction-body',\n                'warning',\n                null,  // tech detail preamble\n                null,  // tech detail body\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.InsufficientBalance:\n              // The user doesn't have enough credit to make this purchase. This is unusual,\n              // as we don't allow the user to have make a purchase that they can't afford.\n              // It can happen if the user has local \"optimistic\" credit that hasn't cleared\n              // on the server, or if the user's balance has changed elsewhere. (But we\n              // don't actually have optimistic balance usage in the Windows client yet.)\n              showNoticeModal(\n                'psicash#transaction-InsufficientBalance-title',\n                'psicash#transaction-InsufficientBalance-body',\n                'warning',\n                null,  // tech detail preamble\n                null,  // tech detail body\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.TransactionAmountMismatch:\n              // The price that we thought the purchase cost is different from what the server\n              // thinks it costs. We'll need a data refresh to get new prices.\n              showNoticeModal(\n                'psicash#transaction-TransactionAmountMismatch-title',\n                'psicash#transaction-TransactionAmountMismatch-body',\n                'warning',\n                null,  // tech detail preamble\n                null,  // tech detail body\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.TransactionTypeNotFound:\n              // The kind of thing we try tried to buy doesn't exist on the server. This is\n              // very unlikely to happen, except maybe for very old clients.\n              showNoticeModal(\n                'psicash#transaction-TransactionTypeNotFound-title',\n                'psicash#transaction-TransactionTypeNotFound-body',\n                'warning',\n                null,  // tech detail preamble\n                null,  // tech detail body\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.InvalidTokens:\n              // The tokens we tried to use were not accepted by the server.\n\n              if (g_PsiCashData.is_account) {\n                // This can occur if the account's tokens have expired since the last\n                // RefreshState. It's unusual (because token expiry is long), but not\n                // unexpected or erroneous.\n                showNoticeModal(\n                  'psicash#transaction-InvalidTokens-title',\n                  'psicash#transaction-InvalidTokens-body-account',\n                  'warning',\n                  null,  // tech detail preamble\n                  null,  // tech detail body\n                  null); // callback\n              }\n              else {\n                // This shouldn't happen for Trackers, barring DB replication lag. It\n                // suggests datastore corruption, or a bad server problem.\n                showNoticeModal(\n                  'psicash#transaction-InvalidTokens-title',\n                  'psicash#transaction-InvalidTokens-body-tracker',\n                  'error',\n                  null,  // tech detail preamble\n                  null,  // tech detail body\n                  null); // callback\n              }\n\n              // We will refresh in either case. If we're an account, it should put us into\n              // a logged-out state. If we're a tracker... it might help.\n              HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('invalid-tokens'));\n              break;\n\n            case PsiCashServerResponseStatus.ServerError:\n              // The server gave a 500-ish error\n              showNoticeModal(\n                'psicash#transaction-ServerError-title',\n                'psicash#transaction-ServerError-body',\n                'error',\n                null,  // tech detail preamble\n                null,  // tech detail body\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.Success:\n              // The purchase succeeded. We need to reconnect to apply the authorization.\n              displayCornerAlert($('#psicash-buyspeedboost-purchase-complete'));\n              // We don't need to explicitly reconnect here, as the PsiCash data refresh\n              // will detect the need for one and do it.\n              break;\n\n            default:\n              throw new Error('Unknown PsiCashServerResponseStatus received: ' + result.status);\n          }\n        }\n      });\n  }\n  $('.psicash-buy-speedboost').click(buySpeedBoostClick);\n\n\n  /**\n   * Event handler for the \"buy PsiCash with real money\" button click.\n   */\n  function buyPsiClick(e) {\n    if (e) {\n      e.preventDefault();\n    }\n\n    if (g_lastState !== 'connected') {\n      showNoticeModal(\n        'psicash#mustconnect-modal#title',\n        'psicash#mustconnect-modal#body',\n        'info',\n        null, null,\n        function() {\n          switchToTab('#connection-tab');\n        }\n      );\n      return;\n    }\n\n    switchToTab('#psicash-tab');\n\n    if (!buyPsiClick.skipAccountEncouragement && !g_PsiCashData.is_account) {\n      // We're showing a modal encouraging PsiCash account signup. The user can either\n      // choose to launch the sign-up process, or can continue on.\n      $('#PsiCashAccountEncouragement').modal({ show: true, backdrop: 'static' });\n      return;\n    }\n\n    buyPsiClick.skipAccountEncouragement = false;\n\n    // Open buy.psi.cash in an external browser\n    window.location = $('a.psicash-buy-psi').prop('href');\n  }\n  $('a.psicash-buy-psi').click(buyPsiClick);\n\n  /**\n   * An encouragement to \"sign up for a PsiCash account\" is shown when the user attempts\n   * to buy PsiCash without an active account. These are handlers for its buttons.\n   */\n  $('#PsiCashAccountEncouragement .js-submit-button').on('click', function psicashAccountEncouragementLoginClick(e) {\n    e.preventDefault();\n    $('#PsiCashAccountEncouragement').modal('hide').one('hidden', () => {\n      psicashAccountLogin();\n    });\n  });\n  $('#PsiCashAccountEncouragement .js-cancel-button').on('click', function psicashAccountEncouragementBuyClick(e) {\n    e.preventDefault();\n    buyPsiClick.skipAccountEncouragement = true;\n    $('#PsiCashAccountEncouragement').modal('hide').one('hidden', () => {\n      buyPsiClick();\n    });\n  });\n\n  /**\n   * Format a numeric amount of PsiCash, for display in the UI.\n   * @param {!number} nanopsi The amount of PsiCash, in nanopsi.\n   * @returns {!string} The formatted PsiCash value.\n   */\n  function formatPsi(nanopsi) {\n    if (!_.isNumber(nanopsi)) {\n      nanopsi = parseInt(nanopsi);\n    }\n\n    var BILLION = 1e9;\n\n    var currLang = $('html').attr('lang');\n\n    // NOTE: If you're testing in Chrome, toLocaleString will behave differently than in IE.\n    // For example, in Chrome locale='ar' doesn't seem to result in any change, but\n    // locale='ar-EG' does. In IE11 they both do.\n\n    var psi = nanopsi / BILLION;\n    // Reduce to two decimal places for display\n    psi = Math.floor(psi * 100) / 100;\n    // Localize number\n    try {\n      psi = psi.toLocaleString(currLang);\n    }\n    catch (e) {\n      // Just fall back to English.\n      psi = psi.toLocaleString('en');\n    }\n\n    // Old IE seems to always localize to English, with `.00` suffix. We want to strip off\n    // that suffix.\n    if (psi.substring(psi.length - '.00'.length) === '.00') {\n      psi = psi.substring(0, psi.length - '.00'.length);\n    }\n\n    return psi;\n  }\n\n  /**\n   * Begin the account login flow (show the login modal).\n   * Should not be called if the user is already logged in.\n   * @param {?Event} event\n   */\n  function psicashAccountLogin(event) {\n    if (event) {\n      event.preventDefault();\n    }\n\n    if (g_lastState !== 'connected') {\n      // We're not connected, so no PsiCash ops are allowed. Switch to the connection tab.\n      showNoticeModal(\n        'psicash#mustconnect-modal#title',\n        'psicash#mustconnect-modal#body',\n        'info',\n        null, null,\n        function() {\n          switchToTab('#connection-tab');\n        }\n      );\n      return;\n    }\n\n    // Clear any input error state\n    $('#PsiCashAccountLogin .control-group').removeClass('error');\n\n    // Show the login modal\n    $('#PsiCashAccountLogin').modal({\n      show: true,\n      backdrop: 'static'\n    }).one('shown', function () {\n      $('#AccountUsername').trigger('focus');\n    }).one('hidden', function () {\n      // The modal has closed; clear the password field\n      $('#PsiCashAccountLogin #AccountPassword').val('');\n\n      // We're purposely not clearing the username field. It's less sensitive (if the user\n      // logs in successfully it will be stored and displayed) and it will be helpful to\n      // the user to not have to type it in again if the login attempt fails.\n    });\n  }\n  $('.js-account-login').on('click', psicashAccountLogin);\n\n  /**\n   * Handler for the login dialog submit event.\n   * @param {Event} event\n   */\n  function psicashAccountLoginSubmitHandler(event) {\n    if (event) {\n      event.preventDefault();\n    }\n\n    if (g_lastState !== 'connected') {\n      // We're not connected, so no PsiCash ops are allowed. Close the login modal and\n      // switch to the connection tab.\n      $('#PsiCashAccountLogin').modal('hide').one('hidden', function () {\n        showNoticeModal(\n          'psicash#mustconnect-modal#title',\n          'psicash#mustconnect-modal#body',\n          'info',\n          null, null,\n          function() {\n            switchToTab('#connection-tab');\n          }\n        );\n      });\n      return;\n    }\n\n    const username = $('#AccountUsername').val();\n    const password = $('#AccountPassword').val();\n\n    // Validate input (make sure the fields aren't blank)\n    $('#AccountUsername').parents('.control-group').toggleClass('error', !username);\n    $('#AccountPassword').parents('.control-group').toggleClass('error', !password);\n    if (!username || !password) {\n      $(!username ? '#AccountUsername' : '#AccountPassword').trigger('focus');\n      return;\n    }\n\n    // We're going to dismiss the login modal before attempting login. This is partly\n    // so that we don't complicate the UI state and partly because modals-over-modals\n    // gets crash-y.\n    $('#PsiCashAccountLogin').modal('hide');\n\n    // Show the \"login in progress UI overlay\"\n    psicashUIWaitState(true, '#psicash-ui-overlay-logging-in');\n\n    HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandLogin(username, password))\n      .then((result) => {\n\n        // In the success case we want to maintain the wait state until after a refresh.\n        // In all other cases we drop it now.\n        if (result.status !== PsiCashServerResponseStatus.Success) {\n          psicashUIWaitState(false, null);\n        }\n\n        if (result.refresh) {\n          // The reponse supplied refresh data.\n          // Note that this will be incomplete -- no balance or purchases -- we still need\n          // to do a full refresh, below.\n          psiCashUIUpdater(result.refresh);\n        }\n        else {\n          // We need to do a full refresh\n          HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('account-login'));\n        }\n\n        if (result.error) {\n          // Catastrophic failure. Hopefully the error string helps the user diagnose the problem.\n          showNoticeModal(\n            'psicash#login#failure-modal-title',\n            'psicash#login#catastrophic-error-body',\n            'error',\n            'general#notice-modal-tech-preamble',\n            result.error,\n            null); // callback\n        }\n        else {\n          switch (result.status) {\n            case PsiCashServerResponseStatus.InvalidCredentials:\n              showNoticeModal(\n                'psicash#login#failure-modal-title',\n                'psicash#login#invalid-credentials-body',\n                'warning',\n                null,  // tech preamble\n                null,  // tech detail\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.BadRequest:\n              // The request was malformed in some way. This shouldn't happen.\n              showNoticeModal(\n                'psicash#login#failure-modal-title',\n                'psicash#login#badrequest-error-body',\n                'error',\n                null,  // tech preamble\n                null,  // tech detail\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.ServerError:\n              // The server gave a 500-ish error\n              showNoticeModal(\n                'psicash#login#failure-modal-title',\n                'psicash#login#server-error-body',\n                'error',\n                null,  // tech preamble\n                null,  // tech detail\n                null); // callback\n              break;\n\n            case PsiCashServerResponseStatus.Success:\n              // Account login succeeded.  hard refresh is required.\n              if (result.last_tracker_merge) {\n                showNoticeModal(\n                  'psicash#login#success-modal-title',\n                  'psicash#login#last-tracker-merge-body',\n                  'success',\n                  null,  // tech preamble\n                  null,  // tech detail\n                  null); // callback\n              }\n\n              // Don't clear the wait state until the refresh is complete, since we're not\n              // really \"ready\" until then.\n              HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('new-login')).then(() => {\n                psicashUIWaitState(false, null);\n              });\n              break;\n\n            default:\n              throw new Error('Login: unknown PsiCashServerResponseStatus received: ' + result.status);\n          }\n        }\n      });\n  }\n  $('#PsiCashAccountLogin .js-submit-button').on('click', psicashAccountLoginSubmitHandler);\n  $('#PsiCashAccountLogin input').on('keyup', function (event) {\n    if (event.key === 'Enter' || event.keyCode === 13) {\n      psicashAccountLoginSubmitHandler();\n    }\n  });\n\n  /**\n   * Begin the account logout flow. Should not be called if the user is not logged in.\n   * @param {?Event} event\n   * @param {boolean} skipConnectedCheck If true, there will be no check of whether\n   *    the Psiphon tunnel is currently connected. Should only be set to true when this\n   *    is called via the local-only logout prompt.\n   */\n  function psicashAccountLogout(event, skipConnectedCheck=false) {\n    if (event) {\n      event.preventDefault();\n    }\n\n    if (!skipConnectedCheck && g_lastState !== 'connected') {\n      $('#PsiCashAccountLogoutOffline').modal({ show: true, backdrop: 'static' });\n      return;\n    }\n\n    psicashUIWaitState(true, '#psicash-ui-overlay-logging-out');\n    PsiCashStore.set('logoutExpected', true);\n\n    HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandLogout())\n      .then((result) => {\n        psicashUIWaitState(false, null);\n\n        if (result.refresh) {\n          // The reponse supplied refresh data\n          psiCashUIUpdater(result.refresh);\n        }\n\n        if (result.reconnect_required) {\n          // An authorization is active on the tunnel and needs to be removed.\n          HtmlCtrlInterface_Log('PsiCash::AccountLogout indicates reconnect required');\n          HtmlCtrlInterface_ReconnectTunnel(/*suppressHomePage=*/true);\n        }\n\n        if (result.error) {\n          // Catastrophic failure. Show a modal error and hope the user can figure it out.\n          showNoticeModal(\n            'psicash#modal-logout-header',\n            'psicash#modal-logout-error-body',\n            'error',\n            'general#notice-modal-tech-preamble',\n            result.error,\n            null); // callback\n        }\n        else {\n          // Note that tunnel reconnection may be necessary to clear any active\n          // authorizations (like Speed Boost), but that will be handled by the\n          // PsiCash data refresh.\n          HtmlCtrlInterface_PsiCashCommand(new PsiCashCommandRefresh('logout'));\n        }\n      });\n  }\n  $('.js-account-logout').on('click', psicashAccountLogout);\n\n  /*\n  If the user attempts to log out of their PsiCash account while not having a connected\n  tunnel, they are prompted as to whether they wish to proceed with a local-only logout.\n  */\n  $('#PsiCashAccountLogoutOffline .js-connect-button').on('click', (e) => {\n    e.preventDefault();\n    $('#PsiCashAccountLogoutOffline').modal('hide').one('hidden', () => {\n      HtmlCtrlInterface_StartTunnel();\n      switchToTab('#connection-tab');\n    });\n  });\n  $('#PsiCashAccountLogoutOffline .js-logout-button').on('click', (e) => {\n    e.preventDefault();\n    $('#PsiCashAccountLogoutOffline').modal('hide').one('hidden', () => {\n      psicashAccountLogout(null, true);\n    });\n  });\n\n  /**\n   *\n   * @param {boolean} start True if the wait state is starting, false if it should be cleared.\n   * @param {*} messageSelector The selector of the message that should be shown during the wait state. May be null if the wait state is ending.\n   */\n  function psicashUIWaitState(start, messageSelector) {\n    if (messageSelector) {\n      $('.js-psicash-ui-overlay-messages > *').not(messageSelector).addClass('hidden');\n      $(messageSelector).removeClass('hidden');\n    }\n\n    $('.psicash-ui-overlay, .psicash-block-overlay').toggleClass('hidden', !start);\n  }\n\n  function switchToPsiCashTabAndExpandSpeedLimitInfo() {\n    // We're going to switch to the PsiCash tab, and ensure that it is showing\n    // (i.e., not collapsing) the porting limiting info.\n    // Setting the cookie here is a bit of hack. If this is the first visit to the\n    // PsiCash pane, it will help prevent the speed limit from collapsing and then\n    // re-expanding (which looks dumb).\n    setCookie('SpeedLimitCollapsed', false);\n    switchToTab('#psicash-tab', () => {\n      // This timeout is a dirty hack. There seems to be a bug where expanding the collapsed\n      // element too soon after the tab shows results in the element not expanding, but the\n      // state getting messed up so it can't even be done manually. In testing, too short\n      // a wait isn't sufficient, so we're going to give it a long time before we try.\n      // Let's pretend this is a feature for drawing attention to the speed limit info.\n      setTimeout(() => {\n        const $speedLimitCollapser = $('.psicash-pane__speed-limit__collapser');\n        const $speedLimitCollapserTarget = $($speedLimitCollapser.data('target'));\n        if (!$speedLimitCollapserTarget.hasClass('in')) {\n          $speedLimitCollapserTarget.collapse('show');\n        }\n      }, 1000);\n    });\n  }\n\n  /**\n   * Called when tunnel core indicates that there was an attempt to access a\n   * port disallowed by the current traffic rules. We will show an alert to\n   * encourage the user to buy Speed Boost.\n   */\n  function handleDisallowedTrafficNotice() {\n    if (PsiCashStore.data.uiState === PsiCashUIState.ACTIVE_BOOST) {\n      // If we're boosting, then any disallowed traffic is something that won't\n      // be let through by purchasing speed boost, so logging, etc., is pointless.\n      DEBUG_LOG('handleDisallowedTrafficNotice: already boosting');\n      return;\n    }\n\n    addLog({\n      priority: 2, // high\n      message: 'Disallowed traffic detected; please purchase Speed Boost'\n    });\n\n    if (g_initObj.Settings.DisableDisallowedTrafficAlert) {\n      // User has disabled this alert in the settings\n      DEBUG_LOG('handleDisallowedTrafficNotice: DisableDisallowedTrafficAlert is true');\n      return;\n    }\n\n    if (!handleDisallowedTrafficNotice.alertDisallowedTraffic) {\n      // We have already shown the alert this session.\n      DEBUG_LOG('handleDisallowedTrafficNotice: alert already shown this session');\n      return;\n    }\n    // else show the alert\n\n    DEBUG_LOG('handleDisallowedTrafficNotice: showing alert');\n\n    handleDisallowedTrafficNotice.alertDisallowedTraffic = false;\n\n    HtmlCtrlInterface_DisallowedTraffic();\n\n    showNoticeModal(\n      'notice#disallowed-traffic-alert-title',\n      'notice#disallowed-traffic-alert-body',\n      'info',\n      null, null, () => {\n        switchToPsiCashTabAndExpandSpeedLimitInfo();\n\n        /* Before we had the PsiCash pane, we would wiggle the bottom-left PsiCash block.\n        We'll leave this code in for now in case we decide that we prefer it.\n        if (compareIEVersion('gte', 9, true)) {\n          const psicashBlock = $('#psicash-block');\n          if (!psicashBlock.hasClass('hidden')) {\n            $('#psicash-block').addClass('draw-attention');\n            // The animation is 1s of movement, and we want the effect to linger for a bit.\n            setTimeout(() => $('#psicash-block').removeClass('draw-attention'), 1500);\n          }\n        }\n        */\n      });\n  }\n  handleDisallowedTrafficNotice.alertDisallowedTraffic = true;\n  $window.on(CONNECTED_STATE_CHANGE_EVENT, () => {\n    if (g_lastState === 'stopped') {\n      // After a hard stop, we will again show the \"disallowed traffic\" alert one time.\n      DEBUG_LOG('handleDisallowedTrafficNotice: resetting alertDisallowedTraffic to true because connected state stopped');\n      handleDisallowedTrafficNotice.alertDisallowedTraffic = true;\n    }\n  });\n  PsiCashStore.subscribe('uiState', () => {\n    if (PsiCashStore.data.uiState === PsiCashUIState.ACTIVE_BOOST &&\n        !handleDisallowedTrafficNotice.boosting) {\n      DEBUG_LOG('handleDisallowedTrafficNotice: boost started');\n      handleDisallowedTrafficNotice.boosting = true;\n    }\n    else if (handleDisallowedTrafficNotice.boosting) {\n      // We were boosting and now we're not. Show the \"disallowed traffic\" alert again.\n      DEBUG_LOG('handleDisallowedTrafficNotice: resetting alertDisallowedTraffic to true because boost ended');\n      handleDisallowedTrafficNotice.boosting = false;\n      handleDisallowedTrafficNotice.alertDisallowedTraffic = true;\n    }\n  });\n\n  /* UI HELPERS ****************************************************************/\n\n  function displayCornerAlert(elem) {\n    nextTick(() => {\n      // Show -- and then hide -- the alert\n      const appearAnimationTime = 500;\n      const showingTime = 4000;\n      const disappearAnimationTime = 1000;\n      // NOTE: Many of the JqueryUI animation effects don't work well with DPI scaling --\n      // they end up floating in the middle of the window, or jumping around, or hidden.\n      // The 'fade' effect is one of the few that is okay, but it's not really the visual\n      // we want. However, not supply an explicit effect provides a default that works and\n      // looks pretty good. I was unable to figure out which named effect it corresponds\n      // to (I didn't go looking in the jQueryUI source code, though).\n      $(elem).toggle({\n        duration: appearAnimationTime,\n        complete: () => {\n          setTimeout(function() {\n            $(elem).toggle({duration: disappearAnimationTime});\n          }, showingTime);\n        }\n      });\n    });\n  }\n\n  // Make the given tab visible. `tab` may be a selector, a DOM element, or a\n  // jQuery object. If `callback` is provided, it will be invoked when tab is shown.\n  function switchToTab(tab, callback) {\n    var $tab = $(tab);\n    if ($tab.hasClass('active')) {\n      // Target tab already showing.\n      if (callback) {\n        nextTick(callback);\n      }\n    }\n    else {\n      // Target tab not already showing. Switch to it before expanding and scrolling.\n      if (callback) {\n        $tab.find('[data-toggle=\"tab\"]').one('shown', callback);\n      }\n      $tab.find('[data-toggle=\"tab\"]').tab('show');\n    }\n  }\n\n  /**\n   * Shows a modal box. String table keys will be used for filling in the content.\n   * The \"tech\" values are optional.\n   * @param {!string} titleKey\n   * @param {!string} bodyKey\n   * @param {?string} levelIcon optional; must be one of \"error\", \"warning\", \"info\", \"success\"\n   * @param {?string} techPreambleKey\n   * @param {?string} techInfoString An explicit string -- not a string table key.\n   * @param {?callback} closedCallback Optional and will be called when the modal is closed.\n   */\n  function showNoticeModal(titleKey, bodyKey, levelIcon, techPreambleKey, techInfoString, closedCallback) {\n    DEBUG_ASSERT(titleKey && bodyKey, 'missing titleKey or bodyKey', titleKey, bodyKey);\n\n    var $modal = $('#NoticeModal');\n\n    $modal.find('.js-modal-title').html(i18n.t(titleKey));\n    $modal.find('.js-notice-modal-body').html(i18n.t(bodyKey));\n\n    $modal.find('.paragraph-icon').addClass('hidden');\n    if (levelIcon) {\n      $modal.find(`.paragraph-icon__${levelIcon}`).removeClass('hidden');\n    }\n\n    if (techPreambleKey && techInfoString) {\n      $modal.find('.js-notice-modal-tech-preamble').html(i18n.t(techPreambleKey));\n      $modal.find('.js-notice-modal-tech-info').text(techInfoString);\n      $modal.find('.js-notice-modal-tech').removeClass('hidden');\n    }\n    else {\n      $modal.find('.js-notice-modal-tech').addClass('hidden');\n    }\n\n    // Put up the modal\n    $modal.modal({\n      show: true,\n      backdrop: 'static'\n    }).one('hidden', function() {\n      if (closedCallback) {\n        closedCallback();\n      }\n    });\n  }\n\n  /* MISC HELPERS AND UTILITIES ************************************************/\n\n  // Support the `data-match-height` feature.\n  function doMatchHeight() {\n    var i, j, $elem, matchSelector, matchSelectorsToMaxHeight = {}, $matchSelectorMatches;\n    var $elemsToChange = $('[data-match-height]');\n\n    //\n    // Reset previously adjusted heights; record the match selectors.\n    //\n    for (i = 0; i < $elemsToChange.length; i++) {\n      $elem = $elemsToChange.eq(i);\n\n      // Store the original padding, if we don't already have it.\n      if (_.isUndefined($elem.data('match-height-orig-padding-top'))) {\n        $elem.data('match-height-orig-padding-top', parseInt($elem.css('padding-top')))\n             .data('match-height-orig-padding-bottom', parseInt($elem.css('padding-bottom')));\n      }\n\n      // Reset the padding to its original state\n      $elem.css('padding-top', $elem.data('match-height-orig-padding-top'))\n           .css('padding-bottom', $elem.data('match-height-orig-padding-bottom'));\n\n      matchSelector = $elem.data('match-height');\n      matchSelectorsToMaxHeight[matchSelector] = null;\n    }\n\n    //\n    // Alter the heights.\n    //\n    for (i = 0; i < $elemsToChange.length; i++) {\n      $elem = $elemsToChange.eq(i);\n      matchSelector = $elem.data('match-height');\n\n      // If we haven't already determined the max for this selector, calculate it\n      if (matchSelectorsToMaxHeight[matchSelector] === null) {\n        $matchSelectorMatches  = $(matchSelector);\n        for (j = 0; j < $matchSelectorMatches.length; j++) {\n          matchSelectorsToMaxHeight[matchSelector] = Math.max(\n            matchSelectorsToMaxHeight[matchSelector],\n            $matchSelectorMatches.eq(j).height());\n        }\n      }\n\n      // Alter the height.\n      matchHeight($elem, matchSelectorsToMaxHeight[matchSelector]);\n    }\n\n    function matchHeight($elem, height) {\n      var heightDiff = height - $elem.height();\n      if (heightDiff <= 0) {\n        // Already at least big enough\n        return;\n      }\n\n      var align = $elem.data('match-height-align');\n      if (align === 'top') {\n        $elem.css('padding-bottom', heightDiff + $elem.data('match-height-orig-padding-bottom'));\n      }\n      else if (align === 'bottom') {\n        $elem.css('padding-top', heightDiff + $elem.data('match-height-orig-padding-top'));\n      }\n      else { // center\n        $elem.css('padding-top', heightDiff/2 + $elem.data('match-height-orig-padding-top'))\n             .css('padding-bottom', heightDiff/2 + $elem.data('match-height-orig-padding-bottom'));\n      }\n    }\n  }\n\n  // Support the `data-match-width` feature\n  function doMatchWidth() {\n    var matchSelectors = [], $dataMatchElems, $elem,\n        matchSelector, $matchMaxElems, matchSelectorMaxWidth, i, j;\n\n    $dataMatchElems = $('[data-match-width]');\n\n    // First reset the widths of all the elements we will be adjusting. Otherwise\n    // the find-max-width will be tainted if an element-to-adjust is also part of\n    // of the find-max-width selector.\n    for (i = 0; i < $dataMatchElems.length; i++) {\n      $elem = $dataMatchElems.eq(i);\n      $elem.css('width', '');\n\n      // Build up a list of the selectors used, with dependent ones at the end.\n      matchSelector = $elem.data('match-width');\n      if (!_.includes(matchSelectors, matchSelector)) {\n        if ($elem.data('match-width-dependent') === 'true') {\n          matchSelectors.push(matchSelector);\n        }\n        else {\n          matchSelectors.unshift(matchSelector);\n        }\n      }\n    }\n\n    // Then collect the maximums for each of the selectors provided by data-match-width\n    for (i = 0; i < matchSelectors.length; i++) {\n      matchSelector = matchSelectors[i];\n\n      matchSelectorMaxWidth = 0.0;\n      $matchMaxElems = $(matchSelector);\n      for (j = 0; j < $matchMaxElems.length; j++) {\n        matchSelectorMaxWidth = Math.max(\n                                  matchSelectorMaxWidth,\n                                  $matchMaxElems.eq(j).outerWidth());\n      }\n\n      // Apply the max width to the target elements.\n      $dataMatchElems = $('[data-match-width=\"' + matchSelector + '\"]');\n      for (j = 0; j < $dataMatchElems.length; j++) {\n        $elem = $dataMatchElems.eq(j);\n        $elem.width(getNetWidth($elem, matchSelectorMaxWidth));\n      }\n    }\n\n    function getNetWidth($elem, grossWidth) {\n      return grossWidth -\n              (parseFloat($elem.css('padding-right')) || 0) -\n              (parseFloat($elem.css('padding-left')) || 0) -\n              (parseFloat($elem.css('border-right-width')) || 0) -\n              (parseFloat($elem.css('border-left-width')) || 0) -\n              (parseFloat($elem.css('margin-right')) || 0) -\n              (parseFloat($elem.css('margin-left')) || 0);\n    }\n  }\n\n  /**\n   * Gets the version of IE rendering the view.\n   * @returns {Number|boolean} Returns false if the current browser/HTML control is not\n   *                           Internet Explorer-based, otherwise returns the integer\n   *                           version of the IE that the view is based on.\n   */\n  function getIEVersion() {\n    // This is complicated by the fact that the MSHTML control uses a different\n    // user agent string than browsers do.\n\n    var ie7_10Match, ie11Match, edgeMatch, tridentMatch, msieMatch;\n\n    var ieVersion = false;\n\n    // User agents differ between browser and actual application, so we need\n    // different checks\n\n    if (IS_BROWSER) {\n      // Some care needs to be taken to work with IE11+'s old-version test mode.\n      // We can't just use Trident versions.\n\n      // This will match IEv7-10.\n      ie7_10Match = window.navigator.userAgent.match(/^Mozilla\\/\\d\\.0 \\(compatible; MSIE (\\d+)/);\n      // This will match IE11.\n      ie11Match = window.navigator.userAgent.match(/Trident\\/(\\d+)/);\n      // This will match Edgev1 (which we will consider IE12).\n      edgeMatch = window.navigator.userAgent.match(/Edge\\/(\\d+)/);\n\n      if (ie7_10Match) {\n        ieVersion = parseInt(ie7_10Match[1]);\n      }\n      else if (ie11Match) {\n        // Trident version is 4 versions behind IE version.\n        ieVersion = parseInt(ie11Match[1]) + 4;\n      }\n      else if (edgeMatch) {\n        ieVersion = parseInt(edgeMatch[1]);\n      }\n    }\n    else {\n      // This will match MSHTMLv8-11.\n      tridentMatch = window.navigator.userAgent.match(/MSIE \\d+.*Trident\\/(\\d+)/);\n      // This will match MSHTMLv7. Note that it must be checked after the Trident match.\n      msieMatch = window.navigator.userAgent.match(/MSIE (\\d+)/);\n\n      // This will match Edgev1 (which we will consider IE12).\n      // Note that this hasn't been seen in the Wild. MSHTML on Win10 uses Trident/8,\n      // which hits the above regex and returns version 12.\n      edgeMatch = window.navigator.userAgent.match(/Edge\\/(\\d+)/);\n\n      if (tridentMatch) {\n        // Trident version is 4 versions behind IE version.\n        ieVersion = parseInt(tridentMatch[1]) + 4;\n      }\n      else if (msieMatch) {\n        ieVersion = parseInt(msieMatch[1]);\n      }\n      else if (edgeMatch) {\n        ieVersion = parseInt(edgeMatch[1]);\n      }\n    }\n\n    return ieVersion;\n  }\n\n  // `comparison` may be: 'eq', 'lt', 'gt', 'lte', 'gte'\n  function compareIEVersion(comparison, targetVersion, acceptNonIE) {\n    var ieVersion = getIEVersion();\n\n    if (ieVersion === false) {\n      return acceptNonIE;\n    }\n\n    if (comparison === 'eq') {\n      return ieVersion == targetVersion;\n    }\n    else if (comparison === 'lt') {\n      return ieVersion < targetVersion;\n    }\n    else if (comparison === 'gt') {\n      return ieVersion > targetVersion;\n    }\n    else if (comparison === 'lte') {\n      return ieVersion <= targetVersion;\n    }\n    else if (comparison === 'gte') {\n      return ieVersion >= targetVersion;\n    }\n\n    return false;\n  }\n\n  //\n  // We don't have the ability to use real cookies or DOM storage, so we'll store\n  // persistent stuff in the registry via the win32 code.\n  //\n  var g_cookies = g_initObj.Cookies ? JSON.parse(g_initObj.Cookies) : {};\n\n  /**\n   * Retrieves the stored cookie value associated with `name`.\n   * @param {string} name\n   * @returns {} The value for `name`. May be null or undefined.\n   */\n  function getCookie(name) {\n    if (IS_BROWSER) {\n      const localVal = JSON.parse(window.localStorage.getItem(name));\n      if (!_.isUndefined(localVal) & localVal !== null) {\n        return localVal;\n      }\n      return g_cookies[name];\n    }\n\n    return g_cookies[name];\n  }\n\n  /**\n   * Persistently stores `value` under the key `name`.\n   * @param {string} name The key to store the `value` under.\n   * @param {} value The value to be stored. Must be JSON-able.\n   */\n  function setCookie(name, value) {\n    if (IS_BROWSER) {\n      window.localStorage.setItem(name, JSON.stringify(value));\n    }\n\n    g_cookies[name] = value;\n    HtmlCtrlInterface_SetCookies(JSON.stringify(g_cookies));\n  }\n\n\n  // Sets a short timeout and then calls `callback`\n  // `context` is optional. Will be `this` when `callback` is called.\n  function nextTick(callback, context) {\n    nextTickFn(callback, context)();\n  }\n\n  // Creates a function that, when called, sets a short timeout and then calls `callback`\n  // `context` is optional. Will be `this` when `callback` is called.\n  function nextTickFn(callback, context) {\n    return function nextTickFnInner() {\n      var args = arguments;\n      var runner = function() {\n        callback.apply(context, args);\n      };\n\n      setTimeout(runner, 0);\n    };\n  }\n\n  // Convert hex-style color (#FFFFFF or #FFF) to RGB style (rgb(255, 255, 255)).\n  // From http://stackoverflow.com/a/5624139/729729\n  function hexToRgb(hex) {\n    // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n    var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n    hex = hex.replace(shorthandRegex, function(m, r, g, b) {\n      return r + r + g + g + b + b;\n    });\n\n    var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    return result ? {\n      r: parseInt(result[1], 16),\n      g: parseInt(result[2], 16),\n      b: parseInt(result[3], 16)\n    } : null;\n  }\n\n  // Draws attention to a button. Note that this may require some extra styling\n  // to fully work (so test accordingly).\n  function drawAttentionToButton(elem) {\n    // We will draw attention by temporarily flaring a box-shadow, and then\n    // wiggling the button. The wiggle comes from CSS animation (see main.less).\n\n    var backgroundColor, backgroundColorRGB, shadowColor;\n    var $elem = $(elem);\n\n    var originalBoxShadow = $elem.data('drawAttentionToButton-originalBoxShadow');\n    if (!originalBoxShadow) {\n      originalBoxShadow = $elem.css('box-shadow');\n      $elem.data('drawAttentionToButton-originalBoxShadow', originalBoxShadow);\n    }\n\n    // The box shadow will be same colour as the button background, with reduced\n    // opacity.\n\n    backgroundColor = $elem.css('background-color');\n    if (!backgroundColor) {\n      backgroundColor = '#999';\n    }\n\n    if (backgroundColor[0] === '#') {\n      // hex style; convert to rgb\n      backgroundColorRGB = hexToRgb(backgroundColor);\n      backgroundColor = 'rgb(' + backgroundColorRGB.r + ', ' +\n                                 backgroundColorRGB.g + ', ' +\n                                 backgroundColorRGB.b + ')';\n    }\n\n    // Only add alpha if this is a rgb(..) colour, and not rgba(...) or anything else.\n    if (backgroundColor.slice(0, 4) === 'rgb(') {\n      shadowColor = 'rgba(' + backgroundColor.slice(4, -1) + ', 0.7)';\n    }\n    else {\n      shadowColor = backgroundColor;\n    }\n\n    // The effect we're going for is the color draining from outside into the button.\n    var animationTimeSecs = 3;\n\n    // Add the initial internal and external shadow\n    $elem.css({\n      'transition': '',\n      'box-shadow': 'inset 0 0 100px #FFF, 0 0 10px ' + shadowColor\n    });\n\n    // After giving that CSS change a moment to take effect...\n    _.delay(function() {\n      // ...add a transition and remove the box shadow. It will disappear slowly.\n      $elem.css({\n        'transition': 'box-shadow ' + animationTimeSecs + 's',\n        'box-shadow': 'none'\n      });\n\n      // When the big box shadow is gone, reset to the original value\n      $elem.one('transitionend', function() {\n        $elem.css({\n          'transition': '',\n          'box-shadow': originalBoxShadow\n        });\n      });\n    }, 10); // if this is too low, the effect seems to fail sometimes (like when a port number field is changed in settings)\n  }\n\n  function DEBUG_ASSERT(check) {\n    if (g_initObj.Config.Debug) {\n      if (_.isFunction(check)) {\n        check = check();\n      }\n\n      if (!check) {\n        let message = 'DEBUG_ASSERT failed: ' + check + '; args: \\n';\n        for (let i = 1; i < arguments.length; i++) {\n          message += '\\t' + arguments[i] + '\\n';\n        }\n        throw new Error(message);\n      }\n    }\n  }\n\n  /**\n   * Returns true if the windows currently has focus; false otherwise.\n   * @returns {boolean}\n   */\n  function windowHasFocus() {\n    return document.hasFocus();\n  }\n\n  /**\n   * Adds a handler that will be called when the windows gets focus.\n   * @param {function} handler\n   */\n  function addWindowFocusHandler(handler) {\n    $window.on('focus', handler);\n  }\n\n  /**\n   * Generates a pseudo-random string, suitable for non-crypto uniqueness.\n   * @returns {string}\n   */\n  function randomID() {\n    return base64.encode(Math.random());\n  }\n\n  /* DEBUGGING *****************************************************************/\n\n  // Some functionality to help us debug (and demo) in browser.\n\n  $(function debugInit() {\n    if (!g_initObj.Config.Debug) {\n      $('#debug-tab, #debug-pane').remove();\n      return;\n    }\n\n    // Make the connect button \"work\" in browser mode\n    $('#connect-toggle a').click(function(e) {\n      if (!IS_BROWSER) {\n        return;\n      }\n\n      e.preventDefault();\n      var buttonConnectState = $(this).parents('.connect-toggle-content').data('connect-state');\n      if (buttonConnectState === 'stopped') {\n        console.log('DEBUG: connection starting');\n        HtmlCtrlInterface_SetState({state: 'starting'});\n        setTimeout(function() {\n          HtmlCtrlInterface_SetState({state: 'connected'});\n        }, 2000);\n      }\n      else if (buttonConnectState === 'starting' || buttonConnectState === 'connected') {\n        console.log('DEBUG: connection stopping');\n        HtmlCtrlInterface_SetState({state: 'stopping'});\n        setTimeout(function() {\n          HtmlCtrlInterface_SetState({state: 'stopped'});\n        }, 2000);\n      }\n      // the stopping button is disabled\n    });\n\n    // Keep state combo up-to-date\n    function updateStateCombo() {\n      $('#debug-state').val(g_lastState);\n    }\n    $window.on(CONNECTED_STATE_CHANGE_EVENT, updateStateCombo);\n    updateStateCombo();\n    // Change state when combo changes\n    $('#debug-state').on('change', function() {\n      HtmlCtrlInterface_SetState({state: $('#debug-state').val()});\n    });\n\n    // Wire up AddLog\n    $('#debug-log a').click(function() {\n      HtmlCtrlInterface_AddLog({\n        message: $('#debug-log input').val(),\n        priority: parseInt($('#debug-log select').val())\n      });\n    });\n\n    // Wire up the AvailableEgressRegions notice\n    $('#debug-AvailableEgressRegions a').click(function() {\n      var regions = [], regionCheckboxes = $('#debug-AvailableEgressRegions input');\n      for (var i = 0; i < regionCheckboxes.length; i++) {\n        if (regionCheckboxes.eq(i).prop('checked')) {\n          regions.push(regionCheckboxes.eq(i).val());\n        }\n      }\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'AvailableEgressRegions',\n        data: { regions: regions }\n      });\n    });\n\n    // Wire up the PsiphonUI::URLCopiedToClipboard notice\n    $('#debug-URLCopiedToClipboard a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'PsiphonUI::URLCopiedToClipboard'\n      });\n    });\n\n    // Wire up the UpstreamProxyError notice\n    $('#debug-UpstreamProxyError a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'UpstreamProxyError',\n        data: { message: $('#debug-UpstreamProxyError input').val() }\n      });\n    });\n\n    // Wire up the TrafficRateLimits notice\n    $('#debug-TrafficRateLimits a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'TrafficRateLimits',\n        data: { downstreamBytesPerSecond: Number($('#debug-TrafficRateLimits input').val()) }\n      });\n    });\n\n    // Wire up the HttpProxyPortInUse notice\n    $('#debug-HttpProxyPortInUse a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'HttpProxyPortInUse'\n      });\n    });\n\n    // Wire up the SocksProxyPortInUse notice\n    $('#debug-SocksProxyPortInUse a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'SocksProxyPortInUse'\n      });\n    });\n\n    // Wire up the SystemProxySettings::SetProxyError test\n    $('#debug-SetProxyError a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'SystemProxySettings::SetProxyError'\n      });\n    });\n\n    // Wire up the SystemProxySettings::SetProxyWarning test\n    $('#debug-SetProxyWarning a').click(function() {\n      HtmlCtrlInterface_AddNotice({\n        noticeType: 'SystemProxySettings::SetProxyWarning',\n        data: '[CONN NAME]'\n      });\n    });\n\n    // Wire up the UpdateDpiScaling test\n    $('#debug-UpdateDpiScaling a').click(function() {\n      HtmlCtrlInterface_UpdateDpiScaling({\n        dpiScaling: $('#debug-UpdateDpiScaling input').val()\n      });\n    });\n\n    // Wire up the RefreshPsiCash test\n    $('#debug-RefreshPsiCash a').click(function debugRefreshPsiCashClick() {\n      if (!$('#debug-RefreshPsiCash-balance').val() ||\n          !$('#debug-RefreshPsiCash-price-1hr').val() ||\n          !$('#debug-RefreshPsiCash-price-24hr').val() ||\n          !$('#debug-RefreshPsiCash-price-7day').val() ||\n          !$('#debug-RefreshPsiCash-price-31day').val()) {\n        return;\n      }\n\n      const msg = makeTestRefreshMsg(null);\n      HtmlCtrlInterface_PsiCashMessage(msg);\n\n      setCookie('debug-RefreshPsiCash-balance', msg.payload.balance);\n      setCookie('debug-RefreshPsiCash-price-1hr', msg.payload.purchase_prices.length ? msg.payload.purchase_prices.find(pp => pp.distinguisher==='1hr').price : null);\n      setCookie('debug-RefreshPsiCash-price-24hr', msg.payload.purchase_prices.length ? msg.payload.purchase_prices.find(pp => pp.distinguisher==='24hr').price : null);\n      setCookie('debug-RefreshPsiCash-price-7day', msg.payload.purchase_prices.length ? msg.payload.purchase_prices.find(pp => pp.distinguisher==='7day').price : null);\n      setCookie('debug-RefreshPsiCash-price-31day', msg.payload.purchase_prices.length ? msg.payload.purchase_prices.find(pp => pp.distinguisher==='31day').price : null);\n      setCookie('debug-RefreshPsiCash-isAccount', msg.payload.is_account);\n      setCookie('debug-RefreshPsiCash-hasTokens', msg.payload.has_tokens);\n      setCookie('debug-RefreshPsiCash-accountUsername', msg.payload.account_username);\n    });\n\n    // Wire up the PsiCash InitDone test\n    $('#debug-PsiCashInitDone a').click(function debugPsiCashInitDoneClick() {\n      testInitDoneResponse();\n    });\n\n    const BILLION = 1e9;\n    // Populate the PsiCash balance, price, and account info\n    $('#debug-RefreshPsiCash-balance').val(_.isNumber(getCookie('debug-RefreshPsiCash-balance')) ? getCookie('debug-RefreshPsiCash-balance') / BILLION : '');\n    $('#debug-RefreshPsiCash-price-1hr').val(_.isNumber(getCookie('debug-RefreshPsiCash-price-1hr')) ? getCookie('debug-RefreshPsiCash-price-1hr') / BILLION : '');\n    $('#debug-RefreshPsiCash-price-24hr').val(_.isNumber(getCookie('debug-RefreshPsiCash-price-24hr')) ? getCookie('debug-RefreshPsiCash-price-24hr') / BILLION : '');\n    $('#debug-RefreshPsiCash-price-7day').val(_.isNumber(getCookie('debug-RefreshPsiCash-price-7day')) ? getCookie('debug-RefreshPsiCash-price-7day') / BILLION : '');\n    $('#debug-RefreshPsiCash-price-31day').val(_.isNumber(getCookie('debug-RefreshPsiCash-price-31day')) ? getCookie('debug-RefreshPsiCash-price-31day') / BILLION : '');\n\n    $('#debug-RefreshPsiCash-isAccount')[0].checked = getCookie('debug-RefreshPsiCash-isAccount');\n    $('#debug-RefreshPsiCash-hasTokens')[0].checked = getCookie('debug-RefreshPsiCash-hasTokens');\n    $('#debug-RefreshPsiCash-accountUsername').val(getCookie('debug-RefreshPsiCash-accountUsername') ? getCookie('debug-RefreshPsiCash-accountUsername') : '');\n\n    // Wire up the Disallowed Traffic test\n    $('#debug-DisallowedTraffic a').click(function debugPsiCashInitDoneClick() {\n      handleDisallowedTrafficNotice();\n    });\n\n  });\n\n  /**\n   * Construct a PsiCashMessageData object from the fields in the debug interface.\n   * @param {?string} msg_id The message.id to use in the \"response\".\n   * @returns {!PsiCashMessageData}\n   */\n  function makeTestRefreshMsg(msg_id) {\n    let purchase = null; /** @type {?PsiCashPurchase} */\n    if ($('#debug-RefreshPsiCash-boost-remaining').val()) {\n      purchase = {\n        id: `purchase-id-${randomID()}`,\n        'class': 'speed-boost',\n        distinguisher: '1hr',\n        authorization: 'myfakeauth',\n        localTimeExpiry: moment().add(parseFloat($('#debug-RefreshPsiCash-boost-remaining').val()), 'minutes').toISOString()\n      };\n    }\n\n    /** @type {PsiCashMessageData} */\n    let msg = {\n      type: PsiCashMessageTypeEnum.REFRESH,\n      id: msg_id,\n      payload: makeTestRefreshPayload(purchase)\n    };\n\n    return msg;\n  }\n\n  /**\n   * Create a PsiCash RefreshState payload suitable for testing\n   * @param {?PsiCashPurchase} purchase\n   * @param {?boolean} isAccount\n   * @param {?boolean} hasTokens\n   * @param {?string} accountUsername Must be set if isAccount&&hasTokens are true\n   * @returns {PsiCashRefreshData}\n   */\n  function makeTestRefreshPayload(purchase=undefined, isAccount=undefined, hasTokens=undefined, accountUsername=undefined) {\n    const BILLION = 1e9;\n\n    if (_.isUndefined(isAccount)) {\n      isAccount = $('#debug-RefreshPsiCash-isAccount')[0].checked;\n    }\n    else {\n      $('#debug-RefreshPsiCash-isAccount')[0].checked = isAccount;\n    }\n\n    if (_.isUndefined(hasTokens)) {\n      hasTokens = $('#debug-RefreshPsiCash-hasTokens')[0].checked;\n    }\n    else {\n      $('#debug-RefreshPsiCash-hasTokens')[0].checked = hasTokens;\n    }\n\n    if (_.isUndefined(accountUsername)) {\n      accountUsername = $('#debug-RefreshPsiCash-accountUsername').val();\n    }\n    else {\n      $('#debug-RefreshPsiCash-accountUsername').val(accountUsername ? accountUsername : '');\n    }\n\n    return {\n      reconnect_required: $('#debug-RefreshPsiCash-reconnectRequired')[0].checked,\n      is_account: isAccount,\n      account_username: accountUsername,\n      has_tokens: hasTokens,\n      balance: hasTokens ? parseFloat($('#debug-RefreshPsiCash-balance').val()) * BILLION : 0,\n      purchase_prices: hasTokens ? [\n        {\n          'class': 'speed-boost',\n          distinguisher: '1hr',\n          price: parseFloat($('#debug-RefreshPsiCash-price-1hr').val()) * BILLION\n        },\n        {\n          'class': 'speed-boost',\n          distinguisher: '24hr',\n          price: parseFloat($('#debug-RefreshPsiCash-price-24hr').val()) * BILLION\n        },\n        {\n          'class': 'speed-boost',\n          distinguisher: '7day',\n          price: parseFloat($('#debug-RefreshPsiCash-price-7day').val()) * BILLION\n        },\n        {\n          'class': 'speed-boost',\n          distinguisher: '31day',\n          price: parseFloat($('#debug-RefreshPsiCash-price-31day').val()) * BILLION\n        }\n      ] : [],\n      purchases: hasTokens && purchase ? [purchase] : null,\n      buy_psi_url: 'https://example.com/buy.psi.cash/#psicash=example',\n      account_signup_url: 'https://example.com/my.psi.cash/signup?etc',\n      account_management_url: 'https://my.psi.cash/?etc',\n      forgot_account_url: 'https://my.psi.cash/forgot?etc',\n    };\n  }\n\n  /**\n   * Mimic an init-done message (via C code).\n   */\n  function testInitDoneResponse() {\n    const error = $('#debug-PsiCashInitDone-error')[0].checked;\n    const recovered = $('#debug-PsiCashInitDone-recovered')[0].checked;\n    /** @type {PsiCashMessageData} */\n    const msg = {\n      type: PsiCashMessageTypeEnum.INIT_DONE,\n      id: '',\n      payload: error ? {\n        error: 'test init error message',\n        recovered: recovered\n      } : {}\n    };\n\n    setTimeout(() => HtmlCtrlInterface_PsiCashMessage(msg), 200);\n  }\n\n  /**\n   * Mimic a refresh response from the server (via C code).\n   * @param {!PsiCashCommandPurchase} command\n   */\n  function testRefreshResponse(command) {\n    const msg = makeTestRefreshMsg(command.id);\n    // Pretend the request takes a while.\n    setTimeout(() => HtmlCtrlInterface_PsiCashMessage(msg), 2000);\n  }\n\n  /**\n   * Mimic a purchase response from the server (via C code).\n   * @param {!PsiCashCommandPurchase} command\n   */\n  function testPurchaseResponse(command) {\n    if (!command.distinguisher || !command.expectedPrice || !command.transactionClass) {\n      alert('Bad command input to testPurchaseResponse: ' + JSON.stringify(command));\n    }\n\n    var resp = $('#debug-PsiCashSpeedBoost-response').val();\n\n    /** @type {PsiCashPurchaseResponse} */\n    var msgPayload = {\n      error: null,\n      status: PsiCashServerResponseStatus.Invalid,\n      purchase: null\n    };\n\n    /** @type {PsiCashMessageData} */\n    var msg = {\n      type: PsiCashMessageTypeEnum.NEW_PURCHASE,\n      id: command.id,\n      payload: msgPayload\n    };\n\n    if (resp === 'error') {\n      msg.payload.error = 'debug error';\n    }\n    else if (PsiCashServerResponseStatus[resp] === PsiCashServerResponseStatus.Success) {\n      msg.payload.status = PsiCashServerResponseStatus.Success;\n\n      let expiry = moment().add(1, 'hour').toISOString();\n      if (command.distinguisher === '24hr') {\n        expiry = moment().add(24, 'hour').toISOString();\n      }\n      else if (command.distinguisher === '7day') {\n        expiry = moment().add(7, 'day').toISOString();\n      }\n      else if (command.distinguisher === '31day') {\n        expiry = moment().add(31, 'day').toISOString();\n      }\n\n      /** @type {PsiCashPurchase} */\n      let purchase = {\n        id: `debugpurchaseid-${randomID()}`,\n        'class': command.transactionClass, // quoting key b/c it's a keyword and old IE will complain\n        distinguisher: command.distinguisher,\n        authorization: 'myfakeauth', // not the correct format, and assuming we always want it, but that's okay for now\n        localTimeExpiry: expiry,\n        serverTimeExpiry: expiry\n      };\n\n      $('#debug-RefreshPsiCash-balance').val((g_PsiCashData.balance - command.expectedPrice) / 1e9);\n      msg.payload.refresh = makeTestRefreshPayload(purchase);\n    }\n    else {\n      msg.payload.status = PsiCashServerResponseStatus[resp];\n    }\n\n    // Pretend the request takes a while.\n    setTimeout(() => HtmlCtrlInterface_PsiCashMessage(msg), 5000);\n  }\n\n  /**\n   * Mimic an account login response from the server (via C code).\n   * @param {!PsiCashCommandPurchase} command\n   */\n  function testAccountLoginResponse(command) {\n    var resp = $('#debug-PsiCashLogin-response').val();\n\n    /** @type {PsiCashLoginResponse} */\n    var msgPayload = {\n      error: null,\n      status: PsiCashServerResponseStatus.Invalid,\n      last_tracker_merge: null,\n      refresh: null\n    };\n\n    /** @type {PsiCashMessageData} */\n    var msg = {\n      type: PsiCashMessageTypeEnum.LOGIN,\n      id: command.id,\n      payload: msgPayload\n    };\n\n    if (resp === 'error') {\n      msg.payload.error = 'debug error';\n    }\n    else if (PsiCashServerResponseStatus[resp] === PsiCashServerResponseStatus.Success) {\n      // Modify this checkbox, or else a refresh will cause us to lose state\n      $('#debug-RefreshPsiCash-isAccount')[0].checked = true;\n\n      msg.payload.status = PsiCashServerResponseStatus.Success;\n\n      msg.payload.last_tracker_merge = $('#debug-PsiCashLogin-last_tracker_merge')[0].checked;\n\n      msg.payload.refresh = makeTestRefreshPayload(undefined, true, true, 'DebugUsername');\n    }\n    else {\n      msg.payload.status = PsiCashServerResponseStatus[resp];\n    }\n\n    // Pretend the request takes a while.\n    setTimeout(() => HtmlCtrlInterface_PsiCashMessage(msg), 5000);\n  }\n\n  /**\n   * Mimic an account logout response from the server (via C code).\n   * @param {!PsiCashCommandPurchase} command\n   */\n  function testAccountLogoutResponse(command) {\n    var resp = $('#debug-PsiCashLogout-response').val();\n\n    /** @type {PsiCashLogoutResponse} */\n    var msgPayload = {\n      error: null,\n    };\n\n    /** @type {PsiCashMessageData} */\n    var msg = {\n      type: PsiCashMessageTypeEnum.LOGOUT,\n      id: command.id,\n      payload: msgPayload\n    };\n\n    if (resp === 'error') {\n      msg.payload.error = 'debug error';\n    }\n    else {\n      msg.payload.reconnect_required = $('#debug-PsiCashLogout-reconnectRequired')[0].checked;\n      msg.payload.refresh = makeTestRefreshPayload(undefined, true, false, null);\n    }\n\n    // Pretend the request takes a while.\n    setTimeout(() => HtmlCtrlInterface_PsiCashMessage(msg), 5000);\n  }\n\n\n  /* INTERFACE METHODS *********************************************************/\n\n  const PSIPHON_LINK_PREFIX = 'psi:';\n\n  /**\n   * Send a command payload to the C backend.\n   * In browser mode, it just logs.\n   * @param {string} action The action that the backend should take.\n   * @param {?any} arg The optional string or object that should be appended to the URL.\n   */\n   function commandAppOperation(action, arg=null) {\n    if (_.isObject(arg)) {\n      arg = JSON.stringify(arg);\n    }\n\n    if (IS_BROWSER) {\n      const appURL = `${PSIPHON_LINK_PREFIX}${action}${arg !== null ? '?'+arg : ''}`;\n      console.log(appURL);\n    }\n    else {\n      const appURL = `${PSIPHON_LINK_PREFIX}${action}${arg !== null ? '?'+base64.encode(unescape(encodeURIComponent(arg))) : ''}`;\n      window.location = appURL;\n    }\n  }\n\n  /* Calls from C code to JS code. */\n\n  // Add new status message.\n  function HtmlCtrlInterface_AddLog(jsonArgs) {\n    nextTick(function() {\n      // Allow object as input to assist with debugging\n      const args = _.isObject(jsonArgs) ? jsonArgs : JSON.parse(jsonArgs);\n      addLog(args);\n    });\n  }\n\n  // Add new notice. This may be interpreted and acted upon.\n  function HtmlCtrlInterface_AddNotice(jsonArgs) {\n    nextTick(function() {\n      // Allow object as input to assist with debugging\n      const args = _.isObject(jsonArgs) ? jsonArgs : JSON.parse(jsonArgs);\n      if (args.noticeType === 'UpstreamProxyError') {\n        upstreamProxyErrorNotice(args.data.message);\n      }\n      else if (args.noticeType === 'HttpProxyPortInUse' ||\n               args.noticeType === 'SocksProxyPortInUse') {\n        localProxyPortConflictNotice(args.noticeType);\n      }\n      else if (args.noticeType === 'AvailableEgressRegions') {\n        // Store the value in a cookie so that it's available at the next startup.\n        setCookie('AvailableEgressRegions', args.data.regions);\n        // Update the UI.\n        updateAvailableEgressRegions(true);\n      }\n      else if (args.noticeType === 'ServerAlert') {\n        if (args.data.reason === 'disallowed-traffic') {\n          handleDisallowedTrafficNotice();\n        }\n      }\n      else if (args.noticeType === 'TrafficRateLimits') {\n        // We are interested in the connection speed when _not_ Boosted\n        if (PsiCashStore.data.uiState !== PsiCashUIState.ACTIVE_BOOST) {\n          // Store the value in a cookie so that it's available at the next startup.\n          setCookie('BaselineRateLimit', args.data.downstreamBytesPerSecond || Number.MAX_SAFE_INTEGER);\n          // Update the UI.\n          psiCashUIUpdater();\n        }\n      }\n      else if (args.noticeType === 'SystemProxySettings::SetProxyError') {\n        showNoticeModal(\n          'notice#systemproxysettings-setproxy-error-title',\n          'notice#systemproxysettings-setproxy-error-body',\n          'error',\n          null, null, null);\n      }\n      else if (args.noticeType === 'SystemProxySettings::SetProxyWarning') {\n        const setProxyWarningTemplate = i18n.t('notice#systemproxysettings-setproxy-warning-template');\n        addLog({\n          priority: 2, // high\n          message: _.template(setProxyWarningTemplate)({data: args.data})\n        });\n      }\n      else if (args.noticeType === 'PsiphonUI::URLCopiedToClipboard') {\n        displayCornerAlert($('#alert-url-copied-to-clipboard'));\n      }\n    });\n  }\n\n  // Set the connected state.\n  // We will de-bounce the state change messages.\n  let g_timeoutSetState = null;\n  function HtmlCtrlInterface_SetState(jsonArgs) {\n    // Clear any queued state changes.\n    if (g_timeoutSetState !== null) {\n      clearTimeout(g_timeoutSetState);\n      g_timeoutSetState = null;\n    }\n\n    g_timeoutSetState = setTimeout(function() {\n      g_timeoutSetState = null;\n\n      // Allow object as input to assist with debugging\n      var args = _.isObject(jsonArgs) ? jsonArgs : JSON.parse(jsonArgs);\n      g_lastState = args.state;\n      $window.trigger(CONNECTED_STATE_CHANGE_EVENT);\n    }, 100);\n  }\n\n  // Refresh the current settings values.\n  function HtmlCtrlInterface_RefreshSettings(jsonArgs) {\n    nextTick(function() {\n      var args = JSON.parse(jsonArgs);\n      refreshSettings(args.settings, true);\n\n      if (args.success){\n        if (args.reconnectRequired) {\n          // backend is reconnecting to apply the settings\n          displayCornerAlert($('#settings-apply-alert'));\n        }\n        else {\n          displayCornerAlert($('#settings-save-alert'));\n        }\n      }\n      // else an error occurred when saving settings... TODO: tell user?\n    });\n  }\n\n  // Indicate a DPI-based scaling change.\n  function HtmlCtrlInterface_UpdateDpiScaling(jsonArgs) {\n    DEBUG_LOG('HtmlCtrlInterface_UpdateDpiScaling called');\n\n    // Allow object as input to assist with debugging\n    var args = _.isObject(jsonArgs) ? jsonArgs : JSON.parse(jsonArgs);\n    nextTick(function() {\n      updateDpiScaling(args.dpiScaling);\n    });\n  }\n\n  // Handle UI deeplinks.\n  function HtmlCtrlInterface_Deeplink(jsonArgs) {\n    DEBUG_LOG('HtmlCtrlInterface_Deeplink called');\n\n    // Allow object as input to assist with debugging\n    var args = _.isObject(jsonArgs) ? jsonArgs : JSON.parse(jsonArgs);\n    nextTick(function() {\n      // NOTE: All deeplinks accepted here _must_ be listed in psiclient_ui.cpp::ALLOWED_DEEPLINKS\n\n      if (args.deeplink.startsWith('psiphon://psicash/buy')) {\n        switchToTab('#psicash-tab');\n        if (g_lastState === 'connected') {\n          buyPsiClick();\n        }\n      }\n      else if (args.deeplink.startsWith('psiphon://psicash') || args.deeplink.startsWith('psiphon://subscribe')) {\n        switchToTab('#psicash-tab');\n      }\n      else if (args.deeplink.startsWith('psiphon://feedback')) {\n        switchToTab('#feedback-tab');\n      }\n      else if (args.deeplink.startsWith('psiphon://settings/')) {\n        const section = args.deeplink.substring(args.deeplink.lastIndexOf('/')+1);\n        showSettingsSection(`#settings-accordion-${section}`);\n      }\n      else if (args.deeplink.startsWith('psiphon://settings')) {\n        switchToTab('#settings-tab');\n      }\n      else {\n        alert(args.deeplink);\n        HtmlCtrlInterface_Log('HtmlCtrlInterface_Deeplink: received unsupported deeplink');\n      }\n    });\n  }\n\n\n  /**\n   * Called from C code when something PsiCash-related occurs, such as a data refresh or\n   * purchase completion.\n   * @param {PsiCashMessageData|string} jsonArgs\n   */\n  function HtmlCtrlInterface_PsiCashMessage(jsonArgs) {\n    nextTick(function() {\n      DEBUG_LOG('HtmlCtrlInterface_PsiCashMessage', jsonArgs);\n\n      let args;\n      try {\n        // Allow object as input to assist with debugging\n        args = _.isObject(jsonArgs) ? jsonArgs : JSON.parse(jsonArgs);\n      }\n      catch(e) {\n        HtmlCtrlInterface_Log('HtmlCtrlInterface_PsiCashMessage: JSON parse failed: ' + e);\n        return;\n      }\n\n      switch (args.type) {\n        case PsiCashMessageTypeEnum.REFRESH:\n          // Payload is PsiCashRefreshData\n          $window.trigger(PsiCashEventTypeEnum.REFRESH, args.payload);\n          break;\n\n        case PsiCashMessageTypeEnum.NEW_PURCHASE:\n          // Payload is PsiCashPurchaseResponse\n          // Nothing special to be done; the promise will be resolved below\n          break;\n\n        case PsiCashMessageTypeEnum.INIT_DONE:\n          // Payload is PsiCashInitDoneData\n          $window.trigger(PsiCashEventTypeEnum.INIT_DONE, args.payload);\n          break;\n\n        case PsiCashMessageTypeEnum.LOGIN:\n          // Payload is PsiCashLoginResponse\n          // Nothing special to be done; the promise will be resolved below\n          break;\n\n        case PsiCashMessageTypeEnum.LOGOUT:\n          // Payload is PsiCashLogoutResponse\n          // Nothing special to be done; the promise will be resolved below\n          break;\n      }\n\n      // Resolve any promise that's awaiting this message/response.\n      if (args.id && !_.isUndefined(g_PsiCashCommandIDToResolver[args.id])) {\n        // Trigger a unique event so that the waiting promise can be resolved.\n        g_PsiCashCommandIDToResolver[args.id].call(null, args.payload);\n        delete g_PsiCashCommandIDToResolver[args.id];\n      }\n    });\n  }\n\n  /* Calls from JS code to C code. */\n\n  // Let the C code know that the UI is ready.\n  function HtmlCtrlInterface_AppReady() {\n    nextTick(function() {\n      commandAppOperation('ready');\n\n      $window.trigger(UI_READY_EVENT);\n    });\n  }\n\n  // Give the C code a string table entry in the appropriate language.\n  // `locale` is the locale for this string table.\n  // The `stringtable` can and should be a full set of key:string mappings, but\n  // the strings will be sent to the C code one at a time, to prevent URL size\n  // overflow.\n  function HtmlCtrlInterface_AddStringTableItem(locale, stringtable) {\n    for (var key in stringtable) {\n      if (!stringtable.hasOwnProperty(key)) {\n        continue;\n      }\n\n      var item = {\n        locale: locale,\n        key: key,\n        string: stringtable[key]\n      };\n      sendStringTableItem(item);\n    }\n\n    function sendStringTableItem(itemObj) {\n      nextTick(function() {\n        commandAppOperation('stringtable', itemObj);\n      });\n    }\n  }\n\n  /**\n   * Add a log entry to the log pane.\n   */\n  function HtmlCtrlInterface_Log() {\n    const msg = Array.prototype.slice.call(arguments).join(' ');\n    nextTick(function() {\n      commandAppOperation('log', msg);\n    });\n  }\n\n  // Connection should start.\n  function HtmlCtrlInterface_StartTunnel() {\n    // Prevent duplicate state change attempts\n    if (g_lastState === 'starting' || g_lastState === 'connected') {\n      return;\n    }\n    nextTick(function() {\n      commandAppOperation('start');\n    });\n  }\n\n  // Connection should stop.\n  function HtmlCtrlInterface_StopTunnel() {\n    // Prevent duplicate state change attempts\n    if (g_lastState === 'stopping' || g_lastState === 'disconnected') {\n      return;\n    }\n    nextTick(function() {\n      commandAppOperation('stop');\n    });\n  }\n\n  // The tunnel should be reconnected (if connected or connecting).\n  function HtmlCtrlInterface_ReconnectTunnel(suppressHomePage) {\n    // Prevent duplicate state change attempts\n    if (g_lastState === 'stopping' || g_lastState === 'disconnected') {\n      return;\n    }\n    nextTick(function() {\n      commandAppOperation('reconnect', `suppress=${suppressHomePage ? '1' : '0'}`);\n      if (IS_BROWSER) {\n        alert('Tunnel reconnected requested');\n      }\n    });\n  }\n\n  // Settings should be saved.\n  function HtmlCtrlInterface_SaveSettings(settingsJSON) {\n    nextTick(function() {\n      commandAppOperation('savesettings', settingsJSON);\n      if (IS_BROWSER) {\n        // DEBUG: Make it appear to behave like a real client\n        _.delay(HtmlCtrlInterface_RefreshSettings, 100, JSON.stringify({\n          settings: JSON.parse(settingsJSON),\n          success: true,\n          reconnectRequired: g_lastState === 'connected' || g_lastState === 'starting'\n        }));\n      }\n    });\n  }\n\n  // Feedback should be sent.\n  function HtmlCtrlInterface_SendFeedback(feedbackJSON) {\n    nextTick(function() {\n      commandAppOperation('sendfeedback', feedbackJSON);\n    });\n  }\n\n  // Cookies (i.e., UI settings) should be saved.\n  function HtmlCtrlInterface_SetCookies(cookiesJSON) {\n    nextTick(function() {\n      commandAppOperation('setcookies', cookiesJSON);\n    });\n  }\n\n  // Banner was clicked.\n  function HtmlCtrlInterface_BannerClick() {\n    nextTick(function() {\n      commandAppOperation('bannerclick');\n      if (IS_BROWSER) {\n        alert('Call from JS to C to launch banner URL');\n      }\n    });\n  }\n\n  /**\n   * Called when a \"disallowed traffic\" server alert is encountered. The C code will take\n   * steps to make the window visible.\n   */\n  function HtmlCtrlInterface_DisallowedTraffic() {\n    nextTick(function() {\n      commandAppOperation('disallowedtraffic');\n      if (IS_BROWSER) {\n        alert('Call from JS to C in response to disallowed traffic');\n      }\n    });\n  }\n\n  /**\n   * Used to communicate Promise resolvers between HtmlCtrlInterface_PsiCashCommand (called\n   * locally) and HtmlCtrlInterface_PsiCashMessage (called from C code).\n   * NOTE: Ideally this would be a map, but our restrictive environment doesn't support them.\n   * @type {Map<string, function>}\n   */\n  let g_PsiCashCommandIDToResolver = {};\n\n  /**\n   * A PsiCash \"command\" should be executed, like purchasing speed boost or refreshing state.\n   * Returns a promise that will be resolved when the command completes.\n   * @param {!PsiCashCommandBase} command\n   * @returns {Promise}\n   */\n  function HtmlCtrlInterface_PsiCashCommand(command) {\n    let promise = new Promise((resolve) => {\n      g_PsiCashCommandIDToResolver[command.id] = resolve;\n\n      nextTick(function() {\n        commandAppOperation('psicash', command);\n\n        if (IS_BROWSER) {\n          const commandToTestResponse = {\n            [PsiCashCommandEnum.REFRESH]: testRefreshResponse,\n            [PsiCashCommandEnum.PURCHASE]: testPurchaseResponse,\n            [PsiCashCommandEnum.LOGIN]: testAccountLoginResponse,\n            [PsiCashCommandEnum.LOGOUT]: testAccountLogoutResponse\n          };\n          commandToTestResponse[command.command](command);\n        }\n      });\n    });\n\n    return promise;\n  }\n\n  /* EXPORTS */\n\n  // The C interface code is unable to access functions that are members of objects,\n  // so we'll need to directly expose our exports.\n\n  window.HtmlCtrlInterface_AddLog = HtmlCtrlInterface_AddLog; // @ts-ignore\n  window.HtmlCtrlInterface_SetState = HtmlCtrlInterface_SetState;\n  window.HtmlCtrlInterface_AddNotice = HtmlCtrlInterface_AddNotice;\n  window.HtmlCtrlInterface_RefreshSettings = HtmlCtrlInterface_RefreshSettings;\n  window.HtmlCtrlInterface_UpdateDpiScaling = HtmlCtrlInterface_UpdateDpiScaling;\n  window.HtmlCtrlInterface_Deeplink = HtmlCtrlInterface_Deeplink;\n  window.HtmlCtrlInterface_PsiCashMessage = HtmlCtrlInterface_PsiCashMessage;\n\n  })(window);\n"],"file":"app.js"}